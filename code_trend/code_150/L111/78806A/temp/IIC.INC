STD_MODE
T_HOLDSTART	==	4
T_LOW		==	5
T_HIGH		==	4
T_RESTART	==	5
T_HOLDDATA	==	5


IIC	MACRO	SLAVE_ADDR,IO_PORT,SCL,SDA,IIC_FG,RX_BUF,TX_BUF,IIC_TEMP

IIC_SEND:
	MOV	IIC_TEMP,@8
IIC_SEND_1:
	CALL	DELAY_1US
	RLC	TX_BUF
	JC	IIC_SEND_2
	CRAM	IO_PORT,SDA
	JMP	IIC_SEND_3
IIC_SEND_2:
	SRAM	IO_PORT,SDA
IIC_SEND_3:
	SRAM	IO_PORT,SCL
	CALL	DELAY_1US
	CRAM	IO_PORT,SCL
	DEC	IIC_TEMP
	JNZ	IIC_SEND_1
	RET

IIC_RECEIVE:
	CALL	SDA_IN
	MOV	IIC_TEMP,@8
IIC_RECEIVE_1:
	SRAM	IO_PORT,SCL
	CALL	DELAY_1US
	CLRC
	JPNB	IO_PORT,SDA,IIC_RECEIVE_2
	SETC
IIC_RECEIVE_2:
	RLC	RX_BUF
	CRAM	IO_PORT,SCL
	CALL	DELAY_1US
	DEC	IIC_TEMP
	JNZ	IIC_RECEIVE_1
	CALL	SDA_OUT
	RET

IIC_START:
	SRAM	IO_PORT,SDA
	SRAM	IO_PORT,SCL
	CALL	DELAY_1US
	CRAM	IO_PORT,SDA
	CALL	DELAY_1US
	CRAM	IO_PORT,SCL
	RET

IIC_STOP:
	CRAM	IO_PORT,SDA
	SRAM	IO_PORT,SCL
	CALL	DELAY_1US
	SRAM	IO_PORT,SDA
	CALL	DELAY_1US
	RET

