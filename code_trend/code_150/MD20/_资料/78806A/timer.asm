
TIMER_DRV:
	BANK	0
	;CALL	CHECK_WEEK
	CALL	CHECK_DAY
	SUB	A,DAY_REG
	JPNZ	TIMER_DRV_RET
	MOV	DAY_REG,@1
	INC	MONTH_REG
	SUBA	MONTH_REG,@13
	JPNZ	TIMER_DRV_RET
	MOV	MONTH_REG,@1
	INC	YEAR_REG

TIMER_DRV_RET:
	RET

CHECK_WEEK:
	SUBA	WEEK_REG,@0
	JPNZ	CHECK_REG_1
	MOV	WEEK_REG,@7
	JMP	CHECK_REG_RET
CHECK_REG_1:
	SUBA	WEEK_REG,@8
	JPNZ	CHECK_REG_RET
	MOV	WEEK_REG,@1
CHECK_REG_RET:
	RET

CHECK_DAY:
	MOV	A,MONTH_REG
	CALL	MONTH_TAB
	MOV	TEMP0,A
	JPB	SYS_FG,LEEP_YEAR,CHECK_DAY_RET
	SUBA	MONTH_REG,@2
	JPNZ	CHECK_DAY_RET
	ADD	TEMP0,@1
CHECK_DAY_RET:
	MOV	A,TEMP0
	RET

MONTH_TAB:
	TBL
	RETL	@0
	RETL	@(31+1)
	RETL	@(28+1)
	RETL	@(31+1)
	RETL	@(30+1)
	RETL	@(31+1)
	RETL	@(30+1)
	RETL	@(31+1)
	RETL	@(31+1)
	RETL	@(30+1)
	RETL	@(31+1)
	RETL	@(30+1)
	RETL	@(31+1)
