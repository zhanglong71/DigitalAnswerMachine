
****************************************************************
*                                                              *
*           MXIC DSP MX93011A CROSS-ASSEMBLER REV 1.2          *
*                                                              *
****************************************************************
[line,address,code]                  [label/instruction/comment]

    1A                  ;//2006.01.17-------------------------------------------------------------------
    2A                  ;//2006.11.29-4B5E--------------------------------------------------------------
    3A                  ;MX93L111S2
    4A                  ;TMR1;用于时间更新DateTime(0--1000)
    5A                  ;TMR2;用于key detect
    6A                  ;TMR3;用于ring detect
    7A                  ;PRO_VAR = 
    8A                  ;ANN_FG :	bit0=
    9A                  ;		bit1=
   10A                  ;		bit2=	1/0-------current OGM exist/not
   11A                  ;		bit3=	0/1 = OGM1/OGM2(select vp and status)
   12A                  ;		bit4=
   13A                  ;		bit5=
   14A                  ;               -------------------------
   15A                  ;		bit6=
   16A                  ;
   17A                  ;		bit7=	0,remote operation-DTMF end
   18A                  ;			1,remote operation-DTMF happened---(DTMF detected process for"busy_chk")
   19A                  ;		bit8=
   20A                  ;		bit9=
   21A                  ;			
   22A                  ;		bit10=	
   23A                  ;			
   24A                  ;		bit11=	
   25A                  ;
   26A                  ;
   27A                  ;		bit12=	0/1---no/new messages(current mailbox current message type)---(STATUS_CHK)
   28A                  ;
   29A                  ;		bit13=	0,not memory full---(STATUS_CHK)
   30A                  ;			1,memory full
   31A                  ;		bit14=	0,no message---(current mailbox current message type)
   32A                  ;			1,have message
   33A                  ;		bit15=
   34A                  ;		--------------------------
   35A                  ;EVENT :	bit0=	1/0------speakerphone/not	;LED FLASH
   36A                  ;		bit1=	1/0------record(memo/OGM)
   37A                  ;		bit2=	1/0------play(memo/OGM/VoicePrompt)
   38A                  ;		bit3=	1/0------remote/local
   39A                  ;		bit4=	1/0------line mode/not
   40A                  ;		bit5=	1/0------beep mode/not
   41A                  ;		bit6=	1/0------vp mode/not
   42A                  ;		bit7=	1/0------record mode/not
   43A                  ;		bit8=	1/0------answer only/ICM(flag)
   44A                  ;		bit9=	1/0------answer on/off
   45A                  ;		bit10=	
   46A                  ;		bit11=
   47A                  ;		bit12=	0/1------ring in no/ok
   48A                  ;		bit13=	0/1------for test model(beening pressed/realeased)
   49A                  ;		bit14=	
   50A                  ;		bit15=
   51A                  ;		--------------------------
   52A                  ;IPTR :		bit0 = 0/1/0==>1---TEST MODEL(reset)/NO TEST MODEL(reset)/CMSG_TEST
   53A                  ;
   54A                  ;BIOR :		bit(1,0)----- (10=2),(01=6),(11=2/6) 铃声
   55A                  ;		bit2 = 0/1--- ICM/only
   56A                  ;		bit3 = 
   57A                  ;		bit(6,5,4)--- SIO(clk,wr,dat)
   58A                  ;		bit7 = 
   59A                  ;		--------------------------
   60A                  ;OPTR :		bit10 --- BUSY
   61A                  ;		bit11 --- ACK
   62A                  ;		bit12 --- LED new messages
   63A                  ;		bit13 --- HOOK
   64A                  ;		bit14 --- 0/1(INDOOR MONITOR监听,正逻辑)
   65A                  ;//------------------------------------------------------------------------------
   66A                  
   67A                  .NOLIST
   73A                  
   74A                  ALC_ON		.EQU   		0
   75A                  MODE9		.EQU		0X9050
   76A                  GCVP_TLEN	.EQU   		1000	;录满了一次做GC_CHK的最长时间(ms)
   77A                  GCTEL_TLEN	.EQU   		1000	;录满了一次做GC_TEL_CHK的最长时间(ms)
   78A                  CPC_TLEN	.EQU   		201	;CPC检测的有效宽度
   79A                  
   80A                  TEXT_IVOP	.EQU   		0	;0
   81A                  TEXT_EVOP	.EQU   		0	;1
   82A                  TEXT_FVOP	.EQU   		1	;0
   83A                  
   84A                  TEXT_m58	.EQU   		0	;1/0 = 有/无CID
   85A                  TEXT_WR		.EQU   		1	;有效脚位起作用,通迅用
   86A                  TEXT_RING_CHK	.EQU   		0	;1/0 = 有/无中断来铃检测
   87A                  TEXT_KSCAN	.EQU   		0	;1===>同时将BUSY_H/L屏蔽
   88A                  TEXT_SIOVP	.EQU   		0	;0===>接收命令测试
   89A                  TEXT_VOP	.EQU   		0	;0/1===>没/有一般性的语音提示
   90A                  TEXT_0X9051	.EQU   		0	;0===>format
   91A                  TEXT_0XE900	.EQU   		0
   92A                  TEXT_CLOCK	.EQU   		0	;0===>不用模拟CLOCK
   93A                  TEXT_WTELNUM	.EQU   		0	;0===>不用模拟写号码
   94A                  TEXT_OUTTELNUM	.EQU   		0	;0===>不用模拟读出发送号码
   95A                  
   96A                  DAM_BIOS  	.EQU   		0X20
   97A                  ;//==============================================================================
   98A                  ;//+                        DAM DEMO PROGRAM                                    +
   99A                  ;//==============================================================================
  100A                  
  101A      C000        .ORG    0XC000
  102A C000 12345678    .DATA   0X1234  0X5678
  103A                  
  104A C002 DF00C337            BS      B1,MAIN          ;// ORG=0X00
  105A C004 DF00C334            BS      B1,INT_NMI       ;// ORG=0X02
  106A C006 DF00C335            BS      B1,INT_SS        ;// ORG=0X04
  107A C008 DF00C336            BS      B1,INT_1         ;// ORG=0X06
  108A C00A DF00C014            BS      B1,INT_CODEC     ;// ORG=0X08
  109A C00C DF00C332            BS      B1,INT_HOSTW     ;// ORG=0X0A
  110A C00E DF00C333            BS      B1,INT_HOSTR     ;// ORG=0X0C
  111A C010 DF00C02A            BS      B1,INT_STMR      ;// ORG=0X0E
  112A                  
  113A C012 01110100    .DATA   0X0111  0X0100           ; MX93L111-version 01.00   ;0x5010(2005.11.10)
  114A                  ;-----------------------------------------------------------/ ??
  115A                  INT_CODEC:
  116A C014 1500                ldpk    0
  117A C015 600C                bit     FLAG2531_0,0
  118A C016 D200C021            bz      TB,SkipSetCodec
  119A C018 0E0C                lac     FLAG2531_0
  120A C019 8580FFFE            andl    0xfffe			;// bit0 in FLAG2531_0 set 0
  121A C01B B00C                sah     FLAG2531_0
  122A C01C 1330                lipk    3
  123A C01D 400D                out    CODECREG0,CDCTLR0
  124A C01E 420E                out    CODECREG1,CDCTLR1
  125A C01F 440F                out    CODECREG2,CDCTLR2
  126A C020 1300                LIPK	0
  127A                  SkipSetCodec:
  128A C021 FC00D5C2    	CALL	C_SIO		;计时
  129A                  	
  130A C023 FC00D5D4    	CALL	SIO_DET		;检测发送或接收请求
  131A                  	
  132A C025 FC00D617    	CALL	C_INT1		;执行发送或接收任务
  133A                  	
  134A C027 FC00D624    	CALL	CLOCK		;侦测CLK
  135A                  
  136A C029 F800                RET
  137A                  
  138A                  ;-------------------------------------------------------
  139A                  INT_STMR:
  140A C02A 1500        	LDPK	0
  141A C02B 1300        	LIPK	0
  142A                  				
  143A C02C 0E21        	LAC     TMR1		;//用于DateTime(0--1000)
  144A C02D 0101                ADHK    0X01
  145A C02E B021                SAH     TMR1
  146A                          
  147A C02F 0E21                LAC     TMR1
  148A C030 0B03                ANDK	0X03
  149A C031 D300C036            BZ	ACZ,INT_STMR1
  150A                          
  151A C033 0E27                LAC     TMR_BTONE	;//for BUSY TONE(+1/4ms)
  152A C034 0101                ADHK    0X01
  153A C035 B027                SAH     TMR_BTONE
  154A                  INT_STMR1:
  155A                  		
  156A C036 0E26        	LAC	TMR_VOX		;//for VOX detection(-1/ms)
  157A C037 0501        	SBHK	0X01
  158A C038 B026        	SAH	TMR_VOX
  159A                  
  160A C039 0E28        	LAC	TMR_CTONE	;//for CONT TONE or GC_CHK(-1/ms)
  161A C03A 0501        	SBHK	0X01
  162A C03B B028        	SAH	TMR_CTONE
  163A                  
  164A C03C 0E23        	LAC	TMR3		;//for ring detection(-1/ms)
  165A C03D 0501        	SBHK	0X01
  166A C03E B023        	SAH	TMR3
  167A                  		
  168A C03F 0E22        	LAC	TMR2		;//used to scan and LED display(+1/ms)
  169A C040 0101        	ADHK	0X01
  170A C041 B022        	SAH	TMR2
  171A                  	
  172A C042 0E22        	LAC	TMR2
  173A C043 050C        	SBHK	0X0C
  174A C044 DD00C049    	BS	SGN,INT_STMR2		 
  175A C046 B022        	SAH	TMR2		;//reset TMR2
  176A C047 FC00C28C    	call    DateTime	;//execute every 12ms
  177A                  INT_STMR2:
  178A                  ;//------ BELOWS ARE FOR LEDS DISPLAY AND KEY SCAN ----------------------------
  179A                  
  180A                  ;-------belows are for long of beep time,end beep when TMR_BEEP=0--------- 
  181A                  INT_T_BEEP:
  182A C049 0E2A        	LAC	TMR_BEEP
  183A C04A DD00C054    	BS	SGN,INT_T_BEEP_END
  184A                  	;LAC	TMR_BEEP
  185A C04C 0501        	SBHK	1
  186A C04D B02A        	SAH	TMR_BEEP
  187A C04E D300C054    	BZ	ACZ,INT_T_BEEP_END
  188A C050 87800093    	LACL	CSEG_END
  189A C052 FC00CC09    	CALL	INT_STOR_MSG
  190A                  INT_T_BEEP_END:
  191A                  ;-------belows are for timer----------------------------------------------
  192A                  INT_T_TIMER:
  193A C054 0E2C        	LAC	TMR_BAK
  194A C055 DB00C066    	BS	ACZ,INT_T_TIMER_END
  195A C057 0E20        	LAC	TMR
  196A C058 0501        	SBHK	1
  197A C059 B020        	SAH	TMR
  198A C05A D300C066    	BZ	ACZ,INT_T_TIMER_END
  199A C05C 0E2C        	LAC	TMR_BAK
  200A C05D B020        	SAH	TMR
  201A C05E 87800090    	LACL	CMSG_TMR
  202A C060 FC00CC09    	CALL	INT_STOR_MSG
  203A C062 87800094    	LACL	CMSG_TMR2
  204A C064 FC00CC09    	CALL	INT_STOR_MSG	
  205A                  INT_T_TIMER_END:
  206A                  ;-------belows are for LED----------------------------------------------
  207A                  INT_LED_TIMER:
  208A C066 0E25        	LAC	TMR_LED_BAK
  209A C067 DB00C074    	BS	ACZ,INT_LED_TIMER_END
  210A C069 0E24        	LAC	TMR_LED
  211A C06A 0501        	SBHK	1
  212A C06B B024        	SAH	TMR_LED
  213A C06C D300C074    	BZ	ACZ,INT_LED_TIMER_END
  214A C06E 0E25        	LAC	TMR_LED_BAK
  215A C06F B024        	SAH	TMR_LED
  216A C070 87800091    	LACL	CMSG_LED
  217A C072 FC00CC09    	CALL	INT_STOR_MSG	
  218A                  INT_LED_TIMER_END:
  219A                  ;-------belows are for cpc-det--------------------------------------------
  220A                  INT_CPC_DET:
  221A C074 1300        	lipk    0
  222A C075 A02E                IN	INT_TTMP1,OPTR
  223A C076 6D2E                BIT	INT_TTMP1,13
  224A C077 D200C09A    	BZ	TB,INT_CPC_DET5
  225A                  	
  226A C079 0E2B        	LAC	TMR_CPC
  227A C07A 828000C9    	SBHL	CPC_TLEN
  228A C07C D500C095    	BZ	SGN,INT_CPC_DET4
  229A                  	
  230A C07E 1300        	LIPK	0
  231A C07F A42E        	IN	INT_TTMP1,IPTR
  232A C080 662E        	BIT	INT_TTMP1,6
  233A C081 D200C08A    	BZ	TB,INT_CPC_DET2
  234A                  INT_CPC_DET1:
  235A C083 0E2B        	LAC     TMR_CPC
  236A C084 0501                SBHK    1
  237A C085 B02B                SAH     TMR_CPC
  238A C086 DB00C08F            BS	ACZ,INT_CPC_DET3
  239A C088 DF00C09F    	BS	B1,INT_CPC_DET_END
  240A                  INT_CPC_DET2:
  241A C08A 878000C9    	LACL	CPC_TLEN
  242A C08C B02B        	SAH	TMR_CPC
  243A                  
  244A C08D DF00C09F    	BS	B1,INT_CPC_DET_END
  245A                  INT_CPC_DET3:	
  246A C08F 8780008B    	LACL	CMSG_CPC
  247A C091 FC00CC09    	CALL	INT_STOR_MSG
  248A C093 DF00C09F    	BS	B1,INT_CPC_DET_END
  249A                  INT_CPC_DET4:
  250A C095 0E2B        	LAC	TMR_CPC
  251A C096 0501        	SBHK	1
  252A C097 B02B        	SAH	TMR_CPC		
  253A C098 DF00C09F    	BS	B1,INT_CPC_DET_END
  254A                  ;-------no remote
  255A                  INT_CPC_DET5:
  256A C09A 8780044C    	LACL	1100
  257A C09C B02B        	SAH	TMR_CPC
  258A C09D DF00C09F    	BS	B1,INT_CPC_DET_END
  259A                  INT_CPC_DET_END:
  260A                  ;-------belows are for memoful--------------------------------------------
  261A                  INT_MEMFUL_DET:
  262A C09F 6D11        	BIT	ANN_FG,13
  263A C0A0 D200C0A6    	BZ	TB,INT_MEMFUL_DET_L
  264A                  INT_MEMFUL_DET_H:
  265A C0A2 FC00C1D3    	CALL	BUSY_L			;告诉memory full
  266A C0A4 DF00C0A8    	BS	B1,INT_MEMFUL_DET_END
  267A                  INT_MEMFUL_DET_L:
  268A C0A6 FC00C1D0    	CALL	BUSY_H
  269A                  INT_MEMFUL_DET_END:			
  270A                  ;-------------------------------------------------------------------------
  271A                  ACK_DET:
  272A C0A8 0E10        	LAC	EVENT			;EVENT(bit3,2,1)
  273A C0A9 8580000E    	ANDL	0X0E
  274A C0AB DB00C0B1    	BS	ACZ,ACK_DET1
  275A C0AD FC00CAE3    	CALL	ACK_L
  276A C0AF DF00C0B3    	BS	B1,ACK_DET_END
  277A                  ACK_DET1:
  278A C0B1 FC00CAE0    	CALL	ACK_H	
  279A                  ACK_DET_END:
  280A                  ;-------------------------------------------------------------------------
  281A                  ;	(IPTR.0 = 1)&(EVENT.13 = 1) 或 (IPTR.0 = 0)|(EVENT.13 = 0)表示无事件,TMR_KEY清零
  282A                  ;	(IPTR.0 = 0)&(EVENT.13 = 1) 持续10ms 表示有键按下,EVENT.13清0
  283A                  ;	(IPTR.0 = 1)&(EVENT.13 = 0) 持续10ms 表示有键松开,EVENT.13置1
  284A                  ;
  285A                  ;---要求初始值相同(IPTR.0 = 0)&(EVENT.13 = 0) 或 (IPTR.0 = 1)&(EVENT.13 = 1)
  286A                  ;-------------------------------------------------------------------------------
  287A                  TEST_DET:
  288A C0B3 1300        	LIPK	0
  289A C0B4 A42E        	IN	INT_TTMP1,IPTR
  290A C0B5 602E        	BIT	INT_TTMP1,0
  291A C0B6 DA00C0C8    	BS	TB,TEST_DET_H
  292A                  TEST_DET_L:
  293A C0B8 6D10        	BIT	EVENT,13
  294A C0B9 D200C0D8    	BZ	TB,TEST_DET1	;状态保持
  295A                  ;---H==>L	
  296A C0BB 0E29        	LAC	TMR_KEY
  297A C0BC 0101        	ADHK	1
  298A C0BD B029        	SAH	TMR_KEY		;按下时间计数
  299A                  	
  300A C0BE 050A        	SBHK	10
  301A C0BF DD00C0DA    	BS	SGN,TEST_DET_END	;KEY PRESSED time > 10ms?
  302A                  
  303A C0C1 878000B4    	LACL	CMSG_TESTD	;test key PRESSED
  304A C0C3 FC00CC09    	CALL	INT_STOR_MSG
  305A                  	
  306A C0C5 ED10        	CRAM	EVENT,13
  307A C0C6 DF00C0DA    	BS	B1,TEST_DET_END
  308A                  ;---------------------------------------
  309A                  TEST_DET_H:
  310A C0C8 6D10        	BIT	EVENT,13
  311A C0C9 DA00C0D8    	BS	TB,TEST_DET1	;状态保持
  312A                  ;---L==>H	
  313A C0CB 0E29        	LAC	TMR_KEY
  314A C0CC 0101        	ADHK	1
  315A C0CD B029        	SAH	TMR_KEY		;松开时间计数
  316A                  
  317A C0CE 050A        	SBHK	10
  318A C0CF DD00C0DA    	BS	SGN,TEST_DET_END	;KEY release time > 10ms?
  319A                  
  320A C0D1 878000B3    	LACL	CMSG_TEST
  321A C0D3 FC00CC09    	CALL	INT_STOR_MSG	;test key released
  322A                  	
  323A C0D5 ED90        	SRAM	EVENT,13
  324A C0D6 DF00C0DA    	BS	B1,TEST_DET_END
  325A                  TEST_DET1:
  326A                  
  327A C0D8 0F00        	LACK	0
  328A C0D9 B029        	SAH	TMR_KEY
  329A                  TEST_DET_END:
  330A                  ;-------------------------------------------------------------------------
  331A                  	;MOD     IMODR
  332A C0DA F800        	RET
  333A                  ;//-----------------------------------------------------------------------
  334A                  
  335A                  
  336A                  ;----------------------------------------------------------------------------
  337A                  
  338A                  SetFlashWaitState:
  339A C0DB 1310                LIPK    0X01
  340A C0DC A05F                IN      SYSTMP1,WSTR
  341A C0DD 0E5F                LAC     SYSTMP1
  342A C0DE 8580F038    	ANDL    0xf038
  343A C0E0 848008C3            ORL     0x08C3
  344A C0E2 B05F                SAH     SYSTMP1
  345A C0E3 405F                OUT     SYSTMP1,WSTR
  346A C0E4 1300                LIPK	0
  347A C0E5 F800                RET
  348A                  ;//-----------------------------------------------------------
  349A                  ;//===========================================
  350A                  SetDspRunMode:               ;// dsp in fast/slow mode
  351A C0E6 1300                LIPK    0X0          ;// for 2523 set fast mode
  352A C0E7 A85F                in      SYSTMP1,CTLR
  353A C0E8 0E5F                lac     SYSTMP1
  354A C0E9 84803100            orl     0x3100       ;// fastmode+enable codec
  355A C0EB B05F                sah     SYSTMP1
  356A C0EC 485F                Out     SYSTMP1,CTLR
  357A                  WaitCodecRdy:
  358A C0ED A85F                in      SYSTMP1,CTLR
  359A C0EE 0E5F                lac     SYSTMP1
  360A C0EF 695F                bit     SYSTMP1,9
  361A C0F0 DA00C0ED            bS      TB,WaitCodecRdy
  362A C0F2 F800                RET
  363A                  ;//----------------------------------------------------------------------------
  364A                  SET_MSGTYPE:
  365A C0F3 8780D000    	LACL	0XD000
  366A C0F5 B000        	SAH	CONF
  367A C0F6 FC000020    	CALL	DAM_BIOS
  368A                  	
  369A C0F8 8780D200    	LACL	0XD200
  370A C0FA B000        	SAH	CONF
  371A C0FB FC000020    	CALL	DAM_BIOS
  372A                  	
  373A C0FD F800        	RET
  374A                  ;----------------------------------------------------------------------------
  375A                  ;       Function : GET_TOTALMSG
  376A                  ;	input  : no
  377A                  ;	output : ACCH = the number of total messages
  378A                  ;----------------------------------------------------------------------------
  379A                  GET_TOTALMSG:
  380A C0FE 87803000    	LACL    0X3000
  381A C100 B000                SAH     CONF
  382A C101 FC000020            CALL    DAM_BIOS
  383A C103 0E01                LAC     RESP
  384A C104 858000FF            ANDL	0XFF
  385A C106 B016                SAH	MSG_T
  386A                  
  387A C107 F800        	RET
  388A                  
  389A                  ;----------------------------------------------------------------------------
  390A                  ;       Function : MSG_CHK
  391A                  ;       Check some FLASH status:ANN_FG : bit0..15
  392A                  ;	input  : no
  393A                  ;	output : no
  394A                  ;	ANN_FG :
  395A                  ;		bit12=	0/1---no/new messages(current mailbox current message type)---(MSG_CHK)
  396A                  
  397A                  ;		bit13=	0,not memory full
  398A                  ;			1,memory full
  399A                  ;		bit14=	0,current mailbox have no message
  400A                  ;			1,current mailbox have message
  401A                  
  402A                  ;		MSG_T=	the number of TOTAL MESSAGE
  403A                  ;		MSG_N=	the number of NEW MESSAGE
  404A                  ;----------------------------------------------------------------------------
  405A                  MSG_CHK:
  406A C108 CA00                PSH     CONF
  407A                  ;-------get the new message number,save it in MSG_N--------------------------
  408A                  
  409A C109 FC00C0F3    	CALL	SET_MSGTYPE
  410A                  	
  411A                  MSG_CHK1:
  412A C10B EC91                SRAM	ANN_FG,12	;ANN_FG(bit12)=0/1---not have/have new message(current mbox,current type)
  413A                          
  414A C10C 87803001            LACL    0X3001
  415A C10E B000                SAH     CONF
  416A C10F FC000020            CALL    DAM_BIOS
  417A C111 0E01                LAC     RESP
  418A C112 B015                SAH     MSG_N		;save the number of NEW messages
  419A                         
  420A C113 D300C116            BZ      ACZ,MSG_CHK1_1
  421A                  
  422A C115 EC11        	CRAM	ANN_FG,12
  423A                  MSG_CHK1_1:
  424A                  ;-------get the total message number,save it in MSG_T---------------------
  425A                  MSG_CHK2:     
  426A C116 EE91        	SRAM	ANN_FG,14	;ANN_FG(bit14)=1/0---have/not have message(current mbox,current type)
  427A                  	
  428A C117 FC00C0FE            CALL    GET_TOTALMSG	;save the number of TOTAL messages
  429A                  
  430A C119 D300C11C            BZ	ACZ,MSG_CHK2_1
  431A                  
  432A C11B EE11                CRAM	ANN_FG,14
  433A                  MSG_CHK2_1:
  434A                  ;-------check if memory is full ?-----------------------------------------
  435A                  MSG_CHK3:
  436A C11C 0E16                LAC     MSG_T
  437A C11D 0563                SBHK    99		;check if the total message number >= 99 ?
  438A C11E D500C129            BZ      SGN,MSG_CHK3_1
  439A                  
  440A C120 87803003            LACL    0X3003		;check if memory is full ?
  441A C122 B000                SAH     CONF
  442A C123 FC000020            CALL    DAM_BIOS
  443A                  
  444A C125 0E01                LAC     RESP
  445A C126 0503               	SBHK	3
  446A C127 D500C12C            BZ      SGN,MSG_CHK3_2
  447A                  MSG_CHK3_1:	
  448A C129 ED91          	SRAM	ANN_FG,13
  449A C12A DF00C12D    	BS	B1,MSG_CHK3_3
  450A                  MSG_CHK3_2:
  451A C12C ED11        	CRAM	ANN_FG,13
  452A                  MSG_CHK3_3:
  453A                  ;------------------------------------------------------------------------------
  454A                  MSG_CHK_RET:
  455A                  ;------------------------------------------------------------------------------
  456A C12D B500                POP     CONF
  457A C12E F800                RET
  458A                  ;------------------------------------------------------------------------------
  459A                  ;	FUNCTION : LED_STATUS
  460A                  ;------------------------------------------------------------------------------
  461A                  LED_STATUS:
  462A C12F FC00C1E0    	CALL	CLR_LEDTIMER
  463A                  	
  464A C131 6C11        	BIT	ANN_FG,12
  465A C132 D200C13A    	BZ	TB,LED_STATUS1
  466A C134 8780012C    	LACL	300
  467A C136 FC00C1DD    	CALL	SET_LEDTIMER
  468A C138 DF00C13E    	BS	B1,LED_STATUS2
  469A                  LED_STATUS1:
  470A C13A 87800092    	LACL	CNO_NMSG
  471A C13C FC00CC19    	CALL	STOR_MSG
  472A                  	
  473A                  	
  474A                  	;CALL	LED_OFF
  475A                  LED_STATUS2:	
  476A C13E F800        	RET
  477A                  
  478A                  ;//----------------------------------------------------------------------------
  479A                  ;//       Function : WBEEP
  480A                  ;//
  481A                  ;//       Generate a warning beep
  482A                  ;//----------------------------------------------------------------------------
  483A                  WBEEP:
  484A C13F CA00                PSH     CONF              ;// push CONF to stack
  485A C140 CA07                PSH     BUF1              ;// push BUF1 to stack
  486A C141 CA08                PSH     BUF2              ;// push BUF2 to stack
  487A                  
  488A C142 87802063            LACL    0X2063            ;// 1700 Hz (1700 X 8.19)
  489A C144 B007                SAH     BUF1
  490A C145 FC00C155            CALL    WBEEP_ACT
  491A                  
  492A C147 87802C30            LACL    0X2C30            ;// 1600 Hz (1600 X 8.19)
  493A C149 B007                SAH     BUF1
  494A C14A FC00C155            CALL    WBEEP_ACT
  495A                  
  496A C14C 87803CC9            LACL    0X3CC9            ;// 1900 Hz (1900 X 8.19)
  497A C14E B007                SAH     BUF1
  498A C14F FC00C155            CALL    WBEEP_ACT
  499A                  
  500A C151 B508                POP     BUF2              ;// recover BUF2
  501A C152 B507                POP     BUF1              ;// recover BUF1
  502A C153 B500                POP     CONF              ;// recover CONF
  503A                  
  504A C154 F800                RET
  505A                  ;//----------------------------------------------------------------------------
  506A                  ;//       Function : WBEEP_ACT
  507A                  ;//
  508A                  ;//       The general function for beep generation
  509A                  ;//       Input  : BUF1=the beep frequency
  510A                  ;//----------------------------------------------------------------------------
  511A                  WBEEP_ACT:
  512A C155 878048FB            LACL    0X48FB            	;// beep start
  513A C157 B000                SAH     CONF
  514A C158 FC000020            CALL    DAM_BIOS
  515A                  
  516A C15A 0F3F                LACK    0X3F                	;// delay 63 ms
  517A C15B B02A                SAH     TMR_BEEP
  518A                  WBEEP_ACT1:
  519A C15C 0E2A                LAC     TMR_BEEP
  520A C15D D500C15C            BZ      SGN,WBEEP_ACT1
  521A                  
  522A C15F 87804400            LACL    0X4400            	;// beep stop
  523A C161 B000                SAH     CONF
  524A C162 FC000020            CALL    DAM_BIOS
  525A                  
  526A C164 F800                RET
  527A                  
  528A                  ;//----------------------------------------------------------------------------
  529A                  ;//       Function : DAA_SPK
  530A                  ;//       Change analog switches for SPK/RECORD play
  531A                  ;//----------------------------------------------------------------------------
  532A                  
  533A                  DAA_SPK:
  534A C165 F100                EINT
  535A C166 87800300            LACL    0X0300          	;// ATT1
  536A C168 B00D                SAH     CODECREG0
  537A                          
  538A C169 0E1E        	LAC	VOI_ATT
  539A C16A 85800007            ANDL	0X07
  540A C16C 8080C31A            ADHL    VOL_TAB
  541A C16E 1100                RPTK    0
  542A C16F CC64                TBR     SYSTMP
  543A C170 0E64                LAC     SYSTMP    
  544A C171 0901                ORK	0X01
  545A C172 B00F                SAH     CODECREG2
  546A C173 FC00C1BD            CALL    InSetCodecReg
  547A                  
  548A C175 F800        	RET
  549A                  ;//----------------------------------------------------------------------------
  550A                  ;//       Function : DAA_LINE_SPK
  551A                  ;//       Change analog switches for SPK play
  552A                  ;//----------------------------------------------------------------------------
  553A                  
  554A                  DAA_LINE_SPK:
  555A C176 F100                EINT
  556A C177 87800008            LACL    0X008          	;// SWL
  557A C179 B00D                SAH     CODECREG0
  558A                          
  559A C17A 87800800            LACL	0X0800
  560A C17C B00F                SAH     CODECREG2
  561A C17D FC00C1BD            CALL    InSetCodecReg
  562A                  
  563A C17F F800        	RET
  564A                  DAA_RECORD:
  565A                  ;.IF	ALC_ON
  566A C180 87804800    	LACL	0X4800			;ALC on
  567A                  ;.ELSE
  568A                          ;LACL    0X5800			;ALC off
  569A                  ;.ENDIF
  570A                          
  571A C182 B00D                SAH     CODECREG0
  572A                          ;LACL    0XC002
  573A                  	;LACL    0XA002
  574A C183 87807001    	LACL    0X7001
  575A C185 B00E                SAH     CODECREG1
  576A C186 FC00C1BD            call    InSetCodecReg
  577A                  
  578A C188 F800        	RET
  579A                  
  580A                  ;//---------------------------------------
  581A                  DAA_LIN_RECORD:
  582A                  ;.IF	ALC_ON	
  583A                  ;	LACL    0XCB08		;	ALC on
  584A                  ;.ELSE
  585A C189 8780DB08            LACL    0XDB08		;LIN==>SWC(b->A)==>SWD==>AD1;DA1==>SWF==>(ATT1)SWG==>SPK DRV
  586A                  ;.ENDIF
  587A C18B B00D                sah     CODECREG0
  588A                          ;LACL    0XEFE2
  589A C18C 8780EFB3            LACL    0XEFB3
  590A C18E B00E                sah     CODECREG1
  591A C18F 87800182            LACL	0X0182
  592A C191 B00F                SAH	CODECREG2
  593A                  
  594A C192 FC00C1CA            CALL	HOOK_ON
  595A C194 FC00C1BD            call    InSetCodecReg
  596A                          
  597A C196 F800                RET
  598A                  DAA_ICM_RECORD:
  599A                  ;.IF	ALC_ON
  600A                  ; 	LACL    0XCB00
  601A                  ;.ELSE
  602A C197 8780DB00            LACL    0XDB00
  603A                  ;.ENDIF
  604A C199 B00D                sah     CODECREG0
  605A                          ;LACL    0XEFE2
  606A C19A 8780EFB3            LACL    0XEFB3
  607A C19C B00E                sah     CODECREG1
  608A                  ;.IF	ALC_ON
  609A                  ;        LACL	0X0482
  610A                  ;.ELSE
  611A C19D 87800482            LACL	0X0482
  612A                  ;.ENDIF
  613A C19F B00F                SAH	CODECREG2
  614A                  
  615A C1A0 FC00C1CA            CALL	HOOK_ON
  616A C1A2 FC00C1BD            call    InSetCodecReg
  617A                          
  618A C1A4 F800                RET
  619A                  ;----------------------------------------------------------------
  620A                  DAA_TWAY_RECORD:
  621A                  ;.IF	ALC_ON
  622A                  ;	LACL    0XC800
  623A                  ;.ELSE	
  624A C1A5 8780D800    	LACL    0XD800		;关SPK
  625A                  ;.ENDIF
  626A C1A7 B00D                SAH     CODECREG0
  627A                          ;LACL    0XEFE2
  628A C1A8 8780EFB3            LACL    0XEFB3
  629A C1AA B00E                SAH     CODECREG1
  630A                  
  631A C1AB 87800462           	LACL	0X0462
  632A C1AD B00F                SAH	CODECREG2
  633A                          
  634A C1AE FC00C1BD            CALL    InSetCodecReg
  635A C1B0 F800                RET
  636A                  
  637A                  ;----------------------------------------------------------------
  638A                  DAA_ROM_MOR:
  639A C1B1 87804060    	LACL    0X4060			;MIC==>SWC(a->A)==>SWJ==>LIN DRV
  640A C1B3 B00D                SAH     CODECREG0
  641A                          ;LACL    0XE0D2
  642A C1B4 8780A002            LACL    0XA002
  643A C1B6 B00E                SAH     CODECREG1
  644A C1B7 87800800            LACL	0X0800
  645A C1B9 B00F                SAH	CODECREG2
  646A C1BA FC00C1BD            CALL    InSetCodecReg
  647A C1BC F800                RET
  648A                  ;----------------------------------------------------------------
  649A                  
  650A                  InSetCodecReg:
  651A C1BD 0E0C                lac     FLAG2531_0
  652A C1BE 0901                ork     1
  653A C1BF B00C                sah     FLAG2531_0
  654A                  StillInSetCodec:
  655A                  CheckSetCodecOk:
  656A C1C0 600C                bit     FLAG2531_0,0
  657A C1C1 DA00C1C0            bs      TB,StillInSetCodec
  658A C1C3 F800                RET
  659A                  
  660A                  
  661A                  ;//----------------------------------------------------------------------------
  662A                  ;//       Function : DAA_OFF
  663A                  ;//
  664A                  ;//       Change analog switches for LOCAL/LINE off
  665A                  ;//----------------------------------------------------------------------------
  666A                  DAA_OFF:
  667A C1C4 87800300            LACL    0X0300		;SWF/SWG(A)
  668A C1C6 B00D                sah     CODECREG0
  669A                     
  670A C1C7 FC00C1BD            call    InSetCodecReg
  671A                          
  672A C1C9 F800                RET
  673A                  ;//----------------------------------------------------------------------------
  674A                  ;//       Function : HOOK_ON
  675A                  ;//
  676A                  ;//       hand on the telephone
  677A                  ;//----------------------------------------------------------------------------
  678A                  HOOK_ON:
  679A C1CA 1300        	lipk    0
  680A C1CB A30D        	SIO	13,OPTR		;HOOK ON----OPTR(bit13)
  681A                  	
  682A C1CC F800        	RET
  683A                  ;//----------------------------------------------------------------------------
  684A                  ;//       Function : HOOK_OFF
  685A                  ;//
  686A                  ;//       hand off the telephone
  687A                  ;//----------------------------------------------------------------------------
  688A                  HOOK_OFF:
  689A C1CD 1300        	lipk    0
  690A C1CE A10D        	CIO	13,OPTR		;HOOK OFF---OPTR(bit13)
  691A                  	
  692A C1CF F800        	RET
  693A                  ;//----------------------------------------------------------------------------
  694A                  ;//       Function : BUSY_H
  695A                  ;//
  696A                  ;//       not memory full
  697A                  ;//----------------------------------------------------------------------------
  698A                  BUSY_H:
  699A                  .IF	TEXT_KSCAN
  700A                  .ELSE
  701A C1D0 1300        	lipk    0
  702A C1D1 A30A        	SIO	10,OPTR		;BUSY OFF---OPTR(bit10)
  703A                  .ENDIF
  704A C1D2 F800        	RET
  705A                  ;//----------------------------------------------------------------------------
  706A                  ;//       Function : BUSY_L
  707A                  ;//
  708A                  ;//       memory full
  709A                  ;//----------------------------------------------------------------------------
  710A                  BUSY_L:
  711A                  .IF	TEXT_KSCAN
  712A                  .ELSE
  713A C1D3 1300        	lipk    0
  714A C1D4 A10A        	CIO	10,OPTR		;BUSY OFF---OPTR(bit10)
  715A                  .ENDIF
  716A C1D5 F800        	RET
  717A                  
  718A                  
  719A                  ;//---------------------------------------------------------------------
  720A                  ;	Function : SET_TIMER
  721A                  ;	SET/CLEAR  TIMER/COUNTER
  722A                  ;//---------------------------------------------------------------------
  723A                  SET_TIMER:
  724A C1D6 B020        	SAH	TMR
  725A C1D7 B02C        	SAH	TMR_BAK
  726A C1D8 F800        	RET
  727A                  CLR_TIMER:
  728A C1D9 0F00        	LACK	0X00
  729A C1DA B020        	SAH	TMR
  730A C1DB B02C        	SAH	TMR_BAK
  731A C1DC F800        	RET
  732A                  ;//---------------------------------------------------------------------
  733A                  ;	Function : SET_TIMER
  734A                  ;	SET/CLEAR  TIMER/COUNTER
  735A                  ;//---------------------------------------------------------------------
  736A                  SET_LEDTIMER:
  737A                  	;LACL	300
  738A C1DD B024        	SAH	TMR_LED
  739A C1DE B025        	SAH	TMR_LED_BAK
  740A C1DF F800        	RET
  741A                  CLR_LEDTIMER:
  742A C1E0 0F00        	LACK	0X00
  743A C1E1 B024        	SAH	TMR_LED
  744A C1E2 B025        	SAH	TMR_LED_BAK
  745A C1E3 F800        	RET
  746A                  ;//---------------------------------------------------------------------
  747A                  ;//	Function : INITIAL
  748A                  ;//
  749A                  ;//---------------------------------------------------------------------
  750A                  INITIAL:
  751A                  	
  752A C1E4 1320        	LIPK    2
  753A C1E5 490B        	OUTk    11,PLLMR		;// 11 → PLLMR
  754A C1E6 4B02        	OUTk    0x02,TESTR  		;// test_erdb=1
  755A                  
  756A                  DspModeMain:
  757A C1E7 0F00                LACK    0               	;// CLEAR ALL INTERNAL RAM TO ZERO
  758A C1E8 7100                LARK    0,0             	;// INTERNAL RAM FOR 93010
  759A C1E9 7301                LARK    1,1              	;// IS 0000 ~ 1024
  760A C1EA F688                MAR     +0,0            	;// FOR 93011 IS 0000 ~ 2048
  761A                  DspMAIN_CLR:
  762A C1EB 537F                LUPK    127,1           	;// LOOP 127 + 1 = 128 TIMES
  763A C1EC B0C8                SAHP    +,0             	;// USE ' 0 ' TO SAVE INTERNAL RAM
  764A C1ED FFFF                NOP
  765A C1EE F689                MAR     +0,1
  766A C1EF F6D8                MAR     -,0			;// USE AR1 TO DECREMENT
  767A C1F0 D600C1EB            BZ      ARZ,DspMAIN_CLR    	;// TOTAL IS 128 * 8 = 1024 TIMES
  768A C1F2 1500                LDPK    0
  769A                          
  770A C1F3 FC00C27A            call    InitDateTime
  771A                          
  772A C1F5 F100                EINT
  773A C1F6 FC00CB05    	CALL	PLY_EEXE	;欺骗DSP-MCU,使之初始化时不能发命令;初始化成功后自动恢复进入待机状态
  774A                  	
  775A C1F8 1300                LIPK    0	
  776A C1F9 8F10A0FF            OUTL    0XA0FF,BIOR	;// set the BIOR register initial value
  777A C1FB 4D1B                OUTK    0X1B,IMR 	;// set the IMR register, INT_STMR & INT_CODEC
  778A                          ;OUTK    0X19,IMR 	;// set the IMR register, INT_STMR & INT_CODEC & INT_INT1M
  779A                  ;//=================================	
  780A                  	
  781A                  	;call    SetFlashWaitState
  782A C1FC 1310                LIPK	1
  783A C1FD 8F00F9FA    	OUTL	0XF9FA,WSTR	; set FLASHWAIT(WSTR11..9)=100, PROGWAIT(WSTR2..0)=010
  784A C1FF 1300        	LIPK	0
  785A                        
  786A C200 FC00C0E6            call    SetDspRunMode
  787A                         
  788A                  ;//-----------------------------
  789A                  .IF	ALC_ON	
  790A                          LACL    0XD710
  791A                  .ELSE        
  792A C202 8780D734            LACL    0XD734
  793A                  .ENDIF	
  794A C204 B000                SAH     CONF
  795A C205 FC000020            CALL    DAM_BIOS        ;// set VOX level
  796A                         
  797A C207 8780770B            LACL    0X770B          ;// set silence threshold
  798A C209 B000                SAH     CONF
  799A C20A FC000020            CALL    DAM_BIOS
  800A                         
  801A                  ;------------------------------------------------
  802A                  ;	force   CODEC_INT  release
  803A                  ;------------------------------------------------
  804A C20C 1501                LDPK    1																	;//????????????
  805A C20D 0E35                LAC     0X35
  806A C20E 84800100            ORL     0X0100
  807A C210 B035                SAH     0X35
  808A                  ;------------------------------------------------
  809A C211 1300        	LIPK	0
  810A C212 1500        	LDPK	0
  811A                  
  812A C213 87800000    	LACL	0X0000
  813A C215 B01B        	SAH	PASSWORD
  814A                  	;sah	CLK_CN		;?????????????????????????????
  815A                  	
  816A C216 87800885            LACL	0X0885			;LOUT_VOL,SPK_VOL,ATT1
  817A C218 B01E                SAH	VOI_ATT
  818A                  
  819A C219 0F06                LACK	0X0006
  820A C21A B019                SAH	RING_ID
  821A C21B B01A                SAH	RING_ID_BAK
  822A                  				
  823A C21C 8780FFFF            LACL    0XFFFF
  824A C21E B012                SAH     KEY             ;// initial KEY value=FFFF
  825A                          
  826A C21F 87800002            LACL	2
  827A C221 B01F                SAH	VPLEN		;//the length of the shortest record
  828A                          
  829A                          ;LACL	0
  830A                          ;SAH	EVENT		;//EVENT(bit9)=0(answer on)
  831A                          ;SAH	FUNC_STACK
  832A                          ;SAH	MSG_QUEUE
  833A                          ;SAH	PRO_VAR
  834A                          
  835A                  
  836A C222 0F00                LACK    0
  837A C223 B067        	SAH	SIO_CNT
  838A C224 B068        	SAH	TMR_TR
  839A C225 B065        	SAH	TRS_FG
  840A                  
  841A C226 FC00C1D0            CALL	BUSY_H
  842A                  ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  843A                  .if	0	;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  844A                  AF_TEST:
  845A                  .IF	TEXT_0X9051	
  846A                  	LACL    0X9051
  847A                  .ELSE
  848A                  	LACL	0X9052
  849A                  .ENDIF
  850A                          SAH     CONF
  851A                          CALL    DAM_BIOS        ;// do AFLASH initialization
  852A                  
  853A                          BIT     RESP,8          ;// check the result of initialization ?
  854A                          BS      TB,INIT_GOOD
  855A                            
  856A                  INIT_BAD:                       ;// initialization fails
  857A                          lac     RESP
  858A                          andk    0x0070
  859A                          sbhk    0x0010
  860A                          BZ      ACZ,InitError  	;// flash id ok,but init pattern error
  861A                  
  862A                          LACL	0X9051      
  863A                          SAH     CONF        
  864A                          CALL    DAM_BIOS        ;// do AFLASH initialization
  865A                  
  866A                          BIT     RESP,8          ;// check the result of initialization ?
  867A                          BS      TB,INIT_GOOD
  868A                  InitError:												;// bad,display 'Ar'
  869A                          CALL    WBEEP
  870A                  
  871A                          BS      B1,AF_TEST
  872A                  INIT_GOOD:                       ;// initialization succeed
  873A                  ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  874A                  .else	;!!!!!!!!!!!!!!!!!!!!!!!!
  875A                  SF_TEST:
  876A                  .IF	TEXT_0X9051	
  877A                  	LACL    0X9051
  878A                  .ELSE
  879A C228 87809052    	LACL	0X9052
  880A                  .ENDIF
  881A C22A B000                SAH     CONF
  882A C22B FC000020    	CALL    DAM_BIOS        ; replace by Mode9
  883A C22D 6801                BIT     RESP,8          ;// check the result of initialization ?
  884A C22E DA00C243            BS      TB,INIT_GOOD
  885A                  
  886A                  INIT_FLASHFMT:                       ;// initialization fails
  887A C230 87809051            LACL	0X9051      
  888A C232 B000                SAH     CONF        
  889A C233 FC000020            CALL    DAM_BIOS        ;// do AFLASH initialization
  890A                  
  891A C235 6801                BIT     RESP,8          ;// check the result of initialization ?
  892A C236 DA00C243            BS      TB,INIT_GOOD
  893A                          
  894A C238 0E01                LAC     RESP
  895A C239 0B70                ANDK    0x0070
  896A C23A 0510                SBHK    0x0010
  897A C23B D300C230            BZ      ACZ,INIT_FLASHFMT  	;// flash id ok,but init pattern error
  898A                  InitError:
  899A C23D FC00C165    	CALL	DAA_SPK												;// bad,display 'Ar'
  900A C23F FC00C13F            CALL    WBEEP
  901A                  
  902A C241 DF00C228            BS      B1,SF_TEST
  903A                  INIT_GOOD:                       ;// initialization succeed
  904A                  .endif	;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  905A                  ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!	
  906A                  ;--------设置voice prompt
  907A                  E_V_TEST:
  908A                  	
  909A                  .IF	TEXT_FVOP
  910A C243 87807604    	LACL	0X7604	;// set voice prompt configuration: flash voice prompt
  911A                  .ENDIF
  912A                  .IF	TEXT_EVOP
  913A                  	LACL	0X7602	;// set voice prompt configuration: external voice prompt
  914A                  .ENDIF
  915A                  .IF	TEXT_IVOP
  916A                  	LACL	0X7601	;// set voice prompt configuration: internal voice prompt
  917A                  .ENDIF
  918A C245 B000        	SAH	CONF
  919A C246 FC000020     	CALL	DAM_BIOS
  920A                  
  921A                  	
  922A                  .IF	TEXT_FVOP
  923A C248 6401        	BIT	RESP,4		;// if flash voice prompt test ok?
  924A                  .ENDIF
  925A                  .IF	TEXT_EVOP
  926A                  	BIT	RESP,1		;// if external	voice prompt test ok?
  927A                  .ENDIF	
  928A                  .IF	TEXT_IVOP
  929A                  	BIT	RESP,0		;// if internal	voice prompt test ok?
  930A                  .ENDIF				
  931A C249 DA00C24F            BS	TB,E_V_OK
  932A                  
  933A C24B FC00C165            CALL    DAA_SPK
  934A C24D FC00C13F            CALL    WBEEP
  935A                  	
  936A                  	;BS	B1,E_V_TEST
  937A                  E_V_OK:
  938A                  	
  939A                  ;//----------------------------------------------------------------
  940A C24F F400                ROVM
  941A                  
  942A C250 FC00C108    	CALL	MSG_CHK
  943A                  	
  944A C252 8780D101            LACL    0XD101
  945A                          ;LACL    0XD103			;// set the output level is equal to the input level
  946A C254 B000                SAH     CONF
  947A C255 FC000020    	CALL    DAM_BIOS
  948A                  
  949A C257 ED90        	SRAM	EVENT,13	;?测试用
  950A C258 0F0A        	LACK	10
  951A C259 B02A        	SAH	TMR_BEEP
  952A                  INIT_TEST:				;wait interrupt check
  953A C25A 0E2A        	LAC	TMR_BEEP
  954A C25B D300C25A    	BZ	ACZ,INIT_TEST
  955A                  	
  956A C25D 0F00        	LACK	0
  957A C25E B051        	SAH	MSG_QUEUE
  958A                  ;//-------------------------------------------------------------------
  959A C25F FC00CA4B    	CALL	INIT_DAM_FUNC
  960A C261 FC00C165    	CALL	DAA_SPK
  961A                  
  962A C263 87803CF0    	LACL	0X3CF0			;a long beep(initial)
  963A C265 FC00CC52    	CALL	STOR_VP
  964A                  ;//-------------------------------------------------------------------	
  965A C267 6D10        	BIT	EVENT,13		;test model key pressed?
  966A                  	;BS	TB,INITIAL_RET
  967A C268 DF00C279    	BS	B1,INITIAL_RET
  968A                  
  969A C26A FC00CA4B    	CALL	INIT_DAM_FUNC
  970A C26C FC00CC38    	CALL	CLR_FUNC		;先空
  971A C26E 8780DC9C        	LACL	TEST_STATE
  972A C270 FC00CC2B         	CALL	PUSH_FUNC
  973A C272 0F00        	LACK	0
  974A C273 B019        	SAH	RING_ID
  975A C274 B03E        	SAH	PRO_VAR
  976A C275 FC00C165    	CALL	DAA_SPK
  977A C277 FC00C13F    	CALL    WBEEP
  978A                  INITIAL_RET:
  979A                  	
  980A C279 F800        	RET
  981A                  			
  982A                  ;------------------------------------------------------------------------------
  983A                  InitDateTime:			;2006.1.1	00:00:00	Sunday
  984A                  	
  985A C27A 87800001            lacl    0x01
  986A C27C B00A                sah     TMR_MONTH   	;initial to jaunary,1
  987A C27D 87800001            lacl    0x01
  988A C27F B009                sah     TMR_DAY 
  989A C280 87800006            lacl    0x06
  990A C282 B00B                sah     TMR_YEAR	;initial year to 2006,link index 2 = 0xff
  991A                          
  992A C283 0F00                LACK	0
  993A C284 B004                SAH	TMR_HOUR;;;;;	; set the hour time '0'
  994A C285 0F00                LACK	0 
  995A C286 B003                SAH	TMR_MIN;;;;;;	; set the  minute time 0
  996A C287 0F00                LACK	0 
  997A C288 B002                SAH	TMR_SEC;;;;;; 	; clear the second time
  998A                          
  999A C289 0F00                LACK	0
 1000A C28A B005        	SAH	TMR_WEEK	;initial to Monday
 1001A C28B F800                ret
 1002A                          
 1003A                  ;------------------------------------------------------------------------------
 1004A                  DateTime:
 1005A C28C 0E21                LAC     TMR1
 1006A C28D 828003E8            SBHL    1000   		; 0X400 * 1 = 1000 MINI SECOND ; 8/29 json
 1007A C28F DD00C2FE            BS      SGN,DateTimeRet
 1008A                  INT_STMR22:	
 1009A C291 B021                SAH     TMR1
 1010A                  
 1011A C292 0E02                LAC     TMR_SEC 	; FOR TIMER SECOND USE
 1012A C293 0101                ADHK    0X01
 1013A C294 B002                SAH     TMR_SEC
 1014A C295 053C                SBHK    0X03C		; 0X3C = 60 SECOND
 1015A C296 DD00C2FE            BS      SGN,DateTimeRet
 1016A                  
 1017A C298 0F00                LACK    0X0
 1018A C299 B002                SAH     TMR_SEC
 1019A                  
 1020A C29A 0E03                LAC     TMR_MIN 	; FOR TIMER MINUS USE
 1021A C29B 0101                ADHK    0X01
 1022A C29C B003                SAH     TMR_MIN
 1023A C29D 053C                SBHK    0X03C   	; 0X3C = 60 MINUS
 1024A C29E DD00C2FE            BS      SGN,DateTimeRet
 1025A                  
 1026A C2A0 0F00                LACK    0X0
 1027A C2A1 B003                SAH     TMR_MIN
 1028A                  
 1029A C2A2 0E04                LAC     TMR_HOUR                ; FOR TIMER HOUR USE
 1030A C2A3 0101                ADHK    0X01
 1031A C2A4 B004                SAH     TMR_HOUR
 1032A C2A5 0518                SBHK    0X018               ; 0X18 = 24 HOUR
 1033A C2A6 DD00C2FE            BS      SGN,DateTimeRet       ; < 0X18
 1034A C2A8 0F00                LACK    0X0
 1035A C2A9 B004                SAH     TMR_HOUR
 1036A                  
 1037A C2AA 0E05                LAC     TMR_WEEK
 1038A C2AB 0101                ADHK    0X01
 1039A C2AC B005                SAH     TMR_WEEK
 1040A C2AD 0507                SBHK    0X07                 ;3/24/97; 0(1)~ 6(7) IS WEEK COUNTER
 1041A C2AE DD00C2B2            BS      SGN,TimeDatePlus     ;for mx93111-s2
 1042A C2B0 0F00                LACK    0X0
 1043A C2B1 B005                SAH     TMR_WEEK
 1044A                  ;for mx93132-n2 ++++++++++++++++++++++++++++
 1045A                  TimeDatePlus:
 1046A C2B2 0E09                LAC     TMR_DAY
 1047A C2B3 0101                ADHK    0X01
 1048A C2B4 B009                SAH     TMR_DAY
 1049A C2B5 858000FF            andl    0xff
 1050A C2B7 051D                sbhk    29   		;it is 28 days in February
 1051A C2B8 DD00C2FE            BS      SGN,DateTimeRet
 1052A C2BA DB00C2C5            bs      ACZ,CheckFebruary28
 1053A C2BC 0501                sbhk    1   		;it is 29 days in February
 1054A C2BD DB00C2C9            bs      ACZ,CheckFebruary29
 1055A C2BF 0501                sbhk    1   		;it is 30 days in April,june,September,November
 1056A C2C0 DB00C2D5            bs      ACZ,CheckMonth30
 1057A C2C2 0501                sbhk    1   		;it is 31 days in jaunary,march,may,july,auguest,Oct,Dec.
 1058A C2C3 DB00C2E5            bs      ACZ,CheckMonth31
 1059A                  CheckFebruary28:
 1060A C2C5 0E0B                lac     TMR_YEAR	;是润年吗?
 1061A C2C6 0B03                andk    0x0003
 1062A C2C7 DB00C2FE            BS      ACZ,DateTimeRet
 1063A                  CheckFebruary29:
 1064A C2C9 0E0A                LAC     TMR_MONTH
 1065A C2CA 0502                sbhk    2
 1066A C2CB D300C2FE            BZ      ACZ,DateTimeRet
 1067A C2CD 87800003            lacl    0x03
 1068A C2CF B00A                SAH     TMR_MONTH
 1069A C2D0 87800001            lacl    0x01
 1070A C2D2 B009                SAH     TMR_DAY	
 1071A C2D3 DF00C2FE            BS      B1,DateTimeRet
 1072A                  CheckMonth30:
 1073A C2D5 0E0A                LAC     TMR_MONTH
 1074A C2D6 0B0F                andk    0x0f
 1075A C2D7 0504                sbhk    4   	;april
 1076A C2D8 DB00C2E5            bs      ACZ,PlusMonth
 1077A C2DA 0502                sbhk    2   	;june
 1078A C2DB DB00C2E5            bs      ACZ,PlusMonth
 1079A C2DD 0503                sbhk    3   	;September
 1080A C2DE DB00C2E5            bs      ACZ,PlusMonth
 1081A C2E0 0502                sbhk    2   	;November
 1082A C2E1 DB00C2E5            bs      ACZ,PlusMonth
 1083A C2E3 DF00C2FE            BS      B1,DateTimeRet
 1084A                  PlusMonth:
 1085A                  CheckMonth31:
 1086A C2E5 0E0A                lac     TMR_MONTH
 1087A C2E6 80800001            adhl    0x01
 1088A C2E8 B00A                sah     TMR_MONTH
 1089A                  	
 1090A C2E9 87800001    	lacl	0x01
 1091A C2EB B009                sah     TMR_DAY
 1092A                          
 1093A C2EC 0E0A                lac     TMR_MONTH
 1094A C2ED 050D                sbhk    13
 1095A C2EE D300C2FE            bz      ACZ,DateTimeRet
 1096A C2F0 0E0B                lac     TMR_YEAR
 1097A C2F1 8580FF00            andl    0xff00
 1098A C2F3 B009                sah     TMR_DAY		;as a register
 1099A                  
 1100A C2F4 0E0B                lac     TMR_YEAR
 1101A C2F5 0101                adhk    1
 1102A C2F6 858000FF            andl    0x00ff
 1103A C2F8 0809                or      TMR_DAY
 1104A C2F9 B00B                sah     TMR_YEAR
 1105A                  
 1106A C2FA 87800001            lacl    0x01
 1107A C2FC B009                sah     TMR_DAY
 1108A C2FD B00A                sah	TMR_MONTH
 1109A                  DateTimeRet:
 1110A C2FE F800                ret
 1111A                  ;------------------------------------------------------------------------
 1112A                  ;	Funtion : transmit the address of bit=0 to messages
 1113A                  ;	input : KEY
 1114A                  ;	output: INT_TTMP1=INT_TTMP2=the address of key bit=0(1..12)key pressed
 1115A                  ;			 =0 no key pressed
 1116A                  
 1117A                  ;------------------------------------------------------------------------
 1118A                  KEYTOMSG:
 1119A C2FF 0E12        	LAC	KEY
 1120A C300 B02F        	SAH	INT_TTMP2
 1121A                  	
 1122A C301 0F01        	LACK	1
 1123A C302 B02E        	SAH	INT_TTMP1
 1124A                  	
 1125A C303 602F        	BIT	INT_TTMP2,0
 1126A C304 D200C317    	BZ	TB,KEYTOMSG_END
 1127A                  KEYTOMSG_LOOP:
 1128A C306 0E2E        	LAC	INT_TTMP1
 1129A C307 050C        	SBHK	12
 1130A C308 DD00C30E    	BS	SGN,KEYTOMSG1
 1131A                  	
 1132A C30A 0F00        	LACK	0
 1133A C30B B02E        	SAH	INT_TTMP1
 1134A C30C B02F        	SAH	INT_TTMP2	;no key pressed
 1135A C30D F800        	RET
 1136A                  KEYTOMSG1:	
 1137A C30E 0E2E        	LAC	INT_TTMP1
 1138A C30F 0101        	ADHK	1
 1139A C310 B02E        	SAH	INT_TTMP1
 1140A                  
 1141A C311 0E2F        	LAC	INT_TTMP2
 1142A C312 9E01        	SFR	1
 1143A C313 B02F        	SAH	INT_TTMP2
 1144A                  	
 1145A C314 602F        	BIT	INT_TTMP2,0
 1146A C315 DA00C306    	BS	TB,KEYTOMSG_LOOP
 1147A                  KEYTOMSG_END:
 1148A C317 0E2E        	LAC	INT_TTMP1
 1149A C318 B02F        	SAH	INT_TTMP2
 1150A                  	
 1151A C319 F800        	RET
 1152A                  ;//----------------------------------------------------------------------
 1153A                  VOL_TAB:
 1154A                  
 1155A                  	;0	1	2	3	4	5	6	7
 1156A C31A 00F000C0    .DATA	0X0F0	0X0C0	0X0A0	0X80	0X60	0X40	0X20	0X00
            00A00080
            00600040
            00200000
 1157A                  
 1158A                  ;//----------------------------------------------------------------------
 1159A                  DGT_TAB:
 1160A                  ;	     A
 1161A                  ;	     __
 1162A                  ;	  F |G |B
 1163A                  ;	    |__|
 1164A                  ;	  E |  |C
 1165A                  ;	    |__| .	;.FAGBECD<===>OPTR(7..0)
 1166A                  ;	     D
 1167A                  	;0	1	2	3	4	5	6	7
 1168A C322 009000F5    .DATA	0X90	0XF5	0XC2	0XC4	0XA5	0X8C	0X88	0XD5
            00C200C4
            00A5008C
            008800D5
 1169A                  	;8	9	A	B	C	D	E	F
 1170A C32A 00800084    .DATA	0X80	0X84	0X81	0XA8	0X9A	0XE0	0X8A	0X8B
            008100A8
            009A00E0
            008A008B
 1171A                  
 1172A                  INT_HOSTW:
 1173A C332 F800        	RET
 1174A                  INT_HOSTR:
 1175A C333 F800        	RET
 1176A                  INT_NMI:
 1177A C334 F800        	RET
 1178A                  INT_SS:
 1179A C335 F800                RET
 1180A                  INT_1:
 1181A C336 F800        	RET
 1182A                  ;-----------------------------------------------------------------------
 1183A                  .INCLUDE main.asm
    1B                  .LIST
    2B                  ;//-----------------------------------------------------------------------
    3B                  MAIN:
    4B C337 FC00C1E4    	CALL	INITIAL
    5B                  ;//--------------------- STAND-BY ROUTINES -------------------------------
    6B                  STAND_BY:
    7B C339 FC00C9BF            CALL	INT_BIOS		;DAM_BIOS软中断
    8B C33B FC00CBF2    	CALL	GET_MSG			;GET MESSAGE
    9B C33D DB00C339    	BS	ACZ,STAND_BY
   10B C33F B03D        	SAH	MSG
   11B                  	
   12B C340 FC00C6E3    	CALL	SYS_MSG
   13B C342 DB00C339    	BS	ACZ,STAND_BY		;系统消息
   14B                  
   15B C344 FC00CC1E    	CALL	GET_FUNC		;应用定向
   16B C346 C000        	CALA
   17B                  	
   18B C347 DF00C339            BS	B1,STAND_BY
   19B                  ;-------------------------------主程序----------------------------------
   20B                  MAIN_PRO:
   21B C349 0E3E        	LAC	PRO_VAR
   22B C34A 8580000F    	ANDL	0X0F
   23B C34C DB00C367    	BS	ACZ,MAIN_PRO0
   24B C34E 0501        	SBHK	1
   25B C34F DB00C48B    	BS	ACZ,MAIN_PRO1
   26B C351 0501        	SBHK	1
   27B C352 DB00C53D    	BS	ACZ,MAIN_PRO2
   28B C354 0501        	SBHK	1
   29B C355 DB00C55F    	BS	ACZ,MAIN_PRO3
   30B C357 0501        	SBHK	1
   31B C358 DB00C5FE    	BS	ACZ,MAIN_PRO4
   32B C35A 0501        	SBHK	1
   33B C35B DB00C632    	BS	ACZ,MAIN_PRO5
   34B C35D 0501        	SBHK	1
   35B C35E DB00C69B    	BS	ACZ,MAIN_PRO6
   36B C360 0501        	SBHK	1
   37B C361 DB00C6B4    	BS	ACZ,MAIN_PRO7
   38B C363 0501        	SBHK	1
   39B C364 DB00C6B5    	BS	ACZ,MAIN_PRO8
   40B                  	
   41B C366 F800        	RET
   42B                  ;======================================================消息生成区
   43B                  MAIN_PRO0:	;空闲状态要考虑的消息:
   44B                  
   45B C367 0E3D        	LAC	MSG
   46B C368 86800081    	XORL	CMSG_INIT		;INITIAL
   47B C36A DB00C3B3    	BS	ACZ,MAIN_PRO0_INIT
   48B                  ;---
   49B                  MAIN_PRO0_1:
   50B C36C 0E3D        	LAC	MSG
   51B C36D 86800001    	XORL	CMSG_KEY1S
   52B C36F DB00C3CF    	BS	ACZ,MAIN_PRO0_PLAY
   53B                  ;---
   54B                  MAIN_PRO0_2:
   55B C371 0E3D        	LAC	MSG
   56B C372 86800002    	XORL	CMSG_KEY2S
   57B C374 DB00C3FF    	BS	ACZ,MAIN_PRO0_TIME
   58B                  ;---
   59B                  MAIN_PRO0_3:
   60B C376 0E3D        	LAC	MSG
   61B C377 86800003    	XORL	CMSG_KEY3S
   62B C379 DB00C400    	BS	ACZ,MAIN_PRO0_PLAY_OGM
   63B                  MAIN_PRO0_3_1:
   64B C37B 0E3D        	LAC	MSG
   65B C37C 86800013    	XORL	CMSG_KEY3L
   66B C37E DB00C42E    	BS	ACZ,MAIN_PRO0_RECO_OGM
   67B                  ;---
   68B                  MAIN_PRO0_4:
   69B C380 0E3D        	LAC	MSG
   70B C381 86800014    	XORL	CMSG_KEY4L
   71B C383 DB00C443    	BS	ACZ,MAIN_PRO0_RECO_MSG
   72B                  ;---
   73B                  MAIN_PRO0_5:
   74B C385 0E3D        	LAC	MSG
   75B C386 86800015    	XORL	CMSG_KEY5L
   76B C388 DB00C458    	BS	ACZ,MAIN_PRO0_ERAS_MSG
   77B                  ;---
   78B                  MAIN_PRO0_6:
   79B C38A 0E3D        	LAC	MSG
   80B C38B 86800006    	XORL	CMSG_KEY6S
   81B C38D DB00C474    	BS	ACZ,MAIN_PRO0_ONOFF
   82B                  ;---
   83B                  MAIN_PRO0_7:
   84B C38F 0E3D        	LAC	MSG
   85B C390 86800017    	XORL	CMSG_KEY7L
   86B C392 DB00C475    	BS	ACZ,MAIN_PRO0_MBOX
   87B                  ;---
   88B                  MAIN_PRO0_9:
   89B C394 0E3D        	LAC	MSG
   90B C395 86800019    	XORL	CMSG_KEY9L
   91B C397 DB00C476    	BS	ACZ,MAIN_PRO0_MENU
   92B                  ;---
   93B                  MAIN_PRO0_10:
   94B C399 0E3D        	LAC	MSG
   95B C39A 8680000A    	XORL	CMSG_KEYAS
   96B C39C DB00C477    	BS	ACZ,MAIN_PRO0_VOLA
   97B                  MAIN_PRO0_10_1:
   98B C39E 0E3D        	LAC	MSG
   99B C39F 8680001A    	XORL	CMSG_KEYAL
  100B C3A1 DB00C477    	BS	ACZ,MAIN_PRO0_VOLA
  101B                  ;---
  102B                  MAIN_PRO0_11:
  103B C3A3 0E3D        	LAC	MSG
  104B C3A4 8680000B    	XORL	CMSG_KEYBS
  105B C3A6 DB00C478    	BS	ACZ,MAIN_PRO0_VOLS
  106B                  ;---
  107B                  MAIN_PRO0_13:	
  108B C3A8 0E3D        	LAC	MSG
  109B C3A9 868000B0    	XORL	CVP_STOP		;PLAY END
  110B C3AB DB00C479    	BS	ACZ,MAIN_PRO0_VOIC_END
  111B                  MAIN_PRO0_14:	
  112B C3AD 0E3D        	LAC	MSG
  113B C3AE 868000B4    	XORL	CMSG_TESTD		;test
  114B C3B0 DB00C47E    	BS	ACZ,MAIN_PRO0_TEST
  115B                  	;LAC	MSG
  116B                  	;XORL	CMSG_TEST		;test
  117B                  	;BS	ACZ,MAIN_PRO0_TEST
  118B                  
  119B                  ;---
  120B C3B2 F800        	RET
  121B                  ;-------------------------------;消息处理
  122B                  MAIN_PRO0_INIT:
  123B C3B3 FC00C1CD    	CALL	HOOK_OFF
  124B C3B5 FC00C1C4    	CALL	DAA_OFF		;要考虑加入的功能(11.18)
  125B C3B7 FC00CA4B    	CALL	INIT_DAM_FUNC
  126B C3B9 FC00C108    	CALL	MSG_CHK
  127B                  	
  128B C3BB FC00DBA8    	CALL	TMPNUM_DEL	;删除临时来电号码(如果有)
  129B C3BD FC00CAC9    	CALL	TEL_GC_CHK
  130B C3BF FC00CA9E    	CALL	GC_CHK
  131B C3C1 FC00C108    	CALL	MSG_CHK
  132B C3C3 FC00C12F    	CALL	LED_STATUS	;有NEW MESSAGES吗?
  133B                  ;---
  134B C3C5 FC00DC11    	CALL	GET_FILEID
  135B C3C7 B017        	SAH	FILE_ID		;stor vp use_dat()
  136B                  ;---	
  137B C3C8 FC00CB03    	CALL	REC_EEND
  138B C3CA FC00CB07    	CALL	PLY_EEND
  139B C3CC FC00CB0B    	CALL	REMT_EEND
  140B                  	
  141B C3CE F800        	RET
  142B                  ;-------
  143B                  MAIN_PRO0_PLAY:	
  144B C3CF 87800092    	LACL	CNO_NMSG
  145B C3D1 FC00CC19    	CALL	STOR_MSG	;LED不要闪烁了(进入放音)
  146B                  	
  147B C3D3 FC00CB05    	CALL	PLY_EEXE
  148B                  	
  149B C3D5 FC00CA4B    	CALL	INIT_DAM_FUNC
  150B                  	
  151B                  	;LACL	0XD000
  152B                  	;SAH	CONF
  153B                  	;CALL	DAM_BIOS
  154B                  	
  155B                  	;LACL	0XD200
  156B                  	;SAH	CONF
  157B                  	;CALL	DAM_BIOS
  158B                  	
  159B C3D7 0F01        	LACK	1
  160B C3D8 B03E        	SAH	PRO_VAR			;进入播放子功能
  161B                  
  162B                  	;CALL	MANAGE			;set new flag to new message
  163B C3D9 FC00D2B7    	CALL	CLR_FLAG
  164B C3DB FC00C108    	CALL	MSG_CHK
  165B                  	
  166B                  	;LAC	MSG_ID
  167B                  	;ANDL	0XFF00
  168B                  	;SAH	MSG_ID
  169B                  	
  170B C3DD 0E16        	LAC	MSG_T
  171B C3DE 0101        	ADHK	1
  172B                  	;OR	MSG_ID
  173B C3DF B014        	SAH	MSG_ID
  174B                  
  175B C3E0 6C11        	BIT	ANN_FG,12
  176B C3E1 DA00C3F0    	BS	TB,MAIN_PRO0_PLAY1
  177B C3E3 6E11        	BIT	ANN_FG,14
  178B C3E4 DA00C3F6    	BS	TB,MAIN_PRO0_PLAY2
  179B                  
  180B C3E6 87800080    	LACL	0X0080		;1.0s mute
  181B C3E8 FC00CC52    	CALL	STOR_VP
  182B C3EA FC00D279    	CALL	BBBEEP		;替换语音BBB
  183B C3EC 0F00        	LACK	0
  184B C3ED B03E        	SAH	PRO_VAR	
  185B                  	
  186B C3EE DF00C3FC    	BS	B1,MAIN_PRO0_PLAY_END
  187B                  ;---
  188B                  MAIN_PRO0_PLAY1:
  189B                  
  190B C3F0 87800005    	LACL	0X005
  191B C3F2 FC00CC52    	CALL	STOR_VP			;替换语音		
  192B C3F4 DF00C3FC    	BS	B1,MAIN_PRO0_PLAY_END
  193B                  ;-
  194B                  MAIN_PRO0_PLAY2:
  195B                  
  196B C3F6 87800010    	LACL	0X0010
  197B C3F8 FC00CC52    	CALL	STOR_VP			;替换语音	
  198B C3FA DF00C3FC    	BS	B1,MAIN_PRO0_PLAY_END	
  199B                  MAIN_PRO0_PLAY_END:
  200B C3FC FC00C165    	CALL	DAA_SPK
  201B C3FE F800        	RET				
  202B                  ;-------	
  203B                  MAIN_PRO0_TIME:
  204B                  	
  205B C3FF F800        	RET
  206B                  ;-------
  207B                  MAIN_PRO0_PLAY_OGM:
  208B C400 FC00CB05    	CALL	PLY_EEXE
  209B C402 FC00CA4B    	CALL	INIT_DAM_FUNC
  210B                  	
  211B C404 0F04        	LACK	4
  212B C405 B03E        	SAH	PRO_VAR			;进入播放OGM子功能
  213B                  	
  214B                  	;CALL	OGM_STATUS
  215B C406 0E15        	LAC	MSG_N
  216B C407 FC00D224    	CALL	OGM_CHK
  217B                  	
  218B C409 0E14        	LAC	MSG_ID
  219B C40A 858000FF    	ANDL	0X0FF
  220B C40C 8480FE00    	ORL	0XFE00
  221B C40E FC00CC52    	CALL	STOR_VP
  222B                  	
  223B C410 0E15        	LAC	MSG_N
  224B C411 FC00D224    	CALL	OGM_CHK
  225B C413 DB00C425    	BS	ACZ,MAIN_PRO0_PLAY_OGM1
  226B                  	
  227B C415 FC00CA4B    	CALL	INIT_DAM_FUNC
  228B                  	
  229B C417 0E15        	LAC	MSG_N
  230B C418 FC00D203    	CALL	SELECT_OGM
  231B                  	
  232B C41A 87800040    	LACL	0X0040		;0.5s mute
  233B C41C FC00CC52    	CALL	STOR_VP
  234B C41E 0E1C        	LAC	LANGUAGE
  235B C41F 9E04        	SFR	4		;OGM vp
  236B C420 0B0F        	ANDK	0X0F
  237B C421 8480FF00    	ORL	0XFF00
  238B C423 FC00CC52    	CALL	STOR_VP
  239B                  MAIN_PRO0_PLAY_OGM1:		
  240B C425 FC00C165    	CALL	DAA_SPK
  241B                  	
  242B C427 0F00        	LACK	0
  243B C428 B03F        	SAH	PRO_VAR1
  244B C429 878003E8    	LACL	1000
  245B C42B FC00C1D6    	CALL	SET_TIMER
  246B                  	
  247B C42D F800        	RET
  248B                  ;-------
  249B                  MAIN_PRO0_RECO_OGM:
  250B C42E FC00CA4B    	CALL	INIT_DAM_FUNC
  251B C430 FC00CB01    	CALL	REC_EEXE
  252B                  	
  253B C432 87800015    	LACL	0X015
  254B C434 B03E        	SAH	PRO_VAR
  255B                  
  256B C435 FC00D267    	CALL	LBEEP
  257B                  	
  258B C437 FC00C165    	CALL	DAA_SPK
  259B                  	
  260B C439 6D11        	BIT	ANN_FG,13	;check memoful?
  261B C43A D200C442    	BZ	TB,MAIN_PRO0_RECO_OGM1
  262B                  	
  263B C43C FC00CA4B    	CALL	INIT_DAM_FUNC
  264B                  	
  265B C43E 0F00        	LACK	0
  266B C43F B03E        	SAH	PRO_VAR
  267B                  	
  268B C440 FC00D279    	CALL	BBBEEP		;memory full(BBB)
  269B                  MAIN_PRO0_RECO_OGM1:	
  270B C442 F800        	RET
  271B                  MAIN_PRO0_RECO_MSG:
  272B C443 FC00CA4B    	CALL	INIT_DAM_FUNC
  273B C445 FC00C165    	CALL	DAA_SPK
  274B C447 FC00D267    	CALL	LBEEP
  275B C449 FC00CB01    	CALL	REC_EEXE
  276B                  	
  277B C44B 87800013    	LACL	0X013
  278B C44D B03E        	SAH	PRO_VAR
  279B                  	
  280B C44E 6D11        	BIT	ANN_FG,13	;check memoful?
  281B C44F D200C457    	BZ	TB,MAIN_PRO0_RECO_MSG1
  282B                  	
  283B C451 FC00CA4B    	CALL	INIT_DAM_FUNC
  284B                  	
  285B C453 0F00        	LACK	0
  286B C454 B03E        	SAH	PRO_VAR
  287B C455 FC00D279    	CALL	BBBEEP		;memory full(BBB)
  288B                  MAIN_PRO0_RECO_MSG1:		
  289B C457 F800        	RET
  290B                  ;-------
  291B                  MAIN_PRO0_ERAS_MSG:
  292B C458 FC00C108    	CALL	MSG_CHK
  293B C45A 0E16        	LAC	MSG_T
  294B C45B DB00C46F    	BS	ACZ,MAIN_PRO0_ERAS_MSG1
  295B                  	
  296B C45D 87806100    	LACL	0X6100
  297B C45F B000        	SAH	CONF
  298B C460 FC000020    	CALL	DAM_BIOS
  299B                  	
  300B C462 87806080    	LACL	0X6080
  301B C464 B000        	SAH	CONF
  302B C465 FC000020    	CALL	DAM_BIOS
  303B                  	
  304B C467 FC00D8F1    	CALL	TELNUMALL_DEL	;删除没有对应message的电话号码
  305B                  
  306B C469 FC00C165    	CALL	DAA_SPK
  307B C46B FC00D26C    	CALL	BBEEP
  308B                  	
  309B C46D DF00C473    	BS	B1,MAIN_PRO0_ERAS_MSG_END
  310B                  MAIN_PRO0_ERAS_MSG1:	
  311B                  	
  312B C46F FC00D279    	CALL	BBBEEP
  313B C471 FC00C165    	CALL	DAA_SPK
  314B                  MAIN_PRO0_ERAS_MSG_END:	
  315B C473 F800        	RET
  316B                  MAIN_PRO0_ONOFF:
  317B                  
  318B                  	;CALL	INIT_DAM_FUNC
  319B                  	;CALL	GC_CHK
  320B                  	
  321B                  	;CALL	DAA_OFF
  322B                  	
  323B C474 F800        	RET
  324B                  MAIN_PRO0_MBOX:
  325B C475 F800        	RET
  326B                  MAIN_PRO0_MENU:
  327B C476 F800        	RET
  328B                  MAIN_PRO0_VOLA:
  329B                  	
  330B C477 F800        	RET
  331B                  MAIN_PRO0_VOLS:
  332B C478 F800        	RET
  333B                  MAIN_PRO0_VOIC_END:
  334B C479 87800081    	LACL	CMSG_INIT
  335B C47B FC00CC19    	CALL	STOR_MSG
  336B C47D F800        	RET
  337B                  MAIN_PRO0_TEST:
  338B C47E FC00CA4B    	CALL	INIT_DAM_FUNC
  339B C480 FC00C1CA    	CALL	HOOK_ON
  340B C482 FC00C189    	CALL	DAA_LIN_RECORD
  341B C484 878020FF    	LACL	0X20FF			;beep(initial)
  342B C486 FC00CC52    	CALL	STOR_VP
  343B                  
  344B C488 0F06        	LACK	0x06
  345B C489 B03E        	SAH	PRO_VAR
  346B                  	
  347B C48A F800        	RET		
  348B                  ;===================================================================	
  349B                  MAIN_PRO1:	;播放(MSG)状态要考虑的消息:
  350B C48B 0E3D        	LAC	MSG
  351B C48C 8680008A    	XORL	CSEG_PAUSE		;pause
  352B C48E DB00C4B4    	BS	ACZ,MAIN_PRO1_PLAY_PAUSE
  353B                  MAIN_PRO1_1:
  354B C490 0E3D        	LAC	MSG
  355B C491 86800005    	XORL	CMSG_KEY5S		;erase
  356B C493 DB00C4CC    	BS	ACZ,MAIN_PRO1_PLAY_ERASE
  357B                  MAIN_PRO1_2:
  358B                  MAIN_PRO1_3:
  359B C495 0E3D        	LAC	MSG
  360B C496 86800006    	XORL	CMSG_KEY6S		;ON/OFF(stop)
  361B C498 DB00C4DA    	BS	ACZ,MAIN_PRO1_PLAY_STOP
  362B                  MAIN_PRO1_4:
  363B                  MAIN_PRO1_5:
  364B C49A 0E3D        	LAC	MSG
  365B C49B 8680000A    	XORL	CMSG_KEYAS		;VOL+
  366B C49D DB00C4EA    	BS	ACZ,MAIN_PRO1_PLAY_VOLA
  367B                  MAIN_PRO1_6:
  368B                  MAIN_PRO1_7:
  369B C49F 0E3D        	LAC	MSG
  370B C4A0 8680000B    	XORL	CMSG_KEYBS		;VOL-
  371B C4A2 DB00C4EB    	BS	ACZ,MAIN_PRO1_PLAY_VOLS
  372B                  MAIN_PRO1_8:
  373B                  MAIN_PRO1_9:
  374B C4A4 0E3D        	LAC	MSG
  375B C4A5 8680000C    	XORL	CMSG_KEYCS		;FFW
  376B C4A7 DB00C4EC    	BS	ACZ,MAIN_PRO1_PLAY_FFW
  377B                  MAIN_PRO1_10:
  378B                  MAIN_PRO1_11:
  379B C4A9 0E3D        	LAC	MSG
  380B C4AA 86800008    	XORL	CMSG_KEY8S		;REW
  381B C4AC DB00C4F5    	BS	ACZ,MAIN_PRO1_PLAY_REW
  382B                  MAIN_PRO1_12:
  383B                  MAIN_PRO1_13:
  384B C4AE 0E3D        	LAC	MSG
  385B C4AF 868000B0    	XORL	CVP_STOP		;PLAY END
  386B C4B1 DB00C513    	BS	ACZ,MAIN_PRO1_PLAY_OVER
  387B                  			
  388B C4B3 F800        	RET
  389B                  ;-------消息处理
  390B                  MAIN_PRO1_PLAY_PAUSE:
  391B C4B4 0E00        	LAC	CONF
  392B C4B5 8580F000    	ANDL	0XF000
  393B C4B7 86802000    	XORL	0X2000
  394B C4B9 D300C4C7    	BZ	ACZ,MAIN_PRO1_PLAY_PAUSE1
  395B                  	
  396B C4BB 0F02        	LACK	2
  397B C4BC B03E        	SAH	PRO_VAR
  398B                  	
  399B C4BD 0F00        	LACK	0
  400B C4BE B03F        	SAH	PRO_VAR1
  401B C4BF 878003E8    	LACL	1000
  402B C4C1 FC00C1D6    	CALL	SET_TIMER
  403B                  	
  404B C4C3 E880        	SRAM	CONF,8
  405B C4C4 FC000020    	CALL	DAM_BIOS
  406B                  	
  407B C4C6 F800        	RET
  408B                  MAIN_PRO1_PLAY_PAUSE1:		;若是BEEP,则循环再发
  409B C4C7 8780008A    	LACL	CSEG_PAUSE
  410B C4C9 FC00CC19    	CALL	STOR_MSG
  411B                  	
  412B C4CB F800        	RET
  413B                  MAIN_PRO1_PLAY_ERASE:
  414B                  
  415B C4CC FC00CA4B    	CALL	INIT_DAM_FUNC
  416B                  	
  417B C4CE FC00DC6A    	CALL	DEL_VPMSG
  418B                  	
  419B C4D0 0E17        	LAC	FILE_ID
  420B C4D1 FC00DC1E    	CALL	GET_USRDAT
  421B C4D3 FC00DBEB    	CALL	GET_TELID
  422B C4D5 FC00D8E5    	CALL	TELNUM_DEL
  423B                  
  424B C4D7 FC00D25E    	CALL	BEEP
  425B                  	
  426B C4D9 F800        	RET
  427B                  MAIN_PRO1_PLAY_STOP:
  428B C4DA FC00CA4B    	CALL	INIT_DAM_FUNC
  429B                  	
  430B C4DC FC00DC7E    	CALL	SETOLD_VPMSG
  431B                  	
  432B C4DE 87806100    	LACL	0X6100
  433B C4E0 B000        	SAH	CONF
  434B C4E1 FC000020    	CALL	DAM_BIOS
  435B                  
  436B C4E3 FC00D26C    	CALL	BBEEP		;替换语音BB
  437B C4E5 FC00C165    	CALL	DAA_SPK
  438B                  	
  439B C4E7 0F00        	LACK	0
  440B C4E8 B03E        	SAH	PRO_VAR
  441B                  	
  442B C4E9 F800        	RET
  443B                  MAIN_PRO1_PLAY_VOLA:
  444B C4EA F800        	RET
  445B                  MAIN_PRO1_PLAY_VOLS:
  446B C4EB F800        	RET
  447B                  MAIN_PRO1_PLAY_FFW:
  448B C4EC FC00CA4B    	CALL	INIT_DAM_FUNC
  449B                  	
  450B C4EE FC00DC7E    	CALL	SETOLD_VPMSG
  451B                  	
  452B C4F0 878000B0    	LACL	CVP_STOP
  453B C4F2 FC00CC19    	CALL	STOR_MSG
  454B                  	
  455B C4F4 F800        	RET
  456B                  ;-------
  457B                  
  458B                  MAIN_PRO1_PLAY_REW:		;从
  459B C4F5 FC00CA4B    	CALL	INIT_DAM_FUNC
  460B                  	
  461B C4F7 FC00DC7E    	CALL	SETOLD_VPMSG
  462B                  
  463B C4F9 0E14        	LAC	MSG_ID
  464B C4FA 003C        	ADH	FILE_LEN
  465B C4FB 858000FF    	ANDL	0X0FF
  466B C4FD 0416        	SBH	MSG_T
  467B C4FE D500C504    	BZ	SGN,MAIN_PRO1_PLAY_REW_1 ;第一个吗?
  468B                  
  469B C500 0E14        	LAC	MSG_ID
  470B C501 003C        	ADH	FILE_LEN
  471B C502 0101        	ADHK	1
  472B C503 B014        	SAH	MSG_ID
  473B                  MAIN_PRO1_PLAY_REW_1:	
  474B C504 6C11        	BIT	ANN_FG,12
  475B C505 D200C509    	BZ	TB,MAIN_PRO1_PLAY_REW_2
  476B                  
  477B C507 FC00D1B2    	CALL	FFW_MANAGE
  478B                  	
  479B                  MAIN_PRO1_PLAY_REW_2:
  480B                  
  481B C509 FC00D25E    	CALL	BEEP		;替换语音B	
  482B                  	
  483B                  .IF	TEXT_m58	
  484B                  	CALL	SEND_INIT
  485B                  .ENDIF
  486B C50B 0E14        	LAC	MSG_ID
  487B C50C FC00DC42    	CALL	GET_RVPLEN
  488B C50E FC00DC58    	CALL	GET_VPMSG
  489B                  
  490B C510 FC00C165    	CALL	DAA_SPK
  491B                  		
  492B C512 F800        	RET
  493B                  ;-------
  494B                  MAIN_PRO1_PLAY_OVER:
  495B C513 FC00CA4B    	CALL	INIT_DAM_FUNC
  496B                  
  497B C515 0E14        	LAC	MSG_ID
  498B C516 858000FF    	ANDL	0X0FF
  499B C518 0501        	SBHK	1
  500B C519 DB00C51D    	BS	ACZ,MAIN_PRO1_PLAY_OVER_1
  501B C51B D500C529    	BZ	SGN,MAIN_PRO1_PLAY_OVER1
  502B                  	
  503B                  ;===
  504B                  MAIN_PRO1_PLAY_OVER_1:	
  505B C51D 87806100    	LACL	0X6100
  506B C51F B000        	SAH	CONF
  507B C520 FC000020    	CALL	DAM_BIOS
  508B                  
  509B C522 FC00D26C    	CALL	BBEEP
  510B                  
  511B C524 FC00C165    	CALL	DAA_SPK
  512B                  	
  513B C526 0F00        	LACK	0
  514B C527 B03E        	SAH	PRO_VAR
  515B                  	
  516B C528 F800        	RET
  517B                  MAIN_PRO1_PLAY_OVER1:
  518B                  
  519B C529 0E14        	LAC	MSG_ID			;next message
  520B C52A 0501        	SBHK	1
  521B C52B B014        	SAH	MSG_ID
  522B                  	
  523B C52C 6C11        	BIT	ANN_FG,12
  524B C52D D200C533    	BZ	TB,MAIN_PRO1_PLAY_OVER2
  525B                  
  526B C52F FC00D1D3    	CALL	REW_MANAGE
  527B C531 D300C51D    	BZ	ACZ,MAIN_PRO1_PLAY_OVER_1	;THE LAST ONE	
  528B                  MAIN_PRO1_PLAY_OVER2:
  529B C533 FC00C165    	CALL	DAA_SPK
  530B C535 FC00D25E    	CALL	BEEP
  531B                  .IF	TEXT_m58	
  532B                  	CALL	SEND_INIT
  533B                  .ENDIF
  534B C537 0E14        	LAC	MSG_ID
  535B C538 FC00DC27    	CALL	GET_VPLEN
  536B C53A FC00DC58    	CALL	GET_VPMSG
  537B                  
  538B C53C F800        	RET		
  539B                  ;=================================================================================
  540B                  MAIN_PRO2:	;暂停(MSG)状态要考虑的消息:
  541B C53D 0E3D        	LAC	MSG
  542B C53E 86800001    	XORL	CMSG_KEY1S		;PLAY
  543B C540 DB00C556    	BS	ACZ,MAIN_PRO_PLAY_ID
  544B                  MAIN_PRO2_1:
  545B C542 0E3D        	LAC	MSG
  546B C543 86800006    	XORL	CMSG_KEY6S		;stop
  547B C545 DB00C4DA    	BS	ACZ,MAIN_PRO1_PLAY_STOP
  548B                  MAIN_PRO2_2:
  549B C547 0E3D        	LAC	MSG
  550B C548 86800090    	XORL	CMSG_TMR		;TMR
  551B C54A DB00C54D    	BS	ACZ,MAIN_PRO2_TMR
  552B                  	
  553B C54C F800        	RET
  554B                  MAIN_PRO2_TMR:
  555B C54D 0E3F        	LAC	PRO_VAR1
  556B C54E 0101        	ADHK	1
  557B C54F B03F        	SAH	PRO_VAR1
  558B C550 0508        	SBHK	8
  559B C551 DB00C4DA    	BS	ACZ,MAIN_PRO1_PLAY_STOP
  560B C553 D500C4DA    	BZ	SGN,MAIN_PRO1_PLAY_STOP
  561B                  	
  562B C555 F800        	RET
  563B                  ;-------
  564B                  MAIN_PRO_PLAY_ID:
  565B C556 0E3E        	LAC	PRO_VAR
  566B C557 8580FFF0    	ANDL	0XFFF0
  567B C559 0901        	ORK	1
  568B C55A B03E        	SAH	PRO_VAR
  569B                  	
  570B C55B E800        	CRAM	CONF,8
  571B C55C FC000020    	CALL	DAM_BIOS
  572B                  MAIN_PRO_PLAY_ID_END:
  573B C55E F800        	RET
  574B                  
  575B                  ;=================================================================================
  576B                  MAIN_PRO3:	;录音(MSG)状态要考虑的消息:
  577B C55F 0E3E        	LAC	PRO_VAR
  578B C560 9E04        	SFR	4
  579B C561 DB00C56E    	BS	ACZ,MAIN_PRO3_2
  580B                  MAIN_PRO3_1:	
  581B                  	
  582B                  MAIN_PRO3_1_1:	
  583B C563 0E3D        	LAC	MSG
  584B C564 868000B0    	XORL	CVP_STOP		;end of the voice prompt and begin to record
  585B C566 DB00C58A    	BS	ACZ,MAIN_PRO3_RECMEMO
  586B                  MAIN_PRO3_1_2:	
  587B C568 0E3D        	LAC	MSG
  588B C569 86800006    	XORL	CMSG_KEY6S		;press STOP key when playing voice prompt
  589B C56B DB00C583    	BS	ACZ,MAIN_PRO3_REC_END1
  590B                  	
  591B C56D F800        	RET
  592B                  ;---	
  593B                  MAIN_PRO3_2:	
  594B C56E 0E3D        	LAC	MSG
  595B C56F 86800006    	XORL	CMSG_KEY6S		;ON/OFF
  596B C571 DB00C59E    	BS	ACZ,MAIN_PRO3_REC_END
  597B                  MAIN_PRO3_2_1:
  598B C573 0E3D        	LAC	MSG
  599B C574 86800090    	XORL	CMSG_TMR		;TMR
  600B C576 DB00C5D7    	BS	ACZ,MAIN_PRO3_REC_TMR
  601B                  MAIN_PRO3_2_2:
  602B C578 0E3D        	LAC	MSG
  603B C579 868000B2    	XORL	CREC_FULL		;REC_FULL
  604B C57B DB00C5DF    	BS	ACZ,MAIN_PRO3_REC_FUL
  605B                  MAIN_PRO3_2_3:
  606B C57D 0E3D        	LAC	MSG
  607B C57E 868000B0    	XORL	CVP_STOP		;RECFULL BEEP VP END
  608B C580 DB00C5F7    	BS	ACZ,MAIN_PRO3_RECFUL_VPEND
  609B                  	
  610B C582 F800        	RET
  611B                  ;-------处理消息
  612B                  MAIN_PRO3_REC_END1:
  613B C583 0F00        	LACK	0
  614B C584 B03E        	SAH	PRO_VAR
  615B                  	
  616B C585 87800081    	LACL	CMSG_INIT
  617B C587 FC00CC19    	CALL	STOR_MSG
  618B C589 F800        	RET
  619B                  
  620B                  MAIN_PRO3_RECMEMO:
  621B                  
  622B C58A FC00C108    	CALL	MSG_CHK
  623B                  ;????????????????????????????????????????????????	
  624B                  	;CALL	TELNUM_WRITE	;????????????????
  625B                  	;CALL	GET_FILEID	;????????????????
  626B                  	;SAH	BUF1		;????????????????
  627B                  	;CALL	GET_TELT	;????????????????
  628B                  	;ORL	0XE700		;????????????????
  629B                  	;SAH	CONF		;????????????????
  630B                  	;CALL	DAM_BIOS	;????????????????
  631B                  ;????????????????????????????????????????????????
  632B                  	;CALL	GET_FILEID
  633B C58C 0E17        	LAC	FILE_ID
  634B C58D FC00DC16    	CALL	SET_USRDAT
  635B                  	
  636B                  MAIN_PRO3_REC:		;for MEMO/OGM record
  637B                  MAIN_PRO5_REC:
  638B C58F 0E3E        	LAC	PRO_VAR
  639B C590 8580FF0F    	ANDL	0XFF0F
  640B C592 B03E        	SAH	PRO_VAR
  641B                  	
  642B C593 0F00        	LACK	0
  643B C594 B03F        	SAH	PRO_VAR1
  644B C595 878003E8    	LACL	1000
  645B C597 FC00C1D6    	CALL	SET_TIMER
  646B                  	
  647B C599 FC00C180    	CALL	DAA_RECORD
  648B                  	
  649B C59B FC00CA8A    	CALL	REC_START
  650B                  	
  651B C59D F800        	RET
  652B                  MAIN_PRO3_REC_END:
  653B C59E 0E3F        	LAC	PRO_VAR1
  654B C59F 0503        	SBHK	3
  655B C5A0 D500C5AE    	BZ	SGN,MAIN_PRO3_REC_END_2	;要求同时满足录音时间t>1s&&t>VPLEN才能保留
  656B                  ;MAIN_PRO3_REC_END_1:
  657B C5A2 EB80        	SRAM	CONF,11
  658B C5A3 FC000020    	CALL	DAM_BIOS	
  659B C5A5 FC00CA4B    	CALL	INIT_DAM_FUNC
  660B                  
  661B C5A7 0F00        	LACK	0
  662B C5A8 B03E        	SAH	PRO_VAR
  663B                  
  664B C5A9 FC00D26C    	CALL	BBEEP
  665B                  	
  666B C5AB FC00C165    	CALL	DAA_SPK	
  667B                  	
  668B C5AD F800        	RET
  669B                  MAIN_PRO3_REC_END_2:
  670B C5AE 0E00        	LAC	CONF
  671B C5AF 8580FFC0    	ANDL	0XFFC0		;不准掐尾
  672B C5B1 B000        	SAH	CONF
  673B C5B2 FC00CA4B    	CALL	INIT_DAM_FUNC
  674B                  	
  675B C5B4 FC00C0FE    	CALL	GET_TOTALMSG
  676B C5B6 FC00D93F    	CALL	GET_MSGMSG
  677B C5B8 FC00D989    	CALL	WRITE_MEMOMSG
  678B                  	
  679B C5BA FC00C0FE    	CALL	GET_TOTALMSG
  680B C5BC FC00DC1E    	CALL	GET_USRDAT
  681B C5BE FC00DBC7    	CALL	COL_ICMTEL
  682B                  
  683B C5C0 FC00DBA8    	CALL	TMPNUM_DEL
  684B                  
  685B C5C2 87809150    	LACL	0X9150			;disable setting old mark
  686B C5C4 B000        	SAH	CONF
  687B C5C5 FC000020    	CALL	DAM_BIOS
  688B                  
  689B C5C7 FC00D25E    	CALL	BEEP
  690B                  	
  691B C5C9 FC00C108    	CALL	MSG_CHK
  692B                  	
  693B C5CB 0F08        	LACK	8
  694B C5CC B03E        	SAH	PRO_VAR
  695B C5CD FC00CB05    	CALL	PLY_EEXE
  696B                  	
  697B C5CF 0E16        	LAC	MSG_T
  698B C5D0 FC00DC27    	CALL	GET_VPLEN
  699B C5D2 FC00DC58    	CALL	GET_VPMSG
  700B C5D4 FC00C165    	CALL	DAA_SPK	
  701B                  	
  702B C5D6 F800        	RET
  703B                  MAIN_PRO3_REC_TMR:
  704B C5D7 0E00        	LAC	CONF
  705B C5D8 8580FFC0    	ANDL	0XFFC0
  706B C5DA B000        	SAH	CONF		;防止掐尾
  707B                  	
  708B C5DB 0E3F        	LAC	PRO_VAR1
  709B C5DC 0101        	ADHK	1
  710B C5DD B03F        	SAH	PRO_VAR1
  711B                  	
  712B C5DE F800        	RET
  713B                  ;-------
  714B                  MAIN_PRO3_REC_FUL:		;for memo record
  715B C5DF 87801040    	LACL	0X1040		;不准掐尾
  716B C5E1 B000        	SAH	CONF
  717B C5E2 FC00CA4B    	CALL	INIT_DAM_FUNC	;stop recording
  718B                  	
  719B C5E4 FC00CA9E    	CALL	GC_CHK
  720B C5E6 FC00C108    	CALL	MSG_CHK
  721B C5E8 6D11        	BIT	ANN_FG,13
  722B C5E9 D200C5F4    	BZ	TB,MAIN_PRO3_REC_FUL1
  723B                  
  724B C5EB FC00D279    	CALL	BBBEEP
  725B C5ED FC00C165    	CALL	DAA_SPK	
  726B C5EF FC00C1CA    	CALL	HOOK_ON
  727B                  	
  728B C5F1 0F00        	LACK	0
  729B C5F2 B03E        	SAH	PRO_VAR
  730B                  		
  731B C5F3 F800        	RET
  732B                  MAIN_PRO3_REC_FUL1:
  733B C5F4 FC00CA8A    	CALL	REC_START
  734B                  	
  735B C5F6 F800        	RET
  736B                  MAIN_PRO3_RECFUL_VPEND:
  737B C5F7 FC00C1CD    	CALL	HOOK_OFF
  738B C5F9 FC00C1C4    	CALL	DAA_OFF
  739B C5FB FC00CB03    	CALL	REC_EEND
  740B                  	
  741B C5FD F800        	RET
  742B                  	
  743B                  ;================================================================================
  744B                  MAIN_PRO4:	;播放(OGM)状态要考虑的消息:
  745B C5FE 0E3D        	LAC	MSG
  746B C5FF 86800005    	XORL	CMSG_KEY5S		;ERASE
  747B C601 DB00C613    	BS	ACZ,MAIN_PRO4_EXE1
  748B                  MAIN_PRO4_1:
  749B C603 0E3D        	LAC	MSG
  750B C604 86800006    	XORL	CMSG_KEY6S		;ON/OFF(stop)
  751B C606 DB00C62B    	BS	ACZ,MAIN_PRO4_EXE2
  752B                  MAIN_PRO4_2:
  753B C608 0E3D        	LAC	MSG
  754B C609 868000B0    	XORL	CVP_STOP		;play end
  755B C60B DB00C62B    	BS	ACZ,MAIN_PRO4_ENDPLY
  756B                  MAIN_PRO4_3:
  757B C60D 0E3D        	LAC	MSG
  758B C60E 86800090    	XORL	CMSG_TMR		;play end
  759B C610 DB00C627    	BS	ACZ,MAIN_PRO4_TMR
  760B C612 F800        	RET
  761B                  ;-------响应按键,消息转换
  762B                  MAIN_PRO4_EXE1:
  763B C613 0E14        	LAC	MSG_ID
  764B C614 858000FF    	ANDL	0X0FF
  765B C616 84802080    	ORL	0X2080
  766B C618 B000        	SAH	CONF
  767B C619 FC000020    	CALL	DAM_BIOS
  768B                  	
  769B C61B 87806100    	LACL	0X6100
  770B C61D B000        	SAH	CONF
  771B C61E FC000020    	CALL	DAM_BIOS
  772B                  	
  773B C620 FC00CA4B    	CALL	INIT_DAM_FUNC
  774B                  	
  775B C622 0F00        	LACK	0
  776B C623 B03E        	SAH	PRO_VAR
  777B                  
  778B C624 FC00D26C    	CALL	BBEEP		;替换语音BB
  779B                  	
  780B C626 F800        	RET
  781B                  MAIN_PRO4_TMR:
  782B C627 0E3F        	LAC	PRO_VAR1
  783B C628 0101        	ADHK	1
  784B C629 B03F        	SAH	PRO_VAR1
  785B                  	
  786B C62A F800        	RET
  787B                  MAIN_PRO4_EXE2:
  788B                  	;LAC	PRO_VAR1
  789B                  	;SBHK	2
  790B                  	;BZ	SGN,MAIN_PRO4_ENDPLY	;播放时间小于2秒就不响应停止命令
  791B                  	;CALL	PLY_EEXE
  792B                  	;RET
  793B                  MAIN_PRO4_ENDPLY:
  794B C62B FC00CA4B    	CALL	INIT_DAM_FUNC
  795B                  	
  796B C62D 0F00        	LACK	0
  797B C62E B03E        	SAH	PRO_VAR
  798B C62F FC00D26C    	CALL	BBEEP		;加语音BB
  799B                  
  800B C631 F800        	RET
  801B                  ;================================================================================
  802B                  MAIN_PRO5:	;录音(OGM)状态要考虑的消息:
  803B C632 0E3E        	LAC	PRO_VAR
  804B C633 9E04        	SFR	4
  805B C634 DB00C65C    	BS	ACZ,MAIN_PRO5_4
  806B                  	
  807B C636 0E3D        	LAC	MSG
  808B                  	;XORL	CMSG_KEY3S		;released OGM key when playing voice prompt
  809B C637 86800006    	XORL	CMSG_KEY6S
  810B C639 DB00C583    	BS	ACZ,MAIN_PRO3_REC_END1
  811B                  MAIN_PRO5_1:	
  812B C63B 0E3D        	LAC	MSG
  813B C63C 868000B0    	XORL	CVP_STOP		;end of the voice prompt and begin to record
  814B C63E DB00C641    	BS	ACZ,MAIN_PRO5_2
  815B C640 F800        	RET
  816B                  MAIN_PRO5_2:
  817B                  	;CALL	OGM_STATUS
  818B C641 0E15        	LAC	MSG_N
  819B C642 FC00D224    	CALL	OGM_CHK
  820B                  ;-------delete the old OGM----------------	
  821B C644 0E14        	LAC	MSG_ID
  822B C645 858000FF    	ANDL	0X0FF
  823B C647 84802080    	ORL	0X2080
  824B C649 B000        	SAH	CONF
  825B C64A FC000020    	CALL	DAM_BIOS
  826B                  	
  827B C64C 0E00        	LAC	CONF
  828B C64D 8580007F    	ANDL	0X007F
  829B C64F 84806100    	ORL	0X6100
  830B C651 B000        	SAH	CONF
  831B C652 FC000020    	CALL	DAM_BIOS
  832B                  	
  833B C654 0E15            	LAC	MSG_N
  834B C655 84807500        	ORL	0X7500
  835B C657 B000            	SAH	CONF
  836B C658 FC000020        	CALL	DAM_BIOS		;set user index data0"OGM_ID"
  837B C65A DF00C58F    	BS	B1,MAIN_PRO5_REC
  838B                  ;---	
  839B                  MAIN_PRO5_4:	
  840B C65C 0E3D        	LAC	MSG
  841B C65D 86800006    	XORL	CMSG_KEY6S		;ON/OFF
  842B C65F DB00C66C    	BS	ACZ,MAIN_PRO5_5
  843B                  MAIN_PRO5_4_1:
  844B C661 0E3D        	LAC	MSG
  845B C662 86800090    	XORL	CMSG_TMR		;TMR
  846B C664 DB00C682    	BS	ACZ,MAIN_PRO5_6	
  847B                  MAIN_PRO5_4_2:
  848B C666 0E3D        	LAC	MSG
  849B C667 868000B2    	XORL	CREC_FULL		;REC_FULL
  850B C669 DB00C68B    	BS	ACZ,MAIN_PRO5_REC_FUL
  851B                  	
  852B C66B F800        	RET
  853B                  MAIN_PRO5_5:
  854B                  	
  855B C66C 0E3F        	LAC	PRO_VAR1
  856B C66D 0503        	SBHK	3
  857B C66E DB00C675    	BS	ACZ,MAIN_PRO5_5_1
  858B C670 D500C675    	BZ	SGN,MAIN_PRO5_5_1
  859B C672 EB80        	SRAM	CONF,11
  860B C673 FC000020    	CALL	DAM_BIOS
  861B                  MAIN_PRO5_5_1:	
  862B C675 0E00        	LAC	CONF
  863B C676 8580F000    	ANDL	0XF000			;不准掐尾
  864B C678 B000        	SAH	CONF
  865B C679 FC00CA4B    	CALL	INIT_DAM_FUNC
  866B                  	
  867B C67B 0F00        	LACK	0
  868B C67C B03E        	SAH	PRO_VAR
  869B                  	
  870B C67D 87800003    	LACL	CMSG_KEY3S		;停止录音(OGM)相当于播放(OGM)
  871B C67F FC00CC19    	CALL	STOR_MSG
  872B                  		
  873B C681 F800        	RET
  874B                  MAIN_PRO5_6:
  875B C682 0E3F        	LAC	PRO_VAR1
  876B C683 0101        	ADHK	1
  877B C684 B03F        	SAH	PRO_VAR1
  878B C685 0578        	SBHK	120
  879B C686 DB00C66C    	BS	ACZ,MAIN_PRO5_5
  880B C688 D500C66C    	BZ	SGN,MAIN_PRO5_5
  881B                  	
  882B C68A F800        	RET
  883B                  MAIN_PRO5_REC_FUL:		;for OGM record
  884B C68B FC00C1D9    	CALL	CLR_TIMER
  885B                  	
  886B C68D 87801000    	LACL	0X1000		;不准掐尾
  887B C68F B000        	SAH	CONF
  888B C690 FC00CA4B    	CALL	INIT_DAM_FUNC		;stop recording
  889B                  	
  890B C692 FC00D26C    	CALL	BBEEP		;录音满语音BB
  891B C694 FC00C165    	CALL	DAA_SPK	
  892B C696 FC00C1CA    	CALL	HOOK_ON
  893B                  	
  894B C698 0F00        	LACK	0
  895B C699 B03E        	SAH	PRO_VAR
  896B                  	
  897B C69A F800        	RET
  898B                  ;-------------------------------------------------------------------------------
  899B                  MAIN_PRO6:	;???TestMode
  900B C69B 0E3D        	LAC	MSG
  901B C69C 868000B0    	XORL	CVP_STOP		;play end
  902B C69E DB00C6A6    	BS	ACZ,MAIN_PRO6_VPSTOP
  903B                  	
  904B C6A0 0E3D        	LAC	MSG
  905B C6A1 868000B3    	XORL	CMSG_TEST
  906B C6A3 DB00C6AB    	BS	ACZ,MAIN_PRO6_ETEST
  907B                  
  908B C6A5 F800        	RET
  909B                  MAIN_PRO6_VPSTOP:
  910B C6A6 878020FF    	LACL	0X20FF
  911B C6A8 FC00CC52    	CALL	STOR_VP
  912B                  	
  913B C6AA F800        	RET
  914B                  MAIN_PRO6_ETEST:
  915B C6AB FC00CA4B    	CALL	INIT_DAM_FUNC
  916B C6AD 87800081    	LACL	CMSG_INIT
  917B C6AF FC00CC19    	CALL	STOR_MSG
  918B                  	
  919B C6B1 0F00        	LACK	0
  920B C6B2 B03E        	SAH	PRO_VAR
  921B                  
  922B C6B3 F800        	RET
  923B                  ;-------------------------------------------------------------------------------
  924B                  MAIN_PRO7:	;音量设置状态要考虑的消息:
  925B                  	
  926B C6B4 F800        	RET
  927B                  ;---------------
  928B                  MAIN_PRO8:	;回放MEMO状态要考虑的消息:
  929B C6B5 0E3D        	LAC	MSG
  930B C6B6 86800006    	XORL	CMSG_KEY6S		;ON/OFF(stop)
  931B C6B8 DB00C6D7    	BS	ACZ,MAIN_PRO8_2_1
  932B                  MAIN_PRO8_1:
  933B C6BA 0E3D        	LAC	MSG
  934B C6BB 86800005    	XORL	CMSG_KEY5S		;eraser
  935B C6BD DB00C6C5    	BS	ACZ,MAIN_PRO8_1_1
  936B                  MAIN_PRO8_2:
  937B C6BF 0E3D        	LAC	MSG
  938B C6C0 868000B0    	XORL	CVP_STOP		;PLAY END
  939B C6C2 DB00C6D7    	BS	ACZ,MAIN_PRO8_2_1
  940B                  			
  941B C6C4 F800        	RET
  942B                  ;---
  943B                  MAIN_PRO8_1_1:
  944B C6C5 FC00CA4B    	CALL	INIT_DAM_FUNC
  945B                  	
  946B C6C7 0E16        	LAC	MSG_T
  947B C6C8 84806000    	ORL	0X6000
  948B C6CA B000        	SAH	CONF
  949B C6CB FC000020    	CALL	DAM_BIOS
  950B                  	
  951B C6CD 87809050    	LACL	0X9050
  952B C6CF B000        	SAH	CONF
  953B C6D0 FC000020    	CALL	DAM_BIOS
  954B                  	
  955B C6D2 0F00        	LACK	0
  956B C6D3 B03E        	SAH	PRO_VAR
  957B C6D4 FC00D26C    	CALL	BBEEP	;替换语音BB	
  958B                  	
  959B C6D6 F800        	RET
  960B                  ;---
  961B                  MAIN_PRO8_2_1:
  962B C6D7 FC00CA4B    	CALL	INIT_DAM_FUNC
  963B                  	
  964B C6D9 87809050    	LACL	0X9050
  965B C6DB B000        	SAH	CONF
  966B C6DC FC000020    	CALL	DAM_BIOS
  967B                  	
  968B C6DE 0F00        	LACK	0
  969B C6DF B03E        	SAH	PRO_VAR
  970B C6E0 FC00D26C    	CALL	BBEEP	;替换语音BB
  971B                  	
  972B C6E2 F800        	RET
  973B                  ;-----------
  974B                  
  975B                  ;=========================================================================
  976B                  
  977B                  	
  978B                  .END
 1184A                  .INCLUDE sys.asm
    1B                  .LIST
    2B                  ;---------------------------
    3B                  SYS_MSG:
    4B C6E3 0E3D        	LAC	MSG
    5B C6E4 86800093    	XORL	CSEG_END		;SEG_END
    6B C6E6 DB00C709    	BS	ACZ,SYS_SEG_END
    7B                  SYS_MSG0:
    8B C6E8 0E3D        	LAC	MSG
    9B C6E9 86800089    	XORL	CSEG_STOP		;SEG_STOP
   10B C6EB DB00C719    	BS	ACZ,SYS_SEG_STOP
   11B                  SYS_MSG1:
   12B C6ED 0E3D        	LAC	MSG
   13B C6EE 86800094    	XORL	CMSG_TMR2		;时钟
   14B C6F0 DB00C71D    	BS	ACZ,SYS_SYS_TMR
   15B                  ;---------------------------------------传递消息区
   16B                  SYS_MSG2:
   17B                  	;LAC	MSG
   18B                  	;XORL	CREC_FULL		;REC_FULL
   19B                  	;BS	ACZ,SYS_REC_FULL
   20B                  SYS_MSG3:
   21B                  	;LAC	MSG
   22B                  	;XORL	CREC_STOP		;REC_STOP
   23B                  	;BS	ACZ,SYS_REC_STOP
   24B                  SYS_MSG4:	
   25B                  	;LAC	MSG
   26B                  	;XORL	CMSG_VOLA
   27B                  	;BS	ACZ,SYS_VOL_ADD		;VOL+
   28B                  SYS_MSG5:	
   29B                  	;LAC	MSG
   30B                  	;XORL	CMSG_VOLS
   31B                  	;BS	ACZ,SYS_VOL_SUB		;VOL-
   32B                  SYS_MSG6:	
   33B C6F2 0E3D        	LAC	MSG
   34B C6F3 86800082    	XORL	CRING_OK
   35B C6F5 DB00C774    	BS	ACZ,SYS_MSG_RUN_ICM
   36B                  SYS_MSG7:	
   37B C6F7 0E3D        	LAC	MSG
   38B C6F8 86800091    	XORL	CMSG_LED
   39B C6FA DB00C78B    	BS	ACZ,SYS_LED_FLASH
   40B                  SYS_MSG8:	
   41B C6FC 0E3D        	LAC	MSG
   42B C6FD 86800092    	XORL	CNO_NMSG
   43B C6FF DB00C797    	BS	ACZ,SYS_NO_NMSG
   44B                  SYS_MSG9:	
   45B                  	
   46B                  SYS_MSG10:	
   47B C701 0E3D        	LAC	MSG
   48B C702 86800087    	XORL	CMSG_SER
   49B C704 DB00C79D    	BS	ACZ,SYS_SER_RUN
   50B                  
   51B                  ;============================================================功能区
   52B                  
   53B                  SYS_MSG_NO:
   54B C706 F800        	RET				;NO
   55B                  
   56B                  SYS_MSG_YES:				;ACK
   57B C707 0F00        	LACK	0
   58B C708 F800        	RET
   59B                  
   60B                  ;---------------
   61B                  SYS_SEG_END:
   62B C709 FC00CC3D    	CALL	GET_VP
   63B C70B DB00C711    	BS	ACZ,SYS_SEG_END0
   64B C70D FC00CA0E    	CALL	INT_BIOS_START
   65B C70F DF00C707    	BS	B1,SYS_MSG_YES
   66B                  SYS_SEG_END0:
   67B C711 FC00CA4B    	CALL	INIT_DAM_FUNC
   68B C713 878000B0    	LACL	CVP_STOP		;通知系统播放完毕
   69B C715 FC00CC19    	CALL	STOR_MSG
   70B C717 DF00C707    	BS	B1,SYS_MSG_YES
   71B                  ;---
   72B                  SYS_SEG_STOP:
   73B C719 DF00C711    	BS	B1,SYS_SEG_END0	
   74B                  ;---
   75B                  SYS_REC_STOP:
   76B                  	
   77B C71B DF00C707    	BS	B1,SYS_MSG_YES
   78B                  ;---
   79B                  SYS_SYS_TMR:
   80B C71D 0E3B        	LAC	PRO_VAR2
   81B C71E 0101        	ADHK	1
   82B C71F 85807FFF    	ANDL	0X7FFF
   83B C721 B03B        	SAH	PRO_VAR2
   84B                  ;---
   85B C722 0E3B        	LAC	PRO_VAR2
   86B C723 0501        	SBHK	1
   87B C724 D300C733    	BZ	ACZ,SYS_SYS_TMR1
   88B C726 0E19        	LAC	RING_ID
   89B C727 0B0F        	ANDK	0X0F
   90B C728 DB00C733    	BS	ACZ,SYS_SYS_TMR1
   91B C72A 043A        	SBH	RING_CNT
   92B C72B D300C733    	BZ	ACZ,SYS_SYS_TMR1
   93B                  	
   94B C72D 87800082    	LACL	CRING_OK	;来铃次数达到摘机次数而且延后1秒后开始摘机
   95B C72F FC00CC19            CALL	STOR_MSG
   96B                          
   97B C731 0F00                LACK	0
   98B C732 B03A        	SAH	RING_CNT
   99B                  SYS_SYS_TMR1:
  100B                  ;---	
  101B C733 0E3B        	LAC	PRO_VAR2
  102B                  	;SBHK	8
  103B C734 0506        	SBHK	6		;来铃次超时改为“6s”---2006/10/12
  104B C735 DD00C739    	BS	SGN,SYS_SYS_TMR2
  105B C737 0F00        	LACK	0
  106B C738 B03A        	SAH	RING_CNT
  107B                  SYS_SYS_TMR2:
  108B C739 DF00C707    	BS	B1,SYS_MSG_YES
  109B                  ;-------
  110B                  SYS_REC_FULL:
  111B                  	;CALL	INIT_DAM_FUNC		;stop recording
  112B                  	;SRAM	ANN_FG,13		;告诉"mcu"MEMOFUL(录音时的假memoful-12.8kbps/162s-4.8kbps/733s)
  113B                  
  114B                  	;BS	B1,SYS_MSG_YES
  115B                  ;---
  116B                  SYS_VOL_ADD:
  117B C73B 0E0F        	LAC	CODECREG2
  118B C73C 8580FF0F    	ANDL	0XFF0F
  119B C73E B00F                SAH	CODECREG2
  120B                  	
  121B C73F 0E1E                LAC	VOI_ATT
  122B C740 85800007            ANDL	0X07
  123B C742 0507                SBHK	7
  124B C743 DB00C748            BS	ACZ,SYS_VOL_ADD1
  125B C745 0E1E                LAC	VOI_ATT
  126B C746 0101                ADHK	1
  127B C747 B01E                SAH	VOI_ATT
  128B                  SYS_VOL_ADD1:
  129B C748 0E1E        	LAC	VOI_ATT
  130B C749 85800007    	ANDL	0X07
  131B C74B 8080C31A            ADHL    VOL_TAB
  132B C74D 1100                RPTK    0
  133B C74E CC64                TBR     SYSTMP
  134B C74F 0E64                LAC     SYSTMP    
  135B C750 84800003            ORL	0X03
  136B C752 080F                OR	CODECREG2
  137B C753 B00F                SAH	CODECREG2
  138B                  	
  139B C754 FC00C1BD    	call    InSetCodecReg
  140B C756 DF00C707    	BS	B1,SYS_MSG_YES
  141B                  SYS_VOL_SUB:
  142B C758 0E0F        	LAC	CODECREG2
  143B C759 8580FF0F    	ANDL	0XFF0F
  144B C75B B00F                SAH	CODECREG2
  145B                  	
  146B C75C 0E1E        	LAC	VOI_ATT
  147B C75D 85800007            ANDL	0X07
  148B C75F DB00C764            BS	ACZ,SYS_VOL_SUB1
  149B C761 0E1E                LAC	VOI_ATT
  150B C762 0501        	SBHK	1
  151B C763 B01E                SAH	VOI_ATT
  152B                  SYS_VOL_SUB1:
  153B C764 0E1E        	LAC	VOI_ATT
  154B C765 85800007    	ANDL	0X07
  155B C767 8080C31A            ADHL    VOL_TAB
  156B C769 1100                RPTK    0
  157B C76A CC64                TBR     SYSTMP
  158B C76B 0E64                LAC     SYSTMP    
  159B C76C 84800003            ORL	0X03
  160B C76E 080F                OR	CODECREG2
  161B C76F B00F                SAH	CODECREG2
  162B                  	
  163B C770 FC00C1BD    	call    InSetCodecReg
  164B C772 DF00C707    	BS	B1,SYS_MSG_YES
  165B                  SYS_MSG_RUN_ICM:
  166B                  
  167B C774 87800092    	LACL	CNO_NMSG
  168B C776 FC00CC19    	CALL	STOR_MSG	;LED不要闪烁了(进入答录)
  169B                  	
  170B C778 FC00CC38         	CALL	CLR_FUNC	;先空
  171B C77A 8780CC62        	LACL	ICM_STATE
  172B C77C FC00CC2B         	CALL	PUSH_FUNC
  173B                       	
  174B C77E FC00CB09         	CALL	REMT_EEXE
  175B                       	
  176B C780 0E19             	LAC	RING_ID
  177B C781 9C0C             	SFL	12
  178B C782 B019             	SAH	RING_ID		;保存在最高四位
  179B                       	
  180B C783 87800081      	LACL	CMSG_INIT
  181B C785 FC00CC19       	CALL	STOR_MSG
  182B                     	
  183B C787 0F00           	LACK	0
  184B C788 B03E           	SAH	PRO_VAR
  185B C789 DF00C707      	BS	B1,SYS_MSG_YES
  186B                  ;-------
  187B                  SYS_LED_FLASH:
  188B                  	;BIT	EVENT,0
  189B                  	;BS	TB,SYS_LED_FLASH1	;查是工作状态吗?
  190B C78B 0E10        	LAC	EVENT
  191B C78C 0B0F        	ANDK	0X0F
  192B C78D D300C793    	BZ	ACZ,SYS_LED_FLASH1
  193B                  	
  194B C78F FC00CAF2    	CALL	LED_FLASH
  195B C791 DF00C795    	BS	B1,SYS_LED_FLASH_END
  196B                  SYS_LED_FLASH1:
  197B C793 FC00CAEC    	CALL	LED_ON
  198B                  SYS_LED_FLASH_END:
  199B C795 DF00C707    	BS	B1,SYS_MSG_YES
  200B                  ;-------
  201B                  SYS_NO_NMSG:
  202B C797 FC00C1E0    	CALL	CLR_LEDTIMER
  203B C799 FC00CAEC    	CALL	LED_ON
  204B C79B DF00C707    	BS	B1,SYS_MSG_YES
  205B                  
  206B                  ;-------检查收到的命令
  207B                  SYS_SER_RUN:
  208B                  	
  209B                  .IF	TEXT_SIOVP	;;;;;;;;;;;;;;;;;;;;;;;;;
  210B                  
  211B                  	LAC	RECE_BUF1
  212B                  	ANDL	0X0FF
  213B                  	XORL	0X8F
  214B                  	BS	ACZ,TEXTA11
  215B                  	
  216B                  	;CALL	INIT_DAM_FUNC
  217B                  	;BS	B1,SYS_SER_RUN_ENDT
  218B                  	
  219B                  	LAC	RECE_BUF1		;BYTE 1(command)
  220B                  	SFR	4
  221B                  	ANDL	0X0F
  222B                  	ORL	0XFF00
  223B                  	CALL	STOR_VP
  224B                  	LAC	RECE_BUF1
  225B                  	ANDL	0X0F
  226B                  	ORL	0XFF00
  227B                  	CALL	STOR_VP
  228B                  	
  229B                  	LAC	RECE_BUF1		;BYTE 2(second)
  230B                  	SFR	12
  231B                  	ANDL	0X0F
  232B                  	ORL	0XFF00
  233B                  	CALL	STOR_VP
  234B                  	LAC	RECE_BUF1
  235B                  	SFR	8
  236B                  	ANDL	0X0F
  237B                  	ORL	0XFF00
  238B                  	CALL	STOR_VP
  239B                  ;111111111111111111111111111111111111111111111111	
  240B                  	LAC	RECE_BUF2
  241B                  	ANDL	0X0FF
  242B                  	SBHL	0X0FF
  243B                  	BS	ACZ,SYS_SER_RUN_ENDT
  244B                  	LAC	RECE_BUF2		;BYTE 3(minute)
  245B                  	SFR	4
  246B                  	ANDL	0X0F
  247B                  	ORL	0XFF00
  248B                  	CALL	STOR_VP
  249B                  	LAC	RECE_BUF2
  250B                  	ANDL	0X0F
  251B                  	ORL	0XFF00
  252B                  	CALL	STOR_VP
  253B                  	
  254B                  	LAC	RECE_BUF2		;BYTE 4(hour)
  255B                  	SFR	12
  256B                  	ANDL	0X0F
  257B                  	ORL	0XFF00
  258B                  	CALL	STOR_VP
  259B                  	LAC	RECE_BUF2
  260B                  	SFR	8
  261B                  	ANDL	0X0F
  262B                  	ORL	0XFF00
  263B                  	CALL	STOR_VP
  264B                  ;222222222222222222222222222222222222222222222222	
  265B                  	LAC	RECE_BUF3
  266B                  	ANDL	0X0FF
  267B                  	SBHL	0X0FF
  268B                  	BS	ACZ,SYS_SER_RUN_ENDT
  269B                  	LAC	RECE_BUF3		;BYTE 5(day)
  270B                  	SFR	4
  271B                  	ANDL	0X0F
  272B                  	ORL	0XFF00
  273B                  	CALL	STOR_VP
  274B                  	LAC	RECE_BUF3
  275B                  	ANDL	0X0F
  276B                  	ORL	0XFF00
  277B                  	CALL	STOR_VP
  278B                  	
  279B                  	LAC	RECE_BUF3		;BYTE 6(month)
  280B                  	SFR	12
  281B                  	ANDL	0X0F
  282B                  	ORL	0XFF00
  283B                  	CALL	STOR_VP
  284B                  	LAC	RECE_BUF3
  285B                  	SFR	8
  286B                  	ANDL	0X0F
  287B                  	ORL	0XFF00
  288B                  	CALL	STOR_VP
  289B                  ;333333333333333333333333333333333333333333333333	
  290B                  	LAC	RECE_BUF4
  291B                  	ANDL	0X0FF
  292B                  	SBHL	0X0FF
  293B                  	BS	ACZ,SYS_SER_RUN_ENDT
  294B                  	LAC	RECE_BUF4		;BYTE 7(year)
  295B                  	SFR	4
  296B                  	ANDL	0X0F
  297B                  	ORL	0XFF00
  298B                  	CALL	STOR_VP
  299B                  	LAC	RECE_BUF4
  300B                  	ANDL	0X0F
  301B                  	ORL	0XFF00
  302B                  	CALL	STOR_VP
  303B                  TEXTA11:	;?????????????????	TEL length
  304B                  	CALL	INIT_DAM_FUNC
  305B                  	
  306B                  	LAC	RECE_BUF4		;BYTE 8(TEL length)
  307B                  	SFR	12
  308B                  	ANDL	0X0F
  309B                  	ADHK	1		;????????????????
  310B                  	ORL	0XFF00
  311B                  	CALL	STOR_VP
  312B                  	LAC	RECE_BUF4
  313B                  	SFR	8
  314B                  	ANDL	0X0F
  315B                  	ADHK	1		;????????????????
  316B                  	ORL	0XFF00
  317B                  	CALL	STOR_VP
  318B                  ;444444444444444444444444444444444444444444444444	
  319B                  	LAC	RECE_BUF5		;BYTE 9(TEL NUM1)
  320B                  	ANDL	0X0FF
  321B                  	SBHL	0X0FF
  322B                  	BS	ACZ,SYS_SER_RUN_ENDT
  323B                  	LAC	RECE_BUF5
  324B                  	SFR	4
  325B                  	ANDL	0X0F
  326B                  	ADHK	1		;????????????????
  327B                  	ORL	0XFF00
  328B                  	CALL	STOR_VP
  329B                  	LAC	RECE_BUF5
  330B                  	ANDL	0X0F
  331B                  	ADHK	1		;????????????????
  332B                  	ORL	0XFF00
  333B                  	CALL	STOR_VP
  334B                  	
  335B                  	LAC	RECE_BUF5		;BYTE 10(TEL NUM2)
  336B                  	SFR	12
  337B                  	ANDL	0X0F
  338B                  	ADHK	1		;????????????????
  339B                  	ORL	0XFF00
  340B                  	CALL	STOR_VP
  341B                  	LAC	RECE_BUF5
  342B                  	SFR	8
  343B                  	ANDL	0X0F
  344B                  	ADHK	1		;????????????????
  345B                  	ORL	0XFF00
  346B                  	CALL	STOR_VP
  347B                  	
  348B                  ;555555555555555555555555555555555555555555555555
  349B                  	LAC	RECE_BUF6		;BYTE 11(TEL NUM3)
  350B                  	ANDL	0X0FF
  351B                  	SBHL	0X0FF
  352B                  	BS	ACZ,SYS_SER_RUN_ENDT
  353B                  	LAC	RECE_BUF6
  354B                  	SFR	4
  355B                  	ANDL	0X0F
  356B                  	ADHK	1		;????????????????
  357B                  	ORL	0XFF00
  358B                  	CALL	STOR_VP
  359B                  	LAC	RECE_BUF6
  360B                  	ANDL	0X0F
  361B                  	ADHK	1		;????????????????
  362B                  	ORL	0XFF00
  363B                  	CALL	STOR_VP
  364B                  	
  365B                  	LAC	RECE_BUF6		;BYTE 12(TEL NUM4)
  366B                  	SFR	12
  367B                  	ANDL	0X0F
  368B                  	ADHK	1		;????????????????
  369B                  	ORL	0XFF00
  370B                  	CALL	STOR_VP
  371B                  	LAC	RECE_BUF6
  372B                  	SFR	8
  373B                  	ANDL	0X0F
  374B                  	ADHK	1		;????????????????
  375B                  	ORL	0XFF00
  376B                  	CALL	STOR_VP
  377B                  	
  378B                  ;66666666666666666666666666666666666666666666666
  379B                  	LAC	RECE_BUF7		;BYTE 13(TEL NUM5)
  380B                  	ANDL	0X0FF
  381B                  	SBHL	0X0FF
  382B                  	BS	ACZ,SYS_SER_RUN_ENDT
  383B                  	LAC	RECE_BUF7
  384B                  	SFR	4
  385B                  	ANDL	0X0F
  386B                  	ADHK	1		;????????????????
  387B                  	ORL	0XFF00
  388B                  	CALL	STOR_VP
  389B                  	LAC	RECE_BUF7
  390B                  	ANDL	0X0F
  391B                  	ADHK	1		;????????????????
  392B                  	ORL	0XFF00
  393B                  	CALL	STOR_VP
  394B                  	
  395B                  	LAC	RECE_BUF7		;BYTE 14(TEL NUM6)
  396B                  	SFR	12
  397B                  	ANDL	0X0F
  398B                  	ADHK	1		;????????????????
  399B                  	ORL	0XFF00
  400B                  	CALL	STOR_VP
  401B                  	LAC	RECE_BUF7
  402B                  	SFR	8
  403B                  	ANDL	0X0F
  404B                  	ADHK	1		;????????????????
  405B                  	ORL	0XFF00
  406B                  	CALL	STOR_VP
  407B                  	
  408B                  ;77777777777777777777777777777777777777777777777
  409B                  	LAC	RECE_BUF8		;BYTE 15(TEL NUM7)
  410B                  	ANDL	0X0FF
  411B                  	SBHL	0X0FF
  412B                  	BS	ACZ,SYS_SER_RUN_ENDT
  413B                  	LAC	RECE_BUF8
  414B                  	SFR	4
  415B                  	ANDL	0X0F
  416B                  	ADHK	1		;????????????????
  417B                  	ORL	0XFF00
  418B                  	CALL	STOR_VP
  419B                  	LAC	RECE_BUF8
  420B                  	ANDL	0X0F
  421B                  	ADHK	1		;????????????????
  422B                  	ORL	0XFF00
  423B                  	CALL	STOR_VP
  424B                  	
  425B                  	LAC	RECE_BUF8		;BYTE 16(TEL NUM8)
  426B                  	SFR	12
  427B                  	ANDL	0X0F
  428B                  	ADHK	1		;????????????????
  429B                  	ORL	0XFF00
  430B                  	CALL	STOR_VP
  431B                  	LAC	RECE_BUF8
  432B                  	SFR	8
  433B                  	ANDL	0X0F
  434B                  	ADHK	1		;????????????????
  435B                  	ORL	0XFF00
  436B                  	CALL	STOR_VP
  437B                  ;888888888888888888888888888888888888888888888888
  438B                  	LAC	RECE_BUF9		;BYTE 17(TEL NUM9)
  439B                  	ANDL	0X0FF
  440B                  	SBHL	0X0FF
  441B                  	BS	ACZ,SYS_SER_RUN_ENDT
  442B                  	LAC	RECE_BUF9
  443B                  	SFR	4
  444B                  	ANDL	0X0F
  445B                  	ADHK	1		;????????????????
  446B                  	ORL	0XFF00
  447B                  	CALL	STOR_VP
  448B                  	LAC	RECE_BUF9
  449B                  	ANDL	0X0F
  450B                  	ADHK	1		;????????????????
  451B                  	ORL	0XFF00
  452B                  	CALL	STOR_VP
  453B                  	
  454B                  	LAC	RECE_BUF9		;BYTE 18(TEL NUM10)
  455B                  	SFR	12
  456B                  	ANDL	0X0F
  457B                  	ADHK	1		;????????????????
  458B                  	ORL	0XFF00
  459B                  	CALL	STOR_VP
  460B                  	LAC	RECE_BUF9
  461B                  	SFR	8
  462B                  	ANDL	0X0F
  463B                  	ADHK	1		;????????????????
  464B                  	ORL	0XFF00
  465B                  	CALL	STOR_VP
  466B                  ;999999999999999999999999999999999999999999999999
  467B                  	LAC	RECE_BUF10
  468B                  	ANDL	0X0FF
  469B                  	SBHL	0X0FF
  470B                  	BS	ACZ,SYS_SER_RUN_ENDT
  471B                  	LAC	RECE_BUF10
  472B                  	SFR	4
  473B                  	ANDL	0X0F
  474B                  	ADHK	1		;????????????????
  475B                  	ORL	0XFF00
  476B                  	CALL	STOR_VP
  477B                  	LAC	RECE_BUF10
  478B                  	ANDL	0X0F
  479B                  	ADHK	1		;????????????????
  480B                  	ORL	0XFF00
  481B                  	CALL	STOR_VP
  482B                  	
  483B                  	LAC	RECE_BUF10
  484B                  	SFR	12
  485B                  	ANDL	0X0F
  486B                  	ADHK	1		;????????????????
  487B                  	ORL	0XFF00
  488B                  	CALL	STOR_VP
  489B                  	LAC	RECE_BUF10
  490B                  	SFR	8
  491B                  	ANDL	0X0F
  492B                  	ADHK	1		;????????????????
  493B                  	ORL	0XFF00
  494B                  	CALL	STOR_VP
  495B                  ;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  496B                  	LAC	RECE_BUF11
  497B                  	ANDL	0X0FF
  498B                  	SBHL	0X0FF
  499B                  	BS	ACZ,SYS_SER_RUN_ENDT
  500B                  	LAC	RECE_BUF11
  501B                  	SFR	4
  502B                  	ANDL	0X0F
  503B                  	ADHK	1		;????????????????
  504B                  	ORL	0XFF00
  505B                  	CALL	STOR_VP
  506B                  	LAC	RECE_BUF11
  507B                  	ANDL	0X0F
  508B                  	ADHK	1		;????????????????
  509B                  	ORL	0XFF00
  510B                  	CALL	STOR_VP
  511B                  	
  512B                  	LAC	RECE_BUF11
  513B                  	SFR	12
  514B                  	ANDL	0X0F
  515B                  	ADHK	1		;????????????????
  516B                  	ORL	0XFF00
  517B                  	CALL	STOR_VP
  518B                  	LAC	RECE_BUF11
  519B                  	SFR	8
  520B                  	ANDL	0X0F
  521B                  	ADHK	1		;????????????????
  522B                  	ORL	0XFF00
  523B                  	CALL	STOR_VP
  524B                  ;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
  525B                  	LAC	RECE_BUF12
  526B                  	ANDL	0X0FF
  527B                  	SBHL	0X0FF
  528B                  	BS	ACZ,SYS_SER_RUN_ENDT
  529B                  	LAC	RECE_BUF12
  530B                  	SFR	4
  531B                  	ANDL	0X0F
  532B                  	ADHK	1		;????????????????
  533B                  	ORL	0XFF00
  534B                  	CALL	STOR_VP
  535B                  	LAC	RECE_BUF12
  536B                  	ANDL	0X0F
  537B                  	ADHK	1		;????????????????
  538B                  	ORL	0XFF00
  539B                  	CALL	STOR_VP
  540B                  	
  541B                  	LAC	RECE_BUF12
  542B                  	SFR	12
  543B                  	ANDL	0X0F
  544B                  	ADHK	1		;????????????????
  545B                  	ORL	0XFF00
  546B                  	CALL	STOR_VP
  547B                  	LAC	RECE_BUF12
  548B                  	SFR	8
  549B                  	ANDL	0X0F
  550B                  	ADHK	1		;????????????????
  551B                  	ORL	0XFF00
  552B                  	CALL	STOR_VP
  553B                  ;CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
  554B                  SYS_SER_RUN_ENDT:
  555B                  	CALL	DAA_SPK	
  556B                  	BS	B1,SYS_MSG_YES
  557B                  .ELSE	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  558B                  
  559B                  ;;;;;;;;for text end
  560B                  SYS_SER_RUN1_1:
  561B C79D 0E6A        	LAC	RECE_BUF1
  562B C79E 858000FF    	ANDL	0X0FF
  563B C7A0 868000A7    	XORL	0XA7
  564B C7A2 DB00C86A    	BS	ACZ,SYS_SER_RUN_TEST
  565B                  SYS_SER_RUN1_2:
  566B C7A4 0E6A        	LAC	RECE_BUF1
  567B C7A5 858000FF    	ANDL	0X0FF
  568B C7A7 86800081    	XORL	0X81
  569B C7A9 DB00C870    	BS	ACZ,SYS_SER_RUN_LANGUAGE
  570B                  SYS_SER_RUN1_3:
  571B C7AB 0E6A        	LAC	RECE_BUF1
  572B C7AC 858000FF    	ANDL	0X0FF
  573B C7AE 86800082    	XORL	0X82
  574B C7B0 DB00C877    	BS	ACZ,SYS_SER_RUN_DATET
  575B                  SYS_SER_RUN1_4:
  576B C7B2 0E6A        	LAC	RECE_BUF1
  577B C7B3 858000FF    	ANDL	0X0FF
  578B C7B5 86800083    	XORL	0X83
  579B C7B7 DB00C929    	BS	ACZ,SYS_SER_RUN_RINGN
  580B                  SYS_SER_RUN1_5:
  581B                  	
  582B                  SYS_SER_RUN1_6:
  583B C7B9 0E6A        	LAC	RECE_BUF1
  584B C7BA 858000FF    	ANDL	0X0FF
  585B C7BC 86800085    	XORL	0X85
  586B C7BE DB00C956    	BS	ACZ,SYS_SER_RUN_ONOFF
  587B                  SYS_SER_RUN1_7:
  588B C7C0 0E6A        	LAC	RECE_BUF1
  589B C7C1 858000FF    	ANDL	0X0FF
  590B C7C3 86800086    	XORL	0X86
  591B C7C5 DB00C956    	BS	ACZ,SYS_SER_RUN_ONOFF
  592B                  SYS_SER_RUN1_8:
  593B C7C7 0E6A        	LAC	RECE_BUF1
  594B C7C8 858000FF    	ANDL	0X0FF
  595B C7CA 86800087    	XORL	0X87
  596B C7CC DB00C96A    	BS	ACZ,SYS_SER_RUN_PSID
  597B                  SYS_SER_RUN1_9:
  598B C7CE 0E6A        	LAC	RECE_BUF1
  599B C7CF 858000FF    	ANDL	0X0FF
  600B C7D1 86800088    	XORL	0X88
  601B C7D3 DB00C992    	BS	ACZ,SYS_SER_RUN_VPLEN
  602B                  SYS_SER_RUN1_10:
  603B C7D5 0E6A        	LAC	RECE_BUF1
  604B C7D6 858000FF    	ANDL	0X0FF
  605B C7D8 86800089    	XORL	0X89
  606B C7DA DB00C999    	BS	ACZ,SYS_SER_RUN_COMPR
  607B                  SYS_SER_RUN1_11:
  608B C7DC 0E6A        	LAC	RECE_BUF1
  609B C7DD 858000FF    	ANDL	0X0FF
  610B C7DF 8680008A    	XORL	0X8A
  611B C7E1 DB00C9AA    	BS	ACZ,SYS_SER_RUN_SOGM
  612B                  SYS_SER_RUN1_12:
  613B C7E3 0E6A        	LAC	RECE_BUF1
  614B C7E4 858000FF    	ANDL	0X0FF
  615B C7E6 8680008B    	XORL	0X8B
  616B C7E8 DB00C9B7    	BS	ACZ,SYS_SER_RUN_TELE
  617B                  SYS_SER_RUN1_13:
  618B C7EA 0E6A        	LAC	RECE_BUF1
  619B C7EB 858000FF    	ANDL	0X0FF
  620B C7ED 8680008C    	XORL	0X8C
  621B C7EF DB00C9BA    	BS	ACZ,SYS_SER_EXIT_TELE
  622B                  SYS_SER_RUN1_14:
  623B C7F1 0E6A        	LAC	RECE_BUF1
  624B C7F2 858000FF    	ANDL	0X0FF
  625B C7F4 8680008F    	XORL	0X8F
  626B C7F6 DB00C9BD    	BS	ACZ,SYS_SER_RECEIVE_TELNUM
  627B                  SYS_SER_RUN2:
  628B C7F8 0E6A        	LAC	RECE_BUF1
  629B C7F9 858000FF    	ANDL	0X0FF
  630B C7FB 86800091    	XORL	0X91
  631B C7FD DB00C8A7    	BS	ACZ,SYS_SER_RUN_REC_OGM1
  632B                  SYS_SER_RUN2_1:
  633B C7FF 0E6A        	LAC	RECE_BUF1
  634B C800 858000FF    	ANDL	0X0FF
  635B C802 86800092    	XORL	0X92
  636B C804 DB00C8AF    	BS	ACZ,SYS_SER_RUN_REC_OGM2
  637B                  SYS_SER_RUN2_2:
  638B C806 0E6A        	LAC	RECE_BUF1
  639B C807 858000FF    	ANDL	0X0FF
  640B C809 86800093    	XORL	0X93
  641B C80B DB00C8B7    	BS	ACZ,SYS_SER_RUN_PLY_OGM1
  642B                  SYS_SER_RUN2_3:
  643B C80D 0E6A        	LAC	RECE_BUF1
  644B C80E 858000FF    	ANDL	0X0FF
  645B C810 86800094    	XORL	0X94
  646B C812 DB00C8BF    	BS	ACZ,SYS_SER_RUN_PLY_OGM2
  647B                  SYS_SER_RUN2_4:
  648B C814 0E6A        	LAC	RECE_BUF1
  649B C815 858000FF    	ANDL	0X0FF
  650B C817 86800095    	XORL	0X95
  651B C819 DB00C8C7    	BS	ACZ,SYS_SER_RUN_ERA_OGM
  652B                  SYS_SER_RUN2_5:
  653B C81B 0E6A        	LAC	RECE_BUF1
  654B C81C 858000FF    	ANDL	0X0FF
  655B C81E 86800096    	XORL	0X96
  656B C820 DB00C8CD    	BS	ACZ,SYS_SER_RUN_STOP
  657B                  SYS_SER_RUN7:
  658B C822 0E6A        	LAC	RECE_BUF1
  659B C823 858000FF    	ANDL	0X0FF
  660B C825 868000B1    	XORL	0XB1
  661B C827 DB00C8D3    	BS	ACZ,SYS_SER_RUN_PLY_MSG
  662B                  SYS_SER_RUN8:
  663B                  	;LAC	RECE_BUF1
  664B                  	;ANDL	0X0FF
  665B                  	;XORL	0XB2
  666B                  	;BS	ACZ,SYS_SER_RUN_PLY_PAUSE	;在接收时已处理
  667B                  SYS_SER_RUN9:
  668B C829 0E6A        	LAC	RECE_BUF1
  669B C82A 858000FF    	ANDL	0X0FF
  670B C82C 868000B3    	XORL	0XB3
  671B C82E DB00C8D9    	BS	ACZ,SYS_SER_RUN_PLY_ERA
  672B                  SYS_SER_RUN10:
  673B C830 0E6A        	LAC	RECE_BUF1
  674B C831 858000FF    	ANDL	0X0FF
  675B C833 868000B4    	XORL	0XB4
  676B C835 DB00C8DF    	BS	ACZ,SYS_SER_RUN_ERAALL
  677B                  SYS_SER_RUN11:
  678B C837 0E6A        	LAC	RECE_BUF1
  679B C838 858000FF    	ANDL	0X0FF
  680B C83A 868000B5    	XORL	0XB5
  681B C83C DB00C8E5    	BS	ACZ,SYS_SER_RUN_PLY_FFW
  682B                  SYS_SER_RUN12:
  683B C83E 0E6A        	LAC	RECE_BUF1
  684B C83F 858000FF    	ANDL	0X0FF
  685B C841 868000B6    	XORL	0XB6
  686B C843 DB00C8EB    	BS	ACZ,SYS_SER_RUN_PLY_REW
  687B                  SYS_SER_RUN13:
  688B C845 0E6A        	LAC	RECE_BUF1
  689B C846 858000FF    	ANDL	0X0FF
  690B C848 868000A1    	XORL	0XA1
  691B C84A DB00C8F1    	BS	ACZ,SYS_SER_RUN_REC_MSG
  692B                  SYS_SER_RUN14:
  693B C84C 0E6A        	LAC	RECE_BUF1
  694B C84D 858000FF    	ANDL	0X0FF
  695B C84F 868000A2    	XORL	0XA2
  696B C851 DB00C8F7    	BS	ACZ,SYS_SER_RUN_REC_TWAY
  697B                  SYS_SER_RUN15:
  698B C853 0E6A        	LAC	RECE_BUF1
  699B C854 858000FF    	ANDL	0X0FF
  700B C856 868000A3    	XORL	0XA3
  701B C858 DB00C90E    	BS	ACZ,SYS_SER_RUN_FORMAT
  702B                  SYS_SER_RUN16:
  703B C85A 0E6A        	LAC	RECE_BUF1
  704B C85B 858000FF    	ANDL	0X0FF
  705B C85D 868000A5    	XORL	0XA5
  706B C85F DB00C8D9    	BS	ACZ,SYS_SER_RUN_PLY_ERA
  707B                  SYS_SER_RUN17:
  708B C861 0E6A        	LAC	RECE_BUF1
  709B C862 858000FF    	ANDL	0X0FF
  710B C864 868000A6    	XORL	0XA6
  711B C866 DB00C936    	BS	ACZ,SYS_SER_RUN_RINGIN
  712B                  SYS_SER_RUN18:
  713B                  	;LAC	RECE_BUF1
  714B                  	;ANDL	0X0FF
  715B                  	;XORL	0X96
  716B                  	;BS	ACZ,SYS_SER_RUN_RECMSG_STOP	;在接收时已处理
  717B                  	
  718B C868 DF00C707    	BS	B1,SYS_MSG_YES
  719B                  .ENDIF	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  720B                  ;-------处理命令
  721B                  SYS_SER_RUN_TEST:
  722B C86A 878000B3    	LACL	CMSG_TEST
  723B C86C FC00CC19    	CALL	STOR_MSG
  724B                  
  725B C86E DF00C707    	BS	B1,SYS_MSG_YES
  726B                  SYS_SER_RUN_LANGUAGE:
  727B C870 0E6A        	LAC	RECE_BUF1
  728B C871 9E08        	SFR	8
  729B C872 858000FF    	ANDL	0X0FF
  730B C874 B01C        	SAH	LANGUAGE
  731B C875 DF00C707    	BS	B1,SYS_MSG_YES
  732B                  ;---
  733B                  SYS_SER_RUN_DATET:
  734B C877 0E6A        	LAC	RECE_BUF1
  735B C878 9E08        	SFR	8
  736B C879 858000FF    	ANDL	0X0FF
  737B C87B FC00D2A3    	CALL	DGT_HEX
  738B C87D B00B        	SAH	TMR_YEAR	;年
  739B                  ;---
  740B C87E 0E6B        	LAC	RECE_BUF2
  741B C87F 858000FF    	ANDL	0XFF
  742B C881 FC00D2A3    	CALL	DGT_HEX
  743B C883 B00A        	SAH	TMR_MONTH	;月
  744B                  	
  745B C884 0E6B        	LAC	RECE_BUF2
  746B C885 9E08        	SFR	8
  747B C886 858000FF    	ANDL	0XFF
  748B C888 FC00D2A3    	CALL	DGT_HEX
  749B C88A B009        	SAH	TMR_DAY		;日
  750B                  ;---
  751B C88B 0E6C        	LAC	RECE_BUF3
  752B C88C 858000FF    	ANDL	0XFF
  753B C88E FC00D2A3    	CALL	DGT_HEX
  754B C890 B005        	SAH	TMR_WEEK	;星期
  755B                  	
  756B C891 0E6C        	LAC	RECE_BUF3
  757B C892 9E08        	SFR	8
  758B C893 858000FF    	ANDL	0XFF
  759B C895 FC00D2A3    	CALL	DGT_HEX
  760B C897 B004        	SAH	TMR_HOUR	;时
  761B                  ;---	
  762B C898 0E6D        	LAC	RECE_BUF4
  763B C899 858000FF    	ANDL	0XFF
  764B C89B FC00D2A3    	CALL	DGT_HEX
  765B C89D B003        	SAH	TMR_MIN		;分
  766B                  	
  767B C89E 0E6D        	LAC	RECE_BUF4
  768B C89F 9E08        	SFR	8
  769B C8A0 858000FF    	ANDL	0XFF
  770B C8A2 FC00D2A3    	CALL	DGT_HEX
  771B C8A4 B002        	SAH	TMR_SEC		;秒
  772B C8A5 DF00C707    	BS	B1,SYS_MSG_YES
  773B                  ;---
  774B                  SYS_SER_RUN_REC_OGM1:
  775B                  	;CRAM	EVENT,8
  776B C8A7 0F03        	LACK	3
  777B C8A8 B015        	SAH	MSG_N
  778B                  	
  779B C8A9 87800013    	LACL	CMSG_KEY3L
  780B C8AB FC00CC19    	CALL	STOR_MSG
  781B C8AD DF00C707    	BS	B1,SYS_MSG_YES
  782B                  ;---
  783B                  SYS_SER_RUN_REC_OGM2:
  784B                  	;SRAM	EVENT,8
  785B C8AF 0F04        	LACK	4
  786B C8B0 B015        	SAH	MSG_N
  787B                  	
  788B C8B1 87800013    	LACL	CMSG_KEY3L
  789B C8B3 FC00CC19    	CALL	STOR_MSG
  790B C8B5 DF00C707    	BS	B1,SYS_MSG_YES
  791B                  ;---	
  792B                  SYS_SER_RUN_PLY_OGM1:
  793B                  	;CRAM	EVENT,8
  794B C8B7 0F03        	LACK	3
  795B C8B8 B015        	SAH	MSG_N
  796B                  	
  797B C8B9 87800003    	LACL	CMSG_KEY3S
  798B C8BB FC00CC19    	CALL	STOR_MSG
  799B C8BD DF00C707    	BS	B1,SYS_MSG_YES
  800B                  ;---
  801B                  SYS_SER_RUN_PLY_OGM2:
  802B                  	;SRAM	EVENT,8
  803B C8BF 0F04        	LACK	4
  804B C8C0 B015        	SAH	MSG_N
  805B                  	
  806B C8C1 87800003    	LACL	CMSG_KEY3S
  807B C8C3 FC00CC19    	CALL	STOR_MSG
  808B C8C5 DF00C707    	BS	B1,SYS_MSG_YES
  809B                  ;---
  810B                  SYS_SER_RUN_ERA_OGM:
  811B C8C7 87800005    	LACL	CMSG_KEY5S
  812B C8C9 FC00CC19    	CALL	STOR_MSG
  813B C8CB DF00C707    	BS	B1,SYS_MSG_YES
  814B                  ;---
  815B                  SYS_SER_RUN_STOP:
  816B C8CD 87800006    	LACL	CMSG_KEY6S
  817B C8CF FC00CC19    	CALL	STOR_MSG
  818B C8D1 DF00C707    	BS	B1,SYS_MSG_YES
  819B                  ;---
  820B                  SYS_SER_RUN_PLY_MSG:
  821B C8D3 87800001    	LACL	CMSG_KEY1S
  822B C8D5 FC00CC19    	CALL	STOR_MSG
  823B C8D7 DF00C707    	BS	B1,SYS_MSG_YES
  824B                  ;---
  825B                  ;SYS_SER_RUN_PLY_PAUSE:
  826B                  	;LACL	CSEG_PAUSE
  827B                  	;CALL	STOR_MSG
  828B                  	;BS	B1,SYS_MSG_YES
  829B                  ;---
  830B                  SYS_SER_RUN_PLY_ERA:
  831B C8D9 87800005    	LACL	CMSG_KEY5S
  832B C8DB FC00CC19    	CALL	STOR_MSG
  833B C8DD DF00C707    	BS	B1,SYS_MSG_YES
  834B                  ;---
  835B                  SYS_SER_RUN_ERAALL:
  836B C8DF 87800015    	LACL	CMSG_KEY5L
  837B C8E1 FC00CC19    	CALL	STOR_MSG
  838B C8E3 DF00C707    	BS	B1,SYS_MSG_YES
  839B                  ;---
  840B                  SYS_SER_RUN_PLY_FFW:
  841B C8E5 8780000C    	LACL	CMSG_KEYCS
  842B C8E7 FC00CC19    	CALL	STOR_MSG
  843B C8E9 DF00C707    	BS	B1,SYS_MSG_YES
  844B                  ;---
  845B                  SYS_SER_RUN_PLY_REW:
  846B C8EB 87800008    	LACL	CMSG_KEY8S
  847B C8ED FC00CC19    	CALL	STOR_MSG
  848B C8EF DF00C707    	BS	B1,SYS_MSG_YES
  849B                  ;---
  850B                  SYS_SER_RUN_REC_MSG:
  851B C8F1 87800014    	LACL	CMSG_KEY4L
  852B C8F3 FC00CC19    	CALL	STOR_MSG
  853B C8F5 DF00C707    	BS	B1,SYS_MSG_YES
  854B                  ;---
  855B                  SYS_SER_RUN_REC_TWAY:
  856B C8F7 87800092    	LACL	CNO_NMSG
  857B C8F9 FC00CC19    	CALL	STOR_MSG	;LED不要闪烁了(进入答录)
  858B                  	
  859B C8FB FC00CC38    	CALL	CLR_FUNC	;先空
  860B C8FD 8780D6A8        	LACL	TWAY_STATE
  861B C8FF FC00CC2B         	CALL	PUSH_FUNC
  862B                       	
  863B C901 FC00CB09         	CALL	REMT_EEXE
  864B                       	
  865B C903 0E19             	LAC	RING_ID
  866B C904 9C0C             	SFL	12
  867B C905 B019             	SAH	RING_ID		;保存在最高四位
  868B                       	
  869B C906 87800081      	LACL	CMSG_INIT
  870B C908 FC00CC19       	CALL	STOR_MSG
  871B                     	
  872B C90A 0F00           	LACK	0
  873B C90B B03E           	SAH	PRO_VAR
  874B                  
  875B C90C DF00C707    	BS	B1,SYS_MSG_YES
  876B                  ;---
  877B                  SYS_SER_RUN_FORMAT:
  878B C90E FC00C1D9    	CALL	CLR_TIMER
  879B                  	
  880B C910 87809051    	LACL	0X9051
  881B C912 B000        	SAH	CONF
  882B C913 FC000020    	CALL	DAM_BIOS
  883B                  	
  884B C915 8780D109    	LACL    0XD109		;12.8kbps
  885B C917 B000        	SAH	CONF
  886B C918 FC000020    	CALL	DAM_BIOS
  887B                  	
  888B C91A 0F00        	LACK	0
  889B C91B B01B        	SAH	PASSWORD
  890B C91C B01C        	SAH	LANGUAGE
  891B                  	
  892B C91D 0F0A        	LACK	10
  893B C91E B019                SAH	RING_ID
  894B C91F E990                SRAM	EVENT,9
  895B C920 E810                CRAM	EVENT,8
  896B                          
  897B C921 0F06                LACK	6
  898B C922 B01A                SAH	RING_ID_BAK
  899B                          
  900B                          
  901B                          
  902B C923 87800081    	LACL	CMSG_INIT
  903B C925 FC00CC19    	CALL	STOR_MSG
  904B C927 DF00C707    	BS	B1,SYS_MSG_YES
  905B                  ;---
  906B                  ;SYS_SER_RUN_RECMSG_STOP:
  907B                  	;LACL	CMSG_KEY6S
  908B                  	;CALL	STOR_MSG
  909B                  	;BS	B1,SYS_MSG_YES
  910B                  ;---
  911B                  SYS_SER_RUN_RINGN:
  912B C929 0F0A        	LACK	10
  913B C92A B019        	SAH	RING_ID
  914B C92B 6910        	BIT	EVENT,9
  915B C92C DA00C934    	BS	TB,SYS_SER_RUN_RINGN_END
  916B                  	
  917B C92E 0E6A        	LAC	RECE_BUF1
  918B C92F 9E08        	SFR	8
  919B C930 858000FF    	ANDL	0XFF
  920B C932 B01A        	SAH	RING_ID_BAK
  921B C933 B019        	SAH	RING_ID
  922B                  SYS_SER_RUN_RINGN_END:
  923B C934 DF00C707    	BS	B1,SYS_MSG_YES
  924B                  ;---
  925B                  SYS_SER_RUN_RINGIN:
  926B C936 0E3A        	LAC	RING_CNT
  927B C937 D300C94B    	BZ	ACZ,SYS_SER_RUN_RINGIN1
  928B                  	
  929B C939 87800006    	LACL	CMSG_KEY6S
  930B C93B FC00CC19    	CALL	STOR_MSG
  931B C93D 87800006    	LACL	CMSG_KEY6S
  932B C93F FC00CC19    	CALL	STOR_MSG
  933B                  
  934B C941 0F01        	LACK	1
  935B C942 B03A        	SAH	RING_CNT
  936B                  	
  937B C943 0F00        	LACK	0
  938B C944 B03B        	SAH	PRO_VAR2
  939B                  	
  940B C945 878003E8    	LACL	1000
  941B C947 FC00C1D6    	CALL	SET_TIMER
  942B C949 DF00C954    	BS	B1,SYS_SER_RUN_RINGIN2
  943B                  SYS_SER_RUN_RINGIN1:
  944B C94B 0E3B        	LAC	PRO_VAR2
  945B C94C 0502        	SBHK	2
  946B C94D DD00C954    	BS	SGN,SYS_SER_RUN_RINGIN2		;两次来铃时间间隔大于2秒
  947B                  	
  948B C94F 0E3A        	LAC	RING_CNT
  949B C950 0101        	ADHK	1
  950B C951 B03A        	SAH	RING_CNT
  951B                  	
  952B C952 0F00        	LACK	0
  953B C953 B03B        	SAH	PRO_VAR2	
  954B                  SYS_SER_RUN_RINGIN2:
  955B                  		
  956B C954 DF00C707    	BS	B1,SYS_MSG_YES
  957B                  ;---
  958B                  SYS_SER_RUN_ONOFF:
  959B C956 E910        	CRAM	EVENT,9
  960B C957 0F02        	LACK	2
  961B C958 B019        	SAH	RING_ID
  962B                  	
  963B C959 0E1A        	LAC	RING_ID_BAK
  964B C95A DB00C95D    	BS	ACZ,SYS_SER_RUN_ONOFF_1
  965B C95C B019        	SAH	RING_ID
  966B                  SYS_SER_RUN_ONOFF_1:	
  967B C95D 0E6A        	LAC	RECE_BUF1
  968B C95E 82800085    	SBHL	0X85
  969B C960 DB00C968    	BS	ACZ,SYS_SER_RUN_ONOFF_END
  970B C962 E990        	SRAM	EVENT,9
  971B C963 0E19        	LAC	RING_ID
  972B C964 0B0F        	ANDK	0X0F
  973B C965 B01A        	SAH	RING_ID_BAK
  974B                  	
  975B C966 0F0A        	LACK	10
  976B C967 B019        	SAH	RING_ID
  977B                  SYS_SER_RUN_ONOFF_END:	
  978B C968 DF00C707    	BS	B1,SYS_MSG_YES
  979B                  ;-------
  980B                  SYS_SER_RUN_PSID:
  981B                  ;---PS1
  982B C96A 0E1B        	LAC	PASSWORD
  983B C96B 85800FFF    	ANDL	0X0FFF
  984B C96D B01B        	SAH	PASSWORD
  985B                  
  986B C96E 0E6A        	LAC	RECE_BUF1
  987B C96F 9C04        	SFL	4
  988B C970 8580F000    	ANDL	0XF000
  989B C972 081B        	OR	PASSWORD
  990B C973 B01B        	SAH	PASSWORD
  991B                  ;---PS2	
  992B C974 0E1B        	LAC	PASSWORD
  993B C975 8580F0FF    	ANDL	0XF0FF
  994B C977 B01B        	SAH	PASSWORD
  995B                  
  996B C978 0E6B        	LAC	RECE_BUF2
  997B C979 9C08        	SFL	8
  998B C97A 85800F00    	ANDL	0X0F00
  999B C97C 081B        	OR	PASSWORD
 1000B C97D B01B        	SAH	PASSWORD
 1001B                  ;---PS3	
 1002B C97E 0E1B        	LAC	PASSWORD
 1003B C97F 8580FF0F    	ANDL	0XFF0F
 1004B C981 B01B        	SAH	PASSWORD
 1005B                  	
 1006B C982 0E6B        	LAC	RECE_BUF2
 1007B C983 9E04        	SFR	4
 1008B C984 858000F0    	ANDL	0X00F0
 1009B C986 081B        	OR	PASSWORD
 1010B C987 B01B        	SAH	PASSWORD
 1011B                  ;---PS4	
 1012B C988 0E1B        	LAC	PASSWORD
 1013B C989 8580FFF0    	ANDL	0XFFF0
 1014B C98B B01B        	SAH	PASSWORD
 1015B                  	
 1016B C98C 0E6C        	LAC	RECE_BUF3
 1017B C98D 0B0F        	ANDK	0X0F
 1018B C98E 081B        	OR	PASSWORD
 1019B C98F B01B        	SAH	PASSWORD
 1020B                  	
 1021B C990 DF00C707    	BS	B1,SYS_MSG_YES
 1022B                  ;---
 1023B                  SYS_SER_RUN_VPLEN:
 1024B C992 0E6A        	LAC	RECE_BUF1
 1025B C993 9E08        	SFR	8
 1026B C994 858000FF    	ANDL	0X0FF
 1027B C996 B01F        	SAH	VPLEN		;录音最短长度
 1028B C997 DF00C707    	BS	B1,SYS_MSG_YES
 1029B                  ;---
 1030B                  SYS_SER_RUN_COMPR:
 1031B C999 FC00CA4B    	CALL	INIT_DAM_FUNC	
 1032B                  	
 1033B C99B 8780D109    	LACL    0XD109		;12.8kbps
 1034B C99D B000        	SAH	CONF
 1035B                  	
 1036B C99E 0E6A        	LAC	RECE_BUF1
 1037B C99F 9E08        	SFR	8
 1038B C9A0 0B7F        	ANDK	0X7F	
 1039B C9A1 DB00C9A6    	BS	ACZ,SYS_SER_RUN_COMPR1
 1040B                  	
 1041B C9A3 8780D101    	LACL    0XD101		;4.8kbps
 1042B C9A5 B000        	SAH	CONF
 1043B                  SYS_SER_RUN_COMPR1:
 1044B C9A6 FC000020    	CALL	DAM_BIOS	
 1045B C9A8 DF00C707    	BS	B1,SYS_MSG_YES
 1046B                  ;---
 1047B                  SYS_SER_RUN_SOGM:
 1048B C9AA E810        	CRAM	EVENT,8
 1049B                  	
 1050B C9AB 0F03        	LACK	3
 1051B C9AC B015        	SAH	MSG_N
 1052B                  	
 1053B C9AD 0E6A        	LAC	RECE_BUF1
 1054B C9AE 9E08        	SFR	8
 1055B C9AF 0B7F        	ANDK	0X7F
 1056B C9B0 DB00C9B5    	BS	ACZ,SYS_SER_RUN_SOGM1
 1057B                  	
 1058B C9B2 0F04        	LACK	4
 1059B C9B3 B015        	SAH	MSG_N
 1060B                  	
 1061B C9B4 E890        	SRAM	EVENT,8
 1062B                  SYS_SER_RUN_SOGM1:		;初始化时为0,收到选择OGM命令时不播放相应OGM
 1063B C9B5 DF00C707    	BS	B1,SYS_MSG_YES
 1064B                  SYS_SER_RUN_TELE:
 1065B C9B7 E090        	SRAM	EVENT,0
 1066B                  	
 1067B                  	;LACL	CNO_NMSG
 1068B                  	;CALL	STOR_MSG	;LED不要闪烁了(进入通话状态)
 1069B C9B8 DF00C707    	BS	B1,SYS_MSG_YES
 1070B                  SYS_SER_EXIT_TELE:
 1071B C9BA E010        	CRAM	EVENT,0
 1072B                  	
 1073B                  	;LACL	CMSG_INIT
 1074B                  	;CALL	STOR_MSG	;LED要闪烁了(退出通话状态)
 1075B C9BB DF00C707    	BS	B1,SYS_MSG_YES
 1076B                  SYS_SER_RECEIVE_TELNUM:
 1077B                  .IF	TEXT_m58
 1078B                  	CALL	TELNUM_WRITE
 1079B                  .ENDIF
 1080B C9BD DF00C707    	BS	B1,SYS_MSG_YES
 1081B                  ;-----------------------------------------------------------------------
 1082B                  ;DAM_BIOS的软中断程序:record/play/beep/VoicePrompt/line
 1083B                  ;-----------------------------------------------------------------------
 1084B                  INT_BIOS:
 1085B C9BF 6710        	BIT	EVENT,7
 1086B C9C0 DA00C9D7    	BS	TB,INT_BIOS_REC		;RECORD
 1087B C9C2 6610        	BIT	EVENT,6
 1088B C9C3 DA00C9E2    	BS	TB,INT_BIOS_PLAY	;PLAY
 1089B C9C5 6510        	BIT	EVENT,5
 1090B C9C6 DA00CA0D    	BS	TB,INT_BIOS_END		;BEEP不作处理
 1091B C9C8 6410        	BIT	EVENT,4
 1092B C9C9 DA00C9D0    	BS	TB,INT_BIOS_LINE	;LINE
 1093B C9CB FC00CC3D    	CALL	GET_VP
 1094B C9CD D300CA0E    	BZ	ACZ,INT_BIOS_START
 1095B                  
 1096B                  	
 1097B C9CF F800        	RET
 1098B                  ;---
 1099B                  INT_BIOS_LINE:				;line mode
 1100B C9D0 87805000    	LACL	0X5000
 1101B C9D2 B000        	SAH	CONF
 1102B C9D3 FC000020    	CALL	DAM_BIOS
 1103B                  	
 1104B C9D5 DF00C9ED    	BS	B1,INT_BIOS_RESP
 1105B                  INT_BIOS_REC:				;record mode
 1106B C9D7 FC000020    	CALL	DAM_BIOS
 1107B C9D9 6701        	BIT	RESP,7
 1108B C9DA D200C9ED    	BZ	TB,INT_BIOS_RESP
 1109B                  	
 1110B C9DC 878000B2    	LACL	CREC_FULL		;产生FLASH满消息
 1111B C9DE FC00CC19    	CALL	STOR_MSG
 1112B C9E0 DF00C9ED    	BS	B1,INT_BIOS_RESP
 1113B                  ;---
 1114B                  INT_BIOS_PLAY:				;play(voice prompt) mode
 1115B C9E2 FC000020    	CALL	DAM_BIOS
 1116B C9E4 6601        	BIT	RESP,6
 1117B C9E5 D200C9ED    	BZ	TB,INT_BIOS_RESP
 1118B                  	
 1119B C9E7 87800093    	LACL	CSEG_END
 1120B C9E9 FC00CC19    	CALL	STOR_MSG		;产生结束消息
 1121B C9EB DF00C9ED    	BS	B1,INT_BIOS_RESP
 1122B                  ;---------
 1123B                  ;---------
 1124B                  INT_BIOS_RESP:
 1125B                  	
 1126B                  ;---------
 1127B                  ;---------
 1128B                  INT_BIOS_RESP_VOX:
 1129B C9ED FC00CB3D    	CALL	VOX_CHK
 1130B C9EF DB00C9F5    	BS	ACZ,INT_BIOS_RESP_VOX_END
 1131B C9F1 87800086    	LACL	CMSG_VOX
 1132B C9F3 FC00CC19    	CALL	STOR_MSG
 1133B                  INT_BIOS_RESP_VOX_END:	
 1134B                  ;---------
 1135B                  ;---------	
 1136B                  INT_BIOS_RESP_DTMF:
 1137B C9F5 FC00CB0D    	CALL	DTMF_CHK
 1138B C9F7 DB00C9FD    	BS	ACZ,INT_BIOS_RESP_DTMF_END
 1139B C9F9 87800085    	LACL	CREV_DTMF
 1140B C9FB FC00CC19    	CALL	STOR_MSG
 1141B                  INT_BIOS_RESP_DTMF_END:
 1142B                  ;---------
 1143B                  ;---------
 1144B                  INT_BIOS_RESP_CTONE:
 1145B C9FD FC00CB28    	CALL	CTONE_CHK
 1146B C9FF DB00CA05    	BS	ACZ,INT_BIOS_RESP_CTONE_END
 1147B CA01 87800083    	LACL	CMSG_CTONE
 1148B CA03 FC00CC19    	CALL	STOR_MSG
 1149B                  INT_BIOS_RESP_CTONE_END:
 1150B                  ;---------
 1151B                  ;---------
 1152B                  INT_BIOS_RESP_BTONE:
 1153B CA05 FC00CB52    	CALL	BTONE_CHK
 1154B CA07 DB00CA0D    	BS	ACZ,INT_BIOS_RESP_BTONE_END
 1155B CA09 87800084    	LACL	CMSG_BTONE
 1156B CA0B FC00CC19    	CALL	STOR_MSG
 1157B                  INT_BIOS_RESP_BTONE_END:
 1158B                  ;---------
 1159B                  INT_BIOS_END:
 1160B                  	
 1161B CA0D F800        	RET
 1162B                  ;----
 1163B                  ;----
 1164B                  INT_BIOS_START:
 1165B CA0E B064        	SAH	SYSTMP
 1166B CA0F FC00CA50    	CALL	DAM_STOP
 1167B                  	
 1168B CA11 0E64        	LAC	SYSTMP
 1169B CA12 858000FF    	ANDL	0XFF
 1170B CA14 B05E        	SAH	SYSTMP0
 1171B                  	
 1172B CA15 0E64        	LAC	SYSTMP
 1173B CA16 9E08        	SFR	8
 1174B CA17 B05F        	SAH	SYSTMP1
 1175B                  	
 1176B CA18 828000FF    	SBHL	0XFF
 1177B CA1A DB00CA43    	BS	ACZ,INT_BIOS_START_VP
 1178B CA1C 0E5F        	LAC	SYSTMP1
 1179B CA1D 828000FE    	SBHL	0XFE
 1180B CA1F DB00CA37    	BS	ACZ,INT_BIOS_START_PLAY_TOTAL
 1181B CA21 0E5F        	LAC	SYSTMP1
 1182B CA22 828000FD    	SBHL	0XFD
 1183B CA24 DB00CA3D    	BS	ACZ,INT_BIOS_START_PLAY_NEW
 1184B                  INT_BIOS_START_BEEP:
 1185B CA26 0E5E        	LAC	SYSTMP0
 1186B CA27 9C03        	SFL	3
 1187B CA28 B02A        	SAH	TMR_BEEP		;length of time
 1188B CA29 0E5F        	LAC	SYSTMP1
 1189B CA2A 9C08        	SFL	8
 1190B CA2B DB00CA33    	BS	ACZ,INT_BIOS_START_BEEP_END	;frequency = 0
 1191B CA2D B007        	SAH	BUF1			;frequency
 1192B                  	
 1193B CA2E 878048F9    	LACL	CBEEP_COMMAND		;ON
 1194B CA30 B000        	SAH	CONF
 1195B CA31 FC000020    	CALL    DAM_BIOS
 1196B                  INT_BIOS_START_BEEP_END:	
 1197B CA33 0E10        	LAC	EVENT
 1198B CA34 0920        	ORK	0X20			;SET flag(bit5)
 1199B CA35 B010        	SAH	EVENT
 1200B                  
 1201B CA36 F800        	RET
 1202B                  ;---
 1203B                  INT_BIOS_START_PLAY_TOTAL:
 1204B CA37 0E5E        	LAC	SYSTMP0
 1205B CA38 84802000    	ORL	0X2000
 1206B CA3A B000        	SAH	CONF
 1207B CA3B DF00CA47    	BS	B1,INT_BIOS_START_VP_FLAG
 1208B                  ;---
 1209B                  INT_BIOS_START_PLAY_NEW:
 1210B CA3D 0E5E        	LAC	SYSTMP0
 1211B CA3E 84802400    	ORL	0X2400
 1212B CA40 B000        	SAH	CONF
 1213B CA41 DF00CA47    	BS	B1,INT_BIOS_START_VP_FLAG
 1214B                  ;---
 1215B                  INT_BIOS_START_VP:
 1216B CA43 0E5E        	LAC	SYSTMP0
 1217B CA44 8480B000    	ORL	0XB000
 1218B CA46 B000        	SAH	CONF
 1219B                  INT_BIOS_START_VP_FLAG:
 1220B CA47 0E10        	LAC	EVENT
 1221B CA48 0940        	ORK	0X40		;set flag(bit6)
 1222B CA49 B010        	SAH	EVENT
 1223B CA4A F800        	RET
 1224B                  ;---
 1225B                  INIT_DAM_FUNC:
 1226B CA4B FC00CA50    	CALL	DAM_STOP	;停止DAM_BIOS
 1227B CA4D 0F00        	LACK	0
 1228B CA4E B040        	SAH	VP_QUEUE	;发声队列清空
 1229B CA4F F800        	RET
 1230B                  ;---
 1231B                  
 1232B                  DAM_STOP:			;关闭前面操作和标志位并设成IDLE模式
 1233B CA50 0F00        	LACK	0
 1234B CA51 B02A        	SAH	TMR_BEEP	;BEEP TMR清
 1235B CA52 0E10        	LAC	EVENT
 1236B CA53 8580FF0F    	ANDL	0XFF0F
 1237B CA55 B010        	SAH	EVENT		;标志清空
 1238B                  	
 1239B CA56 0E00        	LAC	CONF
 1240B CA57 DB00CA87    	BS	ACZ,DAM_STOP_IDLE
 1241B CA59 9E0C        	SFR	12
 1242B CA5A 0501        	SBHK	1
 1243B CA5B DB00CA6B    	BS      ACZ,DAM_STOP_REC	;// 0X1000
 1244B CA5D 0501        	SBHK	1
 1245B CA5E DB00CA79    	BS      ACZ,DAM_STOP_PLAY	;// 0X2000
 1246B CA60 0502        	SBHK	2
 1247B CA61 DB00CA81    	BS      ACZ,DAM_STOP_BEEP	;// 0X4000
 1248B CA63 0501        	SBHK	1
 1249B CA64 DB00CA72    	BS      ACZ,DAM_STOP_LINE	;// 0X5000
 1250B CA66 0506        	SBHK	6
 1251B CA67 DB00CA79    	BS      ACZ,DAM_STOP_PLAY	;// 0XB000
 1252B CA69 DF00CA87    	BS	B1,DAM_STOP_IDLE
 1253B                  DAM_STOP_REC:
 1254B CA6B 0E00        	LAC	CONF
 1255B CA6C 0940        	ORK	0X40
 1256B CA6D B000        	SAH	CONF
 1257B CA6E FC000020    	CALL	DAM_BIOS
 1258B CA70 DF00CA87    	BS	B1,DAM_STOP_IDLE
 1259B                  DAM_STOP_LINE:
 1260B CA72 87805001    	LACL    0X5001
 1261B CA74 B000        	SAH     CONF
 1262B CA75 FC000020    	CALL    DAM_BIOS
 1263B CA77 DF00CA87    	BS	B1,DAM_STOP_IDLE
 1264B                  DAM_STOP_PLAY:
 1265B CA79 0E00        	LAC	CONF
 1266B CA7A 84800200    	ORL     0X0200
 1267B CA7C B000        	SAH	CONF
 1268B CA7D FC000020    	CALL	DAM_BIOS
 1269B CA7F DF00CA87    	BS	B1,DAM_STOP_IDLE
 1270B                  DAM_STOP_BEEP:
 1271B CA81 0E00        	LAC	CONF
 1272B CA82 84800400    	ORL     0X0400
 1273B CA84 B000        	SAH	CONF
 1274B CA85 FC000020    	CALL	DAM_BIOS
 1275B                  DAM_STOP_IDLE:				;// IDLE MODE
 1276B CA87 0F00        	LACK	0
 1277B CA88 B000        	SAH     CONF
 1278B                  	
 1279B CA89 F800        	RET
 1280B                  ;----------------------------------------------------------------------------
 1281B                  ;	Function : REC_START
 1282B                  ;	input : no
 1283B                  ;	output: no
 1284B                  ;----------------------------------------------------------------------------
 1285B                  REC_START:
 1286B CA8A 0E10        	LAC	EVENT
 1287B CA8B 8580FF0F    	ANDL	0XFF0F
 1288B CA8D 84800080    	ORL	0X080
 1289B CA8F B010        	SAH	EVENT
 1290B                  	
 1291B CA90 87801000    	LACL	0X1000
 1292B CA92 B000        	SAH	CONF
 1293B                  	
 1294B CA93 F800        	RET
 1295B                  ;----------------------------------------------------------------------------
 1296B                  ;	Function : LINE_START
 1297B                  ;	input : no
 1298B                  ;	output: no
 1299B                  ;----------------------------------------------------------------------------
 1300B                  LINE_START:
 1301B CA94 0E10        	LAC	EVENT
 1302B CA95 8580FF0F    	ANDL	0XFF0F
 1303B CA97 84800010    	ORL	0X010
 1304B CA99 B010        	SAH	EVENT
 1305B                  	
 1306B CA9A 87805000    	LACL	0X5000
 1307B CA9C B000        	SAH	CONF
 1308B                  	
 1309B CA9D F800        	RET
 1310B                  ;----------------------------------------------------------------------------
 1311B                  ;       Function : GC_CHK
 1312B                  ;
 1313B                  ;       Check garbage collection
 1314B                  ;----------------------------------------------------------------------------
 1315B                  GC_CHK:
 1316B CA9E 878003E8    	LACL	GCVP_TLEN
 1317B CAA0 B028        	SAH	TMR_CTONE
 1318B                  GC_CHK_LOOP:
 1319B CAA1 87803003    	LACL	0X3003
 1320B CAA3 B000        	SAH	CONF
 1321B CAA4 FC000020    	CALL	DAM_BIOS
 1322B CAA6 0E01        	LAC	RESP
 1323B CAA7 828000C8    	SBHL	200		  	;剩下200秒?
 1324B CAA9 D500CAB0    	BZ	SGN,GC_CHK_1
 1325B                  	
 1326B CAAB 87803007    	LACL    0X3007   		; do garbage collection
 1327B CAAD B000                SAH     CONF
 1328B CAAE FC000020            CALL    DAM_BIOS
 1329B                  GC_CHK_1:
 1330B CAB0 87809004            LACL    0X9004   		; do garbage collection
 1331B CAB2 B000                SAH     CONF
 1332B CAB3 FC000020            CALL    DAM_BIOS
 1333B                          
 1334B CAB5 6D11        	BIT	ANN_FG,13
 1335B CAB6 D200CABB            BZ	TB,GC_CHK_NEXT
 1336B CAB8 0E28                LAC	TMR_CTONE
 1337B CAB9 DD00CAC3            BS	SGN,GC_CHK_RTN
 1338B                  GC_CHK_NEXT:
 1339B CABB 87803005    	LACL    0X3005           	; check if garbage collection is required ?
 1340B CABD B000                SAH     CONF
 1341B CABE FC000020            CALL    DAM_BIOS
 1342B CAC0 0E01                LAC     RESP
 1343B CAC1 D300CAA1            BZ      ACZ,GC_CHK_LOOP
 1344B                  GC_CHK_RTN:	
 1345B CAC3 87809050    	LACL    0X9050   		; do garbage collection
 1346B CAC5 B000                SAH     CONF
 1347B CAC6 FC000020            CALL    DAM_BIOS
 1348B                  
 1349B CAC8 F800        	RET
 1350B                  ;----------------------------------------------------------------------------
 1351B                  ;       Function : TEL_GC_CHK
 1352B                  ;
 1353B                  ;       Check garbage collection
 1354B                  ;----------------------------------------------------------------------------
 1355B                  .IF	0
 1356B                  TEL_GC_CHK:
 1357B                          LACL    0XE405            ; check if garbage collection is required ?
 1358B                          SAH     CONF
 1359B                          CALL    DAM_BIOS
 1360B                          LAC     RESP
 1361B                          BS      ACZ,TEL_GC_CHK_RTN
 1362B                  
 1363B                          LACL    0XE407          ; do garbage collection
 1364B                          SAH     CONF
 1365B                          CALL    DAM_BIOS
 1366B                          BS      B1,TEL_GC_CHK       ; L111S2
 1367B                  TEL_GC_CHK_RTN:
 1368B                          RET
 1369B                  .ELSE
 1370B                  ;-------------------------------------------------------------------------------
 1371B                  TEL_GC_CHK:
 1372B CAC9 878003E8    	LACL	GCTEL_TLEN
 1373B CACB B028        	SAH	TMR_CTONE
 1374B                  TEL_GC_LOOP:
 1375B CACC 8780E407            LACL    0XE407          ; do garbage collection first
 1376B CACE B000                SAH     CONF
 1377B CACF FC000020            CALL    DAM_BIOS
 1378B                  	
 1379B CAD1 6D11        	BIT	ANN_FG,13
 1380B CAD2 D200CAD7    	BZ	TB,TEL_GC_NEXT
 1381B CAD4 0E28        	LAC	TMR_CTONE
 1382B CAD5 DD00CADF    	BS	SGN,TEL_GC_CHK_RTN
 1383B                  TEL_GC_NEXT:	
 1384B CAD7 8780E405            LACL    0XE405            ; check if garbage collection is required ?
 1385B CAD9 B000                SAH     CONF
 1386B CADA FC000020            CALL    DAM_BIOS
 1387B                  
 1388B CADC 0E01                LAC     RESP
 1389B CADD D300CACC            BZ      ACZ,TEL_GC_LOOP
 1390B                  
 1391B                  TEL_GC_CHK_RTN:
 1392B CADF F800                RET
 1393B                  .ENDIF
 1394B                  ;----------------------------------------------------------------------------
 1395B                  ;	Function : ACK_H
 1396B                  ;	input : no
 1397B                  ;	output: no
 1398B                  ;----------------------------------------------------------------------------
 1399B                  ACK_H:
 1400B CAE0 1300        	lipk    0
 1401B CAE1 A30B        	SIO	11,OPTR		;ACK ON---(OPTR.11)
 1402B CAE2 F800        	RET
 1403B                  ;----------------------------------------------------------------------------
 1404B                  ;	Function : ACK_L
 1405B                  ;	input : no
 1406B                  ;	output: no
 1407B                  ;----------------------------------------------------------------------------
 1408B                  ACK_L:
 1409B CAE3 1300        	lipk    0
 1410B CAE4 A10B        	CIO	11,OPTR		;ACK OFF---(OPTR.11)
 1411B CAE5 F800        	RET
 1412B                  ;----------------------------------------------------------------------------
 1413B                  ;	Function : IDMONIT_ON
 1414B                  ;	input : no
 1415B                  ;	output: no
 1416B                  ;----------------------------------------------------------------------------
 1417B                  IDMONIT_ON:
 1418B CAE6 1300        	lipk    0
 1419B CAE7 A30E        	SIO	14,OPTR		;in door monitor---(OPTR14)
 1420B CAE8 F800        	RET
 1421B                  ;----------------------------------------------------------------------------
 1422B                  ;	Function : IDMONIT_OFF
 1423B                  ;	input : no
 1424B                  ;	output: no
 1425B                  ;----------------------------------------------------------------------------
 1426B                  IDMONIT_OFF:
 1427B CAE9 1300        	lipk    0
 1428B CAEA A10E        	CIO	14,OPTR		;in door monitor end---(OPTR14)
 1429B CAEB F800        	RET
 1430B                  ;----------------------------------------------------------------------------
 1431B                  ;	Function : LED_ON
 1432B                  ;	input : no
 1433B                  ;	output: no
 1434B                  ;----------------------------------------------------------------------------
 1435B                  LED_ON:
 1436B CAEC 1300        	lipk    0
 1437B CAED A30C        	SIO	12,OPTR		;LED ON---OPTR(bit12)
 1438B CAEE F800        	RET
 1439B                  ;----------------------------------------------------------------------------
 1440B                  ;	Function : LED_OFF
 1441B                  ;	input : no
 1442B                  ;	output: no
 1443B                  ;----------------------------------------------------------------------------
 1444B                  LED_OFF:
 1445B CAEF 1300        	lipk    0
 1446B CAF0 A10C        	CIO	12,OPTR		;LED OFF---OPTR(bit12)
 1447B CAF1 F800        	RET
 1448B                  ;----------------------------------------------------------------------------
 1449B                  ;	Function : LED_FLASH
 1450B                  ;	input : no
 1451B                  ;	output: no
 1452B                  ;----------------------------------------------------------------------------
 1453B                  LED_FLASH:
 1454B CAF2 1300        	lipk    0
 1455B CAF3 A50C        	BINV	12,OPTR		;LED FLASH---OPTR(bit12)
 1456B                  	
 1457B CAF4 878003E8    	LACL	1000
 1458B CAF6 FC00C1DD    	CALL	SET_LEDTIMER	;要求HIGH/LOW=1/0.3
 1459B                  	
 1460B CAF8 A064        	IN      SYSTMP,OPTR
 1461B CAF9 6C64                BIT     SYSTMP,12
 1462B CAFA DA00CB00            BS	TB,LED_FLASH_END
 1463B                  	
 1464B CAFC 8780012C    	LACL	300
 1465B CAFE FC00C1DD    	CALL	SET_LEDTIMER
 1466B                  	
 1467B                  LED_FLASH_END:	
 1468B CB00 F800        	RET
 1469B                  ;----------------------------------------------------------------------------
 1470B                  ;	Function : REC_EEXE
 1471B                  ;	input : no
 1472B                  ;	output: no
 1473B                  ;----------------------------------------------------------------------------
 1474B                  REC_EEXE:
 1475B CB01 E190        	SRAM	EVENT,1
 1476B CB02 F800        	RET
 1477B                  ;----------------------------------------------------------------------------
 1478B                  ;	Function : REC_EEND
 1479B                  ;	input : no
 1480B                  ;	output: no
 1481B                  ;----------------------------------------------------------------------------
 1482B                  REC_EEND:
 1483B CB03 E110        	CRAM	EVENT,1
 1484B CB04 F800        	RET
 1485B                  ;----------------------------------------------------------------------------
 1486B                  ;	Function : PLY_EEXE
 1487B                  ;	input : no
 1488B                  ;	output: no
 1489B                  ;----------------------------------------------------------------------------
 1490B                  PLY_EEXE:
 1491B CB05 E290        	SRAM	EVENT,2
 1492B CB06 F800        	RET
 1493B                  ;----------------------------------------------------------------------------
 1494B                  ;	Function : PLY_EEND
 1495B                  ;	input : no
 1496B                  ;	output: no
 1497B                  ;----------------------------------------------------------------------------
 1498B                  PLY_EEND:
 1499B CB07 E210        	CRAM	EVENT,2
 1500B CB08 F800        	RET
 1501B                  ;----------------------------------------------------------------------------
 1502B                  ;	Function : REMT_EEXE
 1503B                  ;	input : no
 1504B                  ;	output: no
 1505B                  ;----------------------------------------------------------------------------
 1506B                  REMT_EEXE:
 1507B CB09 E390        	SRAM	EVENT,3
 1508B CB0A F800        	RET
 1509B                  ;----------------------------------------------------------------------------
 1510B                  ;	Function : REMT_EEND
 1511B                  ;	input : no
 1512B                  ;	output: no
 1513B                  ;----------------------------------------------------------------------------
 1514B                  REMT_EEND:
 1515B CB0B E310        	CRAM	EVENT,3
 1516B CB0C F800        	RET
 1517B                  ;----------------------------------------------------------------------------
 1518B                  ;       Function : DTMF_CHK
 1519B                  ;
 1520B                  ;       The general routine used in remote line operation. It checks VOX,
 1521B                  ;       BUSY TONE, DTMF, MEMORY FULL, POWER DOWN, ...
 1522B                  ;       Input  : CONF (Record Mode, Play Mode, Line Mode or Voice Prompt Mode)
 1523B                  ;       Output : ACCH = 0  -  One DTMF detected
 1524B                  ;                ACCH = 1  -  Play end
 1525B                  
 1526B                  ;		 DTMF_VAL  =  DTMF value
 1527B                  ;       Parameters:
 1528B                  ;               8. ANN_FG.7 - store the detected DTMF flag
 1529B                  ;----------------------------------------------------------------------------
 1530B                  DTMF_CHK:
 1531B CB0D 0E01                LAC     RESP              	;check the DTMF value ?
 1532B CB0E 0B0F                ANDK    0X0F
 1533B CB0F DB00CB1D            BS      ACZ,DTMF_CHK1
 1534B                  
 1535B CB11 8080CE0B            ADHL    DTMF_TABLE
 1536B CB13 1100                RPTK    0
 1537B CB14 CC64                TBR     SYSTMP
 1538B CB15 0E64                LAC     SYSTMP
 1539B CB16 B01D                SAH     DTMF_VAL          	;save the DTMF value in DTMF_VAL
 1540B                          
 1541B CB17 0E11                LAC     ANN_FG
 1542B CB18 84800080            ORL	0X80
 1543B CB1A B011                SAH     ANN_FG
 1544B CB1B DF00CB26            BS      B1,DTMF_CHK_END
 1545B                  DTMF_CHK1:
 1546B CB1D 6711                BIT     ANN_FG,7
 1547B CB1E D200CB26            BZ      TB,DTMF_CHK_END
 1548B                  DTMF_CHK2:
 1549B CB20 0E11                LAC     ANN_FG
 1550B CB21 8580FF7F            ANDL    0XFF7F
 1551B CB23 B011                SAH     ANN_FG
 1552B                  
 1553B CB24 0F01                LACK    1                 	; DTMF detected, return ACCH=1
 1554B CB25 F800                RET
 1555B                  DTMF_CHK_END:
 1556B CB26 0F00        	LACK	0
 1557B                  	
 1558B CB27 F800        	RET
 1559B                  ;----------------------------------------------------------------------------
 1560B                  ;       Function : CTONE_CHK
 1561B                  ;
 1562B                  ;       The general routine used in remote line operation. It checks CONT TONE
 1563B                  ;       Input  : CONF (Record Mode, Line Mode)
 1564B                  ;       Output : ACCH = 1  -  continuous tone period found
 1565B                  ;                ACCH = 0  -  no continuous tone period found
 1566B                  ;       Parameters:
 1567B                  ;               1. TMR_CTONE     - for continuous tone detection
 1568B                  ;----------------------------------------------------------------------------
 1569B                  CTONE_CHK:
 1570B                  	
 1571B CB28 6401                BIT     RESP,4            	; check if continuous tone happens ?
 1572B CB29 DA00CB2E            BS      TB,CTONE_CHK_ON
 1573B CB2B 87801F40            LACL    8000              	; continuous tone off
 1574B CB2D B028                SAH     TMR_CTONE
 1575B                  CTONE_CHK_ON:
 1576B CB2E 0E28                LAC     TMR_CTONE
 1577B CB2F D500CB3B            BZ      SGN,CTONE_CHK_ON_2
 1578B CB31 0E00                LAC     CONF
 1579B CB32 9E0C                SFR     12
 1580B CB33 0501                SBHK    1
 1581B CB34 D300CB39            BZ      ACZ,CTONE_CHK_ON_1
 1582B CB36 0E00                LAC     CONF
 1583B CB37 0914                ORK     20                	;//continuous tone period found and do
 1584B CB38 B000                SAH     CONF              	;//tail cut of 8.0 sec
 1585B                  CTONE_CHK_ON_1:	
 1586B CB39 0F01                LACK    1                 	; continuous tone period found, return ACCH=0
 1587B CB3A F800                RET
 1588B                  CTONE_CHK_ON_2:
 1589B CB3B 0F00        	LACK    0
 1590B CB3C F800                RET
 1591B                  ;----------------------------------------------------------------------------
 1592B                  ;       Function : VOX_CHK
 1593B                  ;
 1594B                  ;       The general routine used in remote line operation. It checks VOX
 1595B                  ;       Input  : CONF (Record Mode)
 1596B                  ;       Output : ACCH = 1  -  VOX found over 8.0 sec
 1597B                  ;                ACCH = 0  -  no VOX found over 8.0 sec
 1598B                  ;               
 1599B                  ;       Parameters:
 1600B                  ;               1. TMR_VOX - for VOX detection(initial TMR8=VOX time)
 1601B                  ;----------------------------------------------------------------------------
 1602B                  VOX_CHK:				; check the VOX
 1603B CB3D 6601                BIT     RESP,6
 1604B CB3E D200CB4D            BZ      TB,VOX_CHK_OFF
 1605B                  VOX_CHK_ON:                     ; VOX on
 1606B CB40 0E26                LAC     TMR_VOX
 1607B CB41 D500CB50            BZ      SGN,VOX_CHK_END
 1608B CB43 0E00                LAC	CONF
 1609B CB44 9E0C                SFR	12
 1610B CB45 0501                SBHK	1
 1611B CB46 D300CB4B    	BZ	ACZ,VOX_CHK_ON_1
 1612B CB48 0E00                LAC     CONF
 1613B CB49 0914                ORK     20                ; VOX over 8.0 sec and do tail cut of 8.0 sec
 1614B CB4A B000                SAH     CONF
 1615B                  VOX_CHK_ON_1:
 1616B CB4B 0F01                LACK    1                 ; VOX found over 8.0 sec, return ACCH=5
 1617B CB4C F800                RET
 1618B                  VOX_CHK_OFF:                     ; VOX off
 1619B CB4D 87801F40            LACL    8000              ; restore 8.0 sec in TMR8
 1620B CB4F B026                SAH     TMR_VOX
 1621B                  VOX_CHK_END:
 1622B CB50 0F00        	LACK    0
 1623B CB51 F800        	RET
 1624B                  ;----------------------------------------------------------------------------
 1625B                  ;       Function : BTONE_CHK
 1626B                  ;
 1627B                  ;       The general routine used in remote line operation. It checks BUSY TONE
 1628B                  ;       Input  : CONF (Record Mode, Play Mode, Line Mode or Voice Prompt Mode)
 1629B                  ;       Output : ACCH = 1  -  Busy tone
 1630B                  ;                ACCH = 0  -  NO Busy tone
 1631B                  ;
 1632B                  ;       Parameters:
 1633B                  ;               3. TMR_BTONE     - for busy tone detection
 1634B                  ;               4. BTONE_BUF    - store the total time of busy tone
 1635B                  ;               5. BUF1     - store the last on time of busy tone
 1636B                  ;               6. BUF2     - store the last off time of busy tone
 1637B                  ;               7. BUF3     - store some flags for busy tone detection
 1638B                  ;                  (see BUF3.DOC)
 1639B                  ;----------------------------------------------------------------------------
 1640B                  BTONE_CHK:
 1641B CB52 6501                BIT     RESP,5
 1642B CB53 D200CBA9            BZ      TB,BTONE_CHK_OFF
 1643B                  BTONE_CHK_ON:                    	; busy tone on
 1644B CB55 6513                BIT     BUF3,5            	; check if transition from busy tone off ?
 1645B CB56 D200CB99            BZ      TB,BTONE_CHK_ON_ONTON
 1646B                                                    	; enter busy tone on first time
 1647B CB58 0E27                LAC     TMR_BTONE              	; if busy tone off time < 60 ms, fails
 1648B                          ;SBHK    15
 1649B CB59 0532                SBHK    50		;change1 2006/11/04(busy tone off time < 200 ms, fails)
 1650B CB5A DD00CB8E            BS      SGN,BTONE_CHK_ON_FAIL
 1651B                  
 1652B CB5C 0E13                LAC     BUF3
 1653B CB5D 858000CF            ANDL    0XCF
 1654B CB5F 0910                ORK     0X10              	; set 'in busy tone on' bit to 1
 1655B CB60 B013                SAH     BUF3
 1656B                  
 1657B CB61 6713                BIT     BUF3,7            	; check if the first busy tone off to on
 1658B CB62 DA00CB6A            BS      TB,BTONE_CHK_ON1_1 	; has happened ?
 1659B                                                    	; from busy tone off to on first time
 1660B CB64 0E13                LAC     BUF3
 1661B CB65 84800080            ORL     0X80
 1662B CB67 B013                SAH     BUF3
 1663B CB68 DF00CB7C            BS      B1,BTONE_CHK_ON1_2
 1664B                  BTONE_CHK_ON1_1:
 1665B CB6A F500                SOVM
 1666B CB6B 0E27                LAC     TMR_BTONE              	; TMR_BTONE=the current busy tone off time
 1667B CB6C 0408                SBH     BUF2              	; BUF2=the last busy tone off time
 1668B CB6D 9800                ABS                       	; the difference between TMR_BTONE and BUF2
 1669B CB6E F400                ROVM                      	;   must be < 64 ms
 1670B CB6F 0510                SBHK    0X10
 1671B CB70 D500CB8E            BZ      SGN,BTONE_CHK_ON_FAIL
 1672B                          
 1673B CB72 0E27                LAC     TMR_BTONE	;change2 2006/11/04(the 400ms<TONEon + TONEoff<1400ms)
 1674B CB73 0007                ADH	BUF1
 1675B CB74 82800064            SBHL	100
 1676B CB76 DD00CB8E            BS      SGN,BTONE_CHK_ON_FAIL
 1677B CB78 828000FA            SBHL	250
 1678B CB7A D500CB8E            BZ      SGN,BTONE_CHK_ON_FAIL
 1679B                  BTONE_CHK_ON1_2:
 1680B CB7C 0E18                LAC     BTONE_BUF             	; BTONE_BUF store the total busy tone time
 1681B CB7D 0007                ADH     BUF1              	; add the last busy tone on time to BTONE_BUF
 1682B CB7E B018                SAH     BTONE_BUF
 1683B                  
 1684B CB7F 0E13                LAC     BUF3
 1685B CB80 0101                ADHK    1                 	; increase the 'tone on/off count' by 1
 1686B CB81 B013                SAH     BUF3
 1687B CB82 0B0F                ANDK    0X0F
 1688B CB83 0505                SBHK    5                 	; if the 'tone on/off count' >= 5, busy tone
 1689B CB84 DD00CB88            BS      SGN,BTONE_CHK_ON1_5 	;   period found
 1690B                  BTONE_CHK_ON1_3: 
 1691B                  	;LAC	CONF
 1692B                  	;SFR	12
 1693B                  	;SBHK	1
 1694B                  	;BZ	ACZ,BTONE_CHK_ON1_4	;record mode or not?
 1695B                  	                  		; busy tone period found
 1696B                          ;LAC     BTONE_BUF
 1697B                  	;ADH     TMR_BTONE
 1698B                          ;SFR     6                 	; tail cut base 400 ms
 1699B                          ;ANDK    0X3F              	; cut units ~= (SFR 6 + SFR 7) / 2
 1700B                          ;SAH     BTONE_BUF
 1701B                          ;SFR     1
 1702B                          ;ADH     BTONE_BUF
 1703B                          ;SFR     1
 1704B                          ;SAH     BTONE_BUF
 1705B                  
 1706B                          ;LAC     CONF
 1707B                          ;OR      BTONE_BUF
 1708B                          ;SAH     CONF
 1709B                  BTONE_CHK_ON1_4:        
 1710B CB86 0F01                LACK    1                 	; busy tone period found, return ACCH=0
 1711B CB87 F800                RET
 1712B                  
 1713B                  BTONE_CHK_ON1_5:
 1714B CB88 0E27                LAC     TMR_BTONE
 1715B CB89 B008                SAH     BUF2              	; save the current busy tone off time in BUF2
 1716B                  
 1717B CB8A 0F00                LACK    0
 1718B CB8B B027                SAH     TMR_BTONE
 1719B CB8C DF00CBE5            BS      B1,BTONE_CHK_END
 1720B                  BTONE_CHK_ON_FAIL:                    	; busy tone fails
 1721B CB8E 0E27                LAC     TMR_BTONE
 1722B CB8F B008                SAH     BUF2
 1723B CB90 B018                SAH     BTONE_BUF
 1724B                  
 1725B CB91 0F00                LACK    0
 1726B CB92 B027                SAH     TMR_BTONE
 1727B CB93 B007                SAH     BUF1
 1728B                  
 1729B CB94 87800090            LACL    0X90              	; set first busy tone off to on happened
 1730B CB96 B013                SAH     BUF3              	; set 'in busy tone on' bit to 1
 1731B CB97 DF00CBE5            BS      B1,BTONE_CHK_END
 1732B                  BTONE_CHK_ON_ONTON:
 1733B CB99 0E13                LAC     BUF3
 1734B CB9A 858000CF            ANDL    0XCF
 1735B CB9C 0910                ORK     0X10
 1736B CB9D B013                SAH     BUF3
 1737B                  
 1738B CB9E 0E27                LAC     TMR_BTONE            	; FOR FIRST BUSY TONE > 7.0 SEC CHECK
 1739B CB9F 828006D6            SBHL    1750            	; BUSY TONE 7.0 SEC
 1740B CBA1 DD00CBE5            BS      SGN,BTONE_CHK_END
 1741B                  
 1742B CBA3 0E27                LAC     TMR_BTONE            	; OVER 7.0 SECOND BUSY TONE CONTINOUS
 1743B CBA4 B018                SAH     BTONE_BUF
 1744B CBA5 0F00                LACK    0
 1745B CBA6 B027                SAH     TMR_BTONE
 1746B CBA7 DF00CB86            BS      B1,BTONE_CHK_ON1_3  	; JUMP TO TAIL CUT
 1747B                  BTONE_CHK_OFF:                   	; busy tone off
 1748B CBA9 6413                BIT     BUF3,4            	; check if transition from busy tone on ?
 1749B CBAA D200CBDD            BZ      TB,BTONE_CHK_OFF_OFFTOFF
 1750B                  
 1751B CBAC 0E27                LAC     TMR_BTONE              	; if busy tone on time < 60 ms, fails
 1752B                          ;SBHK    15
 1753B CBAD 0532                SBHK    50		;change3 2006/11/04(busy tone on time < 200 ms, fails)
 1754B CBAE DD00CBD3            BS      SGN,BTONE_CHK_OFF_FAIL
 1755B CBB0 057D                SBHK	125		;change4 2006/11/04(busy tone on time > 700 ms, fails)
 1756B CBB1 D500CBD3    	BZ      SGN,BTONE_CHK_OFF_FAIL
 1757B                  
 1758B CBB3 0E13                LAC     BUF3
 1759B CBB4 858000CF            ANDL    0XCF
 1760B CBB6 0920                ORK     0X20              	; set 'in busy tone off' bit to 1
 1761B CBB7 B013                SAH     BUF3
 1762B                  
 1763B CBB8 6613                BIT     BUF3,6             	; check if the first busy tone on to off
 1764B CBB9 DA00CBC2            BS      TB,BTONE_CHK_OFF1_1 	;   has happened ?
 1765B                                                     	; from busy tone on to off first time
 1766B CBBB 0E27                LAC     TMR_BTONE
 1767B CBBC B007                SAH     BUF1
 1768B                  
 1769B CBBD 0E13                LAC     BUF3
 1770B CBBE 0940                ORK     0X40
 1771B CBBF B013                SAH     BUF3
 1772B CBC0 DF00CBCF            BS      B1,BTONE_CHK_OFF1_2
 1773B                  BTONE_CHK_OFF1_1:
 1774B CBC2 F500                SOVM
 1775B CBC3 0E27                LAC     TMR_BTONE		; TMR_BTONE=the current busy tone on time
 1776B CBC4 0407                SBH     BUF1              	; BUF2=the last busy tone on time
 1777B CBC5 9800                ABS                       	; the difference between TMR_BTONE and BUF1
 1778B CBC6 F400                ROVM                      	;   must be < 64 ms
 1779B CBC7 0510                SBHK    0X10
 1780B CBC8 D500CBD3            BZ      SGN,BTONE_CHK_OFF_FAIL
 1781B                  
 1782B CBCA 0E18                LAC     BTONE_BUF             	; BTONE_BUF store the total busy tone time
 1783B CBCB 0008                ADH     BUF2              	; add the last busy tone off time to BTONE_BUF
 1784B CBCC B018                SAH     BTONE_BUF
 1785B                  
 1786B                          ;LAC     BUF3
 1787B                          ;ADHK    1                 	; increase the 'tone on/off count' by 1
 1788B                          ;SAH     BUF3		;change5 2006/11/04(increase the tone on/off only in "off to on")
 1789B                          
 1790B CBCD 0E27                LAC     TMR_BTONE
 1791B CBCE B007                SAH     BUF1              	; save the current busy tone on time in BUF1
 1792B                  BTONE_CHK_OFF1_2:
 1793B CBCF 0F00                LACK    0                 	; reset TMR_BTONE for restart
 1794B CBD0 B027                SAH     TMR_BTONE
 1795B CBD1 DF00CBE5            BS      B1,BTONE_CHK_END
 1796B                  BTONE_CHK_OFF_FAIL:                   	; busy tone fails
 1797B CBD3 0E27                LAC     TMR_BTONE
 1798B CBD4 B007                SAH     BUF1
 1799B                  
 1800B CBD5 0F00                LACK    0
 1801B CBD6 B027                SAH     TMR_BTONE
 1802B CBD7 B018                SAH     BTONE_BUF
 1803B CBD8 B008                SAH     BUF2
 1804B                  
 1805B CBD9 0F60                LACK    0X60              	; set first busy tone on to off happened
 1806B CBDA B013                SAH     BUF3              	; set 'in busy tone off' bit to 1
 1807B CBDB DF00CBE5            BS      B1,BTONE_CHK_END
 1808B                  BTONE_CHK_OFF_OFFTOFF:
 1809B CBDD 6613                BIT     BUF3,6
 1810B CBDE DA00CBE5            BS      TB,BTONE_CHK_END
 1811B CBE0 6713                BIT     BUF3,7
 1812B CBE1 DA00CBE5            BS      TB,BTONE_CHK_END
 1813B CBE3 0F00                LACK    0
 1814B CBE4 B027                SAH     TMR_BTONE
 1815B                  BTONE_CHK_END:
 1816B CBE5 0F00        	LACK	0
 1817B CBE6 F800        	RET
 1818B                  ;----------------------------------------------------------------------------
 1819B                  ;       Function : BCVOX_INIT
 1820B                  ;	input : no
 1821B                  ;	output: no
 1822B                  ;	variable : no
 1823B                  ;----------------------------------------------------------------------------
 1824B                  BCVOX_INIT:
 1825B CBE7 87801F40    	LACL	8000
 1826B CBE9 B026        	SAH	TMR_VOX
 1827B CBEA B028        	SAH	TMR_CTONE
 1828B                  	
 1829B CBEB 0F00        	LACK	0
 1830B CBEC B007        	SAH	BUF1
 1831B CBED B008        	SAH	BUF2
 1832B CBEE B013        	SAH	BUF3
 1833B CBEF B027        	SAH	TMR_BTONE
 1834B CBF0 B018        	SAH	BTONE_BUF
 1835B                  	
 1836B CBF1 F800        	RET      
 1837B                  ;----------------------------------------------------------------------------
 1838B                  
 1839B                  .END
 1185A                  .INCLUDE gui.asm
    1B                  .LIST
    2B                  
    3B                  ;-------------------------------------------------------------------------
    4B                  ;	Function : GET_MSG	
    5B                  ;-------------------------------------------------------------------------
    6B                  GET_MSG:
    7B CBF2 F000        	DINT
    8B                  	
    9B CBF3 0E51        	LAC	MSG_QUEUE
   10B CBF4 0B07        	ANDK	0X07
   11B CBF5 B02D        	SAH	INT_TTMP0
   12B CBF6 0E51        	LAC	MSG_QUEUE
   13B CBF7 9E08        	SFR	8
   14B CBF8 042D        	SBH	INT_TTMP0
   15B CBF9 DB00CC07    	BS	ACZ,GET_MSG_END		;NO MESSAGE
   16B                  GET_MSG_GET:
   17B CBFB 0E51        	LAC	MSG_QUEUE
   18B CBFC 0101        	ADHK	1
   19B CBFD 85800707    	ANDL	0X707
   20B CBFF B051        	SAH	MSG_QUEUE
   21B                  	
   22B CC00 0B07        	ANDK	0X07
   23B CC01 80800052    	ADHL	MSG_ADDR		;GET ADDR
   24B CC03 B02D        	SAH	INT_TTMP0
   25B                  	
   26B CC04 F689        	MAR	+0,1
   27B CC05 722D        	LAR	INT_TTMP0,1
   28B CC06 0E89        	LAC	+0,1
   29B                  GET_MSG_END:
   30B CC07 F100        	EINT
   31B CC08 F800        	RET
   32B                  ;-------------------------------------------------------------------------
   33B                  ;	Function : INT_STOR_MSG	
   34B                  ;-------------------------------------------------------------------------
   35B                  INT_STOR_MSG:			;中断存消息
   36B CC09 B02D        	SAH	INT_TTMP0
   37B                  	
   38B CC0A 0E51        	LAC	MSG_QUEUE
   39B CC0B 80800100    	ADHL	0X100
   40B CC0D 85800707    	ANDL	0X707
   41B CC0F B051        	SAH	MSG_QUEUE
   42B                  	
   43B CC10 9E08        	SFR	8
   44B CC11 80800052    	ADHL	MSG_ADDR	;GET ADDR
   45B CC13 B02E        	SAH	INT_TTMP1
   46B                  	
   47B CC14 F689        	MAR	+0,1
   48B CC15 722E        	LAR	INT_TTMP1,1
   49B CC16 0E2D        	LAC	INT_TTMP0
   50B CC17 B089        	SAH	+0,1
   51B CC18 F800        	RET
   52B                  ;---
   53B                  STOR_MSG:
   54B CC19 F000        	DINT
   55B CC1A FC00CC09    	CALL	INT_STOR_MSG
   56B CC1C F100        	EINT
   57B CC1D F800        	RET
   58B                  ;//-------------------------------------------------------
   59B                  ;---
   60B                  GET_FUNC:
   61B CC1E 0E5A        	LAC	FUNC_STACK
   62B CC1F DB00CC28    	BS	ACZ,GET_FUNC_MAIN
   63B CC21 8080005A    	ADHL	FUNC_STACK
   64B CC23 B05E        	SAH	SYSTMP0
   65B                  	
   66B CC24 F689        	MAR	+0,1
   67B CC25 725E        	LAR	SYSTMP0,1
   68B CC26 0E89        	LAC	+0,1
   69B                  GET_FUNC_END:
   70B CC27 F800        	RET
   71B                  GET_FUNC_MAIN:			;如果没有就是主程序
   72B CC28 8780C349    	LACL	MAIN_PRO
   73B CC2A F800        	RET
   74B                  
   75B                  ;//--------------------------------------------------------------------------
   76B                  ;	Function : PUSH_FUNC
   77B                  ;	input 	 : ACCH
   78B                  ;	output	 : no
   79B                  ;	variable : SYSTMP0,SYSTMP1
   80B                  ;//--------------------------------------------------------------------------
   81B                  PUSH_FUNC:
   82B CC2B B05E        	SAH	SYSTMP0
   83B CC2C 0E5A        	LAC	FUNC_STACK
   84B CC2D 0101        	ADHK	1
   85B CC2E 0B03        	ANDK	0X03
   86B CC2F B05A        	SAH	FUNC_STACK
   87B CC30 8080005A    	ADHL	FUNC_STACK
   88B CC32 B05F        	SAH	SYSTMP1
   89B                  	
   90B CC33 F689        	MAR	+0,1
   91B CC34 725F        	LAR	SYSTMP1,1
   92B CC35 0E5E        	LAC	SYSTMP0
   93B CC36 B089        	SAH	+0,1
   94B CC37 F800        	RET
   95B                  
   96B                  ;---
   97B                  CLR_FUNC:
   98B CC38 0F00        	LACK	0
   99B CC39 B05A        	SAH	FUNC_STACK
  100B CC3A FC00C1C4    	CALL	DAA_OFF		;(默认)线路空置
  101B CC3C F800        	RET
  102B                  
  103B                  ;--------------------
  104B                  GET_VP:
  105B CC3D 0E40        	LAC	VP_QUEUE
  106B CC3E 0B0F        	ANDK	0X0F
  107B CC3F B05E        	SAH	SYSTMP0
  108B CC40 0E40        	LAC	VP_QUEUE
  109B CC41 9E08        	SFR	8
  110B CC42 045E        	SBH	SYSTMP0
  111B CC43 DB00CC51    	BS	ACZ,GET_VP_END
  112B                  	
  113B CC45 0E40        	LAC	VP_QUEUE
  114B CC46 0101        	ADHK	1
  115B CC47 85800F0F    	ANDL	0X0F0F
  116B CC49 B040        	SAH	VP_QUEUE
  117B                  	
  118B CC4A 0B0F        	ANDK	0XF
  119B CC4B 80800041    	ADHL	VP_ADDR
  120B CC4D B05E        	SAH	SYSTMP0		;ADDRESS
  121B                  	
  122B CC4E F689        	MAR	+0,1
  123B CC4F 725E        	LAR	SYSTMP0,1
  124B CC50 0E89        	LAC	+0,1
  125B                  GET_VP_END:
  126B CC51 F800        	RET
  127B                  ;----------------
  128B                  ;------------------------------------------------------------------------------
  129B                  ;	Function : STOR_VP
  130B                  ;
  131B                  ;		input : ACCH
  132B                  ;		output: no
  133B                  ;------------------------------------------------------------------------------
  134B                  STOR_VP:
  135B CC52 B064        	SAH	SYSTMP
  136B CC53 0E40        	LAC	VP_QUEUE
  137B CC54 80800100    	ADHL	0X100
  138B CC56 85800F0F    	ANDL	0X0F0F
  139B CC58 B040        	SAH	VP_QUEUE
  140B                  	
  141B CC59 9E08        	SFR	8
  142B CC5A 80800041    	ADHL	VP_ADDR
  143B CC5C B05E        	SAH	SYSTMP0		;ADDRESS
  144B                  	
  145B CC5D F689        	MAR	+0,1
  146B CC5E 725E        	LAR	SYSTMP0,1
  147B CC5F 0E64        	LAC	SYSTMP
  148B CC60 B089        	SAH	+0,1
  149B CC61 F800        	RET
  150B                  ;---
  151B                  
  152B                  .END
 1186A                  .INCLUDE icm_sta.asm
    1B                  .LIST
    2B                  ICM_STATE:
    3B CC62 0E3D        	LAC	MSG
    4B CC63 86800006    	XORL	CMSG_KEY6S		;接线后摘机(相当于CPC)
    5B CC65 DB00CC7A    	BS	ACZ,ICM_CPC_RUN
    6B                  	
    7B CC67 0E3D        	LAC	MSG			;接线后摘机(相当于CPC)
    8B CC68 8680008B    	XORL	CMSG_CPC
    9B CC6A DB00CC7A    	BS	ACZ,ICM_CPC_RUN
   10B                  	
   11B CC6C 0E3E        	LAC	PRO_VAR
   12B CC6D 9E04        	SFR	4
   13B CC6E DB00CCA7    	BS	ACZ,ICM_STATE1		;for initial
   14B CC70 0501        	SBHK	1
   15B CC71 DB00CD5D    	BS	ACZ,ICM_STATE2		;for record(ANSWER AND RECORD ICM)
   16B CC73 0501        	SBHK	1
   17B CC74 DB00CDD1    	BS	ACZ,ICM_STATE_EXIT	;for end(TimeOut/BTONE/CTONE/VOX_ON)
   18B CC76 0501        	SBHK	1
   19B CC77 DB00CDE9    	BS	ACZ,LINE_STATE1		;for line(ANSWER ONLY)
   20B                  
   21B CC79 F800        	RET
   22B                  ;-------
   23B                  ICM_CPC_RUN:
   24B CC7A 0E00        	LAC	CONF
   25B CC7B 9E0C        	SFR	12
   26B CC7C 0501        	SBHK	1
   27B CC7D D300CCA1    	BZ	ACZ,ICM_CPC_RUN_3
   28B CC7F 0E00        	LAC	CONF
   29B CC80 8580FFC0    	ANDL	0XFFC0
   30B CC82 B000        	SAH	CONF
   31B                  	
   32B CC83 0E3F        	LAC	PRO_VAR1
   33B CC84 0503        	SBHK	3
   34B CC85 D500CC8A    	BZ	SGN,ICM_CPC_RUN_1
   35B CC87 EB80        	SRAM	CONF,11				;少于3秒,录音删除
   36B CC88 FC000020    	CALL	DAM_BIOS
   37B                  ICM_CPC_RUN_1:
   38B CC8A FC00CA4B    	CALL	INIT_DAM_FUNC
   39B                  	
   40B CC8C 8780E605    	LACL	0XE605
   41B CC8E B000        	SAH	CONF
   42B CC8F FC000020    	CALL	DAM_BIOS
   43B CC91 FC00DC09    	CALL	GET_TELT
   44B CC93 D300CC9B    	BZ	ACZ,ICM_CPC_RUN_2		;当无来电时才写入相应的信息
   45B                  	
   46B CC95 FC00C0FE    	CALL	GET_TOTALMSG
   47B CC97 FC00D93F    	CALL	GET_MSGMSG
   48B CC99 FC00D9E8    	CALL	WRITE_ICMMSG
   49B                  ICM_CPC_RUN_2:
   50B CC9B FC00C0FE    	CALL	GET_TOTALMSG
   51B CC9D FC00DC1E    	CALL	GET_USRDAT
   52B CC9F FC00DBC7    	CALL	COL_ICMTEL
   53B                  ICM_CPC_RUN_3:
   54B CCA1 FC00CA4B    	CALL	INIT_DAM_FUNC
   55B CCA3 FC00DBA8    	CALL	TMPNUM_DEL
   56B                  ICM_CPC_RUN_END:	
   57B CCA5 DF00CDD7    	BS	B1,ICM_STATE_EXIT_END
   58B                  	
   59B                  ;=============================================================
   60B                  ICM_STATE1:	
   61B CCA7 0E3D        	LAC	MSG
   62B CCA8 86800081    	XORL	CMSG_INIT		;INITIAL
   63B CCAA DB00CCB7    	BS	ACZ,ICM_STATE_INIT
   64B                  ICM_STATE1_1:	
   65B CCAC 0E3D        	LAC	MSG
   66B CCAD 868000B0    	XORL	CVP_STOP		
   67B CCAF DB00CCDE    	BS	ACZ,ICM_VP_STOP		;CVP_STOP,OGM播放完毕
   68B                  ICM_STATE1_2:
   69B CCB1 0E3D        	LAC	MSG
   70B CCB2 86800085    	XORL	CREV_DTMF		;CREV_DTMF
   71B CCB4 DB00CD03    	BS	ACZ,ICM_REV_DTMF
   72B CCB6 F800        	RET
   73B                  
   74B                  ;---
   75B                  ICM_STATE_INIT:
   76B CCB7 FC00CA4B    	CALL	INIT_DAM_FUNC
   77B CCB9 FC00C189    	CALL	DAA_LIN_RECORD
   78B CCBB FC00C1CA    	CALL	HOOK_ON
   79B                  	
   80B CCBD FC00D214    	CALL	SET_OGMFG	;综合当前情况设定OGM
   81B                  	;CALL	OGM_STATUS
   82B CCBF FC00D224    	CALL	OGM_CHK
   83B CCC1 DB00CCD1    	BS	ACZ,ICM_STATE_INIT1
   84B                  				;判断有无OGM1/OGM2录音
   85B CCC3 FC00D1F4    	CALL	SELECT_VP
   86B                  ;---	
   87B CCC5 0F7D        	LACK	0X07D
   88B CCC6 FC00CC52    	CALL	STOR_VP		;延时1 second
   89B                  	
   90B CCC8 0E1C        	LAC	LANGUAGE
   91B CCC9 9E04        	SFR	4		;default OGM vp
   92B CCCA 0B0F        	ANDK	0X0F
   93B CCCB 8480FF00    	ORL	0XFF00
   94B CCCD FC00CC52    	CALL	STOR_VP
   95B CCCF DF00CCDB    	BS	B1,ICM_STATE_INIT2
   96B                  ICM_STATE_INIT1:
   97B CCD1 0F7D        	LACK	0X07D
   98B CCD2 FC00CC52    	CALL	STOR_VP		;延时1 second
   99B                  	
  100B CCD4 0E14        	LAC	MSG_ID		;record OGM
  101B CCD5 858000FF    	ANDL	0X0FF
  102B CCD7 8480FE00    	ORL	0XFE00
  103B CCD9 FC00CC52    	CALL	STOR_VP
  104B                  ICM_STATE_INIT2:		
  105B CCDB FC00D267    	CALL	LBEEP
  106B                  	
  107B CCDD F800        	RET
  108B                  ;---
  109B                  ICM_VP_STOP:			;开始录音(ICM)/ON_LINE(only)
  110B CCDE FC00CA4B    	CALL	INIT_DAM_FUNC
  111B CCE0 FC00C197    	CALL	DAA_ICM_RECORD
  112B CCE2 FC00CBE7    	CALL	BCVOX_INIT
  113B                  
  114B CCE4 0F00        	LACK	0
  115B CCE5 B03F        	SAH	PRO_VAR1
  116B CCE6 878003E8    	LACL	1000
  117B CCE8 FC00C1D6    	CALL	SET_TIMER
  118B                  
  119B CCEA 0E3E        	LAC	PRO_VAR
  120B CCEB 8580FF0F    	ANDL	0XFF0F
  121B CCED 0110        	ADHK	0X010		;OGM1/record
  122B CCEE B03E        	SAH	PRO_VAR
  123B                  
  124B CCEF FC00C108    	CALL    MSG_CHK
  125B                  	;CALL	GET_FILEID
  126B                  	
  127B CCF1 0E17        	LAC	FILE_ID
  128B CCF2 FC00DC16    	CALL	SET_USRDAT
  129B                  	
  130B CCF4 FC00CA8A    	CALL	REC_START
  131B                  
  132B                  	;CALL	MSG_CHK
  133B CCF6 6311        	BIT	ANN_FG,3	;memory full?
  134B CCF7 D200CD02    	BZ	TB,ICM_VP_STOP1
  135B                  	
  136B CCF9 FC00CA4B    	CALL	INIT_DAM_FUNC
  137B CCFB FC00CA94    	CALL	LINE_START
  138B                  	
  139B CCFD 0E3E        	LAC	PRO_VAR
  140B CCFE 8580FF0F    	ANDL	0XFF0F
  141B CD00 0130        	ADHK	0X030		;OGM2/line
  142B CD01 B03E        	SAH	PRO_VAR
  143B                  ICM_VP_STOP1:	
  144B                  	;BIT	EVENT,8		;判断OGM1/OGM2---record/line
  145B                  	;BZ	TB,ICM_VP_STOP_END
  146B                  	
  147B                  	;CALL	LINE_START
  148B                  			
  149B                  ICM_VP_STOP_END:
  150B                  		
  151B CD02 F800        	RET
  152B                  ;---------------for DTMF
  153B                  ICM_REV_DTMF:			;比较密码
  154B CD03 FC00CBE7    	CALL	BCVOX_INIT	;有键按下BCVOX要清零
  155B                  	
  156B CD05 0E3E        	LAC	PRO_VAR
  157B CD06 8580000F    	ANDL	0X0F
  158B CD08 DB00CD19    	BS	ACZ,ICM_REV_DTMF0
  159B CD0A 0501        	SBHK	1
  160B CD0B DB00CD22    	BS	ACZ,ICM_REV_DTMF1
  161B CD0D 0501        	SBHK	1
  162B CD0E DB00CD2C    	BS	ACZ,ICM_REV_DTMF2
  163B                  	
  164B CD10 0E1B        	LAC	PASSWORD	;第四位(bit3..0)
  165B CD11 0B0F        	ANDK	0X0F
  166B CD12 848000F0    	ORL	0XF0
  167B CD14 041D        	SBH	DTMF_VAL
  168B CD15 DB00CD3F    	BS	ACZ,ICM_REV_DTMF_YES
  169B CD17 DF00CD36    	BS	B1,ICM_REV_DTMF_ERR
  170B                  ICM_REV_DTMF0:			;第一位(bit15..12)
  171B CD19 0E1B        	LAC	PASSWORD
  172B CD1A 9E0C        	SFR	12
  173B CD1B 848000F0    	ORL	0XF0
  174B CD1D 041D        	SBH	DTMF_VAL
  175B CD1E DB00CD3B    	BS	ACZ,ICM_REV_DTMF_OK
  176B CD20 DF00CD36    	BS	B1,ICM_REV_DTMF_ERR
  177B                  ICM_REV_DTMF1:			;第二位(bit11..8)
  178B CD22 0E1B        	LAC	PASSWORD
  179B CD23 9E08        	SFR	8
  180B CD24 0B0F        	ANDK	0X0F
  181B CD25 848000F0    	ORL	0XF0
  182B CD27 041D        	SBH	DTMF_VAL
  183B CD28 DB00CD3B    	BS	ACZ,ICM_REV_DTMF_OK
  184B CD2A DF00CD36    	BS	B1,ICM_REV_DTMF_ERR
  185B                  ICM_REV_DTMF2:			;第三位(bit7..4)
  186B CD2C 0E1B        	LAC	PASSWORD
  187B CD2D 9E04        	SFR	4
  188B CD2E 0B0F        	ANDK	0X0F
  189B CD2F 848000F0    	ORL	0XF0
  190B CD31 041D        	SBH	DTMF_VAL
  191B CD32 DB00CD3B    	BS	ACZ,ICM_REV_DTMF_OK
  192B CD34 DF00CD36    	BS	B1,ICM_REV_DTMF_ERR
  193B                  	
  194B                  ICM_REV_DTMF_ERR:
  195B CD36 0E3E        	LAC	PRO_VAR
  196B CD37 8580FFF0    	ANDL	0XFFF0
  197B CD39 B03E        	SAH	PRO_VAR
  198B CD3A F800        	RET
  199B                  ICM_REV_DTMF_OK:
  200B CD3B 0E3E        	LAC	PRO_VAR
  201B CD3C 0101        	ADHK	1
  202B CD3D B03E        	SAH	PRO_VAR
  203B CD3E F800        	RET
  204B                  ICM_REV_DTMF_YES:		;密码成功
  205B CD3F 0E00        	LAC	CONF
  206B CD40 9E0C        	SFR	12
  207B CD41 0501        	SBHK	1
  208B CD42 D300CD47    	BZ	ACZ,ICM_REV_DTMF_YES1
  209B                  	
  210B CD44 EB80        	SRAM	CONF,11
  211B CD45 FC000020    	CALL	DAM_BIOS	;若是录音过程,则删除之
  212B                  ICM_REV_DTMF_YES1:	
  213B CD47 FC00CA4B    	CALL	INIT_DAM_FUNC
  214B                  	
  215B CD49 FC00CC38    	CALL	CLR_FUNC	;先空
  216B CD4B 8780CE1C    	LACL	REMOTE_PRO	;进入遥控
  217B CD4D FC00CC2B    	CALL	PUSH_FUNC
  218B                  	
  219B CD4F FC00DBA8    	CALL	TMPNUM_DEL
  220B                  	
  221B CD51 FC00C197    	CALL	DAA_ICM_RECORD
  222B                  	
  223B CD53 87800081    	LACL	CMSG_INIT
  224B CD55 FC00CC19    	CALL	STOR_MSG
  225B                  	
  226B CD57 0F00        	LACK	0
  227B CD58 B03E        	SAH	PRO_VAR		;程序步骤
  228B CD59 B03F        	SAH	PRO_VAR1	;计时清零
  229B                  	
  230B CD5A FC00CBE7    	CALL	BCVOX_INIT
  231B                  	
  232B CD5C F800        	RET
  233B                  
  234B                  ;=============================================================
  235B                  ICM_STATE2:
  236B CD5D 0E3D        	LAC	MSG
  237B CD5E 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  238B CD60 DB00CD03    	BS	ACZ,ICM_REV_DTMF
  239B                  ICM_STATE2_1:
  240B CD62 0E3D        	LAC	MSG
  241B CD63 86800090    	XORL	CMSG_TMR		;time 1s
  242B CD65 DB00CDAB    	BS	ACZ,ICM_TMR_DET
  243B                  ICM_STATE2_2:
  244B CD67 0E3D        	LAC	MSG
  245B CD68 86800086    	XORL	CMSG_VOX		;VOX_ON 8s
  246B CD6A DB00CD81    	BS	ACZ,ICM_VOX_DET
  247B                  ICM_STATE2_3:
  248B CD6C 0E3D        	LAC	MSG
  249B CD6D 86800083    	XORL	CMSG_CTONE		;CTONE 8s
  250B CD6F DB00CD81    	BS	ACZ,ICM_CTONE_DET
  251B                  ICM_STATE2_4:
  252B CD71 0E3D        	LAC	MSG
  253B CD72 86800084    	XORL	CMSG_BTONE		;BTONE 8s
  254B CD74 DB00CD81    	BS	ACZ,ICM_BTONE_DET
  255B                  ICM_STATE2_5:
  256B CD76 0E3D        	LAC	MSG
  257B CD77 868000B2    	XORL	CREC_FULL		;REC_FULL
  258B CD79 DB00CDBF    	BS	ACZ,ICM_REC_FUL
  259B                  ICM_STATE2_6:
  260B CD7B 0E3D        	LAC	MSG
  261B CD7C 868000B0    	XORL	CVP_STOP		;PLAY END
  262B CD7E DB00CDCA    	BS	ACZ,ICM_FUL_EVP
  263B                  	
  264B CD80 F800        	RET
  265B                  ;-------
  266B                  ICM_VOX_DET:				;由于后BTONE,CTONE,VOX要持续一段时间,可不考虑小长度的录音删除问题
  267B                  ICM_CTONE_DET:
  268B                  ICM_BTONE_DET:
  269B                  	;CALL	INIT_DAM_FUNC
  270B                  	;CALL	DAA_LIN_RECORD
  271B                  ;---	
  272B CD81 0E00        	LAC	CONF
  273B CD82 9E0C        	SFR	12
  274B CD83 0501        	SBHK	1
  275B CD84 D300CD9D    	BZ	ACZ,ICM_BCVOX_DET
  276B                  	
  277B CD86 FC00CA4B    	CALL	INIT_DAM_FUNC
  278B                  	
  279B CD88 8780E605    	LACL	0XE605
  280B CD8A B000        	SAH	CONF
  281B CD8B FC000020    	CALL	DAM_BIOS
  282B CD8D FC00DC09    	CALL	GET_TELT
  283B CD8F D300CD97    	BZ	ACZ,ICM_BCVOX_1		;当无来电时才写入相应的信息
  284B                  	
  285B CD91 FC00C0FE    	CALL	GET_TOTALMSG
  286B CD93 FC00D93F    	CALL	GET_MSGMSG
  287B CD95 FC00D9E8    	CALL	WRITE_ICMMSG
  288B                  ICM_BCVOX_1:
  289B CD97 FC00C0FE    	CALL	GET_TOTALMSG
  290B CD99 FC00DC1E    	CALL	GET_USRDAT
  291B CD9B FC00DBC7    	CALL	COL_ICMTEL
  292B                  ICM_BCVOX_DET:	
  293B CD9D FC00CA4B    	CALL	INIT_DAM_FUNC
  294B CD9F FC00DBA8    	CALL	TMPNUM_DEL
  295B                  ;---
  296B CDA1 0E3E        	LAC	PRO_VAR
  297B CDA2 8580FF0F    	ANDL	0XFF0F
  298B CDA4 0120        	ADHK	0X020
  299B CDA5 B03E        	SAH	PRO_VAR
  300B                  	
  301B CDA6 FC00C189    	CALL	DAA_LIN_RECORD	
  302B CDA8 FC00D26C    	CALL	BBEEP		;替换语音BB
  303B                  	
  304B CDAA F800        	RET
  305B                  ;---
  306B                  ICM_TMR_DET:
  307B CDAB 0E3F        	LAC	PRO_VAR1
  308B CDAC 0101        	ADHK	1
  309B CDAD B03F        	SAH	PRO_VAR1
  310B CDAE 0578        	SBHK	120
  311B CDAF D300CDBE    	BZ	ACZ,ICM_TMR_DET_END	
  312B CDB1 DD00CDBE    	BS	SGN,ICM_TMR_DET_END
  313B                  	
  314B CDB3 FC00CA4B    	CALL	INIT_DAM_FUNC
  315B CDB5 FC00C189    	CALL	DAA_LIN_RECORD
  316B                  	
  317B CDB7 0E3E        	LAC	PRO_VAR
  318B CDB8 8580FF0F    	ANDL	0XFF0F
  319B CDBA 0120        	ADHK	0X020
  320B CDBB B03E        	SAH	PRO_VAR
  321B                  
  322B CDBC FC00D26C    	CALL	BBEEP		;替换语音BB
  323B                  	
  324B                  ICM_TMR_DET_END:
  325B CDBE F800        	RET
  326B                  ;-------
  327B                  ICM_REC_FUL:
  328B CDBF FC00CA4B    	CALL	INIT_DAM_FUNC
  329B CDC1 FC00C189    	CALL	DAA_LIN_RECORD
  330B                  
  331B CDC3 87800025    	LACL	0X025
  332B CDC5 FC00CC52    	CALL	STOR_VP	
  333B CDC7 FC00D279    	CALL	BBBEEP		;警告语音BBB
  334B                  	
  335B CDC9 F800        	RET
  336B                  ICM_FUL_EVP:
  337B CDCA FC00C197    	CALL	DAA_ICM_RECORD
  338B CDCC FC00CA4B    	CALL	INIT_DAM_FUNC
  339B CDCE FC00CA94    	CALL	LINE_START
  340B                  	
  341B CDD0 F800        	RET
  342B                  ;=================================================================
  343B                  ICM_STATE_EXIT:
  344B CDD1 0E3D        	LAC	MSG
  345B CDD2 868000B0    	XORL	CVP_STOP		
  346B CDD4 DB00CDD7    	BS	ACZ,ICM_STATE_EXIT_END	;CVP_STOP,EXIT播放完毕
  347B                  	
  348B CDD6 F800        	RET
  349B                  ICM_STATE_EXIT_END:
  350B CDD7 FC00CA4B    	CALL	INIT_DAM_FUNC
  351B CDD9 FC00C1CD    	CALL	HOOK_OFF
  352B CDDB FC00CC38    	CALL	CLR_FUNC	;先空
  353B                  	
  354B CDDD FC00DBA8    	CALL	TMPNUM_DEL
  355B                  	
  356B CDDF 0F00        	LACK	0
  357B CDE0 B03E        	SAH	PRO_VAR
  358B                  
  359B CDE1 87800018    	LACL	0X0018
  360B CDE3 FC00CC52    	CALL	STOR_VP		;延时192ms
  361B                  	
  362B CDE5 0E19        	LAC	RING_ID
  363B CDE6 9E0C        	SFR	12
  364B CDE7 B019        	SAH	RING_ID
  365B                  	
  366B CDE8 F800        	RET
  367B                  ;========================================================================
  368B                  LINE_STATE1:
  369B CDE9 0E3D        	LAC	MSG
  370B CDEA 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  371B CDEC DB00CD03    	BS	ACZ,ICM_REV_DTMF
  372B                  LINE_STATE1_1:
  373B CDEE 0E3D        	LAC	MSG
  374B CDEF 86800090    	XORL	CMSG_TMR		;time 1s
  375B CDF1 DB00CDF9    	BS	ACZ,LINE_TMR_DET
  376B                  LINE_STATE1_2:
  377B                  	;LAC	MSG
  378B                  	;XORL	CMSG_VOX		;VOX_ON 8s
  379B                  	;BS	ACZ,ICM_VOX_DET
  380B                  LINE_STATE1_3:
  381B                  	;LAC	MSG
  382B                  	;XORL	CMSG_CTONE		;CTONE 8s
  383B                  	;BS	ACZ,ICM_CTONE_DET
  384B                  LINE_STATE1_4:
  385B CDF3 0E3D        	LAC	MSG
  386B CDF4 86800084    	XORL	CMSG_BTONE		;BTONE 8s
  387B CDF6 DB00CD81    	BS	ACZ,ICM_BTONE_DET
  388B                  
  389B CDF8 F800        	RET
  390B                  ;-------
  391B                  LINE_TMR_DET:
  392B CDF9 0E3F        	LAC	PRO_VAR1
  393B CDFA 0101        	ADHK	1
  394B CDFB B03F        	SAH	PRO_VAR1
  395B CDFC 050A        	SBHK	10
  396B                  	;BZ	ACZ,LINE_TMR_DET_END	
  397B CDFD DD00CE0A    	BS	SGN,LINE_TMR_DET_END
  398B                  	
  399B CDFF FC00CA4B    	CALL	INIT_DAM_FUNC
  400B CE01 FC00C189    	CALL	DAA_LIN_RECORD
  401B                  	
  402B CE03 0E3E        	LAC	PRO_VAR
  403B CE04 8580FF0F    	ANDL	0XFF0F
  404B CE06 0120        	ADHK	0X020
  405B CE07 B03E        	SAH	PRO_VAR
  406B                  	
  407B CE08 FC00D26C    	CALL	BBEEP		;替换语音BB
  408B                  LINE_TMR_DET_END:
  409B CE0A F800        	RET
  410B                  	
  411B                  ;//----------------------------------------------------------------------
  412B                  DTMF_TABLE:
  413B                  
  414B                  	;no	1	2	3	4	5	6	7	8	
  415B CE0B 000000F1    .DATA	0X00	0XF1	0XF2	0XF3	0XF4	0XF5	0XF6	0XF7	0XF8
            00F200F3
            00F400F5
            00F600F7
  416B CE13 00F8         
  417B                  
  418B                  	;9	*	0	#	A	B	C	D
  419B CE14 00F900FE    .DATA	0XF9	0XFE	0XF0	0XFF	0XFA	0XFB	0XFC	0XFD
            00F000FF
            00FA00FB
            00FC00FD
  420B                  
  421B                  .END
 1187A                  .INCLUDE remote.asm
    1B                  .LIST
    2B                  REMOTE_PRO:
    3B CE1C 0E3D        	LAC	MSG			;接线后摘机(相当于CPC)
    4B CE1D 86800006    	XORL	CMSG_KEY6S
    5B CE1F DB00CE4A    	BS	ACZ,REMOTE_CPC_RUN
    6B                  	
    7B CE21 0E3D        	LAC	MSG			;接线后摘机(相当于CPC)
    8B CE22 8680008B    	XORL	CMSG_CPC
    9B CE24 DB00CE4A    	BS	ACZ,REMOTE_CPC_RUN
   10B                  	
   11B CE26 0E3E        	LAC	PRO_VAR
   12B CE27 8580000F    	ANDL	0X0F
   13B CE29 DB00CE60    	BS	ACZ,REMOTE_PRO0
   14B CE2B 0501        	SBHK	1
   15B CE2C DB00CF57    	BS	ACZ,REMOTE_PRO1
   16B CE2E 0501        	SBHK	1
   17B CE2F DB00D01A    	BS	ACZ,REMOTE_PRO2
   18B CE31 0501        	SBHK	1
   19B CE32 DB00D095    	BS	ACZ,REMOTE_PRO3
   20B CE34 0501        	SBHK	1
   21B CE35 DB00D096    	BS	ACZ,REMOTE_PRO4
   22B CE37 0501        	SBHK	1
   23B CE38 DB00D097    	BS	ACZ,REMOTE_PRO5
   24B CE3A 0501        	SBHK	1
   25B CE3B DB00D098    	BS	ACZ,REMOTE_PRO6
   26B CE3D 0501        	SBHK	1
   27B CE3E DB00D099    	BS	ACZ,REMOTE_PRO7
   28B CE40 0501        	SBHK	1
   29B CE41 DB00D13F    	BS	ACZ,REMOTE_PRO8
   30B CE43 0501        	SBHK	1
   31B CE44 DB00D191    	BS	ACZ,REMOTE_PRO9
   32B CE46 0501        	SBHK	1
   33B CE47 DB00D198    	BS	ACZ,REMOTE_PRO10
   34B                  	
   35B CE49 F800        	RET
   36B                  REMOTE_CPC_RUN:
   37B CE4A 0E3E        	LAC	PRO_VAR
   38B CE4B 8580000F    	ANDL	0X0F
   39B CE4D 0501        	SBHK	1
   40B CE4E DB00CE55    	BS	ACZ,REMOTE_CPC_RUN_PLYVP
   41B CE50 0501        	SBHK	1
   42B CE51 DB00CE55    	BS	ACZ,REMOTE_CPC_RUN_PLYVP
   43B                  	
   44B CE53 DF00D19E    	BS	B1,REMOTE_PRO10_END
   45B                  REMOTE_CPC_RUN_PLYVP:
   46B CE55 FC00CA4B    	CALL	INIT_DAM_FUNC
   47B                  	
   48B CE57 FC00DC7E    	CALL	SETOLD_VPMSG
   49B                  	
   50B CE59 87806100    	LACL	0X6100
   51B CE5B B000        	SAH	CONF
   52B CE5C FC000020    	CALL	DAM_BIOS
   53B                  	
   54B CE5E DF00D19E    	BS	B1,REMOTE_PRO10_END
   55B                  ;===============================================================================
   56B                  REMOTE_PRO0:
   57B CE60 0E3D        	LAC	MSG
   58B CE61 86800081    	XORL	CMSG_INIT		;INITIAL(发两声BEEP)
   59B CE63 DB00CE7F    	BS	ACZ,REMOTE_PRO0_INIT
   60B                  REMOTE_PRO0_1:
   61B CE65 0E3D        	LAC	MSG
   62B CE66 86800085    	XORL	CREV_DTMF		;CREV_DTMF
   63B CE68 DB00CE94    	BS	ACZ,REMOTE_PRO0_REV_DTMF
   64B                  REMOTE_PRO0_2:	
   65B CE6A 0E3D        	LAC	MSG
   66B CE6B 868000B0    	XORL	CVP_STOP
   67B CE6D DB00CE86    	BS	ACZ,REMOTE_PRO0_STOPVP	;VP完
   68B                  REMOTE_PRO0_3:	
   69B CE6F 0E3D        	LAC	MSG
   70B CE70 86800084    	XORL	CMSG_BTONE
   71B CE72 DB00CF4E    	BS	ACZ,REMOTE_PRO0_TONE
   72B                  REMOTE_PRO0_4:	
   73B CE74 0E3D        	LAC	MSG
   74B CE75 86800083    	XORL	CMSG_CTONE
   75B CE77 DB00CF4E    	BS	ACZ,REMOTE_PRO0_TONE
   76B                  REMOTE_PRO0_5:	
   77B CE79 0E3D        	LAC	MSG
   78B CE7A 86800090    	XORL	CMSG_TMR
   79B CE7C DB00CF50    	BS	ACZ,REMOTE_PRO0_TMR
   80B                  		
   81B CE7E F800        	RET
   82B                  REMOTE_PRO0_INIT:
   83B CE7F FC00CA4B    	CALL	INIT_DAM_FUNC
   84B CE81 FC00C189    	CALL	DAA_LIN_RECORD
   85B CE83 FC00D26C    	CALL	BBEEP		;BB
   86B                  	
   87B CE85 F800        	RET
   88B                  REMOTE_PRO0_STOPVP:
   89B CE86 FC00CA4B    	CALL	INIT_DAM_FUNC
   90B CE88 FC00C197    	CALL	DAA_ICM_RECORD
   91B CE8A E490        	SRAM	EVENT,4
   92B                  	
   93B CE8B 0F00        	LACK	0			;开始计时
   94B CE8C B03F        	SAH	PRO_VAR1
   95B CE8D 878003E8    	LACL	1000
   96B CE8F FC00C1D6    	CALL	SET_TIMER
   97B                  	
   98B CE91 FC00CBE7    	CALL	BCVOX_INIT
   99B                  	
  100B CE93 F800        	RET
  101B                  	
  102B                  REMOTE_PRO0_REV_DTMF:
  103B CE94 FC00C1D9    	CALL	CLR_TIMER
  104B CE96 0F00        	LACK	0
  105B CE97 B03F        	SAH	PRO_VAR1
  106B                  	
  107B CE98 FC00CBE7    	CALL	BCVOX_INIT
  108B                  	
  109B CE9A 0E1D        	LAC	DTMF_VAL
  110B CE9B 828000F0    	SBHL	0X0F0
  111B CE9D DB00CEC1    	BS	ACZ,REMOTE_PRO0_REV_DTMF_0	;0
  112B CE9F 0501        	SBHK	1
  113B CEA0 DB00CEC2    	BS	ACZ,REMOTE_PRO0_REV_DTMF_1	;1---play new
  114B CEA2 0501        	SBHK	1
  115B CEA3 DB00CEDF    	BS	ACZ,REMOTE_PRO0_REV_DTMF_2	;2---play all
  116B CEA5 0501        	SBHK	1
  117B CEA6 DB00CEF8    	BS	ACZ,REMOTE_PRO0_REV_DTMF_3	;3---erase all
  118B CEA8 0501        	SBHK	1
  119B CEA9 DB00CF16    	BS	ACZ,REMOTE_PRO0_REV_DTMF_4	;4
  120B CEAB 0501        	SBHK	1
  121B CEAC DB00CF17    	BS	ACZ,REMOTE_PRO0_REV_DTMF_5	;5
  122B CEAE 0501        	SBHK	1
  123B CEAF DB00CF18    	BS	ACZ,REMOTE_PRO0_REV_DTMF_6	;6
  124B CEB1 0501        	SBHK	1
  125B CEB2 DB00CF19    	BS	ACZ,REMOTE_PRO0_REV_DTMF_7	;7---record/play OGM
  126B CEB4 0501        	SBHK	1
  127B CEB5 DB00CF2C    	BS	ACZ,REMOTE_PRO0_REV_DTMF_8	;8---indoormonitor
  128B CEB7 0501        	SBHK	1
  129B CEB8 DB00CF35    	BS	ACZ,REMOTE_PRO0_REV_DTMF_9	;9---on/off
  130B CEBA 0505        	SBHK	5
  131B CEBB DB00CF3A    	BS	ACZ,REMOTE_PRO0_REV_DTMF_A	;*---remote prompt
  132B CEBD 0501        	SBHK	1
  133B CEBE DB00CF43    	BS	ACZ,REMOTE_PRO0_REV_DTMF_B	;#---hang off	
  134B                  	
  135B CEC0 F800        	RET
  136B                  REMOTE_PRO0_REV_DTMF_0:
  137B CEC1 F800        	RET
  138B                  REMOTE_PRO0_REV_DTMF_1:
  139B                  	
  140B CEC2 FC00CA4B    	CALL	INIT_DAM_FUNC
  141B                  	
  142B CEC4 FC00C108    	CALL	MSG_CHK
  143B                  	
  144B                  	;CALL	MANAGE
  145B CEC6 FC00D2B7    	CALL	CLR_FLAG
  146B                  	
  147B CEC8 FC00C108    	CALL	MSG_CHK
  148B CECA 6C11        	BIT	ANN_FG,12
  149B CECB DA00CED3    	BS	TB,REMOTE_PRO0_REV_DTMF_1_1
  150B                  
  151B CECD FC00D279    	CALL	BBBEEP		;BBB
  152B                  	
  153B CECF 0F00        	LACK	0
  154B CED0 B03E        	SAH	PRO_VAR
  155B CED1 DF00CEDC    	BS	B1,REMOTE_PRO0_REV_DTMF_1_END
  156B                  REMOTE_PRO0_REV_DTMF_1_1:
  157B CED3 0F01        	LACK	1
  158B CED4 B03E        	SAH	PRO_VAR
  159B                  
  160B CED5 0E16        	LAC	MSG_T
  161B CED6 0101        	ADHK	1
  162B CED7 B014        	SAH	MSG_ID
  163B                  
  164B CED8 87800005    	LACL	0X005
  165B CEDA FC00CC52    	CALL	STOR_VP
  166B                  REMOTE_PRO0_REV_DTMF_1_END:
  167B CEDC FC00C189    	CALL	DAA_LIN_RECORD
  168B                  		
  169B CEDE F800        	RET	
  170B                  REMOTE_PRO0_REV_DTMF_2:	
  171B CEDF FC00CA4B    	CALL	INIT_DAM_FUNC
  172B CEE1 FC00C108    	CALL	MSG_CHK
  173B                  
  174B CEE3 0E16        	LAC	MSG_T
  175B CEE4 0101        	ADHK	1
  176B CEE5 B014        	SAH	MSG_ID
  177B                  	
  178B CEE6 6E11        	BIT	ANN_FG,14
  179B CEE7 DA00CEEF    	BS	TB,REMOTE_PRO0_REV_DTMF_2_1
  180B                  
  181B CEE9 FC00D279    	CALL	BBBEEP		;BBB
  182B                  	
  183B CEEB 0F00        	LACK	0
  184B CEEC B03E        	SAH	PRO_VAR
  185B                  	
  186B CEED DF00CEF5    	BS	B1,REMOTE_PRO0_REV_DTMF_2_END
  187B                  REMOTE_PRO0_REV_DTMF_2_1:
  188B CEEF 0F02        	LACK	2
  189B CEF0 B03E        	SAH	PRO_VAR
  190B                  
  191B CEF1 87800005    	LACL	0X005
  192B CEF3 FC00CC52    	CALL	STOR_VP
  193B                  REMOTE_PRO0_REV_DTMF_2_END:
  194B CEF5 FC00C189    	CALL	DAA_LIN_RECORD
  195B                  	
  196B CEF7 F800        	RET
  197B                  
  198B                  REMOTE_PRO0_REV_DTMF_3:
  199B CEF8 FC00CA4B    	CALL	INIT_DAM_FUNC
  200B                  	
  201B CEFA 0F00        	LACK	0
  202B CEFB B03E        	SAH	PRO_VAR
  203B                  	
  204B CEFC 87806100    	LACL	0X6100
  205B CEFE B000        	SAH	CONF
  206B CEFF FC000020    	CALL	DAM_BIOS
  207B                  	
  208B CF01 87806080    	LACL	0X6080
  209B CF03 B000        	SAH	CONF
  210B CF04 FC000020    	CALL	DAM_BIOS
  211B                  	
  212B CF06 FC00D8F1    	CALL	TELNUMALL_DEL	;删除没有对应message的电话号码
  213B                  	
  214B CF08 FC00C108    	CALL	MSG_CHK
  215B CF0A 6E11        	BIT	ANN_FG,14
  216B CF0B DA00CF11    	BS	TB,REMOTE_PRO0_REV_DTMF_3_1
  217B                  
  218B CF0D FC00D279    	CALL	BBBEEP		;BBB
  219B                  	
  220B CF0F DF00CF13    	BS	B1,REMOTE_PRO0_REV_DTMF_3_END
  221B                  REMOTE_PRO0_REV_DTMF_3_1:	
  222B                  
  223B CF11 FC00D26C    	CALL	BBEEP		;BB
  224B                  REMOTE_PRO0_REV_DTMF_3_END:	
  225B CF13 FC00C189    	CALL	DAA_LIN_RECORD
  226B                  	
  227B CF15 F800        	RET
  228B                  REMOTE_PRO0_REV_DTMF_4:
  229B                  	
  230B CF16 F800        	RET
  231B                  REMOTE_PRO0_REV_DTMF_5:
  232B                  	
  233B CF17 F800        	RET
  234B                  REMOTE_PRO0_REV_DTMF_6:
  235B                  	
  236B CF18 F800        	RET
  237B                  REMOTE_PRO0_REV_DTMF_7:
  238B CF19 FC00CA4B    	CALL	INIT_DAM_FUNC
  239B                  	
  240B CF1B 6D11        	BIT	ANN_FG,13
  241B CF1C DA00CF25    	BS	TB,REMOTE_PRO0_REV_DTMF_7_FUL
  242B                  	
  243B CF1E 0F17        	LACK	0X17
  244B CF1F B03E        	SAH	PRO_VAR
  245B                  
  246B CF20 FC00D267    	CALL	LBEEP		;Lbee...
  247B CF22 FC00C189    	CALL	DAA_LIN_RECORD
  248B                  	
  249B CF24 F800        	RET
  250B                  REMOTE_PRO0_REV_DTMF_7_FUL:	;mfull 直接退出
  251B CF25 87800081    	LACL	CMSG_INIT
  252B CF27 FC00CC19    	CALL	STOR_MSG
  253B                  
  254B CF29 0F00        	LACK	0
  255B CF2A B03E        	SAH	PRO_VAR
  256B                  
  257B CF2B F800        	RET
  258B                  REMOTE_PRO0_REV_DTMF_8:
  259B CF2C FC00CA4B    	CALL	INIT_DAM_FUNC
  260B                  	
  261B CF2E 0F18        	LACK	0X18
  262B CF2F B03E        	SAH	PRO_VAR
  263B                  
  264B CF30 FC00D267    	CALL	LBEEP		;Lbee...
  265B                  	
  266B CF32 FC00C189    	CALL	DAA_LIN_RECORD
  267B                  	
  268B CF34 F800        	RET
  269B                  
  270B                  REMOTE_PRO0_REV_DTMF_9:
  271B CF35 FC00CA4B    	CALL	INIT_DAM_FUNC
  272B CF37 FC00D25E    	CALL	BEEP
  273B                  	
  274B CF39 F800        	RET
  275B                  REMOTE_PRO0_REV_DTMF_A:
  276B CF3A FC00CA4B    	CALL	INIT_DAM_FUNC
  277B CF3C 87800005    	LACL	0X005
  278B CF3E FC00CC52    	CALL	STOR_VP
  279B                  	
  280B CF40 FC00C189    	CALL	DAA_LIN_RECORD
  281B                  	
  282B CF42 F800        	RET
  283B                  REMOTE_PRO0_REV_DTMF_B:		;退出准备
  284B CF43 FC00CA4B    	CALL	INIT_DAM_FUNC
  285B                  	
  286B CF45 0F0A        	LACK	10
  287B CF46 B03E        	SAH	PRO_VAR
  288B                  
  289B CF47 87800005    	LACL	0X005
  290B CF49 FC00CC52    	CALL	STOR_VP
  291B                  	
  292B CF4B FC00C189    	CALL	DAA_LIN_RECORD
  293B                  	
  294B CF4D F800        	RET
  295B                  REMOTE_PRO0_TONE:
  296B CF4E DF00CF43    	BS	B1,REMOTE_PRO0_REV_DTMF_B
  297B                  REMOTE_PRO0_TMR:
  298B CF50 0E3F        	LAC	PRO_VAR1
  299B CF51 0101        	ADHK	1
  300B CF52 B03F        	SAH	PRO_VAR1
  301B CF53 050A        	SBHK	10
  302B CF54 D500CF43    	BZ	SGN,REMOTE_PRO0_REV_DTMF_B
  303B                  	
  304B CF56 F800        	RET	
  305B                  ;=======================================================================
  306B                  ;11111111111111111111111111111111111111111111111111111111111111111111111
  307B                  REMOTE_PRO1:				;播放新message
  308B CF57 0E3E        	LAC	PRO_VAR
  309B CF58 9E04        	SFR	4	
  310B CF59 D300CFE2    	BZ	ACZ,REMOTE_PRO1_PAUSE
  311B                  	
  312B CF5B 0E3D        	LAC	MSG
  313B CF5C 868000B0    	XORL	CVP_STOP		;PLAY END
  314B CF5E DB00CF6B    	BS	ACZ,REMOTE_PRO1_PLAY_OVER
  315B                  REMOTE_PRO1_1:
  316B CF60 0E3D        	LAC	MSG
  317B CF61 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  318B CF63 DB00CF82    	BS	ACZ,REMOTE_PRO1_REV_DTMF
  319B                  REMOTE_PRO1_2:
  320B CF65 0E3D        	LAC	MSG
  321B CF66 86800084    	XORL	CMSG_BTONE		;CMSG_BTONE
  322B CF68 DB00D19E    	BS	ACZ,REMOTE_PRO10_END
  323B CF6A F800        	RET
  324B                  ;---------------处理消息
  325B                  REMOTE_PRO1_PLAY_OVER:
  326B                  
  327B CF6B 0E14        	LAC	MSG_ID
  328B CF6C 858000FF    	ANDL	0X0FF
  329B CF6E 0501        	SBHK	1
  330B CF6F DB00D087    	BS	ACZ,REMOTE_PRO1_REV_DTMF_POUND
  331B CF71 DD00D087    	BS	SGN,REMOTE_PRO1_REV_DTMF_POUND
  332B                  REMOTE_PRO1_PLAY_OVER1:
  333B                  
  334B CF73 0E14        	LAC	MSG_ID			;next message
  335B CF74 0501        	SBHK	1
  336B CF75 B014        	SAH	MSG_ID
  337B                  
  338B CF76 FC00D1D3    	CALL	REW_MANAGE	
  339B CF78 D300D087    	BZ	ACZ,REMOTE_PRO1_REV_DTMF_POUND	;没新的了
  340B                  
  341B CF7A FC00D25E    	CALL	BEEP
  342B                  
  343B                  .IF	TEXT_m58	
  344B                  	CALL	SEND_INIT
  345B                  .ENDIF
  346B                  	
  347B CF7C 0E14        	LAC	MSG_ID
  348B CF7D FC00DC27    	CALL	GET_VPLEN
  349B CF7F FC00DC58    	CALL	GET_VPMSG
  350B                  REMOTE_PRO1_PLAY_OVER_END:	
  351B CF81 F800        	RET	
  352B                  ;-------	
  353B                  REMOTE_PRO1_REV_DTMF:
  354B CF82 0E1D        	LAC	DTMF_VAL
  355B CF83 828000F0    	SBHL	0X0F0
  356B CF85 0503        	SBHK	3
  357B CF86 DB00CF98    	BS	ACZ,REMOTE_PRO1_REV_DTMF_3	;3
  358B CF88 0501        	SBHK	1
  359B CF89 DB00CFA6    	BS	ACZ,REMOTE_PRO1_REV_DTMF_4	;4
  360B CF8B 0501        	SBHK	1
  361B CF8C DB00CFBF    	BS	ACZ,REMOTE_PRO1_REV_DTMF_5	;5
  362B CF8E 0501        	SBHK	1
  363B CF8F DB00CFC9    	BS	ACZ,REMOTE_PRO1_REV_DTMF_6	;6
  364B CF91 0508        	SBHK	8
  365B CF92 DB00CFD2    	BS	ACZ,REMOTE_PRO1_REV_DTMF_STAR	;*
  366B CF94 0501        	SBHK	1
  367B CF95 DB00D087    	BS	ACZ,REMOTE_PRO1_REV_DTMF_POUND	;#
  368B CF97 F800        	RET
  369B                  REMOTE_PRO1_REV_DTMF_3:
  370B CF98 FC00CA4B    	CALL	INIT_DAM_FUNC
  371B                  	
  372B CF9A FC00DC6A    	CALL	DEL_VPMSG
  373B                  	
  374B CF9C 0E17        	LAC	FILE_ID
  375B CF9D FC00DC1E    	CALL	GET_USRDAT
  376B CF9F FC00DBEB    	CALL	GET_TELID
  377B CFA1 FC00D8E5    	CALL	TELNUM_DEL
  378B                  
  379B CFA3 FC00D25E    	CALL	BEEP
  380B                  	
  381B CFA5 F800        	RET
  382B                  REMOTE_PRO1_REV_DTMF_4:
  383B CFA6 FC00CA4B    	CALL	INIT_DAM_FUNC
  384B                  	
  385B CFA8 FC00DC7E    	CALL	SETOLD_VPMSG
  386B                  
  387B CFAA 0E14        	LAC	MSG_ID
  388B CFAB 003C        	ADH	FILE_LEN
  389B CFAC 858000FF    	ANDL	0X0FF
  390B CFAE 0416        	SBH	MSG_T
  391B CFAF D500CFB7    	BZ	SGN,REMOTE_PRO1_REV_DTMF_4_1
  392B                  
  393B CFB1 0E14        	LAC	MSG_ID
  394B CFB2 003C        	ADH	FILE_LEN
  395B CFB3 0101        	ADHK	1
  396B CFB4 B014        	SAH	MSG_ID	
  397B                  
  398B CFB5 FC00D1B2    	CALL	FFW_MANAGE
  399B                  REMOTE_PRO1_REV_DTMF_4_1:
  400B CFB7 FC00D25E    	CALL	BEEP
  401B                  
  402B                  .IF	TEXT_m58	
  403B                  	CALL	SEND_INIT
  404B                  .ENDIF
  405B CFB9 0E14        	LAC	MSG_ID
  406B CFBA FC00DC42    	CALL	GET_RVPLEN
  407B CFBC FC00DC58    	CALL	GET_VPMSG
  408B                  
  409B CFBE F800        	RET
  410B                  REMOTE_PRO1_REV_DTMF_5:
  411B CFBF FC00CA4B    	CALL	INIT_DAM_FUNC
  412B CFC1 FC00D25E    	CALL	BEEP
  413B                  
  414B                  .IF	TEXT_m58	
  415B                  	CALL	SEND_INIT
  416B                  .ENDIF
  417B                  	
  418B CFC3 0E14        	LAC	MSG_ID
  419B                  	;CALL	GET_VPLEN
  420B CFC4 FC00DC42    	CALL	GET_RVPLEN
  421B CFC6 FC00DC58    	CALL	GET_VPMSG
  422B                  	
  423B CFC8 F800        	RET
  424B                  REMOTE_PRO1_REV_DTMF_6:
  425B CFC9 FC00CA4B    	CALL	INIT_DAM_FUNC
  426B                  	
  427B CFCB FC00DC7E    	CALL	SETOLD_VPMSG
  428B                  		
  429B CFCD 878000B0    	LACL	CVP_STOP
  430B CFCF FC00CC19    	CALL	STOR_MSG
  431B                  	
  432B CFD1 F800        	RET
  433B                  REMOTE_PRO1_REV_DTMF_STAR:
  434B                  REMOTE_PRO2_REV_DTMF_STAR:
  435B CFD2 0E00        	LAC	CONF
  436B CFD3 84800100    	ORL	0X0100
  437B CFD5 B000        	SAH	CONF
  438B CFD6 FC000020    	CALL	DAM_BIOS
  439B                  	
  440B CFD8 0E3E        	LAC	PRO_VAR
  441B CFD9 0910        	ORK	0X10
  442B CFDA B03E        	SAH	PRO_VAR
  443B                  	
  444B CFDB 878003E8    	LACL	1000
  445B CFDD FC00C1D6    	CALL	SET_TIMER
  446B CFDF 0F00        	LACK	0
  447B CFE0 B03F        	SAH	PRO_VAR1
  448B                  	
  449B CFE1 F800        	RET
  450B                  
  451B                  REMOTE_PRO1_PAUSE:
  452B                  REMOTE_PRO2_PAUSE:
  453B CFE2 0E3D        	LAC	MSG
  454B CFE3 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  455B CFE5 DB00CFED    	BS	ACZ,REMOTE_PRO1_PAUSE_REV_DTMF
  456B                  REMOTE_PRO1_PAUSE_1:
  457B CFE7 0E3D        	LAC	MSG
  458B CFE8 86800090    	XORL	CMSG_TMR		;CMSG_TMR
  459B CFEA DB00D003    	BS	ACZ,REMOTE_PRO1_PAUSE_TIMER
  460B                  	
  461B CFEC F800        	RET
  462B                  REMOTE_PRO1_PAUSE_REV_DTMF:
  463B CFED 0E1D        	LAC	DTMF_VAL
  464B CFEE 828000F0    	SBHL	0X0F0
  465B CFF0 0503        	SBHK	3
  466B CFF1 DB00CF98    	BS	ACZ,REMOTE_PRO1_REV_DTMF_3	;3	
  467B CFF3 0501        	SBHK	1
  468B CFF4 DB00CFA6    	BS	ACZ,REMOTE_PRO1_REV_DTMF_4	;4
  469B CFF6 0501        	SBHK	1
  470B CFF7 DB00CFBF    	BS	ACZ,REMOTE_PRO1_REV_DTMF_5	;5
  471B CFF9 0501        	SBHK	1
  472B CFFA DB00CFC9    	BS	ACZ,REMOTE_PRO1_REV_DTMF_6	;6
  473B CFFC 0508        	SBHK	8
  474B CFFD DB00D012    	BS	ACZ,REMOTE_PRO1_PAUSE_REV_DTMF_STAR	;*
  475B CFFF 0501        	SBHK	1
  476B D000 DB00D087    	BS	ACZ,REMOTE_PRO1_REV_DTMF_POUND	;#
  477B                  	
  478B D002 F800        	RET
  479B                  REMOTE_PRO1_PAUSE_TIMER:
  480B D003 0E3F        	LAC	PRO_VAR1
  481B D004 0101        	ADHK	1
  482B D005 B03F        	SAH	PRO_VAR1
  483B D006 050A        	SBHK	10
  484B                  	;BZ	ACZ,REMOTE_PRO1_PAUSE_TIMER_1
  485B D007 DD00D011    	BS	SGN,REMOTE_PRO1_PAUSE_TIMER_1
  486B                  	
  487B D009 FC00CA4B    	CALL	INIT_DAM_FUNC
  488B D00B FC00DC7E    	CALL	SETOLD_VPMSG	
  489B                  
  490B D00D FC00D26C    	CALL	BBEEP
  491B                  
  492B D00F 0F00        	LACK	0
  493B D010 B03E        	SAH	PRO_VAR
  494B                  	
  495B                  REMOTE_PRO1_PAUSE_TIMER_1:		
  496B D011 F800        	RET
  497B                  REMOTE_PRO1_PAUSE_REV_DTMF_STAR:
  498B                  	
  499B D012 E800        	CRAM	CONF,8
  500B D013 FC000020    	CALL	DAM_BIOS
  501B                  	
  502B D015 0E3E        	LAC	PRO_VAR
  503B D016 8580FF0F    	ANDL	0XFF0F
  504B D018 B03E        	SAH	PRO_VAR
  505B                  	
  506B D019 F800        	RET
  507B                  ;=======================================================================
  508B                  ;22222222222222222222222222222222222222222222222222222222222222222222222
  509B                  REMOTE_PRO2:
  510B D01A 0E3E        	LAC	PRO_VAR
  511B D01B 9E04        	SFR	4	
  512B D01C D300CFE2    	BZ	ACZ,REMOTE_PRO2_PAUSE
  513B                  	
  514B D01E 0E3D        	LAC	MSG
  515B D01F 868000B0    	XORL	CVP_STOP		;PLAY END
  516B D021 DB00D02E    	BS	ACZ,REMOTE_PRO2_PLAY_OVER
  517B                  REMOTE_PRO2_1:
  518B D023 0E3D        	LAC	MSG
  519B D024 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  520B D026 DB00D041    	BS	ACZ,REMOTE_PRO2_REV_DTMF
  521B                  REMOTE_PRO2_2:
  522B D028 0E3D        	LAC	MSG
  523B D029 86800084    	XORL	CMSG_BTONE		;CMSG_BTONE
  524B D02B DB00D19E    	BS	ACZ,REMOTE_PRO10_END
  525B D02D F800        	RET
  526B                  ;-------
  527B                  REMOTE_PRO2_PLAY_OVER:
  528B                  	
  529B D02E 0E14        	LAC	MSG_ID
  530B D02F 858000FF    	ANDL	0X0FF
  531B D031 0501        	SBHK	1
  532B D032 DB00D087    	BS	ACZ,REMOTE_PRO2_REV_DTMF_POUND
  533B D034 DD00D087    	BS	SGN,REMOTE_PRO2_REV_DTMF_POUND
  534B                  REMOTE_PRO2_PLAY_OVER1:
  535B                  	
  536B D036 0E14        	LAC	MSG_ID			;next message
  537B D037 0501        	SBHK	1
  538B D038 B014        	SAH	MSG_ID
  539B                  
  540B D039 FC00D25E    	CALL	BEEP
  541B                  	
  542B                  .IF	TEXT_m58	
  543B                  	CALL	SEND_INIT
  544B                  .ENDIF
  545B D03B 0E14        	LAC	MSG_ID
  546B D03C FC00DC27    	CALL	GET_VPLEN
  547B D03E FC00DC58    	CALL	GET_VPMSG
  548B                  REMOTE_PRO2_PLAY_OVER_END:	
  549B D040 F800        	RET
  550B                  REMOTE_PRO2_REV_DTMF:
  551B D041 0E1D        	LAC	DTMF_VAL
  552B D042 828000F0    	SBHL	0X0F0
  553B D044 0503        	SBHK	3
  554B D045 DB00D057    	BS	ACZ,REMOTE_PRO2_REV_DTMF_3	;3
  555B D047 0501        	SBHK	1
  556B D048 DB00D065    	BS	ACZ,REMOTE_PRO2_REV_DTMF_4	;4
  557B D04A 0501        	SBHK	1
  558B D04B DB00D07C    	BS	ACZ,REMOTE_PRO2_REV_DTMF_5	;5
  559B D04D 0501        	SBHK	1
  560B D04E DB00D07E    	BS	ACZ,REMOTE_PRO2_REV_DTMF_6	;6
  561B D050 0508        	SBHK	8
  562B D051 DB00CFD2    	BS	ACZ,REMOTE_PRO2_REV_DTMF_STAR	;*
  563B D053 0501        	SBHK	1
  564B D054 DB00D087    	BS	ACZ,REMOTE_PRO2_REV_DTMF_POUND	;#
  565B D056 F800        	RET
  566B                  REMOTE_PRO2_REV_DTMF_3:
  567B D057 FC00CA4B    	CALL	INIT_DAM_FUNC
  568B                  	
  569B D059 FC00DC6A    	CALL	DEL_VPMSG
  570B                  	
  571B D05B 0E17        	LAC	FILE_ID
  572B D05C FC00DC1E    	CALL	GET_USRDAT
  573B D05E FC00DBEB    	CALL	GET_TELID
  574B D060 FC00D8E5    	CALL	TELNUM_DEL
  575B                  
  576B D062 FC00D25E    	CALL	BEEP
  577B                  	
  578B D064 F800        	RET
  579B                  REMOTE_PRO2_REV_DTMF_4:
  580B D065 FC00CA4B    	CALL	INIT_DAM_FUNC
  581B                  	
  582B D067 FC00DC7E    	CALL	SETOLD_VPMSG
  583B                  
  584B D069 0E14        	LAC	MSG_ID
  585B D06A 003C        	ADH	FILE_LEN
  586B D06B 858000FF    	ANDL	0X0FF
  587B D06D 0416        	SBH	MSG_T
  588B D06E D500D074    	BZ	SGN,REMOTE_PRO2_PLAY_NEXT_1 ;第一个吗?
  589B                  	
  590B D070 0E14        	LAC	MSG_ID
  591B D071 003C        	ADH	FILE_LEN
  592B D072 0101        	ADHK	1
  593B D073 B014        	SAH	MSG_ID	
  594B                  	
  595B                  REMOTE_PRO2_PLAY_NEXT_1:
  596B                  
  597B D074 FC00D25E    	CALL	BEEP
  598B                  
  599B                  .IF	TEXT_m58	
  600B                  	CALL	SEND_INIT
  601B                  .ENDIF
  602B D076 0E14        	LAC	MSG_ID
  603B D077 FC00DC42    	CALL	GET_RVPLEN
  604B D079 FC00DC58    	CALL	GET_VPMSG
  605B                  
  606B D07B F800        	RET
  607B                  REMOTE_PRO2_REV_DTMF_5:
  608B D07C DF00CFBF    	BS	B1,REMOTE_PRO1_REV_DTMF_5
  609B                  	;RET
  610B                  REMOTE_PRO2_REV_DTMF_6:
  611B D07E FC00CA4B    	CALL	INIT_DAM_FUNC
  612B                  	
  613B D080 FC00DC7E    	CALL	SETOLD_VPMSG
  614B                  		
  615B D082 878000B0    	LACL	CVP_STOP
  616B D084 FC00CC19    	CALL	STOR_MSG
  617B                  	
  618B D086 F800        	RET
  619B                  
  620B                  REMOTE_PRO1_REV_DTMF_POUND:
  621B                  REMOTE_PRO2_REV_DTMF_POUND:
  622B D087 FC00CA4B    	CALL	INIT_DAM_FUNC
  623B                  	
  624B D089 FC00DC7E    	CALL	SETOLD_VPMSG
  625B                  	
  626B D08B 87806100    	LACL	0X6100
  627B D08D B000        	SAH	CONF
  628B D08E FC000020    	CALL	DAM_BIOS
  629B                  
  630B D090 FC00D26C    	CALL	BBEEP		;BB
  631B                  
  632B D092 0F00        	LACK	0
  633B D093 B03E        	SAH	PRO_VAR
  634B                  	
  635B D094 F800        	RET
  636B                  ;=======================================================================
  637B                  ;33333333333333333333333333333333333333333333333333333333333333333333333
  638B                  REMOTE_PRO3:	
  639B D095 F800        	RET
  640B                  ;=======================================================================
  641B                  ;44444444444444444444444444444444444444444444444444444444444444444444444
  642B                  REMOTE_PRO4:
  643B D096 F800        	RET
  644B                  ;=======================================================================
  645B                  ;55555555555555555555555555555555555555555555555555555555555555555555555
  646B                  REMOTE_PRO5:
  647B D097 F800        	RET
  648B                  ;=======================================================================
  649B                  ;66666666666666666666666666666666666666666666666666666666666666666666666
  650B                  REMOTE_PRO6:
  651B D098 F800        	RET
  652B                  ;=======================================================================
  653B                  ;77777777777777777777777777777777777777777777777777777777777777777777777
  654B                  REMOTE_PRO7:
  655B D099 0E3E        	LAC	PRO_VAR
  656B D09A 9E04        	SFR	4
  657B D09B DB00D0A4    	BS	ACZ,REMOTE_PRO7_RECORD
  658B D09D 0501        	SBHK	1
  659B D09E DB00D0E0    	BS	ACZ,REMOTE_PRO7_1	;play voice prompt
  660B D0A0 0501        	SBHK	1
  661B D0A1 DB00D10B    	BS	ACZ,REMOTE_PRO7_2	;play OGM
  662B                  	
  663B D0A3 F800        	RET
  664B                  ;-------
  665B                  REMOTE_PRO7_RECORD:
  666B D0A4 0E3D        	LAC	MSG
  667B D0A5 86800090    	XORL	CMSG_TMR		;TIMER
  668B D0A7 DB00D0BE    	BS	ACZ,REMOTE_PRO7_RECORD_TIMER
  669B                  REMOTE_PRO7_RECORD_1:
  670B D0A9 0E3D        	LAC	MSG
  671B D0AA 86800085    	XORL	CREV_DTMF		;DTMF
  672B D0AC DB00D0C7    	BS	ACZ,REMOTE_PRO7_RECORD_DTMF
  673B                  REMOTE_PRO7_RECORD_2:	
  674B D0AE 0E3D        	LAC	MSG
  675B D0AF 86800084    	XORL	CMSG_BTONE
  676B D0B1 DB00CF4E    	BS	ACZ,REMOTE_PRO0_TONE
  677B                  REMOTE_PRO7_RECORD_3:	
  678B D0B3 0E3D        	LAC	MSG
  679B D0B4 86800083    	XORL	CMSG_CTONE
  680B D0B6 DB00CF4E    	BS	ACZ,REMOTE_PRO0_TONE
  681B                  REMOTE_PRO7_RECORD_4:	
  682B                  	;LAC	MSG
  683B                  	;XORL	CMSG_TMR
  684B                  	;BS	ACZ,REMOTE_PRO0_TMR
  685B                  ;REMOTE_PRO7_RECORD_5:
  686B D0B8 0E3D        	LAC	MSG
  687B D0B9 868000B2    	XORL	CREC_FULL		;REC_FULL
  688B D0BB DB00D0CC    	BS	ACZ,REMOTE_PRO7_RECORD_DTMF_1
  689B                  
  690B D0BD F800        	RET
  691B                  REMOTE_PRO7_RECORD_TIMER:
  692B D0BE 0E3F        	LAC	PRO_VAR1
  693B D0BF 0101        	ADHK	1
  694B D0C0 B03F        	SAH	PRO_VAR1
  695B                  	
  696B D0C1 0578        	SBHK	120
  697B D0C2 DD00D0C6    	BS	SGN,REMOTE_PRO7_RECORD_TIMER_END
  698B                  	
  699B D0C4 DF00D0CC    	BS	B1,REMOTE_PRO7_RECORD_DTMF_1
  700B                  	
  701B                  REMOTE_PRO7_RECORD_TIMER_END:	
  702B D0C6 F800        	RET
  703B                  ;-------	
  704B                  REMOTE_PRO7_RECORD_DTMF:
  705B D0C7 0E1D        	LAC	DTMF_VAL
  706B D0C8 828000FF    	SBHL	0X0FF
  707B D0CA D300D0DF    	BZ	ACZ,REMOTE_PRO7_RECORD_DTMF_END	;pressed "#"?
  708B                  
  709B                  REMOTE_PRO7_RECORD_DTMF_1:		;处理"#","mfull"
  710B D0CC FC00CA4B    	CALL	INIT_DAM_FUNC
  711B                  	
  712B D0CE FC00C189    	CALL	DAA_LIN_RECORD
  713B                  
  714B D0D0 FC00D228    	CALL	OGM_STATUS
  715B                  	
  716B D0D2 0E14        	LAC	MSG_ID
  717B D0D3 858000FF    	ANDL	0X0FF
  718B D0D5 8480FE00    	ORL	0XFE00
  719B D0D7 FC00CC52    	CALL	STOR_VP
  720B                  		
  721B D0D9 0E3E        	LAC	PRO_VAR
  722B D0DA 8580FF0F    	ANDL	0XFF0F
  723B D0DC 84800020    	ORL	0X020
  724B D0DE B03E        	SAH	PRO_VAR
  725B                  REMOTE_PRO7_RECORD_DTMF_END:
  726B D0DF F800        	RET
  727B                  ;-------
  728B                  REMOTE_PRO7_1:	
  729B D0E0 0E3D        	LAC	MSG
  730B D0E1 868000B0    	XORL	CVP_STOP		;PLAY END
  731B D0E3 DB00D0E6    	BS	ACZ,REMOTE_PRO7_PLAY_OVER
  732B                  	
  733B D0E5 F800        	RET
  734B                  REMOTE_PRO7_PLAY_OVER:	
  735B D0E6 0E3E        	LAC	PRO_VAR
  736B D0E7 8580FF0F    	ANDL	0XFF0F
  737B D0E9 B03E        	SAH	PRO_VAR
  738B                  	
  739B D0EA FC00D228    	CALL	OGM_STATUS
  740B                  ;-------delete the old OGM----------------	
  741B D0EC 0E14        	LAC	MSG_ID
  742B D0ED 84802080    	ORL	0X2080
  743B D0EF B000        	SAH	CONF
  744B D0F0 FC000020    	CALL	DAM_BIOS
  745B                  	
  746B D0F2 0E00        	LAC	CONF
  747B D0F3 8580007F    	ANDL	0X007F
  748B D0F5 84806100    	ORL	0X6100
  749B D0F7 B000        	SAH	CONF
  750B D0F8 FC000020    	CALL	DAM_BIOS
  751B                  	
  752B D0FA 0E15        	LAC	MSG_N
  753B D0FB 84807500        	ORL	0X7500
  754B D0FD B000            	SAH	CONF
  755B D0FE FC000020        	CALL	DAM_BIOS
  756B                  
  757B D100 FC00C197    	CALL	DAA_ICM_RECORD
  758B                  	
  759B D102 0F00        	LACK	0
  760B D103 B03F        	SAH	PRO_VAR1
  761B D104 878003E8    	LACL	1000
  762B D106 FC00C1D6    	CALL	SET_TIMER
  763B                  	
  764B D108 FC00CA8A    	CALL	REC_START
  765B                  	
  766B D10A F800        	RET
  767B                  REMOTE_PRO7_2:
  768B D10B 0E3D        	LAC	MSG
  769B D10C 868000B0    	XORL	CVP_STOP		;CVP_STOP
  770B D10E DB00D116    	BS	ACZ,REMOTE_PRO7_VPSTOP
  771B                  REMOTE_PRO7_2_1:
  772B D110 0E3D        	LAC	MSG
  773B D111 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  774B D113 DB00D11E    	BS	ACZ,REMOTE_PRO7_2_REV_DTMF
  775B                  	
  776B D115 F800        	RET
  777B                  REMOTE_PRO7_VPSTOP:
  778B D116 FC00CA4B    	CALL	INIT_DAM_FUNC
  779B D118 0F00        	LACK	0
  780B D119 B03E        	SAH	PRO_VAR
  781B D11A B03F        	SAH	PRO_VAR1
  782B                  	
  783B D11B FC00D26C    	CALL	BBEEP
  784B                  	
  785B D11D F800        	RET
  786B                  REMOTE_PRO7_2_REV_DTMF:
  787B D11E 0E1D        	LAC	DTMF_VAL
  788B D11F 828000F0    	SBHL	0X0F0
  789B D121 0503        	SBHK	3
  790B D122 DB00D128    	BS	ACZ,REMOTE_PRO7_2_REV_DTMF_3	;3
  791B D124 050C        	SBHK	12
  792B D125 DB00D116    	BS	ACZ,REMOTE_PRO7_VPSTOP	;#
  793B                  	
  794B D127 F800        	RET
  795B                  REMOTE_PRO7_2_REV_DTMF_3:
  796B D128 FC00CA4B    	CALL	INIT_DAM_FUNC
  797B                  	
  798B D12A FC00D228    	CALL	OGM_STATUS
  799B                  ;-------delete the OGM----------------	
  800B D12C 0E14        	LAC	MSG_ID
  801B D12D 84802080    	ORL	0X2080
  802B D12F B000        	SAH	CONF
  803B D130 FC000020    	CALL	DAM_BIOS
  804B                  	
  805B D132 0E00        	LAC	CONF
  806B D133 8580007F    	ANDL	0X007F
  807B D135 84806100    	ORL	0X6100
  808B D137 B000        	SAH	CONF
  809B D138 FC000020    	CALL	DAM_BIOS
  810B                  
  811B D13A FC00D26C    	CALL	BBEEP		;BB
  812B                  	
  813B D13C 0F00        	LACK	0
  814B D13D B03E        	SAH	PRO_VAR
  815B                  	
  816B D13E F800        	RET
  817B                  
  818B                  ;=======================================================================
  819B                  ;88888888888888888888888888888888888888888888888888888888888888888888888
  820B                  REMOTE_PRO8:
  821B D13F 0E3E        	LAC	PRO_VAR
  822B D140 9E04        	SFR	4
  823B D141 0501        	SBHK	1
  824B D142 DB00D179    	BS	ACZ,REMOTE_PRO8_VOPLAY
  825B                  	
  826B D144 FC00CBE7    	CALL	BCVOX_INIT
  827B                  ;---------------------------------------
  828B                  	
  829B D146 0E3D        	LAC	MSG
  830B D147 86800085    	XORL	CREV_DTMF		;CREV_DTMF
  831B D149 DB00D151    	BS	ACZ,REMOTE_PRO8_REV_DTMF
  832B                  REMOTE_PRO8_1:
  833B D14B 0E3D        	LAC	MSG
  834B D14C 86800090    	XORL	CMSG_TMR		;TIMER
  835B D14E DB00D16E    	BS	ACZ,REMOTE_PRO8_TIMER
  836B                  REMOTE_PRO8_2:	;---不让产生VOX,BTONE,CTONE消息
  837B                  	
  838B                  	
  839B                  	
  840B D150 F800        	RET
  841B                  ;---------------处理消息
  842B                  REMOTE_PRO8_REV_DTMF:
  843B D151 0E1D        	LAC	DTMF_VAL
  844B D152 828000F0    	SBHL	0X0F0
  845B D154 050E        	SBHK	14
  846B D155 DB00D15B    	BS	ACZ,REMOTE_PRO8_REV_DTMF_STAR	;*
  847B D157 0501        	SBHK	1
  848B D158 DB00D160    	BS	ACZ,REMOTE_PRO8_REV_DTMF_POUND	;#	
  849B                  	
  850B D15A F800        	RET
  851B                  REMOTE_PRO8_REV_DTMF_STAR:
  852B D15B 0F00        	LACK	0
  853B D15C B03F        	SAH	PRO_VAR1
  854B D15D FC00CBE7    	CALL	BCVOX_INIT
  855B                  	
  856B D15F F800        	RET
  857B                  REMOTE_PRO8_REV_DTMF_POUND:
  858B D160 FC00CA4B    	CALL	INIT_DAM_FUNC
  859B D162 FC00CBE7    	CALL	BCVOX_INIT
  860B                  	
  861B D164 0F00        	LACK	0
  862B D165 B03E        	SAH	PRO_VAR
  863B D166 B03F        	SAH	PRO_VAR1
  864B                  	
  865B D167 87800081    	LACL	CMSG_INIT
  866B D169 FC00CC19    	CALL	STOR_MSG
  867B                  	
  868B D16B FC00CAE9    	CALL	IDMONIT_OFF
  869B                  	
  870B D16D F800        	RET
  871B                  REMOTE_PRO8_TIMER:
  872B D16E 0E3F        	LAC	PRO_VAR1	;计时
  873B D16F 0101        	ADHK	1
  874B D170 B03F        	SAH	PRO_VAR1
  875B D171 051E        	SBHK	30
  876B D172 DD00D178    	BS	SGN,REMOTE_PRO8_TIMER_END	;30s计时
  877B D174 DB00D160    	BS	ACZ,REMOTE_PRO8_REV_DTMF_POUND
  878B D176 DF00D160    	BS	B1,REMOTE_PRO8_REV_DTMF_POUND
  879B                  REMOTE_PRO8_TIMER_END:
  880B                  		
  881B D178 F800        	RET
  882B                  ;-------
  883B                  REMOTE_PRO8_VOPLAY:
  884B D179 0E3D        	LAC	MSG
  885B D17A 868000B0    	XORL	CVP_STOP			;CVP_STOP
  886B D17C DB00D17F    	BS	ACZ,REMOTE_PRO8_VOPLAY_END
  887B                  	
  888B D17E F800        	RET	
  889B                  REMOTE_PRO8_VOPLAY_END:
  890B D17F FC00CA4B    	CALL	INIT_DAM_FUNC
  891B                  	
  892B D181 0E3E        	LAC	PRO_VAR
  893B D182 8580FF0F    	ANDL	0XFF0F
  894B D184 B03E        	SAH	PRO_VAR
  895B                  	
  896B D185 878003E8    	LACL	1000
  897B D187 FC00C1D6    	CALL	SET_TIMER
  898B D189 0F00        	LACK	0
  899B D18A B03F        	SAH	PRO_VAR1
  900B D18B FC00C1B1    	CALL	DAA_ROM_MOR
  901B D18D E490        	SRAM	EVENT,4
  902B                  	
  903B D18E FC00CAE6    	CALL	IDMONIT_ON
  904B                  	
  905B D190 F800        	RET	
  906B                  ;=======================================================================
  907B                  ;99999999999999999999999999999999999999999999999999999999999999999999999
  908B                  REMOTE_PRO9:	
  909B D191 0F00        	LACK	0
  910B D192 B03E        	SAH	PRO_VAR
  911B                  	
  912B D193 87800081    	LACL	CMSG_INIT
  913B D195 FC00CC19    	CALL	STOR_MSG
  914B D197 F800        	RET
  915B                  ;=======================================================================
  916B                  ;#######################################################################
  917B                  REMOTE_PRO10:
  918B D198 0E3D        	LAC	MSG
  919B D199 868000B0    	XORL	CVP_STOP
  920B D19B DB00D19E    	BS	ACZ,REMOTE_PRO10_END
  921B                  	
  922B D19D F800        	RET
  923B                  REMOTE_PRO10_END:
  924B D19E FC00CA4B    	CALL	INIT_DAM_FUNC	
  925B D1A0 FC00CC38    	CALL	CLR_FUNC	;先空	
  926B D1A2 0F00        	LACK	0
  927B D1A3 B03E        	SAH	PRO_VAR
  928B                  	
  929B D1A4 0E19        	LAC	RING_ID
  930B D1A5 9E0C        	SFR	12
  931B D1A6 B019        	SAH	RING_ID		;;;
  932B                  
  933B D1A7 87800018    	LACL	0X0018
  934B D1A9 FC00CC52    	CALL	STOR_VP		;延时192ms
  935B                  		
  936B D1AB FC00C1C4    	CALL	DAA_OFF	
  937B D1AD FC00C1CD    	CALL	HOOK_OFF
  938B D1AF FC00CAE9    	CALL	IDMONIT_OFF
  939B                  		
  940B D1B1 F800        	RET
  941B                  
  942B                  .END
 1188A                  .INCLUDE drive.asm
    1B                  ;------------------------------------------------------------
    2B                  ;	manage message when a FFW_key pressed during playing
    3B                  ;	NEW1,NEW2,NEW3,NEW4,NEW5,NEW6,NEW7(new message exist)
    4B                  ;	to check which message you should play
    5B                  ;	input : MSG_ID(mapping the message you play just)
    6B                  ;		MSG_T(MSG_N)---the number of total message
    7B                  ;	output: ACCH=0---MSG_ID(mapping the message you will play next)
    8B                  ;		ACCH=1---fail
    9B                  ;------------------------------------------------------------
   10B                  FFW_MANAGE:
   11B D1B2 0E14        	LAC	MSG_ID
   12B D1B3 B015        	SAH	MSG_N
   13B                  		
   14B                  FFW_MANAGE1:		
   15B D1B4 FC00D2DA    	CALL	GET_FLAG
   16B D1B6 D300D1BA    	BZ	ACZ,FFW_MANAGE2
   17B D1B8 0F00        	LACK	0
   18B D1B9 F800        	RET
   19B                  FFW_MANAGE2:
   20B D1BA 0E14        	LAC	MSG_ID
   21B D1BB 0101        	ADHK	1
   22B D1BC B014        	SAH	MSG_ID
   23B D1BD 858000FF    	ANDL	0X0FF
   24B D1BF 0416        	SBH	MSG_T
   25B D1C0 DB00D1B2    	BS	ACZ,FFW_MANAGE
   26B D1C2 DD00D1B2    	BS	SGN,FFW_MANAGE
   27B                  FFW_MANAGE3:
   28B D1C4 0E15        	LAC	MSG_N
   29B D1C5 858000FF    	ANDL	0X0FF
   30B D1C7 0416        	SBH	MSG_T
   31B D1C8 DB00D1CF    	BS	ACZ,FFW_MANAGE4
   32B                  	
   33B D1CA 0E15        	LAC	MSG_N
   34B D1CB 0501        	SBHK	1
   35B D1CC B014        	SAH	MSG_ID
   36B D1CD DF00D1D1    	BS	B1,FFW_MANAGE5
   37B                  FFW_MANAGE4:		
   38B D1CF 0E15        	LAC	MSG_N
   39B D1D0 B014        	SAH	MSG_ID
   40B                  FFW_MANAGE5:		
   41B D1D1 0F01        	LACK	1
   42B D1D2 F800        	RET
   43B                  	
   44B                  ;------------------------------------------------------------
   45B                  ;	manage message when a REW_key pressed during playing
   46B                  ;	NEW1,NEW2,NEW3,NEW4,NEW5,NEW6,NEW7(new message exist)
   47B                  ;	to check which message you should play
   48B                  ;	input : MSG_ID(mapping the message you play just)
   49B                  ;
   50B                  ;	output: ACCH=0---MSG_ID(mapping the message you will play next)
   51B                  ;		ACCH=1---fail
   52B                  ;------------------------------------------------------------
   53B                  REW_MANAGE:
   54B                  	
   55B D1D3 0E14        	LAC	MSG_ID
   56B D1D4 B015        	SAH	MSG_N
   57B                  REW_MANAGE1:
   58B D1D5 FC00D2DA    	CALL	GET_FLAG
   59B D1D7 DB00D1F2    	BS	ACZ,REW_MANAGE4
   60B                  
   61B D1D9 0E14        	LAC	MSG_ID
   62B D1DA 0501        	SBHK	1
   63B D1DB B014        	SAH	MSG_ID
   64B D1DC 858000FF    	ANDL	0X0FF
   65B D1DE D300D1D5    	BZ	ACZ,REW_MANAGE1
   66B                  ;-------
   67B D1E0 0E15        	LAC	MSG_N
   68B D1E1 858000FF    	ANDL	0X0FF
   69B D1E3 0501        	SBHK	1
   70B D1E4 D300D1EC    	BZ	ACZ,REW_MANAGE2
   71B D1E6 0E15        	LAC	MSG_N
   72B D1E7 8580FF00    	ANDL	0XFF00
   73B D1E9 0901        	ORK	1
   74B D1EA DF00D1EE    	BS	B1,REW_MANAGE3
   75B                  REW_MANAGE2:
   76B D1EC 0E15        	LAC	MSG_N
   77B D1ED 0101        	ADHK	1
   78B                  REW_MANAGE3:
   79B D1EE B014        	SAH	MSG_ID	
   80B D1EF 0F01        	LACK	1
   81B D1F0 DF00D1F3    	BS	B1,REW_MANAGE_END
   82B                  REW_MANAGE4:
   83B D1F2 0F00        	LACK	0
   84B                  REW_MANAGE_END:
   85B                  	
   86B D1F3 F800        	RET
   87B                  ;//------------------------------------------------------------------------
   88B                  ;	FUNCTION : SELECT_VP
   89B                  ;	IF ANN_FG.3=0,LANGUAGE(7..4) = LANGUAGE(3..0)*2+1,ELSE
   90B                  ;		LANGUAGE(7..4) = LANGUAGE(3..0)*2+1 
   91B                  ;	INPUT : ANN_FG,3
   92B                  ;//------------------------------------------------------------------------	
   93B                  SELECT_VP:
   94B D1F4 0E1C        	LAC	LANGUAGE
   95B D1F5 0B07        	ANDK	0X07
   96B D1F6 B01C        	SAH	LANGUAGE
   97B                  	
   98B D1F7 0E1C        	LAC	LANGUAGE	;"LANGUAGE(7..4) = LANGUAGE(3..0)*2+1" FOR OGM1
   99B D1F8 9C05        	SFL	5
  100B D1F9 0110        	ADHK	0X010
  101B D1FA 081C        	OR	LANGUAGE
  102B D1FB B01C        	SAH	LANGUAGE
  103B                  
  104B                  	;BIT	EVENT,8
  105B                  	;BZ	TB,SELECT_VP_RET
  106B D1FC 6311        	BIT	ANN_FG,3
  107B D1FD D200D202    	BZ	TB,SELECT_VP_RET
  108B                  	
  109B D1FF 0E1C        	LAC	LANGUAGE	;"LANGUAGE(7..4) = LANGUAGE(3..0)*2+2" FOR OGM2
  110B D200 0110        	ADHK	0X010
  111B D201 B01C        	SAH	LANGUAGE
  112B                  
  113B                  SELECT_VP_RET:	
  114B D202 F800        	RET
  115B                  ;//------------------------------------------------------------------------
  116B                  ;	FUNCTION : SELECT DEFAULT OGM
  117B                  ;	IF ACCH =3,LANGUAGE(7..4) = LANGUAGE(3..0)*2+1,ELSE
  118B                  ;		LANGUAGE(7..4) = LANGUAGE(3..0)*2+2 
  119B                  ;	INPUT : ACCH
  120B                  ;//------------------------------------------------------------------------	
  121B                  SELECT_OGM:
  122B D203 B015        	SAH	MSG_N
  123B                  	
  124B D204 0E1C        	LAC	LANGUAGE
  125B D205 0B07        	ANDK	0X07
  126B D206 B01C        	SAH	LANGUAGE
  127B                  	
  128B D207 0E1C        	LAC	LANGUAGE	;"LANGUAGE(7..4) = LANGUAGE(3..0)*2+1" FOR OGM1
  129B D208 9C05        	SFL	5
  130B D209 0110        	ADHK	0X010
  131B D20A 081C        	OR	LANGUAGE
  132B D20B B01C        	SAH	LANGUAGE
  133B                  
  134B D20C 0E15        	LAC	MSG_N
  135B D20D 0503        	SBHK	3
  136B D20E DB00D213    	BS	ACZ,SELECT_OGM_RET
  137B                  	
  138B D210 0E1C        	LAC	LANGUAGE	;"LANGUAGE(7..4) = LANGUAGE(3..0)*2+2" FOR OGM2
  139B D211 0110        	ADHK	0X010
  140B D212 B01C        	SAH	LANGUAGE
  141B                  
  142B                  SELECT_OGM_RET:	
  143B D213 F800        	RET
  144B                  ;//------------------------------------------------------------------------
  145B                  ;	FUNCTION : SET_OGMFG
  146B                  ;	IF 
  147B                  ;	INPUT : ACCH
  148B                  ;//------------------------------------------------------------------------	
  149B                  SET_OGMFG:
  150B D214 E391        	SRAM	ANN_FG,3
  151B D215 0F04        	LACK	4
  152B D216 B015        	SAH	MSG_N
  153B                  	
  154B D217 6910        	BIT	EVENT,9
  155B D218 DA00D223    	BS	TB,SET_OGMFG_1		;ANSWER OFF
  156B D21A 6810        	BIT	EVENT,8
  157B D21B DA00D223    	BS	TB,SET_OGMFG_1		;ANSWER ONLY
  158B D21D 6D11        	BIT	ANN_FG,13
  159B D21E DA00D223    	BS	TB,SET_OGMFG_1		;MFULL
  160B                  	
  161B D220 E311        	CRAM	ANN_FG,3
  162B D221 0F03        	LACK	3
  163B D222 B015        	SAH	MSG_N
  164B                  SET_OGMFG_1:
  165B                  	
  166B D223 F800        	RET
  167B                  ;//------------------------------------------------------------------------
  168B                  ;	OGM_CHK
  169B                  ;	check weather the current OGMx exist?
  170B                  ;	input : EVENT.8		= 0/1---answer ICM/answer only
  171B                  ;	output: 
  172B                  ;		ANN_FG(bit2) 	= 0---not exist
  173B                  ;				  1---exist
  174B                  ;		MSG_ID		= index NO.in current MBOX in current MSG type(OGM)
  175B                  ;		MSG_N = 3/4	= the current OGM index(USR INDEX DATA0)
  176B                  ;//------------------------------------------------------------------------
  177B                  OGM_CHK:
  178B D224 B015        	SAH	MSG_N		;answer normal/only
  179B D225 FC00D22F    	CALL	OGM_STATUS1
  180B                  	
  181B D227 F800        	RET
  182B                  ;//------------------------------------------------------------------------
  183B                  ;	OGM_STATUS
  184B                  ;	check weather the current OGMx exist?
  185B                  ;	input : EVENT.8		= 0/1---answer ICM/answer only
  186B                  ;	output: 
  187B                  ;		ANN_FG(bit2) 	= 0---not exist
  188B                  ;				  1---exist
  189B                  ;		MSG_ID		= index NO.in current MBOX in current MSG type(OGM)
  190B                  ;		MSG_N = 3/4	= the current OGM index(USR INDEX DATA0)
  191B                  ;//------------------------------------------------------------------------
  192B                  OGM_STATUS:
  193B D228 0F03        	LACK	3
  194B D229 B015        	SAH	MSG_N		;answer normal
  195B                  
  196B D22A 6810        	BIT	EVENT,8
  197B D22B D200D22F    	BZ	TB,OGM_STATUS1
  198B                  	
  199B D22D 0F04        	LACK	4
  200B D22E B015        	SAH	MSG_N		;answer only
  201B                  OGM_STATUS1:
  202B                  	
  203B D22F E211        	CRAM	ANN_FG,2
  204B                  	
  205B D230 8780D000    	LACL	0XD000
  206B D232 B000        	SAH	CONF
  207B D233 FC000020    	CALL	DAM_BIOS
  208B D235 8780D202    	LACL	0XD202
  209B D237 B000        	SAH	CONF
  210B D238 FC000020    	CALL	DAM_BIOS
  211B                  	
  212B D23A 87803000    	LACL	0X3000
  213B D23C B000        	SAH	CONF
  214B D23D FC000020    	CALL	DAM_BIOS
  215B D23F 0E01        	LAC	RESP
  216B D240 DB00D25C    	BS	ACZ,OGM_STATUS4
  217B D242 0101        	ADHK	1
  218B D243 B016        	SAH	MSG_T
  219B                  	
  220B D244 0F01        	LACK	1
  221B D245 B014        	SAH	MSG_ID
  222B                  OGM_STATUS2:	
  223B D246 0E14        	LAC	MSG_ID
  224B D247 0416        	SBH	MSG_T
  225B D248 D500D25C    	BZ	SGN,OGM_STATUS4
  226B                  
  227B D24A 0E14        	LAC	MSG_ID
  228B D24B 8480A900    	ORL	0XA900            	;//check if OGMx exists(GET USER INDEX DATA0)?
  229B D24D B000                SAH     CONF
  230B D24E FC000020            CALL    DAM_BIOS
  231B                          
  232B D250 0E01                LAC     RESP			;//LOAD USER ID(MSG_N)
  233B D251 0415                SBH	MSG_N
  234B D252 DB00D259            BS      ACZ,OGM_STATUS3		;//OGMx exist?
  235B                          
  236B D254 0E14        	LAC	MSG_ID
  237B D255 0101        	ADHK	1
  238B D256 B014        	SAH	MSG_ID
  239B D257 DF00D246    	BS	B1,OGM_STATUS2
  240B                  OGM_STATUS3:
  241B                  	
  242B D259 E291                SRAM	ANN_FG,2		;ANN_FG(bit2)=1
  243B                          
  244B D25A 0F00                LACK	0			;OGMx exist?
  245B D25B F800                RET
  246B                  OGM_STATUS4:
  247B D25C 0F01        	LACK	1			;no OGM
  248B D25D F800        	RET
  249B                  ;-------------------------------------------------------------------------------
  250B                  ;	Function : BEEP
  251B                  ;
  252B                  ;       Generate a "BEEP"	---提示用
  253B                  ;-------------------------------------------------------------------------------	
  254B                  BEEP:
  255B D25E 87800025    	LACL	0X025
  256B D260 FC00CC52    	CALL	STOR_VP
  257B D262 87803010    	LACL	0X3010
  258B D264 FC00CC52    	CALL	STOR_VP		;B
  259B                  	
  260B D266 F800        	RET
  261B                  ;------------------------------------------------------------------------------
  262B                  ;	Function : LBEEP
  263B                  ;
  264B                  ;	Generate a "LONG BEEP"---提示用
  265B                  ;------------------------------------------------------------------------------	
  266B                  LBEEP:
  267B D267 87803C50    	LACL	0X3C50
  268B D269 FC00CC52    	CALL	STOR_VP		;B___
  269B                  	
  270B D26B F800        	RET
  271B                  ;-------------------------------------------------------------------------------
  272B                  ;	Function : BBEEP
  273B                  ;
  274B                  ;	Generate two "BBEEP"	---结束用
  275B                  ;-------------------------------------------------------------------------------
  276B                  BBEEP:
  277B D26C 87803010    	LACL	0X3010
  278B D26E FC00CC52    	CALL	STOR_VP
  279B D270 87800005    	LACL	0X005
  280B D272 FC00CC52    	CALL	STOR_VP
  281B D274 87803010    	LACL	0X3010
  282B D276 FC00CC52    	CALL	STOR_VP		;BB
  283B                  	
  284B D278 F800        	RET
  285B                  ;-------------------------------------------------------------------------------
  286B                  ;       Function : BBBEEP
  287B                  ;
  288B                  ;      Generate three "BBBEEP"	---警报用
  289B                  ;-------------------------------------------------------------------------------
  290B                  BBBEEP:
  291B D279 87803C09    	LACL	0X3C09
  292B D27B FC00CC52    	CALL	STOR_VP
  293B D27D 87800005    	LACL	0X005
  294B D27F FC00CC52    	CALL	STOR_VP
  295B D281 87803C09    	LACL	0X3C09
  296B D283 FC00CC52    	CALL	STOR_VP
  297B D285 87800005    	LACL	0X005
  298B D287 FC00CC52    	CALL	STOR_VP
  299B D289 87803C09    	LACL	0X3C09
  300B D28B FC00CC52    	CALL	STOR_VP		;BBB
  301B                  	
  302B D28D F800        	RET
  303B                  ;;;;;;;;
  304B                  .IF	TEXT_VOP
  305B                  
  306B                  ;//----------------------------------------------------------------------------
  307B                  ;//       Function : MSG_WEEK
  308B                  ;//
  309B                  ;//       Generate a warning beep
  310B                  ;//----------------------------------------------------------------------------
  311B                  MSG_WEEK:
  312B                  	LAC	MSG_ID
  313B                  	ANDL	0X0FF
  314B                  	ORL	0XA300
  315B                  	SAH	CONF
  316B                  	CALL	DAM_BIOS
  317B                  	LAC	RESP
  318B                  	ADHK	28
  319B                  	ORL	0XFF00
  320B                  	CALL	STOR_VP
  321B                  	
  322B                  	RET
  323B                  ;//----------------------------------------------------------------------------
  324B                  ;//       Function : MSG_HOUR
  325B                  ;//
  326B                  ;//       Generate a warning beep
  327B                  ;//----------------------------------------------------------------------------
  328B                  MSG_HOUR:
  329B                  	LAC	MSG_ID
  330B                  	ANDL	0X0FF
  331B                  	ORL	0XA200
  332B                  	SAH	CONF
  333B                  	CALL	DAM_BIOS
  334B                  	LAC	RESP
  335B                  	CALL	ANNOUNCE_NUM
  336B                  	
  337B                  	RET
  338B                  ;//----------------------------------------------------------------------------
  339B                  ;//       Function : MSG_MIN
  340B                  ;//
  341B                  ;//       Generate a warning beep
  342B                  ;//----------------------------------------------------------------------------
  343B                  MSG_MIN:
  344B                  	LAC	MSG_ID
  345B                  	ANDL	0X0FF
  346B                  	ORL	0XA100
  347B                  	SAH	CONF
  348B                  	CALL	DAM_BIOS
  349B                  	LAC	RESP
  350B                  	CALL	ANNOUNCE_NUM
  351B                  	
  352B                  	RET
  353B                  
  354B                  ;-------------------------------------------------------------------------
  355B                  ;	Function : ANNOUNCE_NUM --- 数字入播放队列
  356B                  ;	input : ACCH = 要播放的数字(1..99)
  357B                  ;
  358B                  ;-------------------------------------------------------------------------
  359B                  ANNOUNCE_NUM:
  360B                  
  361B                  	SAH	SYSTMP3
  362B                  	SBHK	21
  363B                  	BS	SGN,ANNOUNCE_NUM1
  364B                  	;CALL	HEX_DGT
  365B                  	
  366B                  	LAC	SYSTMP3
  367B                  	SFR	4
  368B                  	ADHK	18
  369B                  	ORL	0XFF00
  370B                  	CALL	STOR_VP
  371B                  	
  372B                  	LAC	SYSTMP3
  373B                  	ANDL	0X0F
  374B                  	BS	ACZ,ANNOUNCE_NUM_END
  375B                  	ORL	0XFF00
  376B                  	CALL	STOR_VP
  377B                  	BS	B1,ANNOUNCE_NUM_END
  378B                  ANNOUNCE_NUM1:
  379B                  	LAC	SYSTMP3
  380B                  	ORL	0XFF00
  381B                  	CALL	STOR_VP
  382B                  ANNOUNCE_NUM_END:
  383B                  	
  384B                  	RET
  385B                  .ENDIF
  386B                  ;//----------------------------------------------------------------------------
  387B                  ;//       Function : HEX_DGT
  388B                  ;//
  389B                  ;//       Transform a binary value to a BCD value
  390B                  
  391B                  ;//       Input  : ACCH = the binary value
  392B                  ;//       Output : ACCH = the BCD value
  393B                  ;//	  Variable : SYSTMP4,SYSTMP5
  394B                  ;//----------------------------------------------------------------------------
  395B                  HEX_DGT:
  396B D28E 858000FF    	ANDL	0XFF
  397B D290 B062        	SAH	SYSTMP4
  398B                  	
  399B D291 0F00        	LACK	0
  400B D292 B063        	SAH	SYSTMP5
  401B                  HEX_DGT_LOOP:
  402B D293 0E62        	LAC	SYSTMP4
  403B D294 050A        	SBHK	10
  404B D295 DD00D29D    	BS	SGN,HEX_DGT_END
  405B D297 B062        	SAH	SYSTMP4
  406B                  	
  407B D298 0E63        	LAC	SYSTMP5
  408B D299 0101        	ADHK	1
  409B D29A B063        	SAH	SYSTMP5
  410B D29B DF00D293    	BS	B1,HEX_DGT_LOOP
  411B                  HEX_DGT_END:
  412B D29D 0E63        	LAC	SYSTMP5
  413B D29E 9C04        	SFL	4
  414B D29F 858000F0    	ANDL	0X0F0
  415B D2A1 0862        	OR	SYSTMP4
  416B                  	
  417B D2A2 F800                RET
  418B                  
  419B                  ;//----------------------------------------------------------------------------
  420B                  ;//       Function : DGT_HEX
  421B                  ;//
  422B                  ;//       Transform a BCD value to binary value
  423B                  ;//       Input  : ACCH = the BCD value
  424B                  ;//       Output : ACCH = the binary value
  425B                  ;//	  Variable : SYSTMP4,SYSTMP5
  426B                  ;//----------------------------------------------------------------------------
  427B                  DGT_HEX:
  428B D2A3 B062        	SAH	SYSTMP4		;LOW(3..0)
  429B D2A4 9E04        	SFR	4
  430B D2A5 0B0F        	ANDK	0XF
  431B D2A6 B063        	SAH	SYSTMP5		;HIGH(7..4)
  432B                  
  433B D2A7 0E62        	LAC	SYSTMP4
  434B D2A8 0B0F        	ANDK	0X0F
  435B D2A9 B062        	SAH	SYSTMP4
  436B                  DGT_HEX_LOOP:
  437B D2AA 0E63        	LAC	SYSTMP5
  438B D2AB DB00D2B5    	BS	ACZ,DGT_HEX_END
  439B                  	
  440B D2AD 0E62        	LAC	SYSTMP4
  441B D2AE 010A        	ADHK	10
  442B D2AF B062        	SAH	SYSTMP4
  443B                  	
  444B D2B0 0E63        	LAC	SYSTMP5
  445B D2B1 0501        	SBHK	1
  446B D2B2 B063        	SAH	SYSTMP5
  447B D2B3 DF00D2AA    	BS	B1,DGT_HEX_LOOP
  448B                  DGT_HEX_END:
  449B D2B5 0E62        	LAC	SYSTMP4
  450B                  	
  451B D2B6 F800                RET
  452B                  ;------------------------------------------------------------------------------
  453B                  ;	Function : clear all new flag of messages
  454B                  ;------------------------------------------------------------------------------
  455B                  CLR_FLAG:
  456B D2B7 0F7F        	LACK	0X07F
  457B D2B8 B038        	SAH	NEW_ID
  458B                  	
  459B D2B9 0F00        	LACK	0
  460B D2BA B031        	SAH	NEW1
  461B D2BB B032        	SAH	NEW2
  462B D2BC B033        	SAH	NEW3
  463B D2BD B034        	SAH	NEW4
  464B D2BE B035        	SAH	NEW5
  465B D2BF B036        	SAH	NEW6
  466B D2C0 B037        	SAH	NEW7
  467B                  	
  468B D2C1 F800        	RET
  469B                  ;------------------------------------------------------------------------------
  470B                  ;	Function : set new flag of message
  471B                  ;	根据MSG_ID设置相应的NEW标志
  472B                  ;	INPUT : ACCH = MSG_ID
  473B                  ;	OUTPUT: NO
  474B                  ;------------------------------------------------------------------------------
  475B                  SET_FLAG:
  476B D2C2 0B7F        	ANDK	0X07F
  477B D2C3 B064        	SAH	SYSTMP		;STOR MSG_ID
  478B D2C4 B038        	SAH	NEW_ID
  479B D2C5 0F01        	LACK	1
  480B D2C6 B030        	SAH	NEW0
  481B                  	
  482B D2C7 0E64        	LAC	SYSTMP
  483B D2C8 0501        	SBHK	1
  484B D2C9 0B0F        	ANDK	0X0F
  485B D2CA B05F        	SAH	SYSTMP1		;save the bits you will move(col)
  486B D2CB 4A5F        	OUT	SYSTMP1,SHFCR	
  487B D2CC 0E30        	LAC	NEW0
  488B D2CD 9C00        	SFL	0
  489B D2CE B030        	SAH	NEW0
  490B                  
  491B D2CF 0E64        	LAC	SYSTMP
  492B D2D0 0501        	SBHK	1
  493B D2D1 9E04        	SFR	4
  494B D2D2 0131        	ADHK	NEW1
  495B D2D3 B05F        	SAH	SYSTMP1		;the address you will load(row)
  496B                  	
  497B D2D4 F689        	MAR	+0,1
  498B D2D5 725F        	LAR	SYSTMP1,1
  499B D2D6 0E30        	LAC	NEW0
  500B D2D7 0889        	OR	+0,1
  501B D2D8 B089        	SAH	+0,1
  502B                  SET_FLAG_END:		
  503B D2D9 F800        	RET
  504B                  
  505B                  ;------------------------------------------------------------------------------
  506B                  ;	Function : get new flag of message
  507B                  ;	根据MSG_ID取得相应的NEW标志,并将标志取反作为返回值
  508B                  ;	INPUT : ACCH = MSG_ID(1..99)
  509B                  ;	OUTPUT: ACCH=0/1 ===>new message/not new
  510B                  ;------------------------------------------------------------------------------
  511B                  GET_FLAG:
  512B D2DA 8580007F    	ANDL	0X07F
  513B D2DC B064        	SAH	SYSTMP		;STOR MSG_ID
  514B D2DD FC00D2F5    	CALL	MANAGE
  515B                  	
  516B D2DF 0E64        	LAC	SYSTMP
  517B D2E0 0501        	SBHK	1
  518B D2E1 9E04        	SFR	4
  519B D2E2 0131        	ADHK	NEW1
  520B D2E3 B05F        	SAH	SYSTMP1		;the address you will load(ROW)
  521B                  	
  522B D2E4 F689        	MAR	+0,1
  523B D2E5 725F        	LAR	SYSTMP1,1
  524B D2E6 0E89        	LAC	+0,1
  525B D2E7 B030        	SAH	NEW0		;stor the flag
  526B                  	
  527B D2E8 0E64        	LAC	SYSTMP
  528B D2E9 0501        	SBHK	1
  529B D2EA 0B0F        	ANDK	0X0F
  530B D2EB B05F        	SAH	SYSTMP1
  531B D2EC 4A5F        	OUT	SYSTMP1,SHFCR	;save the bits you will mov(COL)
  532B                  	
  533B D2ED 0E30        	LAC	NEW0
  534B D2EE 9E00        	SFR	0
  535B D2EF 85800001    	ANDL	0X01
  536B D2F1 B030        	SAH	NEW0		;直接将所得NEW0标志取反作返回值(ACCH)
  537B D2F2 86800001    	XORL	0X01
  538B                  GET_FLAG_END:
  539B D2F4 F800        	RET
  540B                  ;------------------------------------------------------------------------------
  541B                  ;	Function : set new flag of message
  542B                  ;	根据MSG_ID查找和设转置相应的NEW标志
  543B                  ;	INPUT : ACCH = MSG_ID
  544B                  ;	OUTPUT: NO
  545B                  ;------------------------------------------------------------------------------
  546B                  MANAGE:
  547B D2F5 8580007F    	ANDL	0X07F
  548B D2F7 B064        	SAH	SYSTMP		;STOR MSG_ID
  549B                  	
  550B D2F8 0E38        	LAC	NEW_ID
  551B D2F9 0464        	SBH	SYSTMP		;查NEW标志设置过吗(减数与被减数的关系与播放顺序有关,此时是反序)?
  552B D2FA DD00D308    	BS	SGN,CHK_NEWFLAG_END
  553B                  	
  554B D2FC 0E64        	LAC	SYSTMP
  555B D2FD 8480A800    	ORL	0XA800
  556B D2FF B000        	SAH	CONF
  557B D300 FC000020    	CALL	DAM_BIOS
  558B D302 0E01        	LAC	RESP
  559B D303 D300D308    	BZ	ACZ,CHK_NEWFLAG_END
  560B                  	
  561B D305 0E64        	LAC	SYSTMP
  562B D306 FC00D2C2    	CALL	SET_FLAG
  563B                  CHK_NEWFLAG_END:
  564B                  		
  565B D308 F800        	RET
  566B                  ;------------------------------------------------------------------------------
  567B                  ;	Function : SET_FGTABLE
  568B                  ;	set new flag of message
  569B                  ;	设置相应的标志图表NEW1..NEW7
  570B                  ;	INPUT : MSG_T
  571B                  ;	OUTPUT: NO
  572B                  ;------------------------------------------------------------------------------
  573B                  SET_FGTABLE:
  574B D309 FC00D2B7    	CALL	CLR_FLAG
  575B                  	
  576B D30B 0E16        	LAC	MSG_T
  577B D30C B014        	SAH	MSG_ID
  578B                  SET_FGTABLE_LOOP:
  579B D30D 0E14        	LAC	MSG_ID
  580B D30E DB00D319    	BS	ACZ,SET_FGTABLE_END
  581B D310 FC00DC1E    	CALL	GET_USRDAT
  582B D312 FC00D2C2    	CALL	SET_FLAG
  583B                  		
  584B D314 0E14        	LAC	MSG_ID
  585B D315 0501        	SBHK	1
  586B D316 B014        	SAH	MSG_ID
  587B D317 DF00D30D    	BS	B1,SET_FGTABLE_LOOP
  588B                  SET_FGTABLE_END:		
  589B D319 F800        	RET
  590B                  ;------------------------------------------------------------------------------
  591B                  ;	Function : get new flag of message
  592B                  ;	根据MSG_ID取得相应的USE_DAT是否用过(0/1表示没用/用过)
  593B                  ;	INPUT : ACCH = MSG_ID(1..99)
  594B                  ;	OUTPUT: ACCH=0/1 ===>not used/been used
  595B                  ;------------------------------------------------------------------------------
  596B                  GET_DATFLAG:
  597B D31A 8580007F    	ANDL	0X07F
  598B D31C B064        	SAH	SYSTMP		;STOR MSG_ID
  599B                  
  600B D31D 0E64        	LAC	SYSTMP
  601B D31E 0501        	SBHK	1
  602B D31F 9E04        	SFR	4
  603B D320 0131        	ADHK	NEW1
  604B D321 B05F        	SAH	SYSTMP1		;the address you will load(ROW)
  605B                  	
  606B D322 F689        	MAR	+0,1
  607B D323 725F        	LAR	SYSTMP1,1
  608B D324 0E89        	LAC	+0,1
  609B D325 B030        	SAH	NEW0		;stor the flag
  610B                  	
  611B D326 0E64        	LAC	SYSTMP
  612B D327 0501        	SBHK	1
  613B D328 0B0F        	ANDK	0X0F
  614B D329 B05F        	SAH	SYSTMP1
  615B D32A 4A5F        	OUT	SYSTMP1,SHFCR	;save the bits you will mov(COL)
  616B                  	
  617B D32B 0E30        	LAC	NEW0
  618B D32C 9E00        	SFR	0
  619B D32D 85800001    	ANDL	0X01
  620B                  	;SAH	NEW0		;直接将所得NEW0标志取反作返回值(ACCH)
  621B                  	;XORL	0X01
  622B                  GET_DATFLAG_END:
  623B D32F F800        	RET
  624B                  ;-------------------------------------------------------------------------------
  625B                  ;	Function : SERACH_USEID
  626B                  ;	根据标志位图()查可用的USE_DAT
  627B                  ;-------------------------------------------------------------------------------
  628B                  SERACH_USEID:
  629B D330 0F00        	LACK	0
  630B D331 B05F        	SAH	SYSTMP1		;循环计数
  631B                  	
  632B D332 F689        	MAR	+0,1
  633B D333 7331        	LARK	NEW1,1
  634B                  SERACH_USEID_LOOP1:	
  635B D334 0E5F        	LAC	SYSTMP1
  636B D335 0101        	ADHK	1
  637B D336 B05F        	SAH	SYSTMP1		;最多7次(7*16=112)
  638B                  
  639B D337 0EC9        	LAC	+,1
  640B D338 B05E        	SAH	SYSTMP0		;stor flag
  641B D339 8680FFFF    	XORL	0XFFFF
  642B D33B DB00D334    	BS	ACZ,SERACH_USEID_LOOP1
  643B                  
  644B D33D 0E5F        	LAC	SYSTMP1
  645B D33E 0501        	SBHK	1
  646B D33F 9C04        	SFL	4
  647B D340 B05E        	SAH	SYSTMP0		;查找位图标志的开始序号(前面为全0XFFFF表示已用过)
  648B                  SERACH_USEID_LOOP2:
  649B D341 0E5E        	LAC	SYSTMP0
  650B D342 0101        	ADHK	1
  651B D343 B05E        	SAH	SYSTMP0
  652B                  	
  653B D344 FC00D31A    	CALL	GET_DATFLAG
  654B D346 D300D341    	BZ	ACZ,SERACH_USEID_LOOP2	
  655B                  	
  656B D348 0E5E        	LAC	SYSTMP0
  657B                  SERACH_USEID_END:
  658B D349 F800        	RET
  659B                  ;-------------------------------------------------------------------------------
  660B                  ;-------------------------------------------------------------------------------
  661B                  ;-------------------------------------------------------------------------------
  662B                  .END
 1189A                  .INCLUDE sed_ree.asm
    1B                  
    2B                  .LIST
    3B                  
    4B                  ;-------BELOWS ARE FOR SIO BETWEEN DSP AND 78806---------------------
    5B                  ;BIOR:	bit4=SDI=dat(DSP<==>CPU,DSP R/T from this port)
    6B                  ;	bit5=SDO=wr(CPU==>DSP,DSP receive command from this port,contral by CPU)
    7B                  ;	bit6=TRX=clk(CPU==>DSP,DSP receive clock from this port,contral by CPU)
    8B                  ;-------(记录各种状态标志)---------
    9B                  ;TRS_FG:	bit0..3记录已传送/接收的位的个数(clk脉冲个数)
   10B                  ;		bit4 = 0/1---CLK = HIGH/LOW
   11B                  ;		bit5 = 1---下降沿触发,外部中断标志
   12B                  ;		bit6 = 
   13B                  ;		bit7 = 1---命令(可能是多字节命令)接收正在执行,接收标志
   14B                  ;		bit8 =
   15B                  ;		bit9 = 1---字节发送状态.(一个字节从bit7到bit0在此状态)
   16B                  ;		bit10= 1---DSP有数据要求发送出去(从有发送意向到最后一个字节发送完毕)
   17B                  ;		BIT11= 1---收发有效
   18B                  ;		bit12= 1---
   19B                  ;		bit13= 1---
   20B                  ;TMR_TR:记录上次位传送到现在的时间间隔;当传完一字节后,记录的是上次字节到现在的时间
   21B                  ;-------
   22B                  ;SIO_CNT:	bit0..7记录已传送/接收的位的个数
   23B                  
   24B                  ;		bit8..11记录已接收字节个数(接收状态)---或已发送的字节个数(发送状态)
   25B                  
   26B                  END_BYTE	.EQU   		10	;last bit to return idel(FOR DAT)
   27B                  REQ_SEND	.EQU   		24	;24==>3ms
   28B                  
   29B                  BYTE_BYTE	.EQU   		24	;last bit to next byte(3ms-1ms)
   30B                  END_SEND	.EQU   		64	;end of receive(8ms)
   31B                  
   32B                  ;-------------------------------------------------------
   33B                  ;	Function : RECEIVE
   34B                  ;	receive data from BIOR.4
   35B                  ;	receive from STARTBIT to bit7 to bit0 end in ENDBIT
   36B                  ;-------------------------------------------------------
   37B                  RECEIVE:
   38B D34A 6765        	BIT	TRS_FG,7
   39B D34B D200D4A9    	BZ	TB,RECEIVE_END2
   40B                  
   41B D34D 0E69        	LAC	RECE_BUF
   42B D34E 9C01        	SFL	1
   43B D34F B069        	SAH	RECE_BUF
   44B                  	
   45B D350 1300        	LIPK	0
   46B D351 FC00D696    	CALL	DAT_IDEL
   47B D353 FFFF        	NOP
   48B D354 A266        	IN	C_RSIO1,BIOR
   49B D355 0E66        	LAC	C_RSIO1
   50B D356 85800010    	ANDL	0X010
   51B D358 9E04        	SFR	4
   52B D359 0869        	OR	RECE_BUF	;receive data from BIOR.4 and store it in RECE_BUF.0
   53B D35A B069        	SAH	RECE_BUF
   54B                  
   55B D35B 0E65        	LAC	TRS_FG	;;;;;;;;;;;;;
   56B D35C 0B0F        	ANDK	0X0F
   57B D35D 0508        	SBHK	8
   58B D35E D300D4A7    	BZ	ACZ,RECEIVE_END1
   59B                  	
   60B D360 0E67        	LAC	SIO_CNT
   61B D361 80800100    	ADHL	0X0100
   62B D363 8580FFF0    	ANDL	0XFFF0
   63B D365 B067        	SAH	SIO_CNT		;received byte increase one(count11..8)
   64B                  	
   65B D366 0E65        	LAC	TRS_FG
   66B D367 8580FFF0    	ANDL	0XFFF0
   67B D369 B065        	SAH	TRS_FG	;;;;;;;;;;;;;
   68B                  RECEIVE1:	
   69B                  ;-------保存已收到的一个字节(若接收缓冲空间不够用,可继续往后增加)--------
   70B D36A 0E67        	LAC	SIO_CNT
   71B D36B 9E08        	SFR	8
   72B D36C 0501        	SBHK	1
   73B D36D DB00D3BC    	BS	ACZ,RECEIVE5
   74B D36F 0501        	SBHK	1
   75B D370 DB00D3F7    	BS	ACZ,RECEIVE6
   76B D372 0501        	SBHK	1
   77B D373 DB00D3FF    	BS	ACZ,RECEIVE7
   78B D375 0501        	SBHK	1
   79B D376 DB00D405    	BS	ACZ,RECEIVE8
   80B D378 0501        	SBHK	1
   81B D379 DB00D40D    	BS	ACZ,RECEIVE9
   82B D37B 0501        	SBHK	1
   83B D37C DB00D413    	BS	ACZ,RECEIVE10
   84B D37E 0501        	SBHK	1
   85B D37F DB00D41B    	BS	ACZ,RECEIVE11
   86B D381 0501        	SBHK	1
   87B D382 DB00D421    	BS	ACZ,RECEIVE12
   88B D384 0501        	SBHK	1
   89B D385 DB00D429    	BS	ACZ,RECEIVE13
   90B D387 0501        	SBHK	1
   91B D388 DB00D42F    	BS	ACZ,RECEIVE14
   92B D38A 0501        	SBHK	1
   93B D38B DB00D437    	BS	ACZ,RECEIVE15
   94B D38D 0501        	SBHK	1
   95B D38E DB00D43D    	BS	ACZ,RECEIVE16
   96B D390 0501        	SBHK	1
   97B D391 DB00D445    	BS	ACZ,RECEIVE17
   98B D393 0501        	SBHK	1
   99B D394 DB00D44B    	BS	ACZ,RECEIVE18
  100B D396 0501        	SBHK	1
  101B D397 DB00D453    	BS	ACZ,RECEIVE19
  102B D399 0501        	SBHK	1
  103B D39A DB00D459    	BS	ACZ,RECEIVE20
  104B D39C 0501        	SBHK	1
  105B D39D DB00D461    	BS	ACZ,RECEIVE21
  106B D39F 0501        	SBHK	1
  107B D3A0 DB00D467    	BS	ACZ,RECEIVE22
  108B D3A2 0501        	SBHK	1
  109B D3A3 DB00D46F    	BS	ACZ,RECEIVE23
  110B D3A5 0501        	SBHK	1
  111B D3A6 DB00D475    	BS	ACZ,RECEIVE24
  112B D3A8 0501        	SBHK	1
  113B D3A9 DB00D47D    	BS	ACZ,RECEIVE25
  114B D3AB 0501        	SBHK	1
  115B D3AC DB00D483    	BS	ACZ,RECEIVE26
  116B D3AE 0501        	SBHK	1
  117B D3AF DB00D48B    	BS	ACZ,RECEIVE27
  118B D3B1 0501        	SBHK	1
  119B D3B2 DB00D491    	BS	ACZ,RECEIVE28
  120B D3B4 0501        	SBHK	1
  121B D3B5 DB00D499    	BS	ACZ,RECEIVE29
  122B D3B7 0501        	SBHK	1
  123B D3B8 DB00D49F    	BS	ACZ,RECEIVE30
  124B                  
  125B D3BA DF00D4A7    	BS	B1,RECEIVE_END1
  126B                  ;-------将收到的数据存入缓存
  127B                  RECEIVE5:	;1st byte
  128B D3BC 0E69        	LAC	RECE_BUF
  129B D3BD 858000FF    	ANDL	0X0FF
  130B D3BF 868000B2    	XORL	0XB2
  131B D3C1 DB00D3DE    	BS	ACZ,RECEIVE5_1_0
  132B                  RECEIVE5_0:	
  133B D3C3 0E69        	LAC	RECE_BUF
  134B D3C4 858000FF    	ANDL	0X0FF
  135B D3C6 86800096    	XORL	0X96
  136B D3C8 DB00D3E4    	BS	ACZ,RECEIVE5_1_1
  137B                  RECEIVE5_0_1:	
  138B D3CA 0E69        	LAC	RECE_BUF
  139B D3CB 858000FF    	ANDL	0X0FF
  140B D3CD 86800093    	XORL	0X93
  141B D3CF DB00D3EA    	BS	ACZ,RECEIVE5_1_2
  142B D3D1 0E69        	LAC	RECE_BUF
  143B D3D2 858000FF    	ANDL	0X0FF
  144B D3D4 86800094    	XORL	0X94
  145B D3D6 DB00D3EA    	BS	ACZ,RECEIVE5_1_2
  146B                  	
  147B                  RECEIVE5_RECE:	
  148B D3D8 0E69        	LAC	RECE_BUF
  149B D3D9 858000FF    	ANDL	0X0FF
  150B D3DB B06A        	SAH	RECE_BUF1
  151B D3DC DF00D4A7    	BS	B1,RECEIVE_END1
  152B                  RECEIVE5_1_0:
  153B D3DE 8780008A    	LACL	CSEG_PAUSE
  154B D3E0 FC00CC09    	CALL	INT_STOR_MSG
  155B D3E2 DF00D3EE    	BS	B1,RECEIVE5_END
  156B                  RECEIVE5_1_1:
  157B D3E4 87800006    	LACL	CMSG_KEY6S
  158B D3E6 FC00CC09    	CALL	INT_STOR_MSG
  159B D3E8 DF00D3EE    	BS	B1,RECEIVE5_END	
  160B                  RECEIVE5_1_2:
  161B D3EA A10B        	CIO	11,OPTR			;优先响应OGM播放
  162B D3EB E290        	SRAM	EVENT,2
  163B D3EC DF00D3D8    	BS	B1,RECEIVE5_RECE	
  164B                  RECEIVE5_END:	
  165B D3EE E765        	CRAM	TRS_FG,7
  166B                  
  167B D3EF 0F00        	LACK	0
  168B D3F0 B067        	SAH	SIO_CNT
  169B                  	
  170B D3F1 0E65        	LAC	TRS_FG
  171B D3F2 8580FFF0    	ANDL	0XFFF0
  172B D3F4 B065        	SAH	TRS_FG
  173B D3F5 DF00D4A7    	BS	B1,RECEIVE_END1
  174B                  
  175B                  RECEIVE6:	;2nd byte
  176B D3F7 0E69        	LAC	RECE_BUF
  177B D3F8 9C08        	SFL	8
  178B D3F9 8580FF00    	ANDL	0XFF00
  179B D3FB 086A        	OR	RECE_BUF1
  180B D3FC B06A        	SAH	RECE_BUF1
  181B D3FD DF00D4A7    	BS	B1,RECEIVE_END1
  182B                  ;---
  183B                  RECEIVE7:	;3rd byte
  184B D3FF 0E69        	LAC	RECE_BUF
  185B D400 858000FF    	ANDL	0X0FF
  186B D402 B06B        	SAH	RECE_BUF2
  187B D403 DF00D4A7    	BS	B1,RECEIVE_END1
  188B                  RECEIVE8:	;4th byte
  189B D405 0E69        	LAC	RECE_BUF
  190B D406 9C08        	SFL	8
  191B D407 8580FF00    	ANDL	0XFF00
  192B D409 086B        	OR	RECE_BUF2
  193B D40A B06B        	SAH	RECE_BUF2
  194B D40B DF00D4A7    	BS	B1,RECEIVE_END1
  195B                  ;---
  196B                  RECEIVE9:	;5th byte
  197B D40D 0E69        	LAC	RECE_BUF
  198B D40E 858000FF    	ANDL	0X0FF
  199B D410 B06C        	SAH	RECE_BUF3
  200B D411 DF00D4A7    	BS	B1,RECEIVE_END1
  201B                  RECEIVE10:	;6th byte
  202B D413 0E69        	LAC	RECE_BUF
  203B D414 9C08        	SFL	8
  204B D415 8580FF00    	ANDL	0XFF00
  205B D417 086C        	OR	RECE_BUF3
  206B D418 B06C        	SAH	RECE_BUF3
  207B D419 DF00D4A7    	BS	B1,RECEIVE_END1
  208B                  ;---
  209B                  RECEIVE11:	;7th byte
  210B D41B 0E69        	LAC	RECE_BUF
  211B D41C 858000FF    	ANDL	0X0FF
  212B D41E B06D        	SAH	RECE_BUF4
  213B D41F DF00D4A7    	BS	B1,RECEIVE_END1
  214B                  RECEIVE12:	;8th byte
  215B D421 0E69        	LAC	RECE_BUF
  216B D422 9C08        	SFL	8
  217B D423 8580FF00    	ANDL	0XFF00
  218B D425 086D        	OR	RECE_BUF4
  219B D426 B06D        	SAH	RECE_BUF4
  220B D427 DF00D4A7    	BS	B1,RECEIVE_END1
  221B                  ;---
  222B                  RECEIVE13:	;9th byte
  223B D429 0E69        	LAC	RECE_BUF
  224B D42A 858000FF    	ANDL	0X0FF
  225B D42C B06E        	SAH	RECE_BUF5
  226B D42D DF00D4A7    	BS	B1,RECEIVE_END1
  227B                  RECEIVE14:	;10th byte
  228B D42F 0E69        	LAC	RECE_BUF
  229B D430 9C08        	SFL	8
  230B D431 8580FF00    	ANDL	0XFF00
  231B D433 086E        	OR	RECE_BUF5
  232B D434 B06E        	SAH	RECE_BUF5
  233B D435 DF00D4A7    	BS	B1,RECEIVE_END1
  234B                  ;---
  235B                  RECEIVE15:	;11th byte
  236B D437 0E69        	LAC	RECE_BUF
  237B D438 858000FF    	ANDL	0X0FF
  238B D43A B06F        	SAH	RECE_BUF6
  239B D43B DF00D4A7    	BS	B1,RECEIVE_END1
  240B                  RECEIVE16:	;12th byte
  241B D43D 0E69        	LAC	RECE_BUF
  242B D43E 9C08        	SFL	8
  243B D43F 8580FF00    	ANDL	0XFF00
  244B D441 086F        	OR	RECE_BUF6
  245B D442 B06F        	SAH	RECE_BUF6
  246B D443 DF00D4A7    	BS	B1,RECEIVE_END1
  247B                  ;---
  248B                  RECEIVE17:	;13th byte
  249B D445 0E69        	LAC	RECE_BUF
  250B D446 858000FF    	ANDL	0X0FF
  251B D448 B070        	SAH	RECE_BUF7
  252B D449 DF00D4A7    	BS	B1,RECEIVE_END1
  253B                  RECEIVE18:	;14th byte
  254B D44B 0E69        	LAC	RECE_BUF
  255B D44C 9C08        	SFL	8
  256B D44D 8580FF00    	ANDL	0XFF00
  257B D44F 0870        	OR	RECE_BUF7
  258B D450 B070        	SAH	RECE_BUF7
  259B D451 DF00D4A7    	BS	B1,RECEIVE_END1
  260B                  ;---
  261B                  RECEIVE19:	;15th byte
  262B D453 0E69        	LAC	RECE_BUF
  263B D454 858000FF    	ANDL	0X0FF
  264B D456 B071        	SAH	RECE_BUF8
  265B D457 DF00D4A7    	BS	B1,RECEIVE_END1
  266B                  RECEIVE20:	;16th byte
  267B D459 0E69        	LAC	RECE_BUF
  268B D45A 9C08        	SFL	8
  269B D45B 8580FF00    	ANDL	0XFF00
  270B D45D 0871        	OR	RECE_BUF8
  271B D45E B071        	SAH	RECE_BUF8
  272B D45F DF00D4A7    	BS	B1,RECEIVE_END1
  273B                  ;---
  274B                  RECEIVE21:	;17th byte
  275B D461 0E69        	LAC	RECE_BUF
  276B D462 858000FF    	ANDL	0X0FF
  277B D464 B072        	SAH	RECE_BUF9
  278B D465 DF00D4A7    	BS	B1,RECEIVE_END1
  279B                  RECEIVE22:	;18th byte
  280B D467 0E69        	LAC	RECE_BUF
  281B D468 9C08        	SFL	8
  282B D469 8580FF00    	ANDL	0XFF00
  283B D46B 0872        	OR	RECE_BUF9
  284B D46C B072        	SAH	RECE_BUF9
  285B D46D DF00D4A7    	BS	B1,RECEIVE_END1
  286B                  ;---
  287B                  RECEIVE23:	;19th byte
  288B D46F 0E69        	LAC	RECE_BUF
  289B D470 858000FF    	ANDL	0X0FF
  290B D472 B073        	SAH	RECE_BUF10
  291B D473 DF00D4A7    	BS	B1,RECEIVE_END1
  292B                  RECEIVE24:	;20th byte
  293B D475 0E69        	LAC	RECE_BUF
  294B D476 9C08        	SFL	8
  295B D477 8580FF00    	ANDL	0XFF00
  296B D479 0873        	OR	RECE_BUF10
  297B D47A B073        	SAH	RECE_BUF10
  298B D47B DF00D4A7    	BS	B1,RECEIVE_END1
  299B                  ;---
  300B                  RECEIVE25:	;21th byte
  301B D47D 0E69        	LAC	RECE_BUF
  302B D47E 858000FF    	ANDL	0X0FF
  303B D480 B074        	SAH	RECE_BUF11
  304B D481 DF00D4A7    	BS	B1,RECEIVE_END1
  305B                  RECEIVE26:	;22th byte
  306B D483 0E69        	LAC	RECE_BUF
  307B D484 9C08        	SFL	8
  308B D485 8580FF00    	ANDL	0XFF00
  309B D487 0874        	OR	RECE_BUF11
  310B D488 B074        	SAH	RECE_BUF11
  311B D489 DF00D4A7    	BS	B1,RECEIVE_END1
  312B                  ;---
  313B                  RECEIVE27:	;23th byte
  314B D48B 0E69        	LAC	RECE_BUF
  315B D48C 858000FF    	ANDL	0X0FF
  316B D48E B075        	SAH	RECE_BUF12
  317B D48F DF00D4A7    	BS	B1,RECEIVE_END1
  318B                  RECEIVE28:	;24th byte
  319B D491 0E69        	LAC	RECE_BUF
  320B D492 9C08        	SFL	8
  321B D493 8580FF00    	ANDL	0XFF00
  322B D495 0875        	OR	RECE_BUF12
  323B D496 B075        	SAH	RECE_BUF12
  324B D497 DF00D4A7    	BS	B1,RECEIVE_END1
  325B                  ;---
  326B                  RECEIVE29:	;25th byte
  327B D499 0E69        	LAC	RECE_BUF
  328B D49A 858000FF    	ANDL	0X0FF
  329B D49C B076        	SAH	RECE_BUF13
  330B D49D DF00D4A7    	BS	B1,RECEIVE_END1
  331B                  RECEIVE30:	;26th byte
  332B D49F 0E69        	LAC	RECE_BUF
  333B D4A0 9C08        	SFL	8
  334B D4A1 8580FF00    	ANDL	0XFF00
  335B D4A3 0876        	OR	RECE_BUF13
  336B D4A4 B076        	SAH	RECE_BUF13
  337B D4A5 DF00D4A7    	BS	B1,RECEIVE_END1
  338B                  ;-------
  339B                  RECEIVE_END1:
  340B D4A7 0F00        	LACK	0
  341B D4A8 B068        	SAH	TMR_TR		;位接收计时复位
  342B                  
  343B                  RECEIVE_END2:	
  344B D4A9 F800        	RET
  345B                  ;-------------------------------------------------------
  346B                  ;	Function : TRANSMIT
  347B                  ;	send data from BIOR.4
  348B                  ;	send frombit7 to bit0
  349B                  ;-------------------------------------------------------
  350B                  TRANSMIT:
  351B D4AA 6965        	BIT	TRS_FG,9
  352B D4AB D200D5A9    	BZ	TB,TRANSMIT_END1	
  353B                  	
  354B D4AD FC00D67F    	CALL	SEND_BIT
  355B                  	
  356B D4AF 0E65        	LAC	TRS_FG
  357B D4B0 0B0F        	ANDK	0X0F
  358B D4B1 0508        	SBHK	8
  359B D4B2 D300D5A7    	BZ	ACZ,TRANSMIT_END
  360B                  	
  361B D4B4 0E65        	LAC	TRS_FG
  362B D4B5 8580FFF0    	ANDL	0XFFF0
  363B D4B7 B065        	SAH	TRS_FG	;;;;;;;;;;;;;
  364B                  	
  365B D4B8 0E67        	LAC	SIO_CNT
  366B D4B9 80800100    	ADHL	0X0100
  367B D4BB B067        	SAH	SIO_CNT
  368B D4BC 9E08        	SFR	8
  369B D4BD 0B7F        	ANDK	0X7F
  370B D4BE 0477        	SBH	RECE_QUEUE		;发送完了吗?
  371B D4BF D500D5A0    	BZ	SGN,TRANSMIT_TEND
  372B                  	
  373B D4C1 0E67        	LAC	SIO_CNT
  374B D4C2 9E08        	SFR	8
  375B D4C3 0501        	SBHK	1
  376B D4C4 DB00D50A    	BS	ACZ,TRANSMIT_1		;第一byte发送完毕
  377B D4C6 0501        	SBHK	1
  378B D4C7 DB00D511    	BS	ACZ,TRANSMIT_2		;第二byte发送完毕
  379B D4C9 0501        	SBHK	1
  380B D4CA DB00D517    	BS	ACZ,TRANSMIT_3
  381B D4CC 0501        	SBHK	1
  382B D4CD DB00D51E    	BS	ACZ,TRANSMIT_4
  383B D4CF 0501        	SBHK	1
  384B D4D0 DB00D524    	BS	ACZ,TRANSMIT_5
  385B D4D2 0501        	SBHK	1
  386B D4D3 DB00D52B    	BS	ACZ,TRANSMIT_6
  387B D4D5 0501        	SBHK	1
  388B D4D6 DB00D531    	BS	ACZ,TRANSMIT_7
  389B D4D8 0501        	SBHK	1
  390B D4D9 DB00D538    	BS	ACZ,TRANSMIT_8
  391B D4DB 0501        	SBHK	1
  392B D4DC DB00D53E    	BS	ACZ,TRANSMIT_9
  393B D4DE 0501        	SBHK	1
  394B D4DF DB00D545    	BS	ACZ,TRANSMIT_10
  395B D4E1 0501        	SBHK	1
  396B D4E2 DB00D54B    	BS	ACZ,TRANSMIT_11
  397B D4E4 0501        	SBHK	1
  398B D4E5 DB00D552    	BS	ACZ,TRANSMIT_12
  399B D4E7 0501        	SBHK	1
  400B D4E8 DB00D558    	BS	ACZ,TRANSMIT_13
  401B D4EA 0501        	SBHK	1
  402B D4EB DB00D55F    	BS	ACZ,TRANSMIT_14
  403B D4ED 0501        	SBHK	1
  404B D4EE DB00D565    	BS	ACZ,TRANSMIT_15
  405B D4F0 0501        	SBHK	1
  406B D4F1 DB00D56C    	BS	ACZ,TRANSMIT_16
  407B D4F3 0501        	SBHK	1
  408B D4F4 DB00D572    	BS	ACZ,TRANSMIT_17
  409B D4F6 0501        	SBHK	1
  410B D4F7 DB00D579    	BS	ACZ,TRANSMIT_18
  411B D4F9 0501        	SBHK	1
  412B D4FA DB00D57F    	BS	ACZ,TRANSMIT_19
  413B D4FC 0501        	SBHK	1
  414B D4FD DB00D586    	BS	ACZ,TRANSMIT_20
  415B D4FF 0501        	SBHK	1
  416B D500 DB00D58C    	BS	ACZ,TRANSMIT_21
  417B D502 0501        	SBHK	1
  418B D503 DB00D593    	BS	ACZ,TRANSMIT_22
  419B D505 0501        	SBHK	1
  420B D506 DB00D599    	BS	ACZ,TRANSMIT_23		;第23-byte发送完毕
  421B                  	
  422B D508 DF00D5A0    	BS	B1,TRANSMIT_TEND
  423B                  TRANSMIT_1:	;准备发送2nd byte
  424B D50A 0E6A        	LAC	RECE_BUF1
  425B D50B 9E08        	SFR	8
  426B D50C 858000FF    	ANDL	0X0FF
  427B D50E B069        	SAH	RECE_BUF
  428B D50F DF00D5A7    	BS	B1,TRANSMIT_END
  429B                  ;---
  430B                  TRANSMIT_2:	;准备发送3rd
  431B D511 0E6B        	LAC	RECE_BUF2
  432B D512 858000FF    	ANDL	0X0FF
  433B D514 B069        	SAH	RECE_BUF
  434B D515 DF00D5A7    	BS	B1,TRANSMIT_END
  435B                  TRANSMIT_3:	;4th
  436B D517 0E6B        	LAC	RECE_BUF2
  437B D518 9E08        	SFR	8
  438B D519 858000FF    	ANDL	0X0FF
  439B D51B B069        	SAH	RECE_BUF
  440B D51C DF00D5A7    	BS	B1,TRANSMIT_END
  441B                  ;---
  442B                  TRANSMIT_4:	;5th
  443B D51E 0E6C        	LAC	RECE_BUF3
  444B D51F 858000FF    	ANDL	0X0FF
  445B D521 B069        	SAH	RECE_BUF
  446B D522 DF00D5A7    	BS	B1,TRANSMIT_END
  447B                  TRANSMIT_5:	;6th
  448B D524 0E6C        	LAC	RECE_BUF3
  449B D525 9E08        	SFR	8
  450B D526 858000FF    	ANDL	0X0FF
  451B D528 B069        	SAH	RECE_BUF
  452B D529 DF00D5A7    	BS	B1,TRANSMIT_END
  453B                  ;---
  454B                  TRANSMIT_6:	;7th
  455B D52B 0E6D        	LAC	RECE_BUF4
  456B D52C 858000FF    	ANDL	0X0FF
  457B D52E B069        	SAH	RECE_BUF
  458B D52F DF00D5A7    	BS	B1,TRANSMIT_END
  459B                  TRANSMIT_7:	;8th
  460B D531 0E6D        	LAC	RECE_BUF4
  461B D532 9E08        	SFR	8
  462B D533 858000FF    	ANDL	0X0FF
  463B D535 B069        	SAH	RECE_BUF
  464B D536 DF00D5A7    	BS	B1,TRANSMIT_END
  465B                  ;---
  466B                  TRANSMIT_8:	;9th
  467B D538 0E6E        	LAC	RECE_BUF5
  468B D539 858000FF    	ANDL	0X0FF
  469B D53B B069        	SAH	RECE_BUF
  470B D53C DF00D5A7    	BS	B1,TRANSMIT_END
  471B                  TRANSMIT_9:	;10th
  472B D53E 0E6E        	LAC	RECE_BUF5
  473B D53F 9E08        	SFR	8
  474B D540 858000FF    	ANDL	0X0FF
  475B D542 B069        	SAH	RECE_BUF
  476B D543 DF00D5A7    	BS	B1,TRANSMIT_END
  477B                  ;---
  478B                  TRANSMIT_10:	;11th
  479B D545 0E6F        	LAC	RECE_BUF6
  480B D546 858000FF    	ANDL	0X0FF
  481B D548 B069        	SAH	RECE_BUF
  482B D549 DF00D5A7    	BS	B1,TRANSMIT_END
  483B                  TRANSMIT_11:	;12th
  484B D54B 0E6F        	LAC	RECE_BUF6
  485B D54C 9E08        	SFR	8
  486B D54D 858000FF    	ANDL	0X0FF
  487B D54F B069        	SAH	RECE_BUF
  488B D550 DF00D5A7    	BS	B1,TRANSMIT_END
  489B                  ;---
  490B                  TRANSMIT_12:	;13th
  491B D552 0E70        	LAC	RECE_BUF7
  492B D553 858000FF    	ANDL	0X0FF
  493B D555 B069        	SAH	RECE_BUF
  494B D556 DF00D5A7    	BS	B1,TRANSMIT_END
  495B                  TRANSMIT_13:	;14th
  496B D558 0E70        	LAC	RECE_BUF7
  497B D559 9E08        	SFR	8
  498B D55A 858000FF    	ANDL	0X0FF
  499B D55C B069        	SAH	RECE_BUF
  500B D55D DF00D5A7    	BS	B1,TRANSMIT_END
  501B                  ;---
  502B                  TRANSMIT_14:	;15th
  503B D55F 0E71        	LAC	RECE_BUF8
  504B D560 858000FF    	ANDL	0X0FF
  505B D562 B069        	SAH	RECE_BUF
  506B D563 DF00D5A7    	BS	B1,TRANSMIT_END
  507B                  TRANSMIT_15:	;16th
  508B D565 0E71        	LAC	RECE_BUF8
  509B D566 9E08        	SFR	8
  510B D567 858000FF    	ANDL	0X0FF
  511B D569 B069        	SAH	RECE_BUF
  512B D56A DF00D5A7    	BS	B1,TRANSMIT_END
  513B                  ;---
  514B                  TRANSMIT_16:	;17th
  515B D56C 0E72        	LAC	RECE_BUF9
  516B D56D 858000FF    	ANDL	0X0FF
  517B D56F B069        	SAH	RECE_BUF
  518B D570 DF00D5A7    	BS	B1,TRANSMIT_END
  519B                  TRANSMIT_17:	;18th
  520B D572 0E72        	LAC	RECE_BUF9
  521B D573 9E08        	SFR	8
  522B D574 858000FF    	ANDL	0X0FF
  523B D576 B069        	SAH	RECE_BUF
  524B D577 DF00D5A7    	BS	B1,TRANSMIT_END
  525B                  ;---
  526B                  TRANSMIT_18:	;19th
  527B D579 0E73        	LAC	RECE_BUF10
  528B D57A 858000FF    	ANDL	0X0FF
  529B D57C B069        	SAH	RECE_BUF
  530B D57D DF00D5A7    	BS	B1,TRANSMIT_END
  531B                  TRANSMIT_19:	;20th
  532B D57F 0E73        	LAC	RECE_BUF10
  533B D580 9E08        	SFR	8
  534B D581 858000FF    	ANDL	0X0FF
  535B D583 B069        	SAH	RECE_BUF
  536B D584 DF00D5A7    	BS	B1,TRANSMIT_END
  537B                  ;---
  538B                  TRANSMIT_20:	;21th
  539B D586 0E74        	LAC	RECE_BUF11
  540B D587 858000FF    	ANDL	0X0FF
  541B D589 B069        	SAH	RECE_BUF
  542B D58A DF00D5A7    	BS	B1,TRANSMIT_END
  543B                  TRANSMIT_21:	;22th
  544B D58C 0E74        	LAC	RECE_BUF11
  545B D58D 9E08        	SFR	8
  546B D58E 858000FF    	ANDL	0X0FF
  547B D590 B069        	SAH	RECE_BUF
  548B D591 DF00D5A7    	BS	B1,TRANSMIT_END
  549B                  ;---
  550B                  TRANSMIT_22:	;23th
  551B D593 0E75        	LAC	RECE_BUF12
  552B D594 858000FF    	ANDL	0X0FF
  553B D596 B069        	SAH	RECE_BUF
  554B D597 DF00D5A7    	BS	B1,TRANSMIT_END
  555B                  TRANSMIT_23:	;24th
  556B D599 0E75        	LAC	RECE_BUF12
  557B D59A 9E08        	SFR	8
  558B D59B 858000FF    	ANDL	0X0FF
  559B D59D B069        	SAH	RECE_BUF
  560B D59E DF00D5A7    	BS	B1,TRANSMIT_END	
  561B                  		
  562B                  TRANSMIT_TEND:	
  563B D5A0 0F00        	LACK	0
  564B D5A1 B067        	SAH	SIO_CNT
  565B                  	
  566B D5A2 0E65        	LAC	TRS_FG
  567B D5A3 8580FFF0    	ANDL	0XFFF0
  568B D5A5 B065        	SAH	TRS_FG
  569B                  	
  570B D5A6 E965        	CRAM	TRS_FG,9		;发送完毕
  571B                  TRANSMIT_END:
  572B D5A7 0F00        	LACK	0
  573B D5A8 B068        	SAH	TMR_TR
  574B                  	
  575B                  TRANSMIT_END1:	
  576B D5A9 F800        	RET
  577B                  ;------------------------------------------------------
  578B                  ;	Function : ERR_CHK
  579B                  ;	若有传输任务,而又超过一定时间没有clk则报错
  580B                  ;------------------------------------------------------
  581B                  ERR_CHK:
  582B D5AA 6565        	BIT	TRS_FG,5
  583B D5AB DA00D5C1    	BS	TB,ERR_CHK_END
  584B                  ERR_CHK1:	
  585B D5AD 6765        	BIT	TRS_FG,7
  586B D5AE DA00D5C1    	BS	TB,ERR_CHK_END		;接收时不查超时错
  587B                  	
  588B D5B0 6965        	BIT	TRS_FG,9
  589B D5B1 D200D5C1    	BZ	TB,ERR_CHK_END
  590B                  	
  591B D5B3 0E68        	LAC	TMR_TR
  592B D5B4 828002D0    	SBHL	720
  593B D5B6 DD00D5C1    	BS	SGN,ERR_CHK_END		;在接收状态距离上一位或开始90ms之外无脉冲
  594B D5B8 D300D5C1    	BZ	ACZ,ERR_CHK_END
  595B                  	
  596B D5BA 0F00        	LACK	0
  597B D5BB B067        	SAH	SIO_CNT
  598B                  	
  599B D5BC 0E65        	LAC	TRS_FG
  600B D5BD 8580FFF0    	ANDL	0XFFF0
  601B D5BF B065        	SAH	TRS_FG
  602B                  	
  603B D5C0 E965        	CRAM	TRS_FG,9 ;;;;;;;;;
  604B                  	;CALL	DAT_IDEL
  605B                  ERR_CHK_END:
  606B D5C1 F800        	RET
  607B                  ;-------时钟部分,记录各时间等待,超时等------------------------------
  608B                  ;-------------------------------------------------------------------
  609B                  C_SIO:
  610B D5C2 1500        	LDPK	0
  611B D5C3 1300        	LIPK	0
  612B                  	
  613B D5C4 0E68        	LAC	TMR_TR
  614B D5C5 0101        	ADHK	1
  615B D5C6 B068        	SAH	TMR_TR		;increase one every 125us
  616B                  
  617B D5C7 0E68        	LAC	TMR_TR
  618B D5C8 82800320    	SBHL	800
  619B D5CA DD00D5D3    	BS	SGN,C_SIO_END
  620B D5CC 87800320    	LACL	800
  621B D5CE B068        	SAH	TMR_TR		;将TMR_TR2限制在100ms以内,记录位间隔或字节间隔时间
  622B                  	
  623B D5CF 0F00        	LACK	0
  624B D5D0 B067        	SAH	SIO_CNT
  625B D5D1 E965        	CRAM	TRS_FG,9
  626B D5D2 E765        	CRAM	TRS_FG,7
  627B                  	
  628B                  C_SIO_END:
  629B D5D3 F800        	RET	
  630B                  ;-------detect SIO task---------------------------------------------
  631B                  ;-------------------------------------------------------------------
  632B                  SIO_DET:	
  633B                  
  634B D5D4 0E68        	LAC	TMR_TR		;应大于双字节间的时间延迟上限8ms
  635B D5D5 0540        	SBHK	END_SEND
  636B D5D6 DD00D5E6    	BS	SGN,SIO_DET1 		;传送任务结束了吗(距最后一次位传送超过15*Tc-T)?
  637B                  ;-------任务结束或者没任务,清除发送/接收任务标志,置执行命令标志------------------------------
  638B D5D8 6765        	BIT	TRS_FG,7		;本来清除该标志无需判断该位是否为零,但考虑到"可执行"
  639B D5D9 D200D5E6    	BZ	TB,SIO_DET1		;命令位(TRS_FG.10)与其同时操作,却不能被多次置位
  640B                  
  641B D5DB E765        	CRAM	TRS_FG,7		;TRS_FG(bit7)=0;若是发送状态,此位可由COUNT(7..4)=0或TRAN_BUFx=0确定
  642B                  					;只有TMR_TR2>10ms时才表示一次接收任务的正式结束
  643B D5DC 0F00        	LACK	0
  644B D5DD B067        	SAH	SIO_CNT
  645B                  	
  646B D5DE 0E65        	LAC	TRS_FG
  647B D5DF 8580FFF0    	ANDL	0XFFF0
  648B D5E1 B065        	SAH	TRS_FG
  649B                  	
  650B D5E2 87800087    	LACL	CMSG_SER
  651B D5E4 FC00CC09    	CALL	INT_STOR_MSG
  652B                  SIO_DET1:
  653B D5E6 6765        	BIT	TRS_FG,7
  654B D5E7 DA00D616    	BS	TB,SIO_DET_END		;查是否处于接收状态
  655B                  	
  656B D5E9 6965        	BIT	TRS_FG,9
  657B D5EA DA00D616    	BS	TB,SIO_DET_END		;查是否处于发送状态
  658B                  	
  659B D5EC 0E68        	LAC	TMR_TR
  660B D5ED 050A        	SBHK	END_BYTE
  661B D5EE D300D5F2    	BZ	ACZ,SIO_DET2
  662B                  	
  663B D5F0 FC00D696    	CALL	DAT_IDEL
  664B                  SIO_DET2:	
  665B                  	
  666B D5F2 6565        	BIT	TRS_FG,5		;查DSP接收请求(CPU发送clock=BIOR.6=0?)
  667B D5F3 DA00D5FE    	BS	TB,SIO_DET3
  668B                  	
  669B D5F5 6A65        	BIT	TRS_FG,10		;查DSP发送请求(CPU发送clock=BIOR.6=0?)
  670B D5F6 D200D612    	BZ	TB,SIO_DET5
  671B                  	
  672B D5F8 EA65        	CRAM	TRS_FG,10
  673B D5F9 E9E5        	SRAM	TRS_FG,9
  674B                  	
  675B D5FA FC00D6A3    	CALL	WR_L
  676B D5FC DF00D60E    	BS	B1,SIO_DET4
  677B                  SIO_DET3:
  678B D5FE 8780FFFF    	LACL	0XFFFF		;初始化为0XFFFF是为便于测试
  679B D600 B06A        	SAH	RECE_BUF1
  680B D601 B06B        	SAH	RECE_BUF2
  681B D602 B06C        	SAH	RECE_BUF3
  682B D603 B06D        	SAH	RECE_BUF4
  683B D604 B06E        	SAH	RECE_BUF5
  684B D605 B06F        	SAH	RECE_BUF6
  685B D606 B070        	SAH	RECE_BUF7
  686B D607 B071        	SAH	RECE_BUF8
  687B D608 B072        	SAH	RECE_BUF9
  688B D609 B073        	SAH	RECE_BUF10
  689B D60A B074        	SAH	RECE_BUF11
  690B D60B B075        	SAH	RECE_BUF12
  691B D60C B076        	SAH	RECE_BUF13
  692B                  
  693B D60D E7E5        	SRAM	TRS_FG,7	;set the flag of receive bit(TRS_FG.7=1)	
  694B                  ;-------
  695B                  SIO_DET4:			;请求成功,进行一些传送初始化操作
  696B D60E 0F00        	LACK	0
  697B D60F B068        	SAH	TMR_TR		;位传送计时开始
  698B                  	
  699B                  	;LAC	SIO_CNT
  700B                  	;ANDL	0XFFF0
  701B                  	;SAH	SIO_CNT		;位传送计数开始
  702B D610 DF00D616    	BS	B1,SIO_DET_END
  703B                  SIO_DET5:	;SIO idel mode
  704B D612 0E65        	LAC	TRS_FG
  705B D613 8580FFF0    	ANDL	0XFFF0 ;;;;;;;;;;处于空闲状态(保留TRS_FG.10,9,8,7,6,5,4)无请求
  706B D615 B065        	SAH	TRS_FG
  707B                  SIO_DET_END:
  708B                  	
  709B D616 F800        	RET
  710B                  
  711B                  ;-------开始偿试执行命令--------------------------------------------	
  712B                  ;-------执行传送部分,根据状态决定是发送,接收或空闲----------------
  713B                  ;	有脉冲来,则执行相应的收发操作;没有脉冲来
  714B                  ;-----------------------------------------------------------------
  715B                  C_INT1:
  716B D617 6565        	BIT	TRS_FG,5
  717B D618 D200D621    	BZ	TB,C_INT3	;查clock(BIOR.6) fail edge flag
  718B                  	
  719B D61A FC00D4AA    	CALL	TRANSMIT
  720B D61C FC00D34A    	CALL	RECEIVE
  721B                  	
  722B                  		
  723B D61E E565        	CRAM	TRS_FG,5		;clear fail edge flag TRS_FG(bit5)
  724B                  	
  725B D61F DF00D623    	BS	B1,C_INT1_END
  726B                  C_INT3:
  727B D621 FC00D5AA    	CALL	ERR_CHK
  728B                  C_INT1_END:
  729B D623 F800        	RET
  730B                  ;----------------------------------------------------------------------------
  731B                  ;	Funtion : CLOCK
  732B                  ;		检测CLK脉冲
  733B                  ;----------------------------------------------------------------------------
  734B                  CLOCK:	
  735B D624 6965        	BIT	TRS_FG,9
  736B D625 DA00D64E    	BS	TB,CLOCK_S
  737B                  CLOCK_R:
  738B D627 FC00D699    	CALL	DAT_VALID	;检测接收是否有效
  739B D629 6B65        	BIT	TRS_FG,11
  740B D62A DA00D633    	BS	TB,CLOCK_R1
  741B                  	
  742B D62C E4E5        	SRAM	TRS_FG,4	;在WR=HIGH(无收发)时也记下CLK
  743B                  
  744B D62D A266        	IN	C_RSIO1,BIOR
  745B D62E 6666        	BIT	C_RSIO1,6
  746B D62F DA00D64B    	BS	TB,CLOCK_R3
  747B D631 DF00D64D    	BS	B1,CLOCK_R4
  748B                  CLOCK_R1:			
  749B D633 A266        	IN	C_RSIO1,BIOR	;查clock
  750B D634 6666        	BIT	C_RSIO1,6
  751B D635 DA00D64B    	BS	TB,CLOCK_R3
  752B                  	
  753B D637 6465        	BIT	TRS_FG,4
  754B D638 DA00D64D    	BS	TB,CLOCK_R4	;查上次状态,LOW--->LOW则直接退出
  755B                  
  756B D63A E5E5        	SRAM	TRS_FG,5	;if 78806 send clock(fail edge) then TRS_FG.5=1
  757B D63B E4E5        	SRAM	TRS_FG,4
  758B                  
  759B D63C 0E65        	LAC	TRS_FG
  760B D63D 0101        	ADHK	1
  761B D63E B065        	SAH	TRS_FG
  762B                  
  763B D63F 0E65        	LAC	TRS_FG
  764B D640 0B0F        	ANDK	0X0F
  765B D641 0509        	SBHK	9
  766B D642 D300D649    	BZ	ACZ,CLOCK_R2
  767B                  	
  768B D644 0E65        	LAC	TRS_FG
  769B D645 8580FFF0    	ANDL	0XFFF0
  770B D647 0101        	ADHK	1
  771B D648 B065        	SAH	TRS_FG
  772B                  	
  773B                  CLOCK_R2:
  774B D649 DF00D64D    	BS	B1,CLOCK_R4
  775B                  CLOCK_R3:
  776B D64B E465        	CRAM	TRS_FG,4
  777B D64C E565        	CRAM	TRS_FG,5	;可删除---因为收发一个bit后总会清除之
  778B                  CLOCK_R4:
  779B D64D F800        	RET
  780B                  ;-------
  781B                  .IF	TEXT_CLOCK
  782B                  CLOCK_S:
  783B                  	LAC	CLK_CN
  784B                  	ADHK	1
  785B                  	SAH	CLK_CN
  786B                  	
  787B                  	ANDL	0X07
  788B                  	SBHK	1
  789B                  	BZ	ACZ,CLOCK_S2
  790B                  CLOCK_S1:
  791B                  	SRAM	TRS_FG,5
  792B                  	
  793B                  	LAC	TRS_FG
  794B                  	ADHK	1
  795B                  	SAH	TRS_FG
  796B                  
  797B                  	LAC	TRS_FG
  798B                  	ANDK	0X0F
  799B                  	SBHK	9
  800B                  	BZ	ACZ,CLOCK_S2
  801B                  	
  802B                  	LAC	TRS_FG
  803B                  	ANDL	0XFFF0
  804B                  	ADHK	1
  805B                  	SAH	TRS_FG
  806B                  	
  807B                  CLOCK_S2:
  808B                  		
  809B                  	RET
  810B                  .ELSE
  811B                  CLOCK_S:
  812B                  	
  813B                  CLOCK_S1:			
  814B D64E A266        	IN	C_RSIO1,BIOR	;查clock
  815B D64F 6666        	BIT	C_RSIO1,6
  816B D650 D200D666    	BZ	TB,CLOCK_S3
  817B                  	
  818B D652 6465        	BIT	TRS_FG,4
  819B D653 D200D667    	BZ	TB,CLOCK_S4	;查上次状态,HIGH--->HIGH则直接退出
  820B                  
  821B D655 E5E5        	SRAM	TRS_FG,5	;if MCU send clock(rose edge) then TRS_FG.5=1
  822B D656 E465        	CRAM	TRS_FG,4
  823B                  
  824B D657 0E65        	LAC	TRS_FG
  825B D658 0101        	ADHK	1
  826B D659 B065        	SAH	TRS_FG
  827B                  
  828B D65A 0E65        	LAC	TRS_FG
  829B D65B 0B0F        	ANDK	0X0F
  830B D65C 0509        	SBHK	9
  831B D65D D300D664    	BZ	ACZ,CLOCK_S2
  832B                  	
  833B D65F 0E65        	LAC	TRS_FG
  834B D660 8580FFF0    	ANDL	0XFFF0
  835B D662 0101        	ADHK	1
  836B D663 B065        	SAH	TRS_FG
  837B                  	
  838B                  CLOCK_S2:
  839B D664 DF00D667    	BS	B1,CLOCK_S4
  840B                  CLOCK_S3:
  841B D666 E4E5        	SRAM	TRS_FG,4
  842B                  	;CRAM	TRS_FG,5	;可删除---因为收发一个bit后总会清除之
  843B                  CLOCK_S4:
  844B D667 F800        	RET
  845B                  .ENDIF
  846B                  ;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
  847B                  
  848B                  ;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
  849B                  SEND_INIT:
  850B D668 6765        	BIT	TRS_FG,7
  851B D669 DA00D67E    	BS	TB,SEND_INIT_END
  852B D66B 6B65        	BIT	TRS_FG,11
  853B D66C DA00D67E    	BS	TB,SEND_INIT_END
  854B                  .IF	0
  855B                  	LAC	MSG_ID
  856B                  	ORL	0XA000
  857B                  	SAH	CONF
  858B                  	CALL	DAM_BIOS
  859B                  	LAC	RESP
  860B                  	SFL	8
  861B                  	ORL	0X8F
  862B                  	SAH	RECE_BUF1
  863B                  	SAH	RECE_BUF	;SECOND
  864B                  ;---	
  865B                  	LAC	MSG_ID
  866B                  	ORL	0XA100
  867B                  	SAH	CONF
  868B                  	CALL	DAM_BIOS
  869B                  	LAC	RESP
  870B                  	ANDL	0XFF
  871B                  	SAH	RECE_BUF2	;MINUTE
  872B                  	
  873B                  	LAC	MSG_ID
  874B                  	ORL	0XA200
  875B                  	SAH	CONF
  876B                  	CALL	DAM_BIOS
  877B                  	LAC	RESP
  878B                  	SFL	8
  879B                  	OR	RECE_BUF2	;HOUR
  880B                  	SAH	RECE_BUF2
  881B                  ;---	
  882B                  	LAC	MSG_ID
  883B                  	ORL	0XAE00
  884B                  	SAH	CONF
  885B                  	CALL	DAM_BIOS
  886B                  	LAC	RESP
  887B                  	ANDL	0XFF
  888B                  	SAH	RECE_BUF3	;DAY
  889B                  	
  890B                  	LAC	MSG_ID
  891B                  	ORL	0XAD00
  892B                  	SAH	CONF
  893B                  	CALL	DAM_BIOS
  894B                  	LAC	RESP
  895B                  	SFL	8
  896B                  	OR	RECE_BUF3	;MONTH
  897B                  	SAH	RECE_BUF3
  898B                  ;---	
  899B                  	LAC	MSG_ID
  900B                  	ORL	0XAC00
  901B                  	SAH	CONF
  902B                  	CALL	DAM_BIOS
  903B                  	LAC	RESP
  904B                  	ANDL	0XFF
  905B                  	ORL	0X0400
  906B                  	SAH	RECE_BUF4	;YEAR
  907B                  	
  908B                  	LACL	0X454D
  909B                  	SAH	RECE_BUF5
  910B                  	LACL	0X4F4D
  911B                  	SAH	RECE_BUF6
  912B                  .ENDIF
  913B                  ;---
  914B D66E 0E14        	LAC	MSG_ID
  915B D66F FC00DC1E    	CALL	GET_USRDAT
  916B D671 FC00DBEB    	CALL	GET_TELID
  917B D673 DB00D67E    	BS	ACZ,SEND_INIT_END
  918B D675 FC00D778    	CALL	TELNUM_READ
  919B                  	
  920B D677 0E65        	LAC	TRS_FG
  921B D678 8580FFF0    	ANDL	0XFFF0
  922B D67A B065        	SAH	TRS_FG
  923B                  	
  924B D67B 0F00        	LACK	0
  925B D67C B067        	SAH	SIO_CNT
  926B                  	
  927B D67D EAE5        	SRAM	TRS_FG,10	;开始发送了
  928B                  	
  929B                  SEND_INIT_END:
  930B                  		
  931B D67E F800        	RET
  932B                  
  933B                  ;---------------------------------------------------------
  934B                  ;	Function : SEND_BIT
  935B                  ;	根据要发送的位的状态,置输出口H/L,并准备下一位
  936B                  ;---------------------------------------------------------
  937B                  SEND_BIT:	
  938B D67F 6769        	BIT	RECE_BUF,7
  939B D680 DA00D686    	BS	TB,SEND_BIT3
  940B                  	
  941B                  SEND_BIT2:
  942B D682 FC00D692    	CALL	DAT_L
  943B D684 DF00D688    	BS	B1,SEND_BIT_END
  944B                  SEND_BIT3:
  945B D686 FC00D68E    	CALL	DAT_H
  946B                  SEND_BIT_END:
  947B D688 0E69        	LAC	RECE_BUF
  948B D689 9C01        	SFL	1
  949B D68A 858000FF    	ANDL	0X0FF
  950B D68C B069        	SAH	RECE_BUF
  951B                  	
  952B D68D F800        	RET
  953B                  
  954B                  ;----------------------------------------------------------------------------
  955B                  ;	Function : DAT_H
  956B                  ;	dat(BIOR.4=1)
  957B                  ;----------------------------------------------------------------------------
  958B                  DAT_H:
  959B D68E 1300        	LIPK	0
  960B D68F A31C        	SIO	12,BIOR
  961B D690 A314        	SIO	4,BIOR
  962B D691 F800        	RET
  963B                  ;----------------------------------------------------------------------------
  964B                  ;	Function : DAT_L
  965B                  ;	dat(BIOR.4=0)
  966B                  ;----------------------------------------------------------------------------
  967B                  DAT_L:
  968B D692 1300        	LIPK	0
  969B D693 A31C        	SIO	12,BIOR
  970B D694 A114        	CIO	4,BIOR
  971B D695 F800        	RET
  972B                  ;----------------------------------------------------------------------------
  973B                  ;	Function : DAT_IDEL
  974B                  ;	dat(BIOR.12=0)
  975B                  ;----------------------------------------------------------------------------
  976B                  DAT_IDEL:
  977B D696 1300        	LIPK	0
  978B D697 A11C        	CIO	12,BIOR
  979B                  	
  980B D698 F800        	RET
  981B                  ;----------------------------------------------------------------------------
  982B                  ;	Function : DAT_VALID
  983B                  ;	(BIOR.5)
  984B                  ;----------------------------------------------------------------------------
  985B                  DAT_VALID:
  986B D699 EBE5        	SRAM	TRS_FG,11
  987B                  .if	TEXT_WR	
  988B D69A 1300        	LIPK	0
  989B D69B A11D        	CIO	13,BIOR
  990B D69C FFFF        	NOP
  991B D69D A266        	IN	C_RSIO1,BIOR
  992B D69E 6566        	BIT	C_RSIO1,5
  993B D69F D200D6A2    	BZ	TB,DAT_VALID_END
  994B                  	
  995B D6A1 EB65        	CRAM	TRS_FG,11
  996B                  .endif
  997B                  DAT_VALID_END:	
  998B D6A2 F800        	RET
  999B                  ;----------------------------------------------------------------------------
 1000B                  ;	Function : WR_L
 1001B                  ;	(BIOR.5)
 1002B                  ;----------------------------------------------------------------------------
 1003B                  WR_L:
 1004B D6A3 EBE5        	SRAM	TRS_FG,11
 1005B                  .if	TEXT_WR	
 1006B D6A4 1300        	LIPK	0
 1007B D6A5 A31D        	SIO	13,BIOR
 1008B D6A6 A115        	CIO	5,BIOR
 1009B                  .endif
 1010B                  WR_L_END:	
 1011B D6A7 F800        	RET
 1012B                  
 1013B                  
 1014B                  .END
 1190A                  .INCLUDE two_way.asm
    1B                  .LIST
    2B                  TWAY_STATE:
    3B D6A8 0E3D        	LAC	MSG
    4B D6A9 8680008B    	XORL	CMSG_CPC
    5B D6AB DB00D6B8    	BS	ACZ,TWAY_CPC_RUN	;
    6B                  	
    7B D6AD 0E3E        	LAC	PRO_VAR
    8B D6AE 9E04        	SFR	4
    9B D6AF DB00D6BA    	BS	ACZ,TWAY_STATE1		;for initial
   10B D6B1 0501        	SBHK	1
   11B D6B2 DB00D6F2    	BS	ACZ,TWAY_STATE2		;for record/line
   12B D6B4 0501        	SBHK	1
   13B D6B5 DB00D762    	BS	ACZ,TWAY_STATE_EXIT	;for end(TimeOut/BTONE/CTONE/VOX_ON)
   14B                  
   15B D6B7 F800        	RET
   16B                  
   17B                  TWAY_CPC_RUN:
   18B D6B8 DF00D768    	BS	B1,TWAY_STATE_EXIT_END
   19B                  	
   20B                  ;=============================================================
   21B                  TWAY_STATE1:	
   22B D6BA 0E3D        	LAC	MSG
   23B D6BB 86800081    	XORL	CMSG_INIT		;INITIAL
   24B D6BD DB00D6CA    	BS	ACZ,TWAY_STATE_INIT
   25B                  TWAY_STATE1_1:	
   26B D6BF 0E3D        	LAC	MSG
   27B D6C0 868000B0    	XORL	CVP_STOP		
   28B D6C2 DB00D6D8    	BS	ACZ,TWAY_VP_STOP	;CVP_STOP,OGM播放完毕
   29B                  TWAY_STATE1_2:
   30B                  	;LAC	MSG
   31B                  	;XORL	CREV_DTMF		;CREV_DTMF
   32B                  	;BS	ACZ,TWAY_REV_DTMF
   33B                  TWAY_STATE1_3:
   34B D6C4 0E3D        	LAC	MSG
   35B D6C5 86800006    	XORL	CMSG_KEY6S		;STOP
   36B D6C7 DB00D707    	BS	ACZ,TWAY_STOP_DET
   37B                  	
   38B D6C9 F800        	RET
   39B                  
   40B                  ;---
   41B                  TWAY_STATE_INIT:
   42B D6CA FC00CA4B    	CALL	INIT_DAM_FUNC
   43B D6CC FC00C108    	CALL	MSG_CHK
   44B D6CE 6D11        	BIT	ANN_FG,13
   45B D6CF DA00D6D6    	BS	TB,TWAY_STATE_INIT_EXIT
   46B                  TWAY_STATE_INIT_1:
   47B D6D1 FC00C176    	CALL	DAA_LINE_SPK
   48B                  	;CALL	DAA_LIN_RECORD
   49B                  	
   50B D6D3 FC00D267    	CALL	LBEEP
   51B                  TWAY_STATE_INIT_END:
   52B D6D5 F800        	RET
   53B                  TWAY_STATE_INIT_EXIT:		;满了不准再录,退出
   54B D6D6 DF00D768    	BS	B1,TWAY_STATE_EXIT_END	
   55B                  ;---
   56B                  TWAY_VP_STOP:			;开始录音(ICM)/ON_LINE(only)	
   57B D6D8 FC00CA4B    	CALL	INIT_DAM_FUNC
   58B D6DA FC00C1A5    	CALL	DAA_TWAY_RECORD
   59B D6DC FC00CBE7    	CALL	BCVOX_INIT
   60B                  	
   61B D6DE 0E3E        	LAC	PRO_VAR
   62B D6DF 8580FF0F    	ANDL	0XFF0F
   63B D6E1 0110        	ADHK	0X010
   64B D6E2 B03E        	SAH	PRO_VAR
   65B                  	
   66B D6E3 0F00        	LACK	0
   67B D6E4 B03F        	SAH	PRO_VAR1
   68B D6E5 878003E8    	LACL	1000
   69B D6E7 FC00C1D6    	CALL	SET_TIMER
   70B                  	
   71B                  	;LACL	0XD000
   72B                  	;SAH	CONF
   73B                  	;CALL	DAM_BIOS
   74B                  	
   75B                  	;LACL	0XD200
   76B                  	;SAH	CONF
   77B                  	;CALL	DAM_BIOS
   78B                  	
   79B D6E9 FC00C108    	CALL	MSG_CHK
   80B                  
   81B                  	;CALL	GET_FILEID
   82B D6EB 0E17        	LAC	FILE_ID
   83B D6EC FC00DC16    	CALL	SET_USRDAT
   84B                  	
   85B D6EE FC00CA8A    	CALL	REC_START
   86B                  			;;;;判断OGM1/OGM2---record/line
   87B                  TWAY_VP_STOP_END:		
   88B D6F0 F800        	RET
   89B                  ;---------------for DTMF
   90B                  TWAY_REV_DTMF:			;不理会DTMF
   91B                  	
   92B D6F1 F800        	RET
   93B                  
   94B                  ;=============================================================
   95B                  TWAY_STATE2:
   96B                  	;LAC	MSG
   97B                  	;XORL	CREV_DTMF		;CREV_DTMF
   98B                  	;BS	ACZ,TWAY_REV_DTMF
   99B                  TWAY_STATE3:
  100B D6F2 0E3D        	LAC	MSG
  101B D6F3 86800090    	XORL	CMSG_TMR		;time 1s
  102B D6F5 DB00D739    	BS	ACZ,TWAY_TMR_DET
  103B                  TWAY_STATE4:
  104B D6F7 0E3D        	LAC	MSG
  105B D6F8 86800006    	XORL	CMSG_KEY6S		;STOP
  106B D6FA DB00D707    	BS	ACZ,TWAY_STOP_DET
  107B                  TWAY_STATE5:
  108B D6FC 0E3D        	LAC	MSG
  109B D6FD 868000B2    	XORL	CREC_FULL		;REC_FULL
  110B D6FF DB00D741    	BS	ACZ,TWAY_REC_FUL
  111B                  TWAY_STATE6:	
  112B D701 0E3D        	LAC	MSG
  113B D702 868000B0    	XORL	CVP_STOP		;PLAY END
  114B D704 DB00D75F    	BS	ACZ,TWAY_REC_EVP
  115B                  	
  116B D706 F800        	RET
  117B                  ;---
  118B                  TWAY_STOP_DET:
  119B D707 0E3F        	LAC	PRO_VAR1
  120B D708 0503        	SBHK	3
  121B D709 D500D712    	BZ	SGN,TWAY_STOP_DET1
  122B D70B EB80        	SRAM	CONF,11				;少于3秒,录音删除
  123B D70C FC000020    	CALL	DAM_BIOS
  124B D70E FC00CA4B    	CALL	INIT_DAM_FUNC
  125B D710 DF00D727    	BS	B1,TWAY_BCVOX_1
  126B                  TWAY_STOP_DET1:
  127B D712 0E00        	LAC	CONF
  128B D713 85801000    	ANDL	0X1000		;不掐尾
  129B D715 B000        	SAH	CONF
  130B D716 FC00CA4B    	CALL	INIT_DAM_FUNC
  131B                  ;---对应来电	
  132B D718 8780E605    	LACL	0XE605
  133B D71A B000        	SAH	CONF
  134B D71B FC000020    	CALL	DAM_BIOS
  135B D71D FC00DC09    	CALL	GET_TELT
  136B D71F D300D727    	BZ	ACZ,TWAY_BCVOX_1
  137B                  	
  138B D721 FC00C0FE    	CALL	GET_TOTALMSG
  139B D723 FC00D93F    	CALL	GET_MSGMSG
  140B D725 FC00D9E8    	CALL	WRITE_ICMMSG
  141B                  TWAY_BCVOX_1:	
  142B D727 FC00C0FE    	CALL	GET_TOTALMSG
  143B D729 FC00DC1E    	CALL	GET_USRDAT
  144B D72B FC00DBC7    	CALL	COL_ICMTEL
  145B                  
  146B D72D FC00DBA8    	CALL	TMPNUM_DEL
  147B                  
  148B D72F 0E3E        	LAC	PRO_VAR
  149B D730 8580FF0F    	ANDL	0XFF0F
  150B D732 0120        	ADHK	0X020
  151B D733 B03E        	SAH	PRO_VAR
  152B                  
  153B D734 87800005    	LACL	0X005
  154B D736 FC00CC52    	CALL	STOR_VP
  155B                  	
  156B D738 F800        	RET
  157B                  ;---
  158B                  TWAY_TMR_DET:
  159B D739 0E00        	LAC	CONF
  160B D73A 8580FFC0    	ANDL	0XFFC0
  161B D73C B000        	SAH	CONF
  162B                  	
  163B D73D 0E3F        	LAC	PRO_VAR1
  164B D73E 0101        	ADHK	1
  165B D73F B03F        	SAH	PRO_VAR1
  166B                  	
  167B                  TWAY_TMR_DET_END:
  168B D740 F800        	RET
  169B                  ;---
  170B                  TWAY_REC_FUL:
  171B D741 0E00        	LAC	CONF
  172B D742 8580F000    	ANDL	0XF000
  173B D744 B000        	SAH	CONF
  174B D745 FC00CA4B    	CALL	INIT_DAM_FUNC
  175B                  	
  176B D747 FC00CA9E    	CALL	GC_CHK
  177B D749 FC00C108    	CALL	MSG_CHK
  178B D74B 6D11        	BIT	ANN_FG,13
  179B D74C DA00D751    	BS	TB,TWAY_MFULL_EXIT
  180B                  	
  181B D74E FC00CA8A    	CALL	REC_START
  182B                  
  183B D750 F800        	RET
  184B                  TWAY_MFULL_EXIT:		;MFULL退出
  185B D751 FC00CA4B    	CALL	INIT_DAM_FUNC
  186B D753 FC00C176    	CALL	DAA_LINE_SPK
  187B D755 FC00C1CA    	CALL	HOOK_ON
  188B                  	
  189B D757 FC00D279    	CALL	BBBEEP		;警告语音BBB
  190B                  	
  191B D759 0E3E        	LAC	PRO_VAR
  192B D75A 8580FF0F    	ANDL	0XFF0F
  193B D75C 0120        	ADHK	0X020
  194B D75D B03E        	SAH	PRO_VAR
  195B                  
  196B D75E F800        	RET
  197B                  ;---
  198B                  TWAY_REC_EVP:
  199B D75F FC00CA4B    	CALL	INIT_DAM_FUNC
  200B                  	
  201B D761 F800        	RET
  202B                  ;=================================================================
  203B                  TWAY_STATE_EXIT:
  204B D762 0E3D        	LAC	MSG
  205B D763 868000B0    	XORL	CVP_STOP		
  206B D765 DB00D768    	BS	ACZ,TWAY_STATE_EXIT_END	;CVP_STOP,EXIT播放完毕
  207B                  	
  208B D767 F800        	RET
  209B                  TWAY_STATE_EXIT_END:
  210B D768 FC00CA4B    	CALL	INIT_DAM_FUNC
  211B D76A FC00C1CD    	CALL	HOOK_OFF
  212B D76C FC00CC38    	CALL	CLR_FUNC	;先空
  213B                  	
  214B D76E 0F00        	LACK	0
  215B D76F B03E        	SAH	PRO_VAR
  216B                  	
  217B D770 87800081    	LACL	CMSG_INIT
  218B D772 FC00CC19    	CALL	STOR_MSG
  219B                  	
  220B D774 0E19        	LAC	RING_ID
  221B D775 9E0C        	SFR	12
  222B D776 B019        	SAH	RING_ID
  223B                  	
  224B D777 F800        	RET
  225B                  ;//----------------------------------------------------------------------
  226B                  
  227B                  .END
 1191A                  
 1192A                  .INCLUDE ICM_T.asm
    1B                  .LIST
    2B                  ;############################################################################
    3B                  
    4B                  ;       Function : TELNUM_READ
    5B                  ;	根据得到的TEL_ID读出电话号码
    6B                  ;
    7B                  ;	input  : ACCH   = TEL_ID
    8B                  ;	OUTPUT : SYSTMP=the length of telephone data
    9B                  ;	
   10B                  ;	将出数据放在缓冲区 
   11B                  ;
   12B                  ;	variable:SYSTMP1 
   13B                  ;############################################################################
   14B                  TELNUM_READ:
   15B D778 B05F        	SAH	SYSTMP1			;save the TEL_ID
   16B D779 D300D77C    	BZ	ACZ,TELNUM_READ1
   17B D77B F800        	RET
   18B                  TELNUM_READ1:	
   19B D77C 8780E600    	LACL    0XE600          ; set TEL working group 0
   20B D77E B000               	SAH     CONF
   21B D77F FC000020           	CALL    DAM_BIOS
   22B                         	
   23B                  .IF	TEXT_OUTTELNUM	       	
   24B                  ;??????????????????????????
   25B                  	LACL	0X018F
   26B                  	SAH	RECE_BUF1
   27B                  	SAH	RECE_BUF
   28B                  	LACL	0X0302
   29B                  	SAH	RECE_BUF2
   30B                  	LACL	0X0504
   31B                  	SAH	RECE_BUF3
   32B                  	LACL	0X0F06
   33B                  	SAH	RECE_BUF4
   34B                  	LACL	0X3839
   35B                  	SAH	RECE_BUF5
   36B                  	LACL	0X3637
   37B                  	SAH	RECE_BUF6
   38B                  	LACL	0X3435
   39B                  	SAH	RECE_BUF7
   40B                  	LACL	0X3233
   41B                  	SAH	RECE_BUF8
   42B                  	LACL	0X3031
   43B                  	SAH	RECE_BUF9
   44B                  	LACL	0X3839
   45B                  	SAH	RECE_BUF10
   46B                  	LACL	0X3637
   47B                  	SAH	RECE_BUF11
   48B                  	LACL	0XFF35
   49B                  	adh	CLK_CN
   50B                  	SAH	RECE_BUF12
   51B                  	
   52B                  	lac	CLK_CN	;??????????????
   53B                  	adhk	1		;??????
   54B                  	andk	0x1f		;??????
   55B                  	sah	CLK_CN	;??????????????
   56B                  	
   57B                  	LAC	RECE_BUF4
   58B                  	SFR	8
   59B                  	ADHK	8
   60B                  	SAH	RECE_QUEUE
   61B                  ;?????????????????????????? 
   62B                  .ELSE      	
   63B                         	
   64B                  TELNUM_READ_LOOP:
   65B                  ;---byte 1---second
   66B D781 8780E200           	LACL	0XE200		;byte 1
   67B D783 085F        	OR	SYSTMP1
   68B D784 B000               	SAH     CONF
   69B D785 FC000020           	CALL    DAM_BIOS
   70B D787 0E01               	LAC    	RESP
   71B D788 9E08               	SFR     8
   72B D789 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
   73B D78B 0E01               	LAC     RESP
   74B D78C 9C08               	SFL	8
   75B D78D 8480008F           	ORL	0X8F
   76B D78F B069               	SAH	RECE_BUF 
   77B D790 B06A               	SAH	RECE_BUF1
   78B                  	;SAH	+,1
   79B                  ;---byte 2---minute
   80B D791 8780E200    	LACL	0XE200		;byte 2
   81B D793 085F        	OR	SYSTMP1
   82B D794 B000               	SAH	CONF
   83B D795 FC000020           	CALL    DAM_BIOS
   84B D797 0E01               	LAC    	RESP
   85B D798 9E08               	SFR     8
   86B D799 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
   87B D79B 0E01               	LAC     RESP
   88B D79C 858000FF           	ANDL    0X0FF
   89B D79E B06B               	SAH	RECE_BUF2
   90B                  	;SAH	+,1
   91B                  ;---byte 3---hour	
   92B D79F 8780E200    	LACL	0XE200		;byte 3
   93B D7A1 085F        	OR	SYSTMP1
   94B D7A2 B000               	SAH     CONF
   95B D7A3 FC000020           	CALL    DAM_BIOS
   96B D7A5 0E01               	LAC    	RESP
   97B D7A6 9E08               	SFR     8
   98B D7A7 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
   99B D7A9 0E01               	LAC     RESP
  100B D7AA 9C08               	SFL	8
  101B D7AB 8580FF00           	ANDL    0XFF00
  102B D7AD 086B               	OR	RECE_BUF2
  103B D7AE B06B        	SAH	RECE_BUF2
  104B                  	;SAH	+,1
  105B                  ;---byte 4---day	
  106B D7AF 8780E200    	LACL	0XE200		;byte 4
  107B D7B1 085F        	OR	SYSTMP1
  108B D7B2 B000               	SAH     CONF
  109B D7B3 FC000020           	CALL    DAM_BIOS
  110B D7B5 0E01               	LAC    	RESP
  111B D7B6 9E08               	SFR     8
  112B D7B7 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  113B D7B9 0E01               	LAC     RESP
  114B D7BA 858000FF           	ANDL    0X0FF
  115B D7BC B06C               	SAH	RECE_BUF3
  116B                  	;SAH	+,1
  117B                  ;---byte 5---month
  118B D7BD 8780E200    	LACL	0XE200		;byte 5
  119B D7BF 085F        	OR	SYSTMP1
  120B D7C0 B000               	SAH     CONF
  121B D7C1 FC000020           	CALL    DAM_BIOS
  122B D7C3 0E01               	LAC    	RESP
  123B D7C4 9E08               	SFR     8
  124B D7C5 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  125B D7C7 0E01               	LAC     RESP
  126B D7C8 9C08               	SFL	8
  127B D7C9 8580FF00           	ANDL    0XFF00
  128B D7CB 086C        	OR	RECE_BUF3
  129B D7CC B06C        	SAH	RECE_BUF3
  130B                  	;SAH	+,1
  131B                  ;---byte 6---year	
  132B D7CD 8780E200    	LACL	0XE200		;byte 6
  133B D7CF 085F        	OR	SYSTMP1
  134B D7D0 B000               	SAH     CONF
  135B D7D1 FC000020           	CALL    DAM_BIOS
  136B D7D3 0E01               	LAC    	RESP
  137B D7D4 9E08               	SFR     8
  138B D7D5 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  139B D7D7 0E01               	LAC     RESP
  140B D7D8 858000FF           	ANDL    0X0FF
  141B D7DA B06D               	SAH	RECE_BUF4
  142B                  	;SAH	+,1
  143B                  ;---byte 7---length
  144B D7DB 8780E200    	LACL	0XE200		;byte 7
  145B D7DD 085F        	OR	SYSTMP1
  146B D7DE B000               	SAH     CONF
  147B D7DF FC000020           	CALL    DAM_BIOS
  148B D7E1 0E01               	LAC    	RESP
  149B D7E2 9E08               	SFR     8
  150B D7E3 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  151B D7E5 0E01               	LAC     RESP
  152B D7E6 9C08               	SFL	8
  153B D7E7 8580FF00           	ANDL    0XFF00
  154B D7E9 086D               	OR	RECE_BUF4
  155B D7EA B06D        	SAH	RECE_BUF4
  156B                  	
  157B D7EB 0E01        	LAC	RESP
  158B D7EC 0108        	ADHK	8
  159B D7ED B077        	SAH	RECE_QUEUE	;发送长度
  160B                         	;SAH	+,1
  161B                  ;---byte 8---TEL NUM 1	
  162B D7EE 8780E200    	LACL	0XE200
  163B D7F0 085F        	OR	SYSTMP1
  164B D7F1 B000               	SAH     CONF
  165B D7F2 FC000020           	CALL    DAM_BIOS
  166B D7F4 0E01               	LAC    	RESP
  167B D7F5 9E08               	SFR     8
  168B D7F6 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  169B D7F8 0E01               	LAC     RESP
  170B D7F9 858000FF           	ANDL    0X0FF
  171B D7FB B06E               	SAH	RECE_BUF5
  172B                  	;SAH	+,1
  173B                  ;---byte 9---TEL NUM 2
  174B D7FC 8780E200    	LACL	0XE200
  175B D7FE 085F        	OR	SYSTMP1
  176B D7FF B000               	SAH     CONF
  177B D800 FC000020           	CALL    DAM_BIOS
  178B D802 0E01               	LAC    	RESP
  179B D803 9E08               	SFR     8
  180B D804 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  181B D806 0E01               	LAC     RESP
  182B D807 9C08               	SFL	8
  183B D808 8580FF00           	ANDL    0XFF00
  184B D80A 086E               	OR	RECE_BUF5
  185B D80B B06E        	SAH	RECE_BUF5
  186B                         	;SAH	+,1
  187B                  ;---byte 10---TEL NUM 3
  188B D80C 8780E200    	LACL	0XE200
  189B D80E 085F        	OR	SYSTMP1
  190B D80F B000               	SAH     CONF
  191B D810 FC000020           	CALL    DAM_BIOS
  192B D812 0E01               	LAC    	RESP
  193B D813 9E08               	SFR     8
  194B D814 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  195B D816 0E01               	LAC     RESP
  196B D817 858000FF           	ANDL    0X0FF
  197B D819 B06F               	SAH	RECE_BUF6
  198B                  	;SAH	+,1
  199B                  ;---byte 11---TEL NUM 4
  200B D81A 8780E200    	LACL	0XE200
  201B D81C 085F        	OR	SYSTMP1
  202B D81D B000               	SAH     CONF
  203B D81E FC000020           	CALL    DAM_BIOS
  204B D820 0E01               	LAC    	RESP
  205B D821 9E08               	SFR     8
  206B D822 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  207B D824 0E01               	LAC     RESP
  208B D825 9C08               	SFL	8
  209B D826 8580FF00           	ANDL    0XFF00
  210B D828 086F               	OR	RECE_BUF6
  211B D829 B06F        	SAH	RECE_BUF6
  212B                         	;SAH	+,1
  213B                  ;---byte 12---TEL NUM 5
  214B D82A 8780E200    	LACL	0XE200
  215B D82C 085F        	OR	SYSTMP1
  216B D82D B000               	SAH     CONF
  217B D82E FC000020           	CALL    DAM_BIOS
  218B D830 0E01               	LAC    	RESP
  219B D831 9E08               	SFR     8
  220B D832 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  221B D834 0E01               	LAC     RESP
  222B D835 858000FF           	ANDL    0X0FF
  223B D837 B070               	SAH	RECE_BUF7
  224B                  	;SAH	+,1
  225B                  ;---byte 13---TEL NUM 6
  226B D838 8780E200    	LACL	0XE200
  227B D83A 085F        	OR	SYSTMP1
  228B D83B B000               	SAH     CONF
  229B D83C FC000020           	CALL    DAM_BIOS
  230B D83E 0E01               	LAC    	RESP
  231B D83F 9E08               	SFR     8
  232B D840 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  233B D842 0E01               	LAC     RESP
  234B D843 9C08               	SFL	8
  235B D844 8580FF00           	ANDL    0XFF00
  236B D846 0870               	OR	RECE_BUF7
  237B D847 B070        	SAH	RECE_BUF7
  238B                         	;SAH	+,1
  239B                  ;---byte 14---TEL NUM 7
  240B D848 8780E200    	LACL	0XE200
  241B D84A 085F        	OR	SYSTMP1
  242B D84B B000               	SAH     CONF
  243B D84C FC000020           	CALL    DAM_BIOS
  244B D84E 0E01               	LAC    	RESP
  245B D84F 9E08               	SFR     8
  246B D850 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  247B D852 0E01               	LAC     RESP
  248B D853 858000FF           	ANDL    0X0FF
  249B D855 B071               	SAH	RECE_BUF8
  250B                  	;SAH	+,1
  251B                  ;---byte 15---TEL NUM 8
  252B D856 8780E200    	LACL	0XE200
  253B D858 085F        	OR	SYSTMP1
  254B D859 B000               	SAH     CONF
  255B D85A FC000020           	CALL    DAM_BIOS
  256B D85C 0E01               	LAC    	RESP
  257B D85D 9E08               	SFR     8
  258B D85E D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  259B D860 0E01               	LAC     RESP
  260B D861 9C08               	SFL	8
  261B D862 8580FF00           	ANDL    0XFF00
  262B D864 0871               	OR	RECE_BUF8
  263B D865 B071        	SAH	RECE_BUF8
  264B                         	;SAH	+,1
  265B                  ;---byte 16---TEL NUM 9
  266B D866 8780E200    	LACL	0XE200
  267B D868 085F        	OR	SYSTMP1
  268B D869 B000               	SAH     CONF
  269B D86A FC000020           	CALL    DAM_BIOS
  270B D86C 0E01               	LAC    	RESP
  271B D86D 9E08               	SFR     8
  272B D86E D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  273B D870 0E01               	LAC     RESP
  274B D871 858000FF           	ANDL    0X0FF
  275B D873 B072               	SAH	RECE_BUF9
  276B                  	;SAH	+,1
  277B                  ;---byte 17---TEL NUM 10
  278B D874 8780E200    	LACL	0XE200
  279B D876 085F        	OR	SYSTMP1
  280B D877 B000               	SAH     CONF
  281B D878 FC000020           	CALL    DAM_BIOS
  282B D87A 0E01               	LAC    	RESP
  283B D87B 9E08               	SFR     8
  284B D87C D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  285B D87E 0E01               	LAC     RESP
  286B D87F 9C08               	SFL	8
  287B D880 8580FF00           	ANDL    0XFF00
  288B D882 0872               	OR	RECE_BUF9
  289B D883 B072        	SAH	RECE_BUF9
  290B                         	;SAH	+,1
  291B                  ;---byte 18---TEL NUM 11
  292B D884 8780E200    	LACL	0XE200
  293B D886 085F        	OR	SYSTMP1
  294B D887 B000               	SAH     CONF
  295B D888 FC000020           	CALL    DAM_BIOS
  296B D88A 0E01               	LAC    	RESP
  297B D88B 9E08               	SFR     8
  298B D88C D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  299B D88E 0E01               	LAC     RESP
  300B D88F 858000FF           	ANDL    0X0FF
  301B D891 B073               	SAH	RECE_BUF10
  302B                  	;SAH	+,1
  303B                  ;---byte 19---TEL NUM 12
  304B D892 8780E200    	LACL	0XE200
  305B D894 085F        	OR	SYSTMP1
  306B D895 B000               	SAH     CONF
  307B D896 FC000020           	CALL    DAM_BIOS
  308B D898 0E01               	LAC    	RESP
  309B D899 9E08               	SFR     8
  310B D89A D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  311B D89C 0E01               	LAC     RESP
  312B D89D 9C08               	SFL	8
  313B D89E 8580FF00           	ANDL    0XFF00
  314B D8A0 0873               	OR	RECE_BUF10
  315B D8A1 B073        	SAH	RECE_BUF10
  316B                         	;SAH	+,1
  317B                  ;---byte 20---TEL NUM 13
  318B D8A2 8780E200    	LACL	0XE200
  319B D8A4 085F        	OR	SYSTMP1
  320B D8A5 B000               	SAH     CONF
  321B D8A6 FC000020           	CALL    DAM_BIOS
  322B D8A8 0E01               	LAC    	RESP
  323B D8A9 9E08               	SFR     8
  324B D8AA D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  325B D8AC 0E01               	LAC     RESP
  326B D8AD 858000FF           	ANDL    0X0FF
  327B D8AF B074               	SAH	RECE_BUF11
  328B                  	;SAH	+,1
  329B                  ;---byte 21---TEL NUM 14
  330B D8B0 8780E200    	LACL	0XE200
  331B D8B2 085F        	OR	SYSTMP1
  332B D8B3 B000               	SAH     CONF
  333B D8B4 FC000020           	CALL    DAM_BIOS
  334B D8B6 0E01               	LAC    	RESP
  335B D8B7 9E08               	SFR     8
  336B D8B8 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  337B D8BA 0E01               	LAC     RESP
  338B D8BB 9C08               	SFL	8
  339B D8BC 8580FF00           	ANDL    0XFF00
  340B D8BE 0874               	OR	RECE_BUF11
  341B D8BF B074        	SAH	RECE_BUF11
  342B                  	;SAH	+,1
  343B                  ;---byte 22---TEL NUM 15
  344B D8C0 8780E200    	LACL	0XE200
  345B D8C2 085F        	OR	SYSTMP1
  346B D8C3 B000               	SAH     CONF
  347B D8C4 FC000020           	CALL    DAM_BIOS
  348B D8C6 0E01               	LAC    	RESP
  349B D8C7 9E08               	SFR     8
  350B D8C8 D300D8DE           	BZ      ACZ,TELNUM_READ_EXIT
  351B D8CA 0E01               	LAC     RESP
  352B D8CB 858000FF           	ANDL    0X0FF
  353B D8CD B075               	SAH	RECE_BUF12
  354B                  	;SAH	+,1
  355B                  ;---byte 23---TEL NUM 16
  356B D8CE 8780E200    	LACL	0XE200
  357B D8D0 085F        	OR	SYSTMP1
  358B D8D1 B000               	SAH     CONF
  359B D8D2 FC000020           	CALL    DAM_BIOS
  360B D8D4 0E01               	LAC    	RESP
  361B D8D5 9E08               	SFR     8
  362B D8D6 D300D8DE    	BZ      ACZ,TELNUM_READ_EXIT
  363B D8D8 0E01               	LAC     RESP
  364B D8D9 9C08               	SFL	8
  365B D8DA 8580FF00           	ANDL    0XFF00
  366B D8DC 0875               	OR	RECE_BUF12
  367B D8DD B075        	SAH	RECE_BUF12
  368B                  	;SAH	+,1
  369B                  TELNUM_READ_EXIT:
  370B D8DE 8780E300    	LACL	0XE300
  371B D8E0 B000               	SAH     CONF
  372B D8E1 FC000020           	CALL    DAM_BIOS 
  373B                  
  374B                  .ENDIF       	
  375B D8E3 0F01               	LACK	1
  376B                  ;-----------------------------------------
  377B                  	
  378B D8E4 F800        	RET
  379B                  
  380B                  ;############################################################################
  381B                  ;
  382B                  ;       Function : TELNUM_DEL
  383B                  ;	delete the specific telehone number
  384B                  ;
  385B                  ;	INPUT  : ACCH	= TEL_ID you will delete
  386B                  ;	OUTPUT :	 
  387B                  ;############################################################################
  388B                  TELNUM_DEL:
  389B D8E5 858000FF    	ANDL	0XFF
  390B D8E7 DB00D8F0    	BS	ACZ,TELNUM_DEL_EXIT
  391B D8E9 8480E500    	ORL	0XE500
  392B D8EB B000        	SAH	CONF
  393B D8EC FC000020    	CALL	DAM_BIOS
  394B                  	
  395B D8EE FC00CAC9    	CALL	TEL_GC_CHK
  396B                  TELNUM_DEL_EXIT:		
  397B D8F0 F800        	RET
  398B                  ;############################################################################
  399B                  ;
  400B                  ;       Function : TELNUMALL_DEL
  401B                  ;	delete the all telehone number that mapping messages
  402B                  ;
  403B                  ;	INPUT  : no
  404B                  ;	OUTPUT : no
  405B                  ;	variable: SYSTMP
  406B                  ;		 
  407B                  ;############################################################################
  408B                  TELNUMALL_DEL:
  409B                  	
  410B D8F1 8780E600    	LACL	0XE600		;set the TEL working group
  411B D8F3 B000        	SAH	CONF
  412B D8F4 FC000020    	CALL	DAM_BIOS
  413B                  	
  414B D8F6 8780E401    	LACL	0XE401		;Get the total TEL in working group
  415B D8F8 B000        	SAH	CONF
  416B D8F9 FC000020    	CALL	DAM_BIOS
  417B D8FB 0E01        	LAC	RESP
  418B D8FC 85800F00    	ANDL	0X0F00
  419B D8FE D300D928    	BZ	ACZ,TELNUMALL_DEL_EXIT	;no tel-number?
  420B                  	
  421B D900 0E01        	LAC	RESP
  422B D901 B064        	SAH	SYSTMP
  423B D902 DB00D928    	BS	ACZ,TELNUMALL_DEL_EXIT	;no tel-number?
  424B                  	
  425B                  	;LACL	0XD000
  426B                  	;SAH	CONF
  427B                  	;CALL	DAM_BIOS
  428B                  	
  429B                  	;LACL    0X3000
  430B                          ;SAH     CONF
  431B                          ;CALL    DAM_BIOS
  432B                          ;LAC     RESP
  433B                          ;SAH     MSG_T		;save the number of TOTAL messages
  434B D904 FC00C108    	CALL	MSG_CHK
  435B                  TELNUMALL_DEL_LOOP:
  436B D906 0E64        	LAC	SYSTMP
  437B D907 DB00D928    	BS	ACZ,TELNUMALL_DEL_EXIT
  438B                  	
  439B D909 8780EA00    	LACL	0XEA00
  440B D90B 0864        	OR	SYSTMP
  441B D90C B000        	SAH	CONF
  442B D90D FC000020    	CALL	DAM_BIOS
  443B D90F 0E01        	LAC	RESP
  444B D910 9E08        	SFR	8
  445B D911 D300D928    	BZ	ACZ,TELNUMALL_DEL_EXIT
  446B D913 0E01        	LAC	RESP
  447B D914 B017        	SAH	FILE_ID
  448B                  	
  449B D915 FC00D929    	CALL	FIND_ICM
  450B D917 D300D923    	BZ	ACZ,TELNUMALL_DEL_LOOP_1
  451B                  		
  452B D919 8780E500    	LACL	0XE500
  453B D91B 0864        	OR	SYSTMP
  454B D91C B000        	SAH	CONF
  455B D91D FC000020    	CALL	DAM_BIOS
  456B                  	
  457B D91F FC00CAC9    	CALL	TEL_GC_CHK
  458B D921 FC00CA9E    	CALL	GC_CHK
  459B                  TELNUMALL_DEL_LOOP_1:	
  460B D923 0E64        	LAC	SYSTMP
  461B D924 0501        	SBHK	1
  462B D925 B064        	SAH	SYSTMP
  463B D926 DF00D906    	BS	B1,TELNUMALL_DEL_LOOP
  464B                  TELNUMALL_DEL_EXIT:		
  465B D928 F800        	RET
  466B                  ;############################################################################
  467B                  ;	Fumction : FIND_ICM
  468B                  ;		从MSG_T个message中找usr data0=ICM的message 
  469B                  ;		input : MSG_T = the total message in current mailbox
  470B                  ;			FILE_ID=the specific usr data0
  471B                  ;		output: ACCH = the message you find(零表示没找到)
  472B                  ;############################################################################
  473B                  FIND_ICM:
  474B D929 0E16        	LAC	MSG_T
  475B D92A B014        	SAH	MSG_ID
  476B                  	
  477B                  FIND_ICM_1:
  478B D92B 0E14        	LAC	MSG_ID
  479B D92C DB00D93D    	BS	ACZ,FIND_ICM_2		;not find
  480B                  		
  481B D92E 8780A900    	LACL	0XA900 			;GET USER INDEX DATA0
  482B D930 0814        	OR	MSG_ID
  483B D931 B000                SAH     CONF
  484B D932 FC000020            CALL    DAM_BIOS		
  485B D934 0E01        	LAC     RESP
  486B D935 0417        	SBH	FILE_ID
  487B D936 DB00D93D    	BS	ACZ,FIND_ICM_2
  488B                  	
  489B D938 0E14        	LAC	MSG_ID
  490B D939 0501        	SBHK	1
  491B D93A B014        	SAH	MSG_ID
  492B D93B DF00D92B    	BS	B1,FIND_ICM_1
  493B                  FIND_ICM_2:
  494B D93D 0E14        	LAC	MSG_ID
  495B                  	
  496B D93E F800        	RET
  497B                  ;############################################################################
  498B                  ;
  499B                  ;	Function : GET_MSGMSG
  500B                  ;	save the VP message number in working group
  501B                  ;
  502B                  ;	将相应MSG_ID数据(暂存)写入临时RAM存贮区
  503B                  ;	input  : ACCH = MSG_ID
  504B                  ;	output :  SYSTMP0,SYSTMP1,SYSTMP2,SYSTMP3
  505B                  ;	variable :SYSTMP
  506B                  ;
  507B                  ;############################################################################
  508B                  GET_MSGMSG:
  509B D93F B064        	SAH	SYSTMP
  510B D940 D300D943    	BZ	ACZ,GET_MSGMSG1
  511B D942 F800        	RET
  512B                  GET_MSGMSG1:
  513B D943 0E64        	LAC	SYSTMP
  514B D944 0B7F        	ANDK	0X7F
  515B D945 8480A000    	ORL	0XA000
  516B D947 B000        	SAH	CONF
  517B D948 FC000020    	CALL	DAM_BIOS
  518B D94A 0E01        	LAC	RESP
  519B D94B 0B7F        	ANDK	0X7F
  520B D94C B05E        	SAH	SYSTMP0		;second
  521B                  	
  522B D94D 0E64        	LAC	SYSTMP
  523B D94E 0B7F        	ANDK	0X7F
  524B D94F 8480A100    	ORL	0XA100
  525B D951 B000        	SAH	CONF
  526B D952 FC000020    	CALL	DAM_BIOS
  527B D954 0E01        	LAC	RESP
  528B D955 9C08        	SFL	8
  529B D956 8580FF00    	ANDL	0XFF00
  530B D958 085E        	OR	SYSTMP0
  531B D959 B05E        	SAH	SYSTMP0		;minute
  532B                  ;---	
  533B D95A 0E64        	LAC	SYSTMP
  534B D95B 0B7F        	ANDK	0X7F
  535B D95C 8480A200    	ORL	0XA200
  536B D95E B000        	SAH	CONF
  537B D95F FC000020    	CALL	DAM_BIOS
  538B D961 0E01        	LAC	RESP
  539B D962 0B7F        	ANDK	0X7F
  540B D963 B05F        	SAH	SYSTMP1		;hour
  541B                  	
  542B D964 0E64        	LAC	SYSTMP
  543B D965 0B7F        	ANDK	0X7F
  544B D966 8480AE00    	ORL	0XAE00
  545B D968 B000        	SAH	CONF
  546B D969 FC000020    	CALL	DAM_BIOS
  547B D96B 0E01        	LAC	RESP
  548B D96C 9C08        	SFL	8
  549B D96D 8580FF00    	ANDL	0XFF00
  550B D96F 085F        	OR	SYSTMP1
  551B D970 B05F        	SAH	SYSTMP1		;day
  552B                  ;---	
  553B D971 0E64        	LAC	SYSTMP
  554B D972 0B7F        	ANDK	0X7F
  555B D973 8480AD00    	ORL	0XAD00
  556B D975 B000        	SAH	CONF
  557B D976 FC000020    	CALL	DAM_BIOS
  558B D978 0E01        	LAC	RESP
  559B D979 0B7F        	ANDK	0X7F
  560B D97A B060        	SAH	SYSTMP2		;month
  561B                  	
  562B D97B 0E64        	LAC	SYSTMP
  563B D97C 0B7F        	ANDK	0X7F
  564B D97D 8480AC00    	ORL	0XAC00
  565B D97F B000        	SAH	CONF
  566B D980 FC000020    	CALL	DAM_BIOS
  567B D982 0E01        	LAC	RESP
  568B D983 9C08        	SFL	8
  569B D984 8580FF00    	ANDL	0XFF00
  570B D986 0860        	OR	SYSTMP2
  571B D987 B060        	SAH	SYSTMP2		;year
  572B                  ;---	
  573B                  
  574B D988 F800        	RET
  575B                  ;############################################################################
  576B                  ;
  577B                  ;	Function : WRITE_MEMOMSG
  578B                  ;	save the VP message number in working group
  579B                  ;
  580B                  ;	将相应MSG_ID数据(暂存RAM中)写入临时FLASH存贮区
  581B                  ;	input  : SYSTMP0,SYSTMP1,SYSTMP2,SYSTMP3,SYSTMP4,SYSTMP5
  582B                  ;	output :  
  583B                  ;	
  584B                  ;############################################################################
  585B                  WRITE_MEMOMSG:
  586B D989 8780E605    	LACL	0XE605
  587B D98B B000        	SAH	CONF
  588B D98C FC000020    	CALL	DAM_BIOS
  589B                  ;---	
  590B D98E 0E5E        	LAC	SYSTMP0
  591B D98F 0B7F        	ANDK	0X7F
  592B D990 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  593B D992 8480E000    	ORL	0XE000
  594B D994 B000        	SAH	CONF
  595B D995 FC000020    	CALL	DAM_BIOS	;second
  596B                  	
  597B D997 0E5E        	LAC	SYSTMP0
  598B D998 9E08        	SFR	8
  599B D999 0B7F        	ANDK	0X7F
  600B D99A FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  601B D99C 8480E000    	ORL	0XE000
  602B D99E B000        	SAH	CONF
  603B D99F FC000020    	CALL	DAM_BIOS	;minute
  604B                  ;---	
  605B D9A1 0E5F        	LAC	SYSTMP1
  606B D9A2 0B7F        	ANDK	0X7F
  607B D9A3 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  608B D9A5 8480E000    	ORL	0XE000
  609B D9A7 B000        	SAH	CONF
  610B D9A8 FC000020    	CALL	DAM_BIOS	;hour
  611B                  	
  612B D9AA 0E5F        	LAC	SYSTMP1
  613B D9AB 9E08        	SFR	8
  614B D9AC 0B7F        	ANDK	0X7F
  615B D9AD FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  616B D9AF 8480E000    	ORL	0XE000
  617B D9B1 B000        	SAH	CONF
  618B D9B2 FC000020    	CALL	DAM_BIOS	;day
  619B                  ;---	
  620B D9B4 0E60        	LAC	SYSTMP2
  621B D9B5 0B7F        	ANDK	0X7F
  622B D9B6 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  623B D9B8 8480E000    	ORL	0XE000
  624B D9BA B000        	SAH	CONF
  625B D9BB FC000020    	CALL	DAM_BIOS	;month
  626B                  	
  627B D9BD 0E60        	LAC	SYSTMP2
  628B D9BE 9E08        	SFR	8
  629B D9BF 0B7F        	ANDK	0X7F
  630B D9C0 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  631B D9C2 8480E000    	ORL	0XE000
  632B D9C4 B000        	SAH	CONF
  633B D9C5 FC000020    	CALL	DAM_BIOS	;year
  634B                  ;---
  635B D9C7 8780E004    	LACL	0XE004
  636B D9C9 B000        	SAH	CONF
  637B D9CA FC000020    	CALL	DAM_BIOS	;length
  638B                  	
  639B D9CC 8780E04D    	LACL	0XE04D
  640B D9CE B000        	SAH	CONF
  641B D9CF FC000020    	CALL	DAM_BIOS	;M
  642B                  	
  643B D9D1 8780E045    	LACL	0XE045
  644B D9D3 B000        	SAH	CONF
  645B D9D4 FC000020    	CALL	DAM_BIOS	;E
  646B                  	
  647B D9D6 8780E04D    	LACL	0XE04D
  648B D9D8 B000        	SAH	CONF
  649B D9D9 FC000020    	CALL	DAM_BIOS	;M
  650B                  	
  651B D9DB 8780E04F    	LACL	0XE04F
  652B D9DD B000        	SAH	CONF
  653B D9DE FC000020    	CALL	DAM_BIOS	;O
  654B                  	
  655B D9E0 8780E100    	LACL	0XE100
  656B D9E2 B000        	SAH	CONF
  657B D9E3 FC000020    	CALL	DAM_BIOS	;end write
  658B                  	
  659B D9E5 FC00CAC9    	CALL	TEL_GC_CHK
  660B                  WRITE_MEMOMSG_END:	
  661B D9E7 F800        	RET
  662B                  ;############################################################################
  663B                  ;
  664B                  ;	Function : WRITE_ICMMSG
  665B                  ;	save the VP message number in working group
  666B                  ;
  667B                  ;	将相应MSG_ID数据(暂存RAM中)写入临时FLASH存贮区
  668B                  ;	input  : SYSTMP0,SYSTMP1,SYSTMP2,SYSTMP3,SYSTMP4,SYSTMP5
  669B                  ;	output : ACCH = 0/1 ==>NO/have TEL NUM 
  670B                  ;	
  671B                  ;############################################################################
  672B                  WRITE_ICMMSG:
  673B D9E8 8780E605    	LACL	0XE605
  674B D9EA B000        	SAH	CONF
  675B D9EB FC000020    	CALL	DAM_BIOS
  676B                  	
  677B D9ED FC00DC09    	CALL	GET_TELT
  678B D9EF DB00D9F2    	BS	ACZ,WRITE_ICMMSG1
  679B                  	
  680B D9F1 F800        	RET
  681B                  WRITE_ICMMSG1:
  682B                  ;---	
  683B D9F2 0E5E        	LAC	SYSTMP0
  684B D9F3 0B7F        	ANDK	0X7F
  685B D9F4 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  686B D9F6 8480E000    	ORL	0XE000
  687B D9F8 B000        	SAH	CONF
  688B D9F9 FC000020    	CALL	DAM_BIOS	;second
  689B                  	
  690B D9FB 0E5E        	LAC	SYSTMP0
  691B D9FC 9E08        	SFR	8
  692B D9FD 0B7F        	ANDK	0X7F
  693B D9FE FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  694B DA00 8480E000    	ORL	0XE000
  695B DA02 B000        	SAH	CONF
  696B DA03 FC000020    	CALL	DAM_BIOS	;minute
  697B                  ;---	
  698B DA05 0E5F        	LAC	SYSTMP1
  699B DA06 0B7F        	ANDK	0X7F
  700B DA07 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  701B DA09 8480E000    	ORL	0XE000
  702B DA0B B000        	SAH	CONF
  703B DA0C FC000020    	CALL	DAM_BIOS	;hour
  704B                  	
  705B DA0E 0E5F        	LAC	SYSTMP1
  706B DA0F 9E08        	SFR	8
  707B DA10 0B7F        	ANDK	0X7F
  708B DA11 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  709B DA13 8480E000    	ORL	0XE000
  710B DA15 B000        	SAH	CONF
  711B DA16 FC000020    	CALL	DAM_BIOS	;day
  712B                  ;---	
  713B DA18 0E60        	LAC	SYSTMP2
  714B DA19 0B7F        	ANDK	0X7F
  715B DA1A FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  716B DA1C 8480E000    	ORL	0XE000
  717B DA1E B000        	SAH	CONF
  718B DA1F FC000020    	CALL	DAM_BIOS	;month
  719B                  	
  720B DA21 0E60        	LAC	SYSTMP2
  721B DA22 9E08        	SFR	8
  722B DA23 0B7F        	ANDK	0X7F
  723B DA24 FC00D28E    	CALL	HEX_DGT	;!!!!!!!!!
  724B DA26 8480E000    	ORL	0XE000
  725B DA28 B000        	SAH	CONF
  726B DA29 FC000020    	CALL	DAM_BIOS	;year
  727B                  ;---
  728B DA2B 8780E001    	LACL	0XE001
  729B DA2D B000        	SAH	CONF
  730B DA2E FC000020    	CALL	DAM_BIOS	;length
  731B                  	
  732B DA30 8780E020    	LACL	0XE020
  733B DA32 B000        	SAH	CONF
  734B DA33 FC000020    	CALL	DAM_BIOS	;SPACE
  735B                  
  736B DA35 8780E100    	LACL	0XE100
  737B DA37 B000        	SAH	CONF
  738B DA38 FC000020    	CALL	DAM_BIOS	;end write
  739B                  	
  740B DA3A FC00CAC9    	CALL	TEL_GC_CHK
  741B                  WRITE_ICMMSG_END:	
  742B DA3C 0F00        	LACK	0
  743B                  	
  744B DA3D F800        	RET
  745B                  ;############################################################################
  746B                  ;
  747B                  ;	Function : TELNUM_WRITE
  748B                  ;	save the telephone number in working group
  749B                  ;
  750B                  ;	将刚接收到的数据(暂存)写入FLASH
  751B                  ;	input  : RECE_BUF1 = the first addr of the TEL_NUM
  752B                  ;	output : ACCH = no
  753B                  ;	variable : SYSTMP
  754B                  ;
  755B                  ;############################################################################
  756B                  TELNUM_WRITE:
  757B DA3E 8780E605    	LACL	0XE605
  758B DA40 B000        	SAH	CONF
  759B DA41 FC000020    	CALL	DAM_BIOS
  760B                  
  761B                  TELNUM_WRITE_LOOP:
  762B                  .if	TEXT_WTELNUM
  763B                  	LACL	0X018F
  764B                  	SAH	RECE_BUF1
  765B                  	LACL	0X0302
  766B                  	SAH	RECE_BUF2
  767B                  	LACL	0X0504
  768B                  	SAH	RECE_BUF3
  769B                  	LACL	0X0806
  770B                  	SAH	RECE_BUF4
  771B                  	LACL	0X3839
  772B                  	SAH	RECE_BUF5
  773B                  	LACL	0X3637
  774B                  	SAH	RECE_BUF6
  775B                  	LACL	0X3435
  776B                  	SAH	RECE_BUF7
  777B                  	LACL	0X3233
  778B                  	adh	CLK_CN
  779B                  	SAH	RECE_BUF8
  780B                  	
  781B                  	lac	CLK_CN	;??????????????
  782B                  	adhl	0x0101		;??????
  783B                  	andl	0x0707		;??????
  784B                  	sah	CLK_CN	;??????????????
  785B                  .endif	
  786B                  ;---byte 1---second
  787B DA43 0E6A        	LAC	RECE_BUF1
  788B DA44 9E08        	SFR	8
  789B DA45 858000FF    	ANDL	0X0FF
  790B DA47 FC00D2A3    	CALL	DGT_HEX
  791B DA49 B002        	SAH	TMR_SEC		;秒
  792B                  
  793B DA4A 0E6A        	LAC	RECE_BUF1
  794B DA4B 9E08        	SFR	8
  795B DA4C 858000FF    	ANDL	0X0FF
  796B DA4E 8480E000    	ORL	0XE000
  797B DA50 B000        	SAH	CONF
  798B DA51 FC000020    	CALL	DAM_BIOS
  799B                  ;---byte 2---minute	----------
  800B DA53 0E6B        	LAC	RECE_BUF2
  801B DA54 858000FF    	ANDL	0X0FF
  802B DA56 FC00D2A3    	CALL	DGT_HEX
  803B DA58 B003        	SAH	TMR_MIN		;分
  804B                  	
  805B DA59 0E6B        	LAC	RECE_BUF2
  806B DA5A 858000FF    	ANDL	0X0FF
  807B DA5C 8480E000    	ORL	0XE000
  808B DA5E B000        	SAH	CONF
  809B DA5F FC000020    	CALL	DAM_BIOS
  810B                  ;---byte 3---hour
  811B DA61 0E6B        	LAC	RECE_BUF2
  812B DA62 9E08        	SFR	8
  813B DA63 858000FF    	ANDL	0X0FF
  814B DA65 FC00D2A3    	CALL	DGT_HEX
  815B DA67 B004        	SAH	TMR_HOUR	;时
  816B                  	
  817B DA68 0E6B        	LAC	RECE_BUF2
  818B DA69 9E08        	SFR	8
  819B DA6A 858000FF    	ANDL	0X0FF
  820B DA6C 8480E000    	ORL	0XE000
  821B DA6E B000        	SAH	CONF
  822B DA6F FC000020    	CALL	DAM_BIOS
  823B                  ;---byte 4---day	----------
  824B DA71 0E6C        	LAC	RECE_BUF3
  825B DA72 858000FF    	ANDL	0X0FF
  826B DA74 FC00D2A3    	CALL	DGT_HEX
  827B DA76 B009        	SAH	TMR_DAY		;日
  828B                  
  829B DA77 0E6C        	LAC	RECE_BUF3
  830B DA78 858000FF    	ANDL	0X0FF
  831B DA7A 8480E000    	ORL	0XE000
  832B DA7C B000        	SAH	CONF
  833B DA7D FC000020    	CALL	DAM_BIOS
  834B                  ;---byte 5---month
  835B DA7F 0E6C        	LAC	RECE_BUF3
  836B DA80 9E08        	SFR	8
  837B DA81 858000FF    	ANDL	0X0FF
  838B DA83 FC00D2A3    	CALL	DGT_HEX
  839B DA85 B00A        	SAH	TMR_MONTH	;月
  840B                  	
  841B DA86 0E6C        	LAC	RECE_BUF3
  842B DA87 9E08        	SFR	8
  843B DA88 858000FF    	ANDL	0X0FF
  844B DA8A 8480E000    	ORL	0XE000
  845B DA8C B000        	SAH	CONF
  846B DA8D FC000020    	CALL	DAM_BIOS
  847B                  ;---byte 6---year-----------------
  848B DA8F 0E6D        	LAC	RECE_BUF4
  849B DA90 858000FF    	ANDL	0X0FF
  850B DA92 FC00D2A3    	CALL	DGT_HEX
  851B DA94 B00B        	SAH	TMR_YEAR	;年
  852B                  
  853B DA95 0E6D        	LAC	RECE_BUF4
  854B DA96 858000FF    	ANDL	0X0FF
  855B DA98 8480E000    	ORL	0XE000
  856B DA9A B000        	SAH	CONF
  857B DA9B FC000020    	CALL	DAM_BIOS
  858B                  ;---byte 7---length	
  859B DA9D 0E6D        	LAC	RECE_BUF4
  860B DA9E 9E08        	SFR	8
  861B DA9F 858000FF    	ANDL	0X0FF
  862B DAA1 B077        	SAH	RECE_QUEUE		;保存长度用于后于后续判断
  863B DAA2 0103        	ADHK	3		;???????????????
  864B DAA3 8480E000    	ORL	0XE000
  865B DAA5 B000        	SAH	CONF
  866B DAA6 FC000020    	CALL	DAM_BIOS
  867B                  ;---byte 8---TEL NUM 1	----------
  868B DAA8 0E77        	LAC	RECE_QUEUE
  869B DAA9 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  870B                  	
  871B                  	
  872B DAAB 8780E043    	LACL	0XE043		;C?????????????
  873B DAAD B000        	SAH	CONF
  874B DAAE FC000020    	CALL	DAM_BIOS
  875B DAB0 8780E049    	LACL	0XE049		;I?????????????
  876B DAB2 B000        	SAH	CONF
  877B DAB3 FC000020    	CALL	DAM_BIOS
  878B DAB5 8780E044    	LACL	0XE044		;D?????????????
  879B DAB7 B000        	SAH	CONF
  880B DAB8 FC000020    	CALL	DAM_BIOS
  881B                  	
  882B DABA 0E6E        	LAC	RECE_BUF5
  883B DABB 858000FF    	ANDL	0X0FF
  884B DABD 8480E000    	ORL	0XE000
  885B DABF B000        	SAH	CONF
  886B DAC0 FC000020    	CALL	DAM_BIOS
  887B                  	
  888B DAC2 0E77        	LAC	RECE_QUEUE
  889B DAC3 0501        	SBHK	1
  890B DAC4 B077        	SAH	RECE_QUEUE
  891B                  ;---byte 9---TEL NUM 2
  892B DAC5 0E77        	LAC	RECE_QUEUE
  893B DAC6 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  894B DAC8 0E6E        	LAC	RECE_BUF5
  895B DAC9 9E08        	SFR	8
  896B DACA 858000FF    	ANDL	0X0FF
  897B DACC 8480E000    	ORL	0XE000
  898B DACE B000        	SAH	CONF
  899B DACF FC000020    	CALL	DAM_BIOS
  900B                  	
  901B DAD1 0E77        	LAC	RECE_QUEUE
  902B DAD2 0501        	SBHK	1
  903B DAD3 B077        	SAH	RECE_QUEUE
  904B                  ;---byte 10---TEL NUM 3
  905B DAD4 0E77        	LAC	RECE_QUEUE
  906B DAD5 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  907B DAD7 0E6F        	LAC	RECE_BUF6
  908B DAD8 858000FF    	ANDL	0X0FF
  909B DADA 8480E000    	ORL	0XE000
  910B DADC B000        	SAH	CONF
  911B DADD FC000020    	CALL	DAM_BIOS
  912B                  	
  913B DADF 0E77        	LAC	RECE_QUEUE
  914B DAE0 0501        	SBHK	1
  915B DAE1 B077        	SAH	RECE_QUEUE
  916B                  ;---byte 11---TEL NUM 4
  917B DAE2 0E77        	LAC	RECE_QUEUE
  918B DAE3 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  919B DAE5 0E6F        	LAC	RECE_BUF6
  920B DAE6 9E08        	SFR	8
  921B DAE7 858000FF    	ANDL	0X0FF
  922B DAE9 8480E000    	ORL	0XE000
  923B DAEB B000        	SAH	CONF
  924B DAEC FC000020    	CALL	DAM_BIOS
  925B                  	
  926B DAEE 0E77        	LAC	RECE_QUEUE
  927B DAEF 0501        	SBHK	1
  928B DAF0 B077        	SAH	RECE_QUEUE
  929B                  ;---byte 12---TEL NUM 5
  930B DAF1 0E77        	LAC	RECE_QUEUE
  931B DAF2 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  932B DAF4 0E70        	LAC	RECE_BUF7
  933B DAF5 858000FF    	ANDL	0X0FF
  934B DAF7 8480E000    	ORL	0XE000
  935B DAF9 B000        	SAH	CONF
  936B DAFA FC000020    	CALL	DAM_BIOS
  937B                  	
  938B DAFC 0E77        	LAC	RECE_QUEUE
  939B DAFD 0501        	SBHK	1
  940B DAFE B077        	SAH	RECE_QUEUE
  941B                  ;---byte 13---TEL NUM 6
  942B DAFF 0E77        	LAC	RECE_QUEUE
  943B DB00 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  944B DB02 0E70        	LAC	RECE_BUF7
  945B DB03 9E08        	SFR	8
  946B DB04 858000FF    	ANDL	0X0FF
  947B DB06 8480E000    	ORL	0XE000
  948B DB08 B000        	SAH	CONF
  949B DB09 FC000020    	CALL	DAM_BIOS
  950B                  	
  951B DB0B 0E77        	LAC	RECE_QUEUE
  952B DB0C 0501        	SBHK	1
  953B DB0D B077        	SAH	RECE_QUEUE
  954B                  ;---byte 14---TEL NUM 7
  955B DB0E 0E77        	LAC	RECE_QUEUE
  956B DB0F DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  957B DB11 0E71        	LAC	RECE_BUF8
  958B DB12 858000FF    	ANDL	0X0FF
  959B DB14 8480E000    	ORL	0XE000
  960B DB16 B000        	SAH	CONF
  961B DB17 FC000020    	CALL	DAM_BIOS
  962B                  	
  963B DB19 0E77        	LAC	RECE_QUEUE
  964B DB1A 0501        	SBHK	1
  965B DB1B B077        	SAH	RECE_QUEUE
  966B                  ;---byte 15---TEL NUM 8
  967B DB1C 0E77        	LAC	RECE_QUEUE
  968B DB1D DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  969B DB1F 0E71        	LAC	RECE_BUF8
  970B DB20 9E08        	SFR	8
  971B DB21 858000FF    	ANDL	0X0FF
  972B DB23 8480E000    	ORL	0XE000
  973B DB25 B000        	SAH	CONF
  974B DB26 FC000020    	CALL	DAM_BIOS
  975B                  	
  976B DB28 0E77        	LAC	RECE_QUEUE
  977B DB29 0501        	SBHK	1
  978B DB2A B077        	SAH	RECE_QUEUE
  979B                  ;---byte 16---TEL NUM 9
  980B DB2B 0E77        	LAC	RECE_QUEUE
  981B DB2C DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  982B DB2E 0E72        	LAC	RECE_BUF9
  983B DB2F 858000FF    	ANDL	0X0FF
  984B DB31 8480E000    	ORL	0XE000
  985B DB33 B000        	SAH	CONF
  986B DB34 FC000020    	CALL	DAM_BIOS
  987B                  	
  988B DB36 0E77        	LAC	RECE_QUEUE
  989B DB37 0501        	SBHK	1
  990B DB38 B077        	SAH	RECE_QUEUE
  991B                  ;---byte 17---TEL NUM 10
  992B DB39 0E77        	LAC	RECE_QUEUE
  993B DB3A DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
  994B DB3C 0E72        	LAC	RECE_BUF9
  995B DB3D 9E08        	SFR	8
  996B DB3E 858000FF    	ANDL	0X0FF
  997B DB40 8480E000    	ORL	0XE000
  998B DB42 B000        	SAH	CONF
  999B DB43 FC000020    	CALL	DAM_BIOS
 1000B                  	
 1001B DB45 0E77        	LAC	RECE_QUEUE
 1002B DB46 0501        	SBHK	1
 1003B DB47 B077        	SAH	RECE_QUEUE
 1004B                  ;---byte 18---TEL NUM 11
 1005B DB48 0E77        	LAC	RECE_QUEUE
 1006B DB49 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1007B DB4B 0E73        	LAC	RECE_BUF10
 1008B DB4C 858000FF    	ANDL	0X0FF
 1009B DB4E 8480E000    	ORL	0XE000
 1010B DB50 B000        	SAH	CONF
 1011B DB51 FC000020    	CALL	DAM_BIOS
 1012B                  	
 1013B DB53 0E77        	LAC	RECE_QUEUE
 1014B DB54 0501        	SBHK	1
 1015B DB55 B077        	SAH	RECE_QUEUE
 1016B                  ;---byte 19---TEL NUM 12
 1017B DB56 0E77        	LAC	RECE_QUEUE
 1018B DB57 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1019B DB59 0E73        	LAC	RECE_BUF10
 1020B DB5A 9E08        	SFR	8
 1021B DB5B 858000FF    	ANDL	0X0FF
 1022B DB5D 8480E000    	ORL	0XE000
 1023B DB5F B000        	SAH	CONF
 1024B DB60 FC000020    	CALL	DAM_BIOS
 1025B                  	
 1026B DB62 0E77        	LAC	RECE_QUEUE
 1027B DB63 0501        	SBHK	1
 1028B DB64 B077        	SAH	RECE_QUEUE
 1029B                  ;---byte 20---TEL NUM 13
 1030B DB65 0E77        	LAC	RECE_QUEUE
 1031B DB66 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1032B DB68 0E74        	LAC	RECE_BUF11
 1033B DB69 858000FF    	ANDL	0X0FF
 1034B DB6B 8480E000    	ORL	0XE000
 1035B DB6D B000        	SAH	CONF
 1036B DB6E FC000020    	CALL	DAM_BIOS
 1037B                  	
 1038B DB70 0E77        	LAC	RECE_QUEUE
 1039B DB71 0501        	SBHK	1
 1040B DB72 B077        	SAH	RECE_QUEUE
 1041B                  ;---byte 21---TEL NUM 14
 1042B DB73 0E77        	LAC	RECE_QUEUE
 1043B DB74 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1044B DB76 0E74        	LAC	RECE_BUF11
 1045B DB77 9E08        	SFR	8
 1046B DB78 858000FF    	ANDL	0X0FF
 1047B DB7A 8480E000    	ORL	0XE000
 1048B DB7C B000        	SAH	CONF
 1049B DB7D FC000020    	CALL	DAM_BIOS
 1050B                  	
 1051B DB7F 0E77        	LAC	RECE_QUEUE
 1052B DB80 0501        	SBHK	1
 1053B DB81 B077        	SAH	RECE_QUEUE
 1054B                  ;---byte 22---TEL NUM 15
 1055B DB82 0E77        	LAC	RECE_QUEUE
 1056B DB83 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1057B DB85 0E75        	LAC	RECE_BUF12
 1058B DB86 858000FF    	ANDL	0X0FF
 1059B DB88 8480E000    	ORL	0XE000
 1060B DB8A B000        	SAH	CONF
 1061B DB8B FC000020    	CALL	DAM_BIOS
 1062B                  	
 1063B DB8D 0E77        	LAC	RECE_QUEUE
 1064B DB8E 0501        	SBHK	1
 1065B DB8F B077        	SAH	RECE_QUEUE
 1066B                  ;---byte 23---TEL NUM 16
 1067B DB90 0E77        	LAC	RECE_QUEUE
 1068B DB91 DB00DB9F    	BS	ACZ,TELNUM_WRITE_EXIT
 1069B DB93 0E75        	LAC	RECE_BUF12
 1070B DB94 9E08        	SFR	8
 1071B DB95 858000FF    	ANDL	0X0FF
 1072B DB97 8480E000    	ORL	0XE000
 1073B DB99 B000        	SAH	CONF
 1074B DB9A FC000020    	CALL	DAM_BIOS
 1075B                  	
 1076B DB9C 0E77        	LAC	RECE_QUEUE
 1077B DB9D 0501        	SBHK	1
 1078B DB9E B077        	SAH	RECE_QUEUE
 1079B                  
 1080B                  TELNUM_WRITE_EXIT:
 1081B DB9F 8780E100    	LACL	0XE100
 1082B DBA1 B000        	SAH	CONF
 1083B DBA2 FC000020    	CALL	DAM_BIOS
 1084B                  	
 1085B DBA4 FC00CAC9    	CALL	TEL_GC_CHK
 1086B                  	
 1087B DBA6 0F00        	LACK	0
 1088B                  	
 1089B DBA7 F800        	RET
 1090B                  ;############################################################################
 1091B                  ;
 1092B                  ;	Function : TMPNUM_DEL
 1093B                  ;	delete the telephone number in tempe working group
 1094B                  ;
 1095B                  ;	删除临时号码(退出ICM状态,或本地播放前)
 1096B                  ;	input  : RECE_BUF1 = the first addr of the TEL_NUM
 1097B                  ;	output : ACCH = no
 1098B                  ;	variable : SYSTMP
 1099B                  ;
 1100B                  ;############################################################################
 1101B                  TMPNUM_DEL:
 1102B DBA8 8780E605    	LACL	0XE605		;set the TEL working group 0
 1103B DBAA B000        	SAH	CONF
 1104B DBAB FC000020    	CALL	DAM_BIOS
 1105B                  	
 1106B DBAD 8780E401    	LACL	0XE401		;set the TEL working group 0
 1107B DBAF B000        	SAH	CONF
 1108B DBB0 FC000020    	CALL	DAM_BIOS
 1109B                  	
 1110B DBB2 0E01        	LAC	RESP
 1111B DBB3 DB00DBC6    	BS	ACZ,TMPNUM_DEL_END
 1112B DBB5 0101        	ADHK	1
 1113B DBB6 B064        	SAH	SYSTMP
 1114B                  TMPNUM_DEL_LOOP:
 1115B DBB7 0E64        	LAC	SYSTMP
 1116B DBB8 0501        	SBHK	1
 1117B DBB9 B064        	SAH	SYSTMP
 1118B DBBA DB00DBC6    	BS	ACZ,TMPNUM_DEL_END	
 1119B                  	
 1120B DBBC 8780E500    	LACL	0XE500
 1121B DBBE 0864        	OR	SYSTMP
 1122B DBBF B000        	SAH	CONF
 1123B DBC0 FC000020    	CALL	DAM_BIOS
 1124B                  	
 1125B DBC2 FC00CAC9    	CALL	TEL_GC_CHK
 1126B DBC4 DF00DBB7    	BS	B1,TMPNUM_DEL_LOOP
 1127B                  TMPNUM_DEL_END:
 1128B                  		
 1129B DBC6 F800        	RET
 1130B                  ;############################################################################
 1131B                  ;
 1132B                  ;	Function : COL_ICMTEL
 1133B                  ;	delete the telephone number in tempe working group
 1134B                  ;
 1135B                  ;	建立ICM录音与来电号码的关联(ICM录音成功后)
 1136B                  ;	input  : ACCH = USER DATA0
 1137B                  ;	output : no
 1138B                  ;	variable : SYSTMP
 1139B                  ;
 1140B                  ;############################################################################
 1141B                  COL_ICMTEL:
 1142B DBC7 B064        	SAH	SYSTMP
 1143B                  	
 1144B DBC8 8780E605    	LACL	0XE605		;置当前GROUP = 5
 1145B DBCA B000        	SAH	CONF
 1146B DBCB FC000020    	CALL	DAM_BIOS
 1147B                  	
 1148B DBCD 0F00        	LACK	0		;以下将group(5)中的最新号码,复制到group(0)
 1149B DBCE B007        	SAH	BUF1		
 1150B                  	
 1151B DBCF FC00DC09    	CALL	GET_TELT
 1152B DBD1 DB00DBEA    	BS	ACZ,COL_ICMTEL_END	;无临时号码退出
 1153B DBD3 8480ED00    	ORL	0XED00
 1154B DBD5 B000        	SAH	CONF
 1155B DBD6 FC000020    	CALL	DAM_BIOS
 1156B                  	
 1157B DBD8 8780E600    	LACL	0XE600		;置当前GROUP = 0
 1158B DBDA B000        	SAH	CONF
 1159B DBDB FC000020    	CALL	DAM_BIOS
 1160B                  	
 1161B DBDD 0E64        	LAC	SYSTMP		;以下将group(0)中的最新号码置index-0 = SYSTMP
 1162B DBDE B007        	SAH	BUF1
 1163B                  	
 1164B DBDF FC00DC09    	CALL	GET_TELT
 1165B DBE1 DB00DBEA    	BS	ACZ,COL_ICMTEL_END
 1166B DBE3 8480E700    	ORL	0XE700
 1167B DBE5 B000        	SAH	CONF
 1168B DBE6 FC000020    	CALL	DAM_BIOS
 1169B                  	
 1170B DBE8 FC00CAC9    	CALL	TEL_GC_CHK
 1171B                  	
 1172B                  COL_ICMTEL_END:
 1173B                  		
 1174B DBEA F800        	RET
 1175B                  	
 1176B                  ;############################################################################
 1177B                  ;	FUNCTION : GET_TELID
 1178B                  ;	根据index-0找TEL_ID
 1179B                  ;	INPUT : ACCH = index-0
 1180B                  ;	OUTPUT: ACCH = MSG_ID(0表示没找到)
 1181B                  ;	
 1182B                  ;	variable : SYSTMP0
 1183B                  ;		   SYSTMP1
 1184B                  ;############################################################################
 1185B                  .IF	TEXT_0XE900
 1186B                  GET_TELID:
 1187B                  	SAH	SYSTMP0
 1188B                  	
 1189B                  	LACL	0XE600
 1190B                  	SAH	CONF
 1191B                  	CALL	DAM_BIOS
 1192B                  	
 1193B                  	LAC	SYSTMP0
 1194B                  	ANDL	0XFF
 1195B                  	ORL	0XE900
 1196B                  	SAH	CONF
 1197B                  	CALL	DAM_BIOS
 1198B                  	LAC	RESP
 1199B                  	SFR	8
 1200B                  	BZ	ACZ,GET_TELID1
 1201B                  	LAC	RESP
 1202B                  	RET
 1203B                  GET_TELID1:
 1204B                  	LACK	0
 1205B                  	RET
 1206B                  .ELSE
 1207B                  GET_TELID:
 1208B DBEB B05E        	SAH	SYSTMP0
 1209B                  	
 1210B DBEC 8780E600    	LACL	0XE600
 1211B DBEE B000        	SAH	CONF
 1212B DBEF FC000020    	CALL	DAM_BIOS
 1213B                  	
 1214B DBF1 FC00DC09    	CALL	GET_TELT
 1215B DBF3 B05F        	SAH	SYSTMP1
 1216B                  GET_TELID1:
 1217B DBF4 0E5F        	LAC	SYSTMP1
 1218B DBF5 DB00DC08    	BS	ACZ,GET_TELID_END
 1219B DBF7 858000FF    	ANDL	0XFF
 1220B DBF9 8480EA00    	ORL	0XEA00
 1221B DBFB B000        	SAH	CONF
 1222B DBFC FC000020    	CALL	DAM_BIOS
 1223B                  	
 1224B DBFE 0E01        	LAC	RESP
 1225B DBFF 045E        	SBH	SYSTMP0
 1226B DC00 DB00DC07    	BS	ACZ,GET_TELID2
 1227B DC02 0E5F        	LAC	SYSTMP1
 1228B DC03 0501        	SBHK	1
 1229B DC04 B05F        	SAH	SYSTMP1
 1230B DC05 DF00DBF4    	BS	B1,GET_TELID1
 1231B                  GET_TELID2:
 1232B DC07 0E5F        	LAC	SYSTMP1
 1233B                  GET_TELID_END:
 1234B DC08 F800        	RET
 1235B                  .ENDIF
 1236B                  
 1237B                  ;---------------上面是AXC用到的,下面是m48要用的??????????????????????????????
 1238B                  ;############################################################################
 1239B                  ;	FUNCTION : GET_TELT
 1240B                  ;	INPUT : NO
 1241B                  ;	OUTPUT: ACCH
 1242B                  ;############################################################################
 1243B                  GET_TELT:
 1244B DC09 8780E401    	LACL	0XE401
 1245B DC0B B000        	SAH	CONF
 1246B DC0C FC000020    	CALL	DAM_BIOS
 1247B                  	
 1248B DC0E 0E01        	LAC	RESP
 1249B DC0F 0B7F        	ANDK	0X7F
 1250B                  	
 1251B DC10 F800        	RET
 1252B                  
 1253B                  ;############################################################################
 1254B                  ;	FUNCTION : GET_FILEID
 1255B                  ;	找一个可用的FILE_ID,用于录音前设usr_dat0
 1256B                  ;	INPUT : no
 1257B                  ;	OUTPUT: ACCH/FILE_ID
 1258B                  ;############################################################################
 1259B                  GET_FILEID:
 1260B DC11 FC00D309    	CALL	SET_FGTABLE
 1261B                  	
 1262B DC13 FC00D330    	CALL	SERACH_USEID
 1263B                  	
 1264B DC15 F800        	RET
 1265B                  ;############################################################################
 1266B                  ;	FUNCTION : SET_USRDAT
 1267B                  ;	INPUT : ACCH = USER INDEX DATA0
 1268B                  ;	OUTPUT: NO
 1269B                  ;############################################################################
 1270B                  SET_USRDAT:
 1271B DC16 858000FF    	ANDL	0XFF
 1272B DC18 84807500    	ORL	0X7500
 1273B DC1A B000        	SAH	CONF
 1274B DC1B FC000020    	CALL	DAM_BIOS
 1275B                  	
 1276B DC1D F800        	RET
 1277B                  ;############################################################################
 1278B                  ;	FUNCTION : GET_USRDAT
 1279B                  ;	INPUT : ACCH = MSG_ID
 1280B                  ;	OUTPUT: ACCH = USER INDEX DATA0
 1281B                  ;############################################################################
 1282B                  GET_USRDAT:
 1283B DC1E 858000FF    	ANDL	0XFF
 1284B DC20 8480A900    	ORL	0XA900
 1285B DC22 B000        	SAH	CONF
 1286B DC23 FC000020    	CALL	DAM_BIOS
 1287B                  	
 1288B DC25 0E01        	LAC	RESP
 1289B                  	
 1290B DC26 F800        	RET
 1291B                  ;############################################################################
 1292B                  ;	FUNCTION : GET_VPLEN
 1293B                  ;	将与MSG_ID的USER-DATA0相同的VP全部找出,以FILE_ID(MSG_ID)为基址,以FILE_LEN为长度返回
 1294B                  ;	INPUT : ACCH = MSG_ID(输入的MSG_ID是USER-DATA0相同所有值的最大值)
 1295B                  ;	OUTPUT: MSG_ID = FILE_ID(由相同的USR-DATA0最大值变成相同的USR-DATA0的MSG_ID最小的值)
 1296B                  ;		FILE_LEN(本次相同USE_DAT的VP条目数-1)
 1297B                  ;############################################################################
 1298B                  GET_VPLEN:
 1299B DC27 B014        	SAH	MSG_ID
 1300B DC28 FC00DC1E    	CALL	GET_USRDAT
 1301B DC2A B017        	SAH	FILE_ID
 1302B                  	
 1303B DC2B 0F00        	LACK	0
 1304B DC2C B03C        	SAH	FILE_LEN
 1305B                  GET_VPLEN_LOOP:
 1306B DC2D 0E3C        	LAC	FILE_LEN
 1307B DC2E 0101        	ADHK	1
 1308B DC2F B03C        	SAH	FILE_LEN
 1309B                  	
 1310B DC30 0E14        	LAC	MSG_ID
 1311B DC31 0501        	SBHK	1
 1312B DC32 B014        	SAH	MSG_ID
 1313B DC33 DB00DC3A    	BS	ACZ,GET_VPLEN_1
 1314B DC35 FC00DC1E    	CALL	GET_USRDAT
 1315B DC37 0417        	SBH	FILE_ID
 1316B DC38 DB00DC2D    	BS	ACZ,GET_VPLEN_LOOP
 1317B                  GET_VPLEN_1:
 1318B DC3A 0E14        	LAC	MSG_ID
 1319B DC3B 0101        	ADHK	1
 1320B DC3C B014        	SAH	MSG_ID
 1321B DC3D B017        	SAH	FILE_ID
 1322B                  	
 1323B DC3E 0E3C        	LAC	FILE_LEN
 1324B DC3F 0501        	SBHK	1
 1325B DC40 B03C        	SAH	FILE_LEN
 1326B                  GET_VPLEN_END:
 1327B DC41 F800        	RET
 1328B                  ;############################################################################
 1329B                  ;	FUNCTION : GET_RVPLEN
 1330B                  ;	将与MSG_ID的USER-DATA0相同的VP全部找出,以FILE_ID(MSG_ID)为基址,以FILE_LEN为长度返回
 1331B                  ;	INPUT : ACCH = MSG_ID(输入的MSG_ID是USER-DATA0相同所有值的最小值)
 1332B                  ;	OUTPUT: MSG_ID = FILE_ID(MSG_ID保持为USER-DATA0相同最小的值)
 1333B                  ;		FILE_LEN(本次相同USE_DAT的VP条目数-1)
 1334B                  ;############################################################################
 1335B                  GET_RVPLEN:
 1336B DC42 B014        	SAH	MSG_ID
 1337B DC43 FC00DC1E    	CALL	GET_USRDAT
 1338B DC45 B017        	SAH	FILE_ID
 1339B                  	
 1340B DC46 0F00        	LACK	0
 1341B DC47 B03C        	SAH	FILE_LEN
 1342B                  GET_RVPLEN_LOOP:
 1343B DC48 0E3C        	LAC	FILE_LEN
 1344B DC49 0101        	ADHK	1
 1345B DC4A B03C        	SAH	FILE_LEN
 1346B                  	
 1347B DC4B 0E14        	LAC	MSG_ID
 1348B DC4C 003C        	ADH	FILE_LEN
 1349B DC4D FC00DC1E    	CALL	GET_USRDAT
 1350B DC4F 0417        	SBH	FILE_ID
 1351B DC50 DB00DC48    	BS	ACZ,GET_RVPLEN_LOOP
 1352B                  
 1353B DC52 0E14        	LAC	MSG_ID
 1354B DC53 B017        	SAH	FILE_ID
 1355B                  	
 1356B DC54 0E3C        	LAC	FILE_LEN
 1357B DC55 0501        	SBHK	1
 1358B DC56 B03C        	SAH	FILE_LEN
 1359B                  GET_RVPLEN_END:
 1360B DC57 F800        	RET
 1361B                  ;############################################################################
 1362B                  ;	FUNCTION : GET_VPMSG
 1363B                  ;	将与MSG_ID的USER-DATA0相同的录音按id号由小到大(MSG_ID..MSG_ID+FILE_LEN)的顺序入队列
 1364B                  ;	INPUT : FLIE_LEN
 1365B                  ;		FILE_ID(first VP)     
 1366B                  ;	OUTPUT: NO
 1367B                  ;############################################################################
 1368B                  GET_VPMSG:
 1369B DC58 0F00        	LACK	0
 1370B DC59 B015        	SAH	MSG_N		;已入队列的条数
 1371B                  GET_VPMSG_1:
 1372B DC5A 0E3C        	LAC	FILE_LEN
 1373B DC5B 0415        	SBH	MSG_N
 1374B DC5C DD00DC69    	BS	SGN,GET_VPMSG_END
 1375B                  
 1376B DC5E 0E17        	LAC	FILE_ID		;message(record)
 1377B DC5F 0015        	ADH	MSG_N
 1378B DC60 8480FE00    	ORL	0XFE00
 1379B DC62 FC00CC52    	CALL	STOR_VP
 1380B                  	
 1381B DC64 0E15        	LAC	MSG_N
 1382B DC65 0101        	ADHK	1
 1383B DC66 B015        	SAH	MSG_N
 1384B DC67 DF00DC5A    	BS	B1,GET_VPMSG_1
 1385B                  GET_VPMSG_END:
 1386B DC69 F800        	RET
 1387B                  ;############################################################################
 1388B                  ;	FUNCTION : DEL_VPMSG
 1389B                  ;	将与MSG_ID的USER-DATA0相同的录音按id号由小到大(MSG_ID..MSG_ID+FILE_LEN)的顺序置删除标志
 1390B                  ;	INPUT : FLIE_LEN
 1391B                  ;		FILE_ID(first MSG_ID of VP)     
 1392B                  ;	OUTPUT: NO
 1393B                  ;############################################################################
 1394B                  DEL_VPMSG:
 1395B DC6A 0F00        	LACK	0
 1396B DC6B B015        	SAH	MSG_N		;已处理的条数
 1397B                  DEL_VPMSG_1:
 1398B DC6C 0E3C        	LAC	FILE_LEN
 1399B DC6D 0415        	SBH	MSG_N
 1400B DC6E DD00DC7D    	BS	SGN,DEL_VPMSG_END
 1401B                  	
 1402B DC70 0E17        	LAC	FILE_ID		;message(record)
 1403B DC71 0015        	ADH	MSG_N
 1404B DC72 0B7F        	ANDK	0X7F
 1405B DC73 84802080    	ORL	0X2080
 1406B DC75 B000        	SAH	CONF
 1407B DC76 FC000020    	CALL	DAM_BIOS
 1408B                  	
 1409B DC78 0E15        	LAC	MSG_N
 1410B DC79 0101        	ADHK	1
 1411B DC7A B015        	SAH	MSG_N
 1412B DC7B DF00DC6C    	BS	B1,DEL_VPMSG_1
 1413B                  DEL_VPMSG_END:
 1414B DC7D F800        	RET
 1415B                  ;############################################################################
 1416B                  ;	FUNCTION : SETOLD_VPMSG
 1417B                  ;	将与MSG_ID的USER-DATA0相同的录音按id号由小到大(MSG_ID..MSG_ID+FILE_LEN)的播放后停止
 1418B                  ;	INPUT : FLIE_LEN
 1419B                  ;		FILE_ID(first MSG_ID of VP)     
 1420B                  ;	OUTPUT: NO
 1421B                  ;############################################################################
 1422B                  SETOLD_VPMSG:
 1423B DC7E 0F00        	LACK	0
 1424B DC7F B015        	SAH	MSG_N		;已处理的条数
 1425B                  SETOLD_VPMSG_1:
 1426B DC80 0E3C        	LAC	FILE_LEN
 1427B DC81 0415        	SBH	MSG_N
 1428B DC82 DD00DC9B    	BS	SGN,SETOLD_VPMSG_END
 1429B                  	
 1430B DC84 0E17        	LAC	FILE_ID		;message(record)
 1431B DC85 0015        	ADH	MSG_N
 1432B DC86 8580007F    	ANDL	0X7F
 1433B DC88 84802000    	ORL	0X2000
 1434B DC8A B000        	SAH	CONF
 1435B DC8B FC000020    	CALL	DAM_BIOS
 1436B                  	
 1437B DC8D 0E17        	LAC	FILE_ID		;message(record)
 1438B DC8E 0015        	ADH	MSG_N
 1439B DC8F 8580007F    	ANDL	0X7F
 1440B DC91 84802200    	ORL	0X2200
 1441B DC93 B000        	SAH	CONF
 1442B DC94 FC000020    	CALL	DAM_BIOS
 1443B                  	
 1444B DC96 0E15        	LAC	MSG_N
 1445B DC97 0101        	ADHK	1
 1446B DC98 B015        	SAH	MSG_N
 1447B DC99 DF00DC80    	BS	B1,SETOLD_VPMSG_1
 1448B                  SETOLD_VPMSG_END:
 1449B DC9B F800        	RET	
 1450B                  .END
 1193A                  .INCLUDE test.asm
    1B                  .LIST
    2B                  TEST_STATE:
    3B DC9C 0E3E        	LAC	PRO_VAR
    4B DC9D 0B0F        	ANDK	0X0F
    5B DC9E DB00DCB6    	BS	ACZ,TEST_PRO0	;idel
    6B DCA0 0501        	SBHK	1
    7B DCA1 DB00DCC5    	BS	ACZ,TEST_PRO1	;idel
    8B DCA3 0501        	SBHK	1
    9B DCA4 DB00DCDC    	BS	ACZ,TEST_PRO2	;ICM record
   10B DCA6 0501        	SBHK	1
   11B DCA7 DB00DD13    	BS	ACZ,TEST_PRO3	;remote play
   12B DCA9 0501        	SBHK	1
   13B DCAA DB00DD9A    	BS	ACZ,TEST_PRO4	;mome record
   14B DCAC 0501        	SBHK	1
   15B DCAD DB00DDD8    	BS	ACZ,TEST_PRO5	;local	play
   16B DCAF 0501        	SBHK	1
   17B DCB0 DB00DE55    	BS	ACZ,TEST_PRO6	;vox detect
   18B DCB2 0501        	SBHK	1
   19B DCB3 DB00DE85    	BS	ACZ,TEST_PRO7	;cpc detect
   20B                  
   21B DCB5 F800        	RET
   22B                  ;======================================================消息生成区
   23B                  TEST_PRO0:	;进入TEST状态要考虑的消息
   24B DCB6 0E3D        	LAC	MSG
   25B DCB7 868000B3    	XORL	CMSG_TEST
   26B DCB9 DB00DCBC    	BS	ACZ,TEST_PRO0_1
   27B                  	
   28B DCBB F800        	RET
   29B                  TEST_PRO0_1:
   30B DCBC FC00C165    	CALL	DAA_SPK
   31B DCBE 87803C20    	LACL	0X3C20			;beep(initial)
   32B DCC0 FC00CC52    	CALL	STOR_VP
   33B                  	;LACL	1		;new
   34B                  	;ORL	0XFF00
   35B                  	;CALL	STOR_VP
   36B                  	
   37B DCC2 0F01        	LACK	1
   38B DCC3 B03E        	SAH	PRO_VAR
   39B                  	
   40B DCC4 F800        	RET
   41B                  ;-----------------------------------------------------------
   42B                  TEST_PRO1:
   43B DCC5 0E3D        	LAC	MSG
   44B DCC6 868000B3    	XORL	CMSG_TEST
   45B DCC8 DB00DCD0    	BS	ACZ,TEST_PRO1_0_0
   46B                  TEST_PRO1_0:		;空闲状态要考虑的消息:
   47B DCCA 0E3D        	LAC	MSG
   48B DCCB 868000B0    	XORL	CVP_STOP
   49B DCCD DB00DCDB    	BS	ACZ,TEST_PRO1_1_0
   50B                  	
   51B DCCF F800        	RET
   52B                  	
   53B                  TEST_PRO1_0_0:
   54B DCD0 FC00CA4B    	CALL	INIT_DAM_FUNC
   55B DCD2 FC00C165    	CALL	DAA_SPK
   56B DCD4 87803C20    	LACL	0X3C20		;beep(initial)
   57B DCD6 FC00CC52    	CALL	STOR_VP
   58B                  	;LACL	2		;2
   59B                  	;ORL	0XFF00
   60B                  	;CALL	STOR_VP
   61B                  	
   62B DCD8 0F02        	LACK	2
   63B DCD9 B03E        	SAH	PRO_VAR	
   64B                  	
   65B DCDA F800        	RET
   66B                  	
   67B                  	
   68B                  TEST_PRO1_1_0:
   69B                  
   70B DCDB F800        	RET
   71B                  ;-----------------------------------------------------------
   72B                  TEST_PRO2:	;TEST ICM RECORD状态要考虑的消息
   73B DCDC 0E3D        	LAC	MSG
   74B DCDD 868000B3    	XORL	CMSG_TEST
   75B DCDF DB00DCEC    	BS	ACZ,TEST_PRO2_1
   76B                  TEST_PRO2_0_0:
   77B DCE1 0E3D        	LAC	MSG
   78B DCE2 868000B2    	XORL	CREC_FULL		;REC_FULL
   79B DCE4 DB00DD10    	BS	ACZ,TEST_PRO2_4
   80B                  TEST_PRO2_0_1:
   81B DCE6 0E3D        	LAC	MSG
   82B DCE7 868000B0    	XORL	CVP_STOP
   83B DCE9 DB00DCFB    	BS	ACZ,TEST_PRO2_2
   84B                  		
   85B DCEB F800        	RET
   86B                  TEST_PRO2_1:
   87B DCEC 0E00        	LAC	CONF
   88B DCED 8580F000    	ANDL	0XF000
   89B DCEF B000        	SAH	CONF
   90B DCF0 FC00CA4B    	CALL	INIT_DAM_FUNC
   91B DCF2 FC00C165    	CALL	DAA_SPK
   92B DCF4 87803C20    	LACL	0X3C20			;beep(initial)
   93B DCF6 FC00CC52    	CALL	STOR_VP
   94B                  	;LACK	3		;3
   95B                  	;ORL	0XFF00
   96B                  	;CALL	STOR_VP
   97B                  	
   98B DCF8 0F03        	LACK	3
   99B DCF9 B03E        	SAH	PRO_VAR	
  100B                  	
  101B DCFA F800        	RET
  102B                  	
  103B                  TEST_PRO2_2:		;TEST ICM RECORD状态
  104B DCFB FC00CA4B    	CALL	INIT_DAM_FUNC
  105B DCFD FC00C197    	CALL	DAA_ICM_RECORD
  106B DCFF FC00C1CA    	CALL	HOOK_ON
  107B                  	
  108B DD01 FC00C108    	CALL	MSG_CHK
  109B DD03 FC00DC11    	CALL	GET_FILEID
  110B DD05 FC00DC16    	CALL	SET_USRDAT
  111B                  
  112B DD07 0F00        	LACK	0
  113B DD08 B03F        	SAH	PRO_VAR1
  114B DD09 878003E8    	LACL	1000
  115B DD0B FC00C1D6    	CALL	SET_TIMER
  116B                  
  117B DD0D FC00CA8A    	CALL	REC_START
  118B                  	
  119B DD0F F800        	RET
  120B                  
  121B                  TEST_PRO2_4:
  122B DD10 FC00CA4B    	CALL	INIT_DAM_FUNC
  123B                  	
  124B DD12 F800        	RET
  125B                  ;-----------------------------------------------------------
  126B                  TEST_PRO3:	;TEST REMOTE PLAY状态要考虑的消息
  127B DD13 0E3E        	LAC	PRO_VAR
  128B DD14 9E04        	SFR	4
  129B DD15 0B0F        	ANDK	0X0F
  130B DD16 DB00DD27    	BS	ACZ,TEST_PRO3_0_3
  131B DD18 0501        	SBHK	1
  132B DD19 DB00DD1C    	BS	ACZ,TEST_PRO3_0_1
  133B                  	
  134B DD1B F800        	RET
  135B                  ;---
  136B                  TEST_PRO3_0_1:
  137B DD1C 0E3D        	LAC	MSG
  138B DD1D 868000B0    	XORL	CVP_STOP
  139B DD1F DB00DD69    	BS	ACZ,TEST_PRO3_4
  140B                  TEST_PRO3_0_2:
  141B DD21 0E3D        	LAC	MSG
  142B DD22 868000B3    	XORL	CMSG_TEST
  143B DD24 DB00DD2D    	BS	ACZ,TEST_PRO3_2
  144B                  	
  145B DD26 F800        	RET
  146B                  TEST_PRO3_0_3:
  147B DD27 0E3D        	LAC	MSG
  148B DD28 868000B0    	XORL	CVP_STOP
  149B DD2A DB00DD3A    	BS	ACZ,TEST_PRO3_3
  150B                  
  151B                  	
  152B DD2C F800        	RET
  153B                  ;---
  154B                  
  155B                  TEST_PRO3_2:	;进入TEST MEMO RECORD
  156B DD2D FC00C1CD    	CALL	HOOK_OFF
  157B DD2F FC00CA4B    	CALL	INIT_DAM_FUNC
  158B DD31 FC00C165    	CALL	DAA_SPK
  159B DD33 87803C20    	LACL	0X3C20			;beep(initial)
  160B DD35 FC00CC52    	CALL	STOR_VP
  161B                  	;LACL	4		;4
  162B                  	;ORL	0XFF00
  163B                  	;CALL	STOR_VP
  164B                  	
  165B DD37 0F04        	LACK	4
  166B DD38 B03E        	SAH	PRO_VAR	
  167B                  	
  168B                  	
  169B DD39 F800        	RET
  170B                  TEST_PRO3_3:		;正式进入TEST REMOTE PLAY	
  171B DD3A 0F00        	LACK	0
  172B DD3B B03F        	SAH	PRO_VAR1
  173B DD3C 878003E8    	LACL	1000
  174B DD3E FC00C1D6    	CALL	SET_TIMER
  175B                  	
  176B DD40 0F13        	LACK	0X013
  177B DD41 B03E        	SAH	PRO_VAR
  178B                  
  179B DD42 FC00CA4B    	CALL	INIT_DAM_FUNC
  180B DD44 FC00C189    	CALL	DAA_LIN_RECORD
  181B DD46 FC00C1CA    	CALL	HOOK_ON
  182B                  
  183B DD48 FC00C108    	CALL	MSG_CHK
  184B DD4A 0E16        	LAC	MSG_T
  185B DD4B 0101        	ADHK	1
  186B DD4C B014        	SAH	MSG_ID
  187B                  	
  188B DD4D 6E11        	BIT	ANN_FG,14
  189B DD4E DA00DD64    	BS	TB,TEST_PRO3_3_1
  190B                  	
  191B DD50 87803010    	LACL	0X3010
  192B DD52 FC00CC52    	CALL	STOR_VP
  193B DD54 87800005    	LACL	0X005
  194B DD56 FC00CC52    	CALL	STOR_VP
  195B DD58 87803010    	LACL	0X3010
  196B DD5A FC00CC52    	CALL	STOR_VP
  197B DD5C 87800005    	LACL	0X005
  198B DD5E FC00CC52    	CALL	STOR_VP
  199B DD60 87803010    	LACL	0X3010
  200B DD62 FC00CC52    	CALL	STOR_VP
  201B                  TEST_PRO3_3_1:
  202B DD64 87800005    	LACL	0X005
  203B DD66 FC00CC52    	CALL	STOR_VP
  204B                  
  205B DD68 F800        	RET
  206B                  	
  207B                  TEST_PRO3_4:		;进入TEST REMOTE PLAY(next)状态
  208B DD69 0E14        	LAC	MSG_ID
  209B DD6A 858000FF    	ANDL	0X0FF
  210B DD6C 0501        	SBHK	1
  211B DD6D DB00DD82    	BS	ACZ,TEST_PRO3_4_1
  212B DD6F DD00DD82    	BS	SGN,TEST_PRO3_4_1
  213B                  	
  214B DD71 0E14        	LAC	MSG_ID			;next message
  215B DD72 0501        	SBHK	1
  216B DD73 B014        	SAH	MSG_ID
  217B                  
  218B DD74 87800025    	LACL	0X025
  219B DD76 FC00CC52    	CALL	STOR_VP
  220B DD78 87803010    	LACL	0X3010
  221B DD7A FC00CC52    	CALL	STOR_VP
  222B                  
  223B DD7C 0E14        	LAC	MSG_ID
  224B DD7D FC00DC27    	CALL	GET_VPLEN
  225B DD7F FC00DC58    	CALL	GET_VPMSG
  226B                  
  227B DD81 F800        	RET
  228B                  TEST_PRO3_4_1:
  229B DD82 FC00CA4B    	CALL	INIT_DAM_FUNC
  230B DD84 FC00DC7E    	CALL	SETOLD_VPMSG
  231B                  	
  232B DD86 87806100    	LACL	0X6100
  233B DD88 B000        	SAH	CONF
  234B DD89 FC000020    	CALL	DAM_BIOS
  235B                  
  236B DD8B 87803010    	LACL	0X3010
  237B DD8D FC00CC52    	CALL	STOR_VP
  238B DD8F 87800005    	LACL	0X005
  239B DD91 FC00CC52    	CALL	STOR_VP
  240B DD93 87803010    	LACL	0X3010
  241B DD95 FC00CC52    	CALL	STOR_VP
  242B                  	
  243B DD97 0F23        	LACK	0X023
  244B DD98 B03E        	SAH	PRO_VAR
  245B                  	
  246B DD99 F800        	RET
  247B                  ;-----------------------------------------------------------
  248B                  TEST_PRO4:	;TEST RECORD MEMO状态要考虑的消息
  249B DD9A 0E3D        	LAC	MSG
  250B DD9B 868000B3    	XORL	CMSG_TEST
  251B DD9D DB00DDBF    	BS	ACZ,TEST_PRO4_2
  252B                  TEST_PRO4_0:
  253B DD9F 0E3D        	LAC	MSG
  254B DDA0 868000B2    	XORL	CREC_FULL		;REC_FULL
  255B DDA2 DB00DDCE    	BS	ACZ,TEST_PRO4_0_0
  256B                  TEST_PRO4_0_1:	
  257B DDA4 0E3D        	LAC	MSG
  258B DDA5 868000B0    	XORL	CVP_STOP
  259B DDA7 DB00DDAA    	BS	ACZ,TEST_PRO4_3
  260B                  	
  261B DDA9 F800        	RET
  262B                  
  263B                  TEST_PRO4_3:
  264B DDAA FC00CA4B    	CALL	INIT_DAM_FUNC
  265B DDAC FC00C180    	CALL	DAA_RECORD
  266B DDAE FC00C1CD    	CALL	HOOK_OFF
  267B                  
  268B DDB0 FC00C108    	CALL	MSG_CHK
  269B DDB2 FC00DC11    	CALL	GET_FILEID
  270B DDB4 FC00DC16    	CALL	SET_USRDAT
  271B                  
  272B DDB6 0F00        	LACK	0
  273B DDB7 B03F        	SAH	PRO_VAR1
  274B DDB8 878003E8    	LACL	1000
  275B DDBA FC00C1D6    	CALL	SET_TIMER
  276B                  
  277B DDBC FC00CA8A    	CALL	REC_START
  278B                  	
  279B DDBE F800        	RET
  280B                  
  281B                  TEST_PRO4_2:
  282B DDBF 0E00        	LAC	CONF
  283B DDC0 8580F000    	ANDL	0XF000
  284B DDC2 B000        	SAH	CONF
  285B DDC3 FC00CA4B    	CALL	INIT_DAM_FUNC
  286B DDC5 FC00C165    	CALL	DAA_SPK
  287B DDC7 87803C20    	LACL	0X3C20			;beep(initial)
  288B DDC9 FC00CC52    	CALL	STOR_VP
  289B                  	;LACL	5		;5
  290B                  	;ORL	0XFF00
  291B                  	;CALL	STOR_VP
  292B                  	
  293B DDCB 0F05        	LACK	5
  294B DDCC B03E        	SAH	PRO_VAR	
  295B                  
  296B DDCD F800        	RET
  297B                  
  298B                  TEST_PRO4_0_0:
  299B DDCE FC00CA4B    	CALL	INIT_DAM_FUNC
  300B                  	
  301B DDD0 FC00C108    	CALL	MSG_CHK
  302B DDD2 6D11        	BIT	ANN_FG,13
  303B DDD3 DA00DDD7    	BS	TB,TEST_PRO4_0_0_1
  304B                  	
  305B DDD5 FC00CA8A    	CALL	REC_START
  306B                  TEST_PRO4_0_0_1:
  307B                  		
  308B DDD7 F800        	RET
  309B                  ;-----------------------------------------------------------
  310B                  TEST_PRO5:	;TEST LOCAL PLAY状态要考虑的消息
  311B DDD8 0E3E        	LAC	PRO_VAR
  312B DDD9 9E04        	SFR	4
  313B DDDA 0B0F        	ANDK	0X0F
  314B DDDB DB00DDEC    	BS	ACZ,TEST_PRO5_0_3
  315B DDDD 0501        	SBHK	1
  316B DDDE DB00DDE1    	BS	ACZ,TEST_PRO5_0_0
  317B                  	
  318B DDE0 F800        	RET
  319B                  	
  320B                  TEST_PRO5_0_0:	
  321B DDE1 0E3D        	LAC	MSG
  322B DDE2 868000B3    	XORL	CMSG_TEST
  323B DDE4 DB00DE19    	BS	ACZ,TEST_PRO5_3
  324B                  TEST_PRO5_0_1:
  325B DDE6 0E3D        	LAC	MSG
  326B DDE7 868000B0    	XORL	CVP_STOP
  327B DDE9 DB00DE24    	BS	ACZ,TEST_PRO5_2
  328B                  		
  329B DDEB F800        	RET
  330B                  
  331B                  TEST_PRO5_0_3:
  332B DDEC 0E3D        	LAC	MSG
  333B DDED 868000B0    	XORL	CVP_STOP
  334B DDEF DB00DDF2    	BS	ACZ,TEST_PRO5_1_1
  335B                  	
  336B DDF1 F800        	RET
  337B                  TEST_PRO5_1_1:			;正式开始
  338B DDF2 FC00CA4B    	CALL	INIT_DAM_FUNC
  339B DDF4 FC00C165    	CALL	DAA_SPK
  340B                  	
  341B DDF6 0F15        	LACK	0X015
  342B DDF7 B03E        	SAH	PRO_VAR
  343B                  
  344B DDF8 FC00C108    	CALL	MSG_CHK
  345B DDFA 0E16        	LAC	MSG_T
  346B DDFB 0101        	ADHK	1
  347B DDFC B014        	SAH	MSG_ID
  348B                  	
  349B DDFD 6E11        	BIT	ANN_FG,14
  350B DDFE DA00DE14    	BS	TB,TEST_PRO5_1_2
  351B                  	
  352B DE00 87803010    	LACL	0X3010
  353B DE02 FC00CC52    	CALL	STOR_VP
  354B DE04 87800005    	LACL	0X005
  355B DE06 FC00CC52    	CALL	STOR_VP
  356B DE08 87803010    	LACL	0X3010
  357B DE0A FC00CC52    	CALL	STOR_VP
  358B DE0C 87800005    	LACL	0X005
  359B DE0E FC00CC52    	CALL	STOR_VP
  360B DE10 87803010    	LACL	0X3010
  361B DE12 FC00CC52    	CALL	STOR_VP
  362B                  TEST_PRO5_1_2:
  363B DE14 87800005    	LACL	0X005
  364B DE16 FC00CC52    	CALL	STOR_VP
  365B                  
  366B DE18 F800        	RET
  367B                  TEST_PRO5_3:
  368B DE19 FC00CA4B    	CALL	INIT_DAM_FUNC
  369B DE1B FC00C165    	CALL	DAA_SPK
  370B DE1D 87803C20    	LACL	0X3C20			;beep(initial)
  371B DE1F FC00CC52    	CALL	STOR_VP
  372B                  	;LACL	6		;6
  373B                  	;ORL	0XFF00
  374B                  	;CALL	STOR_VP
  375B                  	
  376B DE21 0F06        	LACK	6
  377B DE22 B03E        	SAH	PRO_VAR	
  378B                  	
  379B DE23 F800        	RET
  380B                  
  381B                  TEST_PRO5_2:	
  382B DE24 0E14        	LAC	MSG_ID
  383B DE25 858000FF    	ANDL	0X0FF
  384B DE27 0501        	SBHK	1
  385B DE28 DB00DE3D    	BS	ACZ,TEST_PRO5_2_1
  386B DE2A DD00DE3D    	BS	SGN,TEST_PRO5_2_1
  387B                  	
  388B DE2C 0E14        	LAC	MSG_ID			;next message
  389B DE2D 0501        	SBHK	1
  390B DE2E B014        	SAH	MSG_ID
  391B                  
  392B DE2F 87800025    	LACL	0X025
  393B DE31 FC00CC52    	CALL	STOR_VP
  394B DE33 87803010    	LACL	0X3010
  395B DE35 FC00CC52    	CALL	STOR_VP
  396B                  
  397B DE37 0E14        	LAC	MSG_ID
  398B DE38 FC00DC27    	CALL	GET_VPLEN
  399B DE3A FC00DC58    	CALL	GET_VPMSG
  400B                  
  401B DE3C F800        	RET
  402B                  TEST_PRO5_2_1:
  403B DE3D FC00CA4B    	CALL	INIT_DAM_FUNC
  404B DE3F FC00DC7E    	CALL	SETOLD_VPMSG
  405B                  	
  406B DE41 0F25        	LACK	0X025
  407B DE42 B03E        	SAH	PRO_VAR
  408B                  	
  409B DE43 87806100    	LACL	0X6100
  410B DE45 B000        	SAH	CONF
  411B DE46 FC000020    	CALL	DAM_BIOS
  412B                  
  413B DE48 87803010    	LACL	0X3010
  414B DE4A FC00CC52    	CALL	STOR_VP
  415B DE4C 87800005    	LACL	0X005
  416B DE4E FC00CC52    	CALL	STOR_VP
  417B DE50 87803010    	LACL	0X3010
  418B DE52 FC00CC52    	CALL	STOR_VP
  419B                  	
  420B DE54 F800        	RET
  421B                  ;-----------------------------------------------------------
  422B                  TEST_PRO6:	;TEST CHECK VOX状态要考虑的消息
  423B DE55 0E3D        	LAC	MSG
  424B DE56 868000B3    	XORL	CMSG_TEST
  425B DE58 DB00DE60    	BS	ACZ,TEST_PRO6_1
  426B                  TEST_PRO6_0:	
  427B DE5A 0E3D        	LAC	MSG
  428B DE5B 868000B0    	XORL	CVP_STOP
  429B DE5D DB00DE6B    	BS	ACZ,TEST_PRO6_2
  430B                  	
  431B DE5F F800        	RET
  432B                  TEST_PRO6_1:	;进入TEST 并机
  433B DE60 FC00CA4B    	CALL	INIT_DAM_FUNC
  434B DE62 FC00C165    	CALL	DAA_SPK
  435B DE64 87803C20    	LACL	0X3C20			;beep(initial)
  436B DE66 FC00CC52    	CALL	STOR_VP
  437B                  	;LACK	7		;7
  438B                  	;ORL	0XFF00
  439B                  	;CALL	STOR_VP
  440B                  	
  441B DE68 0F07        	LACK	7
  442B DE69 B03E        	SAH	PRO_VAR	
  443B                  
  444B                  
  445B DE6A F800        	RET
  446B                  TEST_PRO6_2:	
  447B DE6B FC00CA4B    	CALL	INIT_DAM_FUNC
  448B DE6D FC00C189    	CALL	DAA_LIN_RECORD
  449B DE6F FC00C1CA    	CALL	HOOK_ON
  450B                  TEST_PRO6_2_0:
  451B DE71 FC00CA94    	CALL	LINE_START
  452B DE73 FC000020    	CALL	DAM_BIOS
  453B                  	
  454B DE75 6601        	BIT     RESP,6
  455B DE76 D200DE7C            BZ      TB,TEST_PRO6_2_1	;VOX LEVEL
  456B DE78 6D10                BIT	EVENT,13
  457B DE79 DA00DE71    	BS	TB,TEST_PRO6_2_0	;TEST KEY pressed?
  458B                  	
  459B                  	;LACK   10
  460B                          ;SAH	TMR_VOX
  461B                  	;CALL	INIT_DAM_FUNC
  462B                  
  463B DE7B F800        	RET
  464B                  TEST_PRO6_2_1:	
  465B DE7C FC00CA4B    	CALL	INIT_DAM_FUNC
  466B DE7E FC00C165    	CALL	DAA_SPK
  467B DE80 87803020    	LACL	0X3020
  468B DE82 FC00CC52    	CALL	STOR_VP
  469B                  	
  470B DE84 F800        	RET
  471B                  
  472B                  ;-----------------------------------------------------------
  473B                  TEST_PRO7:	;TEST CHECK 并机要考虑的消息
  474B DE85 0E3D        	LAC	MSG
  475B DE86 8680008B    	XORL	CMSG_CPC
  476B DE88 DB00DE9F    	BS	ACZ,TEST_PRO7_1	
  477B                  TEST_PRO7_0_0:
  478B DE8A 0E3D        	LAC	MSG			;接线后摘机(相当于CPC)
  479B DE8B 86800006    	XORL	CMSG_KEY6S
  480B DE8D DB00DE9F    	BS	ACZ,TEST_PRO7_1
  481B                  TEST_PRO7_0_1:	
  482B DE8F 0E3D        	LAC	MSG
  483B DE90 868000B3    	XORL	CMSG_TEST
  484B DE92 DB00DEC0    	BS	ACZ,TEST_PRO7_2
  485B                  TEST_PRO7_0_2:
  486B DE94 0E3D        	LAC	MSG
  487B DE95 868000B0    	XORL	CVP_STOP
  488B DE97 DB00DE9A    	BS	ACZ,TEST_PRO7_3
  489B                  	
  490B DE99 F800        	RET
  491B                  
  492B                  TEST_PRO7_3:
  493B DE9A FC00C1CA    	CALL	HOOK_ON
  494B DE9C FC00CA4B    	CALL	INIT_DAM_FUNC
  495B                  
  496B DE9E F800        	RET
  497B                  	
  498B                  TEST_PRO7_1:
  499B DE9F FC00CA4B    	CALL	INIT_DAM_FUNC
  500B DEA1 FC00C165    	CALL	DAA_SPK
  501B                  
  502B DEA3 87803020    	LACL	0X3020
  503B DEA5 FC00CC52    	CALL	STOR_VP
  504B DEA7 87800005    	LACL	0X005
  505B DEA9 FC00CC52    	CALL	STOR_VP
  506B DEAB 87803020    	LACL	0X3020
  507B DEAD FC00CC52    	CALL	STOR_VP	
  508B DEAF 87800005    	LACL	0X005
  509B DEB1 FC00CC52    	CALL	STOR_VP
  510B DEB3 87803020    	LACL	0X3020
  511B DEB5 FC00CC52    	CALL	STOR_VP
  512B DEB7 87800005    	LACL	0X005
  513B DEB9 FC00CC52    	CALL	STOR_VP
  514B DEBB 87803020    	LACL	0X3020
  515B DEBD FC00CC52    	CALL	STOR_VP		;BBBB
  516B                  	
  517B DEBF F800        	RET
  518B                  	
  519B                  TEST_PRO7_2:
  520B DEC0 FC00C165    	CALL	DAA_SPK
  521B DEC2 87801620    	LACL	0X1620			;beep(initial)
  522B DEC4 FC00CC52    	CALL	STOR_VP
  523B DEC6 87802020    	LACL	0X2020			;beep(initial)
  524B DEC8 FC00CC52    	CALL	STOR_VP
  525B DECA 87803020    	LACL	0X3020			;beep(initial)
  526B DECC FC00CC52    	CALL	STOR_VP
  527B DECE 87803920    	LACL	0X3920			;beep(initial)
  528B DED0 FC00CC52    	CALL	STOR_VP
  529B                  	
  530B DED2 0E3E        	LAC	PRO_VAR
  531B DED3 0101        	ADHK	1
  532B DED4 B03E        	SAH	PRO_VAR	
  533B                  	
  534B DED5 F800        	RET
  535B                  ;-----------------------------------------------------------	
  536B                  	
  537B                  
  538B                  .END
 1194A                  
 1195A                  .END
